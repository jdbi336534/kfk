function setInitChannelEvent(e){initChannelFun=e}function startInitChannel(){initChannelFun&&initChannelFun(),1==autoUploadFlag&&uploadPer++}function addFileToUploadQueues(e,t){if(null!=e){if(e.size<=0)return void alert("文件大小不能为空");if(e.pageSize>4096)return void alert("分包大小不能大于4kb");if(e.size>=104857600)return void alert("请不要上传大于100M的文件");uploads.push(e),e.uploadProcess=t,uploadPer<3&&startInitChannel()}}function startNext(e){if(1==autoUploadFlag&&!(null==uploads||null==e||uploads.length<1)){var t=uploads.shift();return e._fileInfo=t,null!=t?void setTimeout(function(){t.upload(e)},500):void 0}}function closeAllchannels(){if(!(null==channelist||channelist.length<1)){for(var e=0;e<channelist.length;e++)channelist[e].socket.readyState===WebSocket.OPEN&&channelist[e].close();uploadPer=0}}function getStringErrTip(e){var t="";switch(e){case EtcFileSdk.FAILED:t="上传或删除失败。请稍后再试。";break;case EtcFileSdk.DONE:t="上传或删除完成。";break;case EtcFileSdk.FILE_SIZE_ERROR:t="浏览器最大可上传100Mb。";break;case EtcFileSdk.FILE_NAME_LENTH_ERROR:t="文件名称长度错误,正确长度是0到128.";break;case EtcFileSdk.FILE_PAGE_SIZE_ERROR:t="分片大小错误,正确大小是1到1024*4.";break;case EtcFileSdk.FILE_GUID_LENTH_ERROR:t="文件ID长度错误，请使用1到32.";break;case EtcFileSdk.FILE_SAVE_FAIL:t="文件上传保存失败。";break;case EtcFileSdk.TIMEOUT:t="上传超时"}return t}function etcjs_file_channel(){this.connected=null,this.error=null,this.receive=null,this.socket=null,this.actionID=0,this.disposed=null,this.callBacks=new Object,this.queues=new Array,this.fileDeletedCallBack=null,this.fileUpLoadCallBack=null,this.fileUpLoadFailCallBack=null}function newGuid(){for(var e="",t=1;t<=32;t++){var n=Math.floor(16*Math.random()).toString(16);e+=n,8!=t&&12!=t&&16!=t&&20!=t||(e+="-")}return e}function etcjs_FileInfo(e,t){this.size=e.size,this.file=e,this.fileType=e.type,this.fileName=e.name,this.md5=e.md5,this.pageSize=t,this.pageIndex=0,this.pages=0,this.uploadError=null,this.uploadProcess=null,this.dataBuffer=null,this.uploadBytes=0,this.id=newGuid(),this.tag=Math.floor(65536*Math.random()).toString(16),this.loadCallBack=null,this.pages=Math.ceil(this.size/this.pageSize),this.status=0,this.initChannelCallback=null}function et_http(){}function getServer(e){var t=e.config,n=e.service;if(t){var r=t.appkey||"295f10ee-a2ce-472242",i=t.userid,s="5",o=Math.round((new Date).getTime()/1e3).toString(),a=s+n+o+hex_md5(r+o)+r+i;e.message=a,sendToLB(e)}}function decodeASCIIToInt(e){for(var t="",n=0;n<e.length;n++)t+=e.charCodeAt(n).toString(16);return 4==t.length&&parseInt(t[0],16)>=8&&(t="ffff"+t),parseInt(t,16)<<0}function timeoutRandom(e){return Math.round(60*Math.random())+e}function sendToLB(e){var t=!1,n=new WebSocket(e.config.balanceServer);n.onopen=function(t){n.send(e.message),e.cb({type:1,message:"onopen",event:t})},n.onmessage=function(r){var i=decode64(r.data);if(""!=i){if(r.flag=i.substr(0,2),r.version=decodeASCIIToInt(i.substr(2,1)),r.bodylen=decodeASCIIToInt(i.substr(3,2)),r.bodylen<0){var s="";r.bodylen==-1?s="协议非法":r.bodylen==-2?s="UID非法":r.bodylen==-3&&(s="无可用的服务");var o={type:"error",error:{message:s,code:r.bodylen}};return e.cb({type:2,message:"onerror",event:o}),void n.close()}r.encry=decodeASCIIToInt(i.substr(5,1)),r.server=decodeASCIIToInt(i.substr(6,1)),r.timeout=timeoutRandom(decodeASCIIToInt(i.substr(7,4))),r.ip=i.substr(11,r.bodylen-6)}t=!0,e.cb({type:0,message:"onmessage",event:r}),n.close()},n.onerror=function(n){t||e.cb({type:2,message:"onerror",event:n})},n.onclose=function(n){t?e.cb({type:1,message:"onclose",event:n}):e.cb({type:3,message:"onclose",event:n})}}function intToASCIIString(e,t){if(null!=e){if(1==t)return String.fromCharCode(e);if(2==t){var n=e.toString(16),r=Math.floor((n.length+1)/2);if(1==r)return String.fromCharCode(0)+String.fromCharCode(e);if(2==r){3==n.length&&(n="0"+n);var i=n.substr(0,2),s=parseInt(i,16),o=n.substr(2,2),a=parseInt(o,16);return String.fromCharCode(s)+String.fromCharCode(a)}}}return null}function getServerVer1(e){var t="LB",n=1,r=0,i=null;"IW"==e.service?i=6:"FW"==e.service?i=5:"WS"==e.service?i=2:"VS"==e.service&&(i=3);var s=Math.round((new Date).getTime()/1e3).toString(),o=e.config.userid,a=hex_md5(o+s),l=2+s.length+a.length+o.length;e.message=t+intToASCIIString(n,1)+intToASCIIString(l,2)+intToASCIIString(r,1)+intToASCIIString(i,1)+s+a+o,e.version=n,sendToLB(e)}function et_lb(e){this.IW={effectiveTime:0,im_host:"",im_port:0,lastUpdateTime:(new Date).getTime()/1e3},this.FW={effectiveTime:0,lastUpdateTime:(new Date).getTime()/1e3},this.WS={effectiveTime:0,http_host:"",http_port:"",lastUpdateTime:(new Date).getTime()/1e3},this.VS={effectiveTime:0,lastUpdateTime:(new Date).getTime()/1e3},e&&(this.imCallBack=e)}function encode64(e){var t,n,r,i,s,o="",a="",l="",u=0;do t=e.charCodeAt(u++),n=e.charCodeAt(u++),a=e.charCodeAt(u++),r=t>>2,i=(3&t)<<4|n>>4,s=(15&n)<<2|a>>6,l=63&a,isNaN(n)?s=l=64:isNaN(a)&&(l=64),o=o+keyStr.charAt(r)+keyStr.charAt(i)+keyStr.charAt(s)+keyStr.charAt(l),t=n=a="",r=i=s=l="";while(u<e.length);return o}function decode64(e){var t,n,r,i,s,o="",a="",l="",u=0;if(e.length%4!=0)return"";var c=/[^A-Za-z0-9\+\/\=]/g;if(c.exec(e))return"";do r=keyStr.indexOf(e.charAt(u++)),i=keyStr.indexOf(e.charAt(u++)),s=keyStr.indexOf(e.charAt(u++)),l=keyStr.indexOf(e.charAt(u++)),t=r<<2|i>>4,n=(15&i)<<4|s>>2,a=(3&s)<<6|l,o+=String.fromCharCode(t),64!=s&&(o+=String.fromCharCode(n)),64!=l&&(o+=String.fromCharCode(a)),t=n=a="",r=i=s=l="";while(u<e.length);return o}function utf16to8(e){var t,n,r,i;for(t="",r=e.length,n=0;n<r;n++)i=e.charCodeAt(n),i>=1&&i<=127?t+=e.charAt(n):i>2047?(t+=String.fromCharCode(224|i>>12&15),t+=String.fromCharCode(128|i>>6&63),t+=String.fromCharCode(128|i>>0&63)):(t+=String.fromCharCode(192|i>>6&31),t+=String.fromCharCode(128|i>>0&63));return t}function utf8to16(e){var t,n,r,i,s,o;for(t="",r=e.length,n=0;n<r;)switch(i=e.charCodeAt(n++),i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(n-1);break;case 12:case 13:s=e.charCodeAt(n++),t+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=e.charCodeAt(n++),o=e.charCodeAt(n++),t+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&o)<<0)}return t}function hex_md5(e){return binl2hex(core_md5(str2binl(e),e.length*chrsz))}function core_md5(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var n=1732584193,r=-271733879,i=-1732584194,s=271733878,o=0;o<e.length;o+=16){var a=n,l=r,u=i,c=s;n=md5_ff(n,r,i,s,e[o+0],7,-680876936),s=md5_ff(s,n,r,i,e[o+1],12,-389564586),i=md5_ff(i,s,n,r,e[o+2],17,606105819),r=md5_ff(r,i,s,n,e[o+3],22,-1044525330),n=md5_ff(n,r,i,s,e[o+4],7,-176418897),s=md5_ff(s,n,r,i,e[o+5],12,1200080426),i=md5_ff(i,s,n,r,e[o+6],17,-1473231341),r=md5_ff(r,i,s,n,e[o+7],22,-45705983),n=md5_ff(n,r,i,s,e[o+8],7,1770035416),s=md5_ff(s,n,r,i,e[o+9],12,-1958414417),i=md5_ff(i,s,n,r,e[o+10],17,-42063),r=md5_ff(r,i,s,n,e[o+11],22,-1990404162),n=md5_ff(n,r,i,s,e[o+12],7,1804603682),s=md5_ff(s,n,r,i,e[o+13],12,-40341101),i=md5_ff(i,s,n,r,e[o+14],17,-1502002290),r=md5_ff(r,i,s,n,e[o+15],22,1236535329),n=md5_gg(n,r,i,s,e[o+1],5,-165796510),s=md5_gg(s,n,r,i,e[o+6],9,-1069501632),i=md5_gg(i,s,n,r,e[o+11],14,643717713),r=md5_gg(r,i,s,n,e[o+0],20,-373897302),n=md5_gg(n,r,i,s,e[o+5],5,-701558691),s=md5_gg(s,n,r,i,e[o+10],9,38016083),i=md5_gg(i,s,n,r,e[o+15],14,-660478335),r=md5_gg(r,i,s,n,e[o+4],20,-405537848),n=md5_gg(n,r,i,s,e[o+9],5,568446438),s=md5_gg(s,n,r,i,e[o+14],9,-1019803690),i=md5_gg(i,s,n,r,e[o+3],14,-187363961),r=md5_gg(r,i,s,n,e[o+8],20,1163531501),n=md5_gg(n,r,i,s,e[o+13],5,-1444681467),s=md5_gg(s,n,r,i,e[o+2],9,-51403784),i=md5_gg(i,s,n,r,e[o+7],14,1735328473),r=md5_gg(r,i,s,n,e[o+12],20,-1926607734),n=md5_hh(n,r,i,s,e[o+5],4,-378558),s=md5_hh(s,n,r,i,e[o+8],11,-2022574463),i=md5_hh(i,s,n,r,e[o+11],16,1839030562),r=md5_hh(r,i,s,n,e[o+14],23,-35309556),n=md5_hh(n,r,i,s,e[o+1],4,-1530992060),s=md5_hh(s,n,r,i,e[o+4],11,1272893353),i=md5_hh(i,s,n,r,e[o+7],16,-155497632),r=md5_hh(r,i,s,n,e[o+10],23,-1094730640),n=md5_hh(n,r,i,s,e[o+13],4,681279174),s=md5_hh(s,n,r,i,e[o+0],11,-358537222),i=md5_hh(i,s,n,r,e[o+3],16,-722521979),r=md5_hh(r,i,s,n,e[o+6],23,76029189),n=md5_hh(n,r,i,s,e[o+9],4,-640364487),s=md5_hh(s,n,r,i,e[o+12],11,-421815835),i=md5_hh(i,s,n,r,e[o+15],16,530742520),r=md5_hh(r,i,s,n,e[o+2],23,-995338651),n=md5_ii(n,r,i,s,e[o+0],6,-198630844),s=md5_ii(s,n,r,i,e[o+7],10,1126891415),i=md5_ii(i,s,n,r,e[o+14],15,-1416354905),r=md5_ii(r,i,s,n,e[o+5],21,-57434055),n=md5_ii(n,r,i,s,e[o+12],6,1700485571),s=md5_ii(s,n,r,i,e[o+3],10,-1894986606),i=md5_ii(i,s,n,r,e[o+10],15,-1051523),r=md5_ii(r,i,s,n,e[o+1],21,-2054922799),n=md5_ii(n,r,i,s,e[o+8],6,1873313359),s=md5_ii(s,n,r,i,e[o+15],10,-30611744),i=md5_ii(i,s,n,r,e[o+6],15,-1560198380),r=md5_ii(r,i,s,n,e[o+13],21,1309151649),n=md5_ii(n,r,i,s,e[o+4],6,-145523070),s=md5_ii(s,n,r,i,e[o+11],10,-1120210379),i=md5_ii(i,s,n,r,e[o+2],15,718787259),r=md5_ii(r,i,s,n,e[o+9],21,-343485551),n=safe_add(n,a),r=safe_add(r,l),i=safe_add(i,u),s=safe_add(s,c)}return Array(n,r,i,s)}function md5_cmn(e,t,n,r,i,s){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(r,s)),i),n)}function md5_ff(e,t,n,r,i,s,o){return md5_cmn(t&n|~t&r,e,t,i,s,o)}function md5_gg(e,t,n,r,i,s,o){return md5_cmn(t&r|n&~r,e,t,i,s,o)}function md5_hh(e,t,n,r,i,s,o){return md5_cmn(t^n^r,e,t,i,s,o)}function md5_ii(e,t,n,r,i,s,o){return md5_cmn(n^(t|~r),e,t,i,s,o)}function safe_add(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function bit_rol(e,t){return e<<t|e>>>32-t}function str2binl(e){for(var t=Array(),n=(1<<chrsz)-1,r=0;r<e.length*chrsz;r+=chrsz)t[r>>5]|=(e.charCodeAt(r/chrsz)&n)<<r%32;return t}function binl2hex(e){for(var t=hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n}function byteLength(e){var t=0,n=e.length;if(!e)return 0;if("string"==typeof e){for(var r=0;r<n;r++)t+=e.charCodeAt(r)>255?2:1;return t}return n}function etGetIMProtocolNo(){return sdkInfo.protocolVersionNo.im}function etGetLBProtocolNo(){return sdkInfo.protocolVersionNo.lb}function etGetFileProtocolNo(){return sdkInfo.protocolVersionNo.file}function etGetFileProtocolNo(){return sdkInfo.protocolVersionNo.vs}function etGetSDKNo(){return sdkInfo.sdkVersionNo}function etGetSDKPlatform(){return sdkInfo.platform}function etGetSDKVersion(){return"JavaScript-SDK V"+etGetSDKNo()}function et_cloud(e){this.im=null,this.av=null,this.sipServer=null,this.wsServer=null,this.iceServer=null,this.fileServer=null,this.selfView=e.selfView,this.remoteView=e.remoteView,this.selfAudio=e.selfAudio,this.remoteAudio=e.remoteAudio,this.isLogin=!1,this.nickName=null,this.userid=null,this.appkey=null,this.imCallBack=e.imCallBack,this.avCallBack=e.avCallBack,this.fileCallBack=e.fileCallBack,this.fileList=new Array,this.token=null,this.im=null,this.lb=null,this.http=null}function loadbalance_error(e){return e.error||(e.error={}),e.error.code==-1?(e.error.code="-13",e.error.message=commonError[e.error.code]):e.error.code==-2?(e.error.code="-14",e.error.message=commonError[e.error.code]):e.error.code==-3?(e.error.code="-15",e.error.message=commonError[e.error.code]):e.error.code==-11?(e.error.code="-16",e.error.message=commonError[e.error.code]):e.error.code==-13?(e.error.code="-10",e.error.message=commonError[e.error.code]):(e.error.code="-20",e.error.message=commonError[e.error.code]),e}function http_callback(e,t,n){if("error"==t){var r="-0x3006";e.ret=r,e.code=r,e.message=httpError[e.code],e=JSON.stringify(e)}else{var i=$.parseJSON(e);1==i.ret?(i.code="-0x3100",i.message=httpError[i.code]):2==i.ret?(i.code="-0x3101",i.message=httpError[i.code]):3==i.ret?(i.code="-0x3102",i.message=httpError[i.code]):4==i.ret?(i.code="-0x3103",i.message=httpError[i.code]):5==i.ret?(i.code="-0x3104",i.message=httpError[i.code]):6==i.ret?(i.code="-0x3105",i.message=httpError[i.code]):7==i.ret?(i.code="-0x3106",i.message=httpError[i.code]):8==i.ret?(i.code="-0x3107",i.message=httpError[i.code]):9==i.ret?(i.code="-0x3108",i.message=httpError[i.code]):10==i.ret&&(i.code="-0x3109",i.message=httpError[i.code]),e=JSON.stringify(i)}n&&n(e)}!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.et_client=e()}}(function(){var e;return function t(e,n,r){function i(o,a){if(!n[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};e[o][0].call(c.exports,function(t){var n=e[o][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){},{}],2:[function(e,t,n){arguments[4][1][0].apply(n,arguments)},{dup:1}],3:[function(e,t,n){function r(e){return this instanceof r?(this.length=0,this.parent=void 0,"number"==typeof e?i(this,e):"string"==typeof e?s(this,e,arguments.length>1?arguments[1]:"utf8"):o(this,e)):arguments.length>1?new r(e,arguments[1]):new r(e)}function i(e,t){if(e=d(e,t<0?0:0|f(t)),!r.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;n++)e[n]=0;return e}function s(e,t,n){"string"==typeof n&&""!==n||(n="utf8");var r=0|g(t,n);return e=d(e,r),e.write(t,n),e}function o(e,t){if(r.isBuffer(t))return a(e,t);if(z(t))return l(e,t);if(null==t)throw new TypeError("must start with number, buffer, array or string");return"undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer?u(e,t):t.length?c(e,t):h(e,t)}function a(e,t){var n=0|f(t.length);return e=d(e,n),t.copy(e,0,0,n),e}function l(e,t){var n=0|f(t.length);e=d(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function u(e,t){var n=0|f(t.length);e=d(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function c(e,t){var n=0|f(t.length);e=d(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e,t){var n,r=0;"Buffer"===t.type&&z(t.data)&&(n=t.data,r=0|f(n.length)),e=d(e,r);for(var i=0;i<r;i+=1)e[i]=255&n[i];return e}function d(e,t){r.TYPED_ARRAY_SUPPORT?e=r._augment(new Uint8Array(t)):(e.length=t,e._isBuffer=!0);var n=0!==t&&t<=r.poolSize>>>1;return n&&(e.parent=Y),e}function f(e){return 0|e}function p(e,t){if(!(this instanceof p))return new p(e,t);var n=new r(e,t);return delete n.parent,n}function g(e,t){if("string"!=typeof e&&(e=String(e)),0===e.length)return 0;switch(t||"utf8"){case"ascii":case"binary":case"raw":return e.length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e.length;case"hex":return e.length>>>1;case"utf8":case"utf-8":return q(e).length;case"base64":return H(e).length;default:return e.length}}function m(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var s=t.length;if(s%2!==0)throw new Error("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;o++){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))throw new Error("Invalid hex string");e[n+o]=a}return o}function _(e,t,n,r){return F(q(t,e.length-n),e,n,r)}function v(e,t,n,r){return F(B(t),e,n,r)}function y(e,t,n,r){return v(e,t,n,r)}function b(e,t,n,r){return F(H(t),e,n,r)}function T(e,t,n,r){return F(j(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?W.fromByteArray(e):W.fromByteArray(e.slice(t,n))}function w(e,t,n){var r="",i="";n=Math.min(e.length,n);for(var s=t;s<n;s++)e[s]<=127?(r+=G(i)+String.fromCharCode(e[s]),i=""):i+="%"+e[s].toString(16);return r+G(i)}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(127&e[i]);return r}function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;s++)i+=P(e[s]);return i}function R(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function I(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,n,i,s,o){if(!r.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>s||t<o)throw new RangeError("value is out of bounds");if(n+i>e.length)throw new RangeError("index out of range")}function x(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;i++)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function U(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;i++)e[n+i]=t>>>8*(r?i:3-i)&255}function D(e,t,n,r,i,s){if(t>i||t<s)throw new RangeError("value is out of bounds");if(n+r>e.length)throw new RangeError("index out of range");if(n<0)throw new RangeError("index out of range")}function O(e,t,n,r,i){return i||D(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),V.write(e,t,n,r,23,4),n+4}function N(e,t,n,r,i){return i||D(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),V.write(e,t,n,r,52,8),n+8}function L(e){if(e=M(e).replace(J,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function M(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function P(e){return e<16?"0"+e.toString(16):e.toString(16)}function q(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],o=0;o<r;o++){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&((t-=3)>-1&&s.push(239,191,189),i=null);if(n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<2097152))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function B(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}function j(e,t){for(var n,r,i,s=[],o=0;o<e.length&&!((t-=2)<0);o++)n=e.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}function H(e){return W.toByteArray(L(e))}function F(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);i++)t[i+n]=e[i];return i}function G(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}/*!
     * The buffer module from node.js, for the browser.
     *
     * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
     * @license  MIT
     */
var W=e("base64-js"),V=e("ieee754"),z=e("is-array");n.Buffer=r,n.SlowBuffer=p,n.INSPECT_MAX_BYTES=50,r.poolSize=8192;var Y={};r.TYPED_ARRAY_SUPPORT=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(n){return!1}}(),r.isBuffer=function(e){return!(null==e||!e._isBuffer)},r.compare=function(e,t){if(!r.isBuffer(e)||!r.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,s=0,o=Math.min(n,i);s<o&&e[s]===t[s];)++s;return s!==o&&(n=e[s],i=t[s]),n<i?-1:i<n?1:0},r.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(e,t){if(!z(e))throw new TypeError("list argument must be an Array of Buffers.");if(0===e.length)return new r(0);if(1===e.length)return e[0];var n;if(void 0===t)for(t=0,n=0;n<e.length;n++)t+=e[n].length;var i=new r(t),s=0;for(n=0;n<e.length;n++){var o=e[n];o.copy(i,s),s+=o.length}return i},r.byteLength=g,r.prototype.length=void 0,r.prototype.parent=void 0,r.prototype.toString=function(e,t,n){var r=!1;if(t=0|t,n=void 0===n||n===1/0?this.length:0|n,e||(e="utf8"),t<0&&(t=0),n>this.length&&(n=this.length),n<=t)return"";for(;;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return w(this,t,n);case"ascii":return E(this,t,n);case"binary":return C(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}},r.prototype.equals=function(e){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===r.compare(this,e)},r.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},r.prototype.compare=function(e){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?0:r.compare(this,e)},r.prototype.indexOf=function(e,t){function n(e,t,n){for(var r=-1,i=0;n+i<e.length;i++)if(e[n+i]===t[r===-1?0:i-r]){if(r===-1&&(r=i),i-r+1===t.length)return n+r}else r=-1;return-1}if(t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(t<0&&(t=Math.max(this.length+t,0)),"string"==typeof e)return 0===e.length?-1:String.prototype.indexOf.call(this,e,t);if(r.isBuffer(e))return n(this,e,t);if("number"==typeof e)return r.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):n(this,[e],t);throw new TypeError("val must be string, number or Buffer")},r.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},r.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},r.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t=0|t,isFinite(n)?(n=0|n,void 0===r&&(r="utf8")):(r=n,n=void 0);else{var i=r;r=t,t=0|n,n=i}var s=this.length-t;if((void 0===n||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":return v(this,e,t,n);case"binary":return y(this,e,t,n);case"base64":return b(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},r.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var i;if(r.TYPED_ARRAY_SUPPORT)i=r._augment(this.subarray(e,t));else{var s=t-e;i=new r(s,(void 0));for(var o=0;o<s;o++)i[o]=this[o+e]}return i.length&&(i.parent=this.parent||this),i},r.prototype.readUIntLE=function(e,t,n){e=0|e,t=0|t,n||I(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},r.prototype.readUIntBE=function(e,t,n){e=0|e,t=0|t,n||I(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},r.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},r.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},r.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},r.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},r.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},r.prototype.readIntLE=function(e,t,n){e=0|e,t=0|t,n||I(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},r.prototype.readIntBE=function(e,t,n){e=0|e,t=0|t,n||I(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},r.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},r.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},r.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},r.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),V.read(this,e,!0,23,4)},r.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),V.read(this,e,!1,23,4)},r.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),V.read(this,e,!0,52,8)},r.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),V.read(this,e,!1,52,8)},r.prototype.writeUIntLE=function(e,t,n,r){e=+e,t=0|t,n=0|n,r||k(this,e,t,n,Math.pow(2,8*n),0);var i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},r.prototype.writeUIntBE=function(e,t,n,r){e=+e,t=0|t,n=0|n,r||k(this,e,t,n,Math.pow(2,8*n),0);var i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},r.prototype.writeUInt8=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,1,255,0),r.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e,t+1},r.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,2,65535,0),r.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},r.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,2,65535,0),r.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e):x(this,e,t,!1),t+2},r.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,4,4294967295,0),r.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e):U(this,e,t,!0),t+4},r.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,4,4294967295,0),r.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e):U(this,e,t,!1),t+4},r.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t=0|t,!r){var i=Math.pow(2,8*n-1);k(this,e,t,n,i-1,-i)}var s=0,o=1,a=e<0?1:0;for(this[t]=255&e;++s<n&&(o*=256);)this[t+s]=(e/o>>0)-a&255;return t+n},r.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t=0|t,!r){var i=Math.pow(2,8*n-1);k(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=e<0?1:0;for(this[t+s]=255&e;--s>=0&&(o*=256);)this[t+s]=(e/o>>0)-a&255;return t+n},r.prototype.writeInt8=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,1,127,-128),r.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=e,t+1},r.prototype.writeInt16LE=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,2,32767,-32768),r.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},r.prototype.writeInt16BE=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,2,32767,-32768),r.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e):x(this,e,t,!1),t+2},r.prototype.writeInt32LE=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,4,2147483647,-2147483648),r.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},r.prototype.writeInt32BE=function(e,t,n){return e=+e,t=0|t,n||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),r.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e):U(this,e,t,!1),t+4},r.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},r.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},r.prototype.writeDoubleLE=function(e,t,n){return N(this,e,t,!0,n)},r.prototype.writeDoubleBE=function(e,t,n){return N(this,e,t,!1,n)},r.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var s=i-n;if(s<1e3||!r.TYPED_ARRAY_SUPPORT)for(var o=0;o<s;o++)e[o+t]=this[o+n];else e._set(this.subarray(n,n+s),t);return s},r.prototype.fill=function(e,t,n){if(e||(e=0),t||(t=0),n||(n=this.length),n<t)throw new RangeError("end < start");if(n!==t&&0!==this.length){if(t<0||t>=this.length)throw new RangeError("start out of bounds");if(n<0||n>this.length)throw new RangeError("end out of bounds");var r;if("number"==typeof e)for(r=t;r<n;r++)this[r]=e;else{var i=q(e.toString()),s=i.length;for(r=t;r<n;r++)this[r]=i[r%s]}return this}},r.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(r.TYPED_ARRAY_SUPPORT)return new r(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var K=r.prototype;r._augment=function(e){return e.constructor=r,e._isBuffer=!0,e._set=e.set,e.get=K.get,e.set=K.set,e.write=K.write,e.toString=K.toString,e.toLocaleString=K.toString,e.toJSON=K.toJSON,e.equals=K.equals,e.compare=K.compare,e.indexOf=K.indexOf,e.copy=K.copy,e.slice=K.slice,e.readUIntLE=K.readUIntLE,e.readUIntBE=K.readUIntBE,e.readUInt8=K.readUInt8,e.readUInt16LE=K.readUInt16LE,e.readUInt16BE=K.readUInt16BE,e.readUInt32LE=K.readUInt32LE,e.readUInt32BE=K.readUInt32BE,e.readIntLE=K.readIntLE,e.readIntBE=K.readIntBE,e.readInt8=K.readInt8,e.readInt16LE=K.readInt16LE,e.readInt16BE=K.readInt16BE,e.readInt32LE=K.readInt32LE,e.readInt32BE=K.readInt32BE,e.readFloatLE=K.readFloatLE,e.readFloatBE=K.readFloatBE,e.readDoubleLE=K.readDoubleLE,e.readDoubleBE=K.readDoubleBE,e.writeUInt8=K.writeUInt8,e.writeUIntLE=K.writeUIntLE,e.writeUIntBE=K.writeUIntBE,e.writeUInt16LE=K.writeUInt16LE,e.writeUInt16BE=K.writeUInt16BE,e.writeUInt32LE=K.writeUInt32LE,e.writeUInt32BE=K.writeUInt32BE,e.writeIntLE=K.writeIntLE,e.writeIntBE=K.writeIntBE,e.writeInt8=K.writeInt8,e.writeInt16LE=K.writeInt16LE,e.writeInt16BE=K.writeInt16BE,e.writeInt32LE=K.writeInt32LE,e.writeInt32BE=K.writeInt32BE,e.writeFloatLE=K.writeFloatLE,e.writeFloatBE=K.writeFloatBE,e.writeDoubleLE=K.writeDoubleLE,e.writeDoubleBE=K.writeDoubleBE,e.fill=K.fill,e.inspect=K.inspect,e.toArrayBuffer=K.toArrayBuffer,e};var J=/[^+\/0-9A-z\-]/g},{"base64-js":4,ieee754:5,"is-array":6}],4:[function(e,t,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===o||t===h?62:t===a||t===d?63:t<l?-1:t<l+10?t-l+26+26:t<c+26?t-c:t<u+26?t-u+26:void 0}function n(e){function n(e){u[h++]=e}var r,i,o,a,l,u;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=e.length;l="="===e.charAt(c-2)?2:"="===e.charAt(c-1)?1:0,u=new s(3*e.length/4-l),o=l>0?e.length-4:e.length;var h=0;for(r=0,i=0;r<o;r+=4,i+=3)a=t(e.charAt(r))<<18|t(e.charAt(r+1))<<12|t(e.charAt(r+2))<<6|t(e.charAt(r+3)),n((16711680&a)>>16),n((65280&a)>>8),n(255&a);return 2===l?(a=t(e.charAt(r))<<2|t(e.charAt(r+1))>>4,n(255&a)):1===l&&(a=t(e.charAt(r))<<10|t(e.charAt(r+1))<<4|t(e.charAt(r+2))>>2,n(a>>8&255),n(255&a)),u}function i(e){function t(e){return r.charAt(e)}function n(e){return t(e>>18&63)+t(e>>12&63)+t(e>>6&63)+t(63&e)}var i,s,o,a=e.length%3,l="";for(i=0,o=e.length-a;i<o;i+=3)s=(e[i]<<16)+(e[i+1]<<8)+e[i+2],l+=n(s);switch(a){case 1:s=e[e.length-1],l+=t(s>>2),l+=t(s<<4&63),l+="==";break;case 2:s=(e[e.length-2]<<8)+e[e.length-1],l+=t(s>>10),l+=t(s>>4&63),l+=t(s<<2&63),l+="="}return l}var s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="+".charCodeAt(0),a="/".charCodeAt(0),l="0".charCodeAt(0),u="a".charCodeAt(0),c="A".charCodeAt(0),h="-".charCodeAt(0),d="_".charCodeAt(0);e.toByteArray=n,e.fromByteArray=i}("undefined"==typeof n?this.base64js={}:n)},{}],5:[function(e,t,n){n.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,u=l>>1,c=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=256*s+e[t+h],h+=d,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=r;c>0;o=256*o+e[t+h],h+=d,c-=8);if(0===s)s=1-u;else{if(s===l)return o?NaN:(f?-1:1)*(1/0);o+=Math.pow(2,r),s-=u}return(f?-1:1)*o*Math.pow(2,s-r)},n.write=function(e,t,n,r,i,s){var o,a,l,u=8*s-i-1,c=(1<<u)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),t+=o+h>=1?d/l:d*Math.pow(2,1-h),t*l>=2&&(o++,l/=2),o+h>=c?(a=0,o=c):o+h>=1?(a=(t*l-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+f]=255&o,f+=p,o/=256,u-=8);e[n+f-p]|=128*g}},{}],6:[function(e,t,n){var r=Array.isArray,i=Object.prototype.toString;t.exports=r||function(e){return!!e&&"[object Array]"==i.call(e)}},{}],7:[function(e,t,n){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,s=new Array(r-1),l=1;l<r;l++)s[l-1]=arguments[l];n.apply(this,s)}else if(o(n)){for(r=arguments.length,s=new Array(r-1),l=1;l<r;l++)s[l-1]=arguments[l];for(u=n.slice(),r=u.length,l=0;l<r;l++)u[l].apply(this,s)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}],8:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],9:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],10:[function(e,t,n){function r(){c=!1,a.length?u=a.concat(u):h=-1,u.length&&i()}function i(){if(!c){var e=setTimeout(r);c=!0;for(var t=u.length;t;){for(a=u,u=[];++h<t;)a[h].run();h=-1,t=u.length}a=null,c=!1,clearTimeout(e)}}function s(e,t){this.fun=e,this.array=t}function o(){}var a,l=t.exports={},u=[],c=!1,h=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new s(e,t)),1!==u.length||c||setTimeout(i,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=o,l.addListener=o,l.once=o,l.off=o,l.removeListener=o,l.removeAllListeners=o,l.emit=o,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],11:[function(t,n,r){(function(t){!function(i){function s(e){throw RangeError(N[e])}function o(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function a(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(O,".");var i=e.split("."),s=o(i,t).join(".");return r+s}function l(e){for(var t,n,r=[],i=0,s=e.length;i<s;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<s?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function u(e){return o(e,function(e){var t="";return e>65535&&(e-=65536,t+=P(e>>>10&1023|55296),e=56320|1023&e),t+=P(e)}).join("")}function c(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:w}function h(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function d(e,t,n){var r=0;for(e=n?M(e/R):e>>1,e+=M(e/t);e>L*C>>1;r+=w)e=M(e/L);return M(r+(L+1)*e/(e+A))}function f(e){var t,n,r,i,o,a,l,h,f,p,g=[],m=e.length,_=0,v=k,y=I;for(n=e.lastIndexOf(x),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&s("not-basic"),g.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<m;){for(o=_,a=1,l=w;i>=m&&s("invalid-input"),h=c(e.charCodeAt(i++)),(h>=w||h>M((S-_)/a))&&s("overflow"),_+=h*a,f=l<=y?E:l>=y+C?C:l-y,!(h<f);l+=w)p=w-f,a>M(S/p)&&s("overflow"),a*=p;t=g.length+1,y=d(_-o,t,0==o),M(_/t)>S-v&&s("overflow"),v+=M(_/t),_%=t,g.splice(_++,0,v)}return u(g)}function p(e){var t,n,r,i,o,a,u,c,f,p,g,m,_,v,y,b=[];for(e=l(e),m=e.length,t=k,n=0,o=I,a=0;a<m;++a)g=e[a],g<128&&b.push(P(g));for(r=i=b.length,i&&b.push(x);r<m;){for(u=S,a=0;a<m;++a)g=e[a],g>=t&&g<u&&(u=g);for(_=r+1,u-t>M((S-n)/_)&&s("overflow"),n+=(u-t)*_,t=u,a=0;a<m;++a)if(g=e[a],g<t&&++n>S&&s("overflow"),g==t){for(c=n,f=w;p=f<=o?E:f>=o+C?C:f-o,!(c<p);f+=w)y=c-p,v=w-p,b.push(P(h(p+y%v,0))),c=M(y/v);b.push(P(h(c,0))),o=d(n,_,r==i),n=0,++r}++n,++t}return b.join("")}function g(e){return a(e,function(e){return U.test(e)?f(e.slice(4).toLowerCase()):e})}function m(e){return a(e,function(e){return D.test(e)?"xn--"+p(e):e})}var _="object"==typeof r&&r&&!r.nodeType&&r,v="object"==typeof n&&n&&!n.nodeType&&n,y="object"==typeof t&&t;y.global!==y&&y.window!==y&&y.self!==y||(i=y);var b,T,S=2147483647,w=36,E=1,C=26,A=38,R=700,I=72,k=128,x="-",U=/^xn--/,D=/[^\x20-\x7E]/,O=/[\x2E\u3002\uFF0E\uFF61]/g,N={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},L=w-E,M=Math.floor,P=String.fromCharCode;if(b={version:"1.3.2",ucs2:{decode:l,encode:u},decode:f,encode:p,toASCII:m,toUnicode:g},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return b});else if(_&&v)if(n.exports==_)v.exports=b;else for(T in b)b.hasOwnProperty(T)&&(_[T]=b[T]);else i.punycode=b}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(e,t,n){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&",n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var a=/\+/g;e=e.split(t);var l=1e3;s&&"number"==typeof s.maxKeys&&(l=s.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var h,d,f,p,g=e[c].replace(a,"%20"),m=g.indexOf(n);m>=0?(h=g.substr(0,m),d=g.substr(m+1)):(h=g,d=""),f=decodeURIComponent(h),p=decodeURIComponent(d),r(o,f)?i(o[f])?o[f].push(p):o[f]=[o[f],p]:o[f]=p}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],13:[function(e,t,n){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(o(e),function(o){var a=encodeURIComponent(i(o))+n;return s(e[o])?r(e[o],function(e){return a+encodeURIComponent(i(e))}).join(t):a+encodeURIComponent(i(e[o]))}).join(t):a?encodeURIComponent(i(a))+n+encodeURIComponent(i(e)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],14:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":12,"./encode":13}],15:[function(e,t,n){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":16}],16:[function(e,t,n){(function(n){function r(e){return this instanceof r?(l.call(this,e),u.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",i)):new r(e)}function i(){this.allowHalfOpen||this._writableState.ended||n.nextTick(this.end.bind(this))}function s(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=r;var o=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},a=e("core-util-is");a.inherits=e("inherits");var l=e("./_stream_readable"),u=e("./_stream_writable");a.inherits(r,l),s(o(u.prototype),function(e){r.prototype[e]||(r.prototype[e]=u.prototype[e])})}).call(this,e("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:10,"core-util-is":21,inherits:8}],17:[function(e,t,n){function r(e){return this instanceof r?void i.call(this,e):new r(e)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=r;var i=e("./_stream_transform"),s=e("core-util-is");s.inherits=e("inherits"),s.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":19,"core-util-is":21,inherits:8}],18:[function(e,t,n){(function(n){function r(t,n){var r=e("./_stream_duplex");t=t||{};var i=t.highWaterMark,s=t.objectMode?16:16384;this.highWaterMark=i||0===i?i:s,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,n instanceof r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(I||(I=e("string_decoder/").StringDecoder),this.decoder=new I(t.encoding),this.encoding=t.encoding)}function i(t){e("./_stream_duplex");return this instanceof i?(this._readableState=new r(t,this),this.readable=!0,void A.call(this)):new i(t)}function s(e,t,n,r,i){var s=u(t,n);if(s)e.emit("error",s);else if(R.isNullOrUndefined(n))t.reading=!1,t.ended||c(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&i){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else!t.decoder||i||r||(n=t.decoder.write(n)),i||(t.reading=!1),t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&h(e)),f(e,t);else i||(t.reading=!1);return o(t)}function o(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function a(e){if(e>=x)e=x;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}function l(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:isNaN(e)||R.isNull(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=a(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function u(e,t){var n=null;return R.isBuffer(t)||R.isString(t)||R.isNullOrUndefined(t)||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function c(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,h(e)}function h(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(k("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?n.nextTick(function(){d(e)}):d(e))}function d(e){k("emit readable"),e.emit("readable"),v(e)}function f(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(function(){p(e,t)}))}function p(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(k("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function g(e){return function(){var t=e._readableState;k("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&C.listenerCount(e,"data")&&(t.flowing=!0,v(e))}}function m(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(function(){_(e,t)}))}function _(e,t){t.resumeScheduled=!1,e.emit("resume"),v(e),t.flowing&&!t.reading&&e.read(0)}function v(e){var t=e._readableState;if(k("flow",t.flowing),t.flowing)do var n=e.read();while(null!==n&&t.flowing)}function y(e,t){var n,r=t.buffer,i=t.length,s=!!t.decoder,o=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(o)n=r.shift();else if(!e||e>=i)n=s?r.join(""):E.concat(r,i),r.length=0;else if(e<r[0].length){var a=r[0];n=a.slice(0,e),r[0]=a.slice(e)}else if(e===r[0].length)n=r.shift();else{n=s?"":new E(e);for(var l=0,u=0,c=r.length;u<c&&l<e;u++){var a=r[0],h=Math.min(e-l,a.length);s?n+=a.slice(0,h):a.copy(n,l,0,h),h<a.length?r[0]=a.slice(h):r.shift(),l+=h}}return n}function b(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,n.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function T(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function S(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=i;var w=e("isarray"),E=e("buffer").Buffer;i.ReadableState=r;var C=e("events").EventEmitter;C.listenerCount||(C.listenerCount=function(e,t){return e.listeners(t).length});var A=e("stream"),R=e("core-util-is");R.inherits=e("inherits");var I,k=e("util");k=k&&k.debuglog?k.debuglog("stream"):function(){},R.inherits(i,A),i.prototype.push=function(e,t){var n=this._readableState;return R.isString(e)&&!n.objectMode&&(t=t||n.defaultEncoding,t!==n.encoding&&(e=new E(e,t),t="")),s(this,n,e,t,!1)},i.prototype.unshift=function(e){var t=this._readableState;return s(this,t,e,"",!0)},i.prototype.setEncoding=function(t){return I||(I=e("string_decoder/").StringDecoder),this._readableState.decoder=new I(t),this._readableState.encoding=t,this};var x=8388608;i.prototype.read=function(e){k("read",e);var t=this._readableState,n=e;if((!R.isNumber(e)||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return k("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?b(this):h(this),null;if(e=l(e,t),0===e&&t.ended)return 0===t.length&&b(this),null;var r=t.needReadable;k("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,k("length less than watermark",r)),(t.ended||t.reading)&&(r=!1,k("reading or ended",r)),r&&(k("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=l(n,t));var i;return i=e>0?y(e,t):null,R.isNull(i)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&b(this),R.isNull(i)||this.emit("data",i),i},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function r(e){k("onunpipe"),e===h&&s()}function i(){k("onend"),e.end()}function s(){k("cleanup"),e.removeListener("close",l),e.removeListener("finish",u),e.removeListener("drain",m),e.removeListener("error",a),e.removeListener("unpipe",r),h.removeListener("end",i),h.removeListener("end",s),h.removeListener("data",o),!d.awaitDrain||e._writableState&&!e._writableState.needDrain||m()}function o(t){k("ondata");var n=e.write(t);!1===n&&(k("false write response, pause",h._readableState.awaitDrain),h._readableState.awaitDrain++,h.pause())}function a(t){k("onerror",t),c(),e.removeListener("error",a),0===C.listenerCount(e,"error")&&e.emit("error",t)}function l(){e.removeListener("finish",u),c()}function u(){k("onfinish"),e.removeListener("close",l),c()}function c(){k("unpipe"),h.unpipe(e)}var h=this,d=this._readableState;switch(d.pipesCount){case 0:d.pipes=e;break;case 1:d.pipes=[d.pipes,e];break;default:d.pipes.push(e)}d.pipesCount+=1,k("pipe count=%d opts=%j",d.pipesCount,t);var f=(!t||t.end!==!1)&&e!==n.stdout&&e!==n.stderr,p=f?i:s;d.endEmitted?n.nextTick(p):h.once("end",p),e.on("unpipe",r);var m=g(h);return e.on("drain",m),h.on("data",o),e._events&&e._events.error?w(e._events.error)?e._events.error.unshift(a):e._events.error=[a,e._events.error]:e.on("error",a),e.once("close",l),e.once("finish",u),e.emit("pipe",h),d.flowing||(k("pipe resume"),h.resume()),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var i=S(t.pipes,e);return i===-1?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var r=A.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&this.readable){var i=this._readableState;if(!i.readableListening)if(i.readableListening=!0,i.emittedReadable=!1,i.needReadable=!0,i.reading)i.length&&h(this,i);else{var s=this;n.nextTick(function(){k("readable nexttick read 0"),s.read(0)})}}return r},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){var e=this._readableState;return e.flowing||(k("resume"),e.flowing=!0,e.reading||(k("resume read 0"),this.read(0)),m(this,e)),this},i.prototype.pause=function(){return k("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(k("pause"),this._readableState.flowing=!1,this.emit("pause")),this},i.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(k("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(k("wrapped data"),t.decoder&&(i=t.decoder.write(i)),i&&(t.objectMode||i.length)){var s=r.push(i);s||(n=!0,e.pause())}});for(var i in e)R.isFunction(e[i])&&R.isUndefined(this[i])&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var s=["error","close","destroy","pause","resume"];return T(s,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){k("wrapped _read",t),n&&(n=!1,e.resume())},r},i._fromList=y}).call(this,e("_process"))},{"./_stream_duplex":16,_process:10,buffer:3,"core-util-is":21,events:7,inherits:8,isarray:9,stream:26,"string_decoder/":27,util:2}],19:[function(e,t,n){function r(e,t){this.afterTransform=function(e,n){return i(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function i(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,l.isNullOrUndefined(n)||e.push(n),i&&i(t);var s=e._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&e._read(s.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);a.call(this,e),this._transformState=new r(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){l.isFunction(this._flush)?this._flush(function(e){o(t,e)}):o(t)})}function o(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=e._transformState;if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=s;var a=e("./_stream_duplex"),l=e("core-util-is");l.inherits=e("inherits"),l.inherits(s,a),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("not implemented")},s.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;l.isNull(t.writechunk)||!t.writecb||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))}},{"./_stream_duplex":16,"core-util-is":21,inherits:8}],20:[function(e,t,n){(function(n){function r(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function i(t,n){var r=e("./_stream_duplex");t=t||{};var i=t.highWaterMark,s=t.objectMode?16:16384;this.highWaterMark=i||0===i?i:s,this.objectMode=!!t.objectMode,n instanceof r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=t.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){f(n,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function s(t){var n=e("./_stream_duplex");return this instanceof s||this instanceof n?(this._writableState=new i(t,this),this.writable=!0,void w.call(this)):new s(t)}function o(e,t,r){var i=new Error("write after end");e.emit("error",i),n.nextTick(function(){r(i)})}function a(e,t,r,i){var s=!0;if(!(S.isBuffer(r)||S.isString(r)||S.isNullOrUndefined(r)||t.objectMode)){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),n.nextTick(function(){i(o)}),s=!1}return s}function l(e,t,n){return!e.objectMode&&e.decodeStrings!==!1&&S.isString(t)&&(t=new T(t,n)),t}function u(e,t,n,i,s){n=l(t,n,i),S.isBuffer(n)&&(i="buffer");var o=t.objectMode?1:n.length;t.length+=o;var a=t.length<t.highWaterMark;return a||(t.needDrain=!0),t.writing||t.corked?t.buffer.push(new r(n,i,s)):c(e,t,!1,o,n,i,s),a}function c(e,t,n,r,i,s,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function h(e,t,r,i,s){r?n.nextTick(function(){t.pendingcb--,s(i)}):(t.pendingcb--,s(i)),e._writableState.errorEmitted=!0,e.emit("error",i)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function f(e,t){var r=e._writableState,i=r.sync,s=r.writecb;if(d(r),t)h(e,r,i,t,s);else{var o=_(e,r);o||r.corked||r.bufferProcessing||!r.buffer.length||m(e,r),i?n.nextTick(function(){p(e,r,o,s)}):p(e,r,o,s)}}function p(e,t,n,r){n||g(e,t),t.pendingcb--,r(),y(e,t)}function g(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function m(e,t){if(t.bufferProcessing=!0,e._writev&&t.buffer.length>1){for(var n=[],r=0;r<t.buffer.length;r++)n.push(t.buffer[r].callback);t.pendingcb++,c(e,t,!0,t.length,t.buffer,"",function(e){for(var r=0;r<n.length;r++)t.pendingcb--,n[r](e)}),t.buffer=[]}else{for(var r=0;r<t.buffer.length;r++){var i=t.buffer[r],s=i.chunk,o=i.encoding,a=i.callback,l=t.objectMode?1:s.length;if(c(e,t,!1,l,s,o,a),t.writing){r++;break}}r<t.buffer.length?t.buffer=t.buffer.slice(r):t.buffer.length=0}t.bufferProcessing=!1}function _(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function v(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function y(e,t){var n=_(e,t);return n&&(0===t.pendingcb?(v(e,t),t.finished=!0,e.emit("finish")):v(e,t)),n}function b(e,t,r){t.ending=!0,y(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r)),t.ended=!0}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=s;var T=e("buffer").Buffer;s.WritableState=i;var S=e("core-util-is");S.inherits=e("inherits");var w=e("stream");S.inherits(s,w),s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},s.prototype.write=function(e,t,n){var r=this._writableState,i=!1;return S.isFunction(t)&&(n=t,t=null),S.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),S.isFunction(n)||(n=function(){}),r.ended?o(this,r,n):a(this,r,e,n)&&(r.pendingcb++,i=u(this,r,e,t,n)),i},s.prototype.cork=function(){var e=this._writableState;e.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.buffer.length||m(this,e))},s.prototype._write=function(e,t,n){n(new Error("not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,n){var r=this._writableState;S.isFunction(e)?(n=e,e=null,t=null):S.isFunction(t)&&(n=t,t=null),S.isNullOrUndefined(e)||this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||b(this,r,n)}}).call(this,e("_process"))},{"./_stream_duplex":16,_process:10,buffer:3,"core-util-is":21,inherits:8,stream:26}],21:[function(e,t,n){(function(e){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
function t(e){return Array.isArray(e)}function r(e){return"boolean"==typeof e}function i(e){return null===e}function s(e){return null==e}function o(e){return"number"==typeof e}function a(e){return"string"==typeof e}function l(e){return"symbol"==typeof e}function u(e){return void 0===e}function c(e){return h(e)&&"[object RegExp]"===_(e)}function h(e){return"object"==typeof e&&null!==e}function d(e){return h(e)&&"[object Date]"===_(e)}function f(e){return h(e)&&("[object Error]"===_(e)||e instanceof Error)}function p(e){return"function"==typeof e}function g(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function m(t){return e.isBuffer(t)}function _(e){return Object.prototype.toString.call(e)}n.isArray=t,n.isBoolean=r,n.isNull=i,n.isNullOrUndefined=s,n.isNumber=o,n.isString=a,n.isSymbol=l,n.isUndefined=u,n.isRegExp=c,n.isObject=h,n.isDate=d,n.isError=f,n.isFunction=p,n.isPrimitive=g,n.isBuffer=m}).call(this,e("buffer").Buffer)},{buffer:3}],22:[function(e,t,n){t.exports=e("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":17}],23:[function(e,t,n){n=t.exports=e("./lib/_stream_readable.js"),n.Stream=e("stream"),n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,stream:26}],24:[function(e,t,n){t.exports=e("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":19}],25:[function(e,t,n){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":20}],26:[function(e,t,n){function r(){i.call(this)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=r;var i=e("events").EventEmitter,s=e("inherits");s(r,i),r.Readable=e("readable-stream/readable.js"),r.Writable=e("readable-stream/writable.js"),r.Duplex=e("readable-stream/duplex.js"),r.Transform=e("readable-stream/transform.js"),r.PassThrough=e("readable-stream/passthrough.js"),r.Stream=r,r.prototype.pipe=function(e,t){function n(t){e.writable&&!1===e.write(t)&&u.pause&&u.pause()}function r(){u.readable&&u.resume&&u.resume()}function s(){c||(c=!0,e.end())}function o(){c||(c=!0,"function"==typeof e.destroy&&e.destroy())}function a(e){if(l(),0===i.listenerCount(this,"error"))throw e}function l(){u.removeListener("data",n),e.removeListener("drain",r),u.removeListener("end",s),u.removeListener("close",o),u.removeListener("error",a),e.removeListener("error",a),u.removeListener("end",l),u.removeListener("close",l),e.removeListener("close",l)}var u=this;u.on("data",n),e.on("drain",r),e._isStdio||t&&t.end===!1||(u.on("end",s),u.on("close",o));var c=!1;
// Allow for unix-like usage: A.pipe(B).pipe(C)
return u.on("error",a),e.on("error",a),u.on("end",l),u.on("close",l),e.on("close",l),e.emit("pipe",u),e}},{events:7,inherits:8,"readable-stream/duplex.js":15,"readable-stream/passthrough.js":22,"readable-stream/readable.js":23,"readable-stream/transform.js":24,"readable-stream/writable.js":25}],27:[function(e,t,n){function r(e){if(e&&!l(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function s(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function o(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var a=e("buffer").Buffer,l=a.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},u=n.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),r(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=o;break;default:return void(this.write=i)}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};u.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,r=t.charCodeAt(i);if(r>=55296&&r<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,i)}return t},u.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},u.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},{buffer:3}],28:[function(e,t,n){function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,n){if(e&&u(e)&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}function s(e){return l(e)&&(e=i(e)),e instanceof r?e.format():r.prototype.format.call(e)}function o(e,t){return i(e,!1,!0).resolve(t)}function a(e,t){return e?i(e,!1,!0).resolveObject(t):t}function l(e){return"string"==typeof e}function u(e){return"object"==typeof e&&null!==e}function c(e){return null===e}function h(e){return null==e}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var d=e("punycode");n.parse=i,n.resolve=o,n.resolveObject=a,n.format=s,n.Url=r;var f=/^([a-z0-9.+-]+:)/i,p=/:[0-9]*$/,g=["<",">",'"',"`"," ","\r","\n","\t"],m=["{","}","|","\\","^","`"].concat(g),_=["'"].concat(m),v=["%","/","?",";","#"].concat(_),y=["/","?","#"],b=255,T=/^[a-z0-9A-Z_-]{0,63}$/,S=/^([a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},C={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=e("querystring");r.prototype.parse=function(e,t,n){if(!l(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e;r=r.trim();var i=f.exec(r);if(i){i=i[0];var s=i.toLowerCase();this.protocol=s,r=r.substr(i.length)}if(n||i||r.match(/^\/\/[^@\/]+@[^@\/]+/)){var o="//"===r.substr(0,2);!o||i&&E[i]||(r=r.substr(2),this.slashes=!0)}if(!E[i]&&(o||i&&!C[i])){for(var a=-1,u=0;u<y.length;u++){var c=r.indexOf(y[u]);c!==-1&&(a===-1||c<a)&&(a=c)}var h,p;p=a===-1?r.lastIndexOf("@"):r.lastIndexOf("@",a),p!==-1&&(h=r.slice(0,p),r=r.slice(p+1),this.auth=decodeURIComponent(h)),a=-1;for(var u=0;u<v.length;u++){var c=r.indexOf(v[u]);c!==-1&&(a===-1||c<a)&&(a=c)}a===-1&&(a=r.length),this.host=r.slice(0,a),r=r.slice(a),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var m=this.hostname.split(/\./),u=0,R=m.length;u<R;u++){var I=m[u];if(I&&!I.match(T)){for(var k="",x=0,U=I.length;x<U;x++)k+=I.charCodeAt(x)>127?"x":I[x];if(!k.match(T)){var D=m.slice(0,u),O=m.slice(u+1),N=I.match(S);N&&(D.push(N[1]),O.unshift(N[2])),O.length&&(r="/"+O.join(".")+r),this.hostname=D.join(".");break}}}if(this.hostname.length>b?this.hostname="":this.hostname=this.hostname.toLowerCase(),!g){for(var L=this.hostname.split("."),M=[],u=0;u<L.length;++u){var P=L[u];M.push(P.match(/[^A-Za-z0-9_-]/)?"xn--"+d.encode(P):P)}this.hostname=M.join(".")}var q=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+q,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==r[0]&&(r="/"+r))}if(!w[s])for(var u=0,R=_.length;u<R;u++){var j=_[u],H=encodeURIComponent(j);H===j&&(H=escape(j)),r=r.split(j).join(H)}var F=r.indexOf("#");F!==-1&&(this.hash=r.substr(F),r=r.slice(0,F));var G=r.indexOf("?");if(G!==-1?(this.search=r.substr(G),this.query=r.substr(G+1),t&&(this.query=A.parse(this.query)),r=r.slice(0,G)):t&&(this.search="",this.query={}),r&&(this.pathname=r),C[s]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var q=this.pathname||"",P=this.search||"";this.path=q+P}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&u(this.query)&&Object.keys(this.query).length&&(s=A.stringify(this.query));var o=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||C[t])&&i!==!1?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),o=o.replace("#","%23"),t+i+n+o+r},r.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(l(e)){var t=new r;t.parse(e,!1,!0),e=t}var n=new r;if(Object.keys(this).forEach(function(e){n[e]=this[e]},this),n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol)return Object.keys(e).forEach(function(t){"protocol"!==t&&(n[t]=e[t])}),C[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n;if(e.protocol&&e.protocol!==n.protocol){if(!C[e.protocol])return Object.keys(e).forEach(function(t){n[t]=e[t]}),n.href=n.format(),n;if(n.protocol=e.protocol,e.host||E[e.protocol])n.pathname=e.pathname;else{for(var i=(e.pathname||"").split("/");i.length&&!(e.host=i.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==i[0]&&i.unshift(""),i.length<2&&i.unshift(""),n.pathname=i.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var s=n.pathname||"",o=n.search||"";n.path=s+o}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var a=n.pathname&&"/"===n.pathname.charAt(0),u=e.host||e.pathname&&"/"===e.pathname.charAt(0),d=u||a||n.host&&e.pathname,f=d,p=n.pathname&&n.pathname.split("/")||[],i=e.pathname&&e.pathname.split("/")||[],g=n.protocol&&!C[n.protocol];if(g&&(n.hostname="",n.port=null,n.host&&(""===p[0]?p[0]=n.host:p.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===i[0]?i[0]=e.host:i.unshift(e.host)),e.host=null),d=d&&(""===i[0]||""===p[0])),u)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,p=i;else if(i.length)p||(p=[]),p.pop(),p=p.concat(i),n.search=e.search,n.query=e.query;else if(!h(e.search)){if(g){n.hostname=n.host=p.shift();var m=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");m&&(n.auth=m.shift(),n.host=n.hostname=m.shift())}return n.search=e.search,n.query=e.query,c(n.pathname)&&c(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!p.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var _=p.slice(-1)[0],v=(n.host||e.host)&&("."===_||".."===_)||""===_,y=0,b=p.length;b>=0;b--)_=p[b],"."==_?p.splice(b,1):".."===_?(p.splice(b,1),y++):y&&(p.splice(b,1),y--);if(!d&&!f)for(;y--;y)p.unshift("..");!d||""===p[0]||p[0]&&"/"===p[0].charAt(0)||p.unshift(""),v&&"/"!==p.join("/").substr(-1)&&p.push("");var T=""===p[0]||p[0]&&"/"===p[0].charAt(0);if(g){n.hostname=n.host=T?"":p.length?p.shift():"";var m=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");m&&(n.auth=m.shift(),n.host=n.hostname=m.shift())}return d=d||n.host&&p.length,d&&!T&&p.unshift(""),p.length?n.pathname=p.join("/"):(n.pathname=null,n.path=null),c(n.pathname)&&c(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=p.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{punycode:11,querystring:14}],29:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],30:[function(e,t,n){(function(t,r){function i(e,t){var r={seen:[],stylize:o};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(t)?r.showHidden=t:t&&n._extend(r,t),T(r.showHidden)&&(r.showHidden=!1),T(r.depth)&&(r.depth=2),T(r.colors)&&(r.colors=!1),T(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),l(r,e,r.depth)}function s(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function o(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function l(e,t,r){if(e.customInspect&&t&&A(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return y(i)||(i=l(e,i,r)),i}var s=u(e,t);if(s)return s;var o=Object.keys(t),g=a(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),C(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return c(t);if(0===o.length){if(A(t)){var m=t.name?": "+t.name:"";return e.stylize("[Function"+m+"]","special")}if(S(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(C(t))return c(t)}var _="",v=!1,b=["{","}"];if(p(t)&&(v=!0,b=["[","]"]),A(t)){var T=t.name?": "+t.name:"";_=" [Function"+T+"]"}if(S(t)&&(_=" "+RegExp.prototype.toString.call(t)),E(t)&&(_=" "+Date.prototype.toUTCString.call(t)),C(t)&&(_=" "+c(t)),0===o.length&&(!v||0==t.length))return b[0]+_+b[1];if(r<0)return S(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var w;return w=v?h(e,t,r,g,o):o.map(function(n){return d(e,t,r,g,n,v)}),e.seen.pop(),f(w,_,b)}function u(e,t){if(T(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return v(t)?e.stylize(""+t,"number"):g(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,i){for(var s=[],o=0,a=t.length;o<a;++o)U(t,String(o))?s.push(d(e,t,n,r,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(d(e,t,n,r,i,!0))}),s}function d(e,t,n,r,i,s){var o,a,u;if(u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),U(r,i)||(o="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=m(n)?l(e,u.value,null):l(e,u.value,n-1),a.indexOf("\n")>-1&&(a=s?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),T(o)){if(s&&i.match(/^\d+$/))return a;o=JSON.stringify(""+i),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function f(e,t,n){var r=0,i=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function m(e){return null===e}function _(e){return null==e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function T(e){return void 0===e}function S(e){return w(e)&&"[object RegExp]"===I(e)}function w(e){return"object"==typeof e&&null!==e}function E(e){return w(e)&&"[object Date]"===I(e)}function C(e){return w(e)&&("[object Error]"===I(e)||e instanceof Error)}function A(e){return"function"==typeof e}function R(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function I(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}function x(){var e=new Date,t=[k(e.getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":");return[e.getDate(),L[e.getMonth()],t].join(" ")}function U(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var D=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,s=r.length,o=String(e).replace(D,function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return e}}),a=r[n];n<s;a=r[++n])o+=m(a)||!w(a)?" "+a:" "+i(a);return o},n.deprecate=function(e,i){function s(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}if(T(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var o=!1;return s};var O,N={};n.debuglog=function(e){if(T(O)&&(O=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!N[e])if(new RegExp("\\b"+e+"\\b","i").test(O)){var r=t.pid;N[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else N[e]=function(){};return N[e]},n.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=g,n.isNull=m,n.isNullOrUndefined=_,n.isNumber=v,n.isString=y,n.isSymbol=b,n.isUndefined=T,n.isRegExp=S,n.isObject=w,n.isDate=E,n.isError=C,n.isFunction=A,n.isPrimitive=R,n.isBuffer=e("./support/isBuffer");var L=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",x(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":29,_process:10,inherits:8}],31:[function(e,t,n){(function(n,r){"use strict";function i(){return"mqttjs_"+Math.random().toString(16).substr(2,8)}function s(e,t,n){try{var r=d.generate(t).toString("base64");!e.stream.write(r)&&n?e.stream.once("drain",n):n&&n()}catch(i){n?n(i):e.emit("error",i)}}function o(e,t,n){e.outgoingStore.put(t,function(r){return r?n&&n(r):void s(e,t,n)})}function a(){}function l(e,t){var n,r=this;if(!(this instanceof l))return new l(e,t);this.options=t||{};for(n in m)"undefined"==typeof this.options[n]?this.options[n]=m[n]:this.options[n]=t[n];this.ping_number=0,this.options.clientId=this.options.clientId||i(),this.streamBuilder=e,this.outgoingStore=this.options.outgoingStore||new c,this.incomingStore=this.options.incomingStore||new c,this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.disconnecting=!1,this.connackTimer=null,this.reconnectTimer=null,this.nextId=Math.floor(65535*Math.random()),this.outgoing={},this.on("connect",function(){this.connected=!0}),this.on("close",function(){this.connected=!1}),this.on("connect",this._setupPingTimer),this.on("connect",function(){function e(){var n=t.shift(),i=null;n&&(i=n.packet,r._sendPacket(i,function(t){n.cb&&n.cb(t),e()}))}var t=this.queue;e()}),this.on("close",function(){null!==r.pingTimer&&(clearInterval(r.pingTimer),r.pingTimer=null)}),this.on("close",this._setupReconnect),u.EventEmitter.call(this),this._setupStream()}var u=e("events"),c=e("./store"),h=e("end-of-stream"),d=e("mqtt-packet"),f=e("readable-stream").Writable,p=e("inherits"),g=r.setImmediate||function(e){n.nextTick(e)},m={keepalive:10,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0};p(l,u.EventEmitter),l.prototype._setupStream=function(){function e(){var t=u.shift(),r=o;t?n._handlePacket(t,e):(o=null,r())}var t,n=this,r=new f,i=d.parser(this.options),o=null,l=null,u=[];this._clearReconnect(),this.stream=this.streamBuilder(this),i.on("packet",function(e){u.push(e)}),r._write=function(t,n,r){o=r,i.parse(t),e()},this.stream.pipe(r),this.stream.on("error",a),h(this.stream,this.emit.bind(this,"close")),t=Object.create(this.options),t.cmd="connect",s(this,t),i.on("error",this.emit.bind(this,"error")),l=this.outgoingStore.createStream(),l.once("readable",function(){function e(){var t=l.read(1);t&&(!n.disconnecting&&!n.reconnectTimer&&0<n.options.reconnectPeriod?(l.read(0),n.outgoing[t.messageId]=function(){e()},n._sendPacket(t)):l.close())}e()}).on("error",this.emit.bind(this,"error")),this.connackTimer=setTimeout(function(){n._cleanUp(!0)},this.options.connectTimeout)},l.prototype._handlePacket=function(e,t){switch(e.cmd){case"publish":this._handlePublish(e,t);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(e),t();break;case"pubrel":this._handlePubrel(e,t);break;case"connack":this._handleConnack(e),t();break;case"pingresp":this._handlePingresp(e),t()}},l.prototype._checkDisconnecting=function(e){return this.disconnecting&&(e?e(new Error("client disconnecting")):this.emit(new Error("client disconnecting"))),this.disconnecting},l.prototype.publish=function(e,t,n,r){var i;if("function"==typeof n&&(r=n,n=null),n||(n={qos:0,retain:!1}),this._checkDisconnecting(r))return this;switch(r=r||a,i={cmd:"publish",topic:e,payload:t,qos:n.qos,retain:n.retain,messageId:this._nextId()},n.qos){case 1:case 2:this.outgoing[i.messageId]=r,this._sendPacket(i);break;default:this._sendPacket(i,r)}return this},l.prototype.subscribe=function(){var e,t=Array.prototype.slice.call(arguments),n=[],r=t.shift(),i=t.pop()||a,s=t.pop();return"string"==typeof r&&(r=[r]),this._checkDisconnecting(i)?this:("function"!=typeof i&&(s=i,i=a),s||(s={qos:0}),Array.isArray(r)?r.forEach(function(e){n.push({topic:e,qos:s.qos})}):Object.keys(r).forEach(function(e){n.push({topic:e,qos:r[e]})}),e={cmd:"subscribe",subscriptions:n,qos:1,retain:!1,dup:!1,messageId:this._nextId()},this.outgoing[e.messageId]=i,this._sendPacket(e),this)},l.prototype.unsubscribe=function(e,t){var n={cmd:"unsubscribe",qos:1,messageId:this._nextId()};return t=t||a,this._checkDisconnecting(t)?this:("string"==typeof e?n.unsubscriptions=[e]:"object"==typeof e&&e.length&&(n.unsubscriptions=e),this.outgoing[n.messageId]=t,this._sendPacket(n),this)},l.prototype.end=function(e){function t(){r.incomingStore.close(function(){r.outgoingStore.close(e)})}function n(){r._cleanUp(!1,t)}var r=this;return!!this.disconnecting||(this.disconnecting=!0,0<Object.keys(this.outgoing).length?this.once("outgoingEmpty",setTimeout.bind(null,n,10)):n(),this)},l.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},l.prototype._setupReconnect=function(){var e=this;!e.disconnecting&&!e.reconnectTimer&&0<e.options.reconnectPeriod&&(this.emit("offline"),e.reconnectTimer=setInterval(function(){e._reconnect()},e.options.reconnectPeriod))},l.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=!1)},l.prototype._cleanUp=function(e,t){t&&this.stream.on("close",t),e?this.stream.destroy():this._sendPacket({cmd:"disconnect"},g.bind(null,this.stream.end.bind(this.stream))),this._clearReconnect(),null!==this.pingTimer&&(clearInterval(this.pingTimer),this.pingTimer=null)},l.prototype._sendPacket=function(e,t){if(!this.connected)return this.queue.push({packet:e,cb:t});switch(e.qos){case 2:case 1:o(this,e,t);break;case 0:default:s(this,e,t)}},l.prototype._setupPingTimer=function(){var e=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=setInterval(function(){e._checkPing()},1e3*this.options.keepalive))},l.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):5==this.ping_number?(this.ping_number=0,this._cleanUp(!0)):(this.ping_number+=1,this.pingResp=!1,this._sendPacket({cmd:"pingreq"}))},l.prototype._handlePingresp=function(){this.ping_number=0,this.pingResp=!0},l.prototype._handleConnack=function(e){var t=e.returnCode,n=["","Unacceptable protocol version","Identifier rejected","Server unavailable","Bad username or password","Not authorized"];clearTimeout(this.connackTimer),0===t?this.emit("connect"):0<t&&this.emit("error",new Error("Connection refused: "+n[t]))},l.prototype._handlePublish=function(e,t){var n=e.topic.toString(),r=e.payload,i=e.qos,s=e.messageId,o=this;switch(i){case 2:this.incomingStore.put(e,function(){o._sendPacket({cmd:"pubrec",messageId:s},t)});break;case 1:this._sendPacket({cmd:"puback",messageId:s});case 0:this.emit("message",n,r,e),this.handleMessage(e,t)}},l.prototype.handleMessage=function(e,t){t()},l.prototype._handleAck=function(e){var t=e.messageId,n=e.cmd,r=null,i=this.outgoing[t],s=this;if(i){switch(n){case"pubcomp":case"puback":delete this.outgoing[t],this.outgoingStore.del(e,i);break;case"pubrec":r={cmd:"pubrel",qos:2,messageId:t},this._sendPacket(r);break;case"suback":delete this.outgoing[t],this.outgoingStore.del(e,function(t,n){var r,o=n.subscriptions,a=e.granted;if(t)return s.emit("error",t);for(r=0;r<a.length;r+=1)o[r].qos=a[r];i(null,o)});break;case"unsuback":delete this.outgoing[t],this.outgoingStore.del(e,i);break;default:s.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},l.prototype._handlePubrel=function(e,t){var n=e.messageId,r=this;r.incomingStore.get(e,function(i,s){return i?r.emit("error",i):("pubrel"!==s.cmd&&(r.emit("message",s.topic,s.payload,s),r.incomingStore.put(e)),void r._sendPacket({cmd:"pubcomp",messageId:n},t))})},l.prototype._nextId=function(){var e=this.nextId++;return 65535===e&&(this.nextId=1),e},t.exports=l}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":36,_process:10,"end-of-stream":37,events:7,inherits:40,"mqtt-packet":43,"readable-stream":56}],32:[function(e,t,n){(function(n){"use strict";function r(e){var t;e.auth&&(t=e.auth.match(/^(.+):(.+)$/),t?(e.username=t[1],e.password=t[2]):e.username=e.auth)}function i(e,t){function n(e){return t.servers&&(e._reconnectCount&&e._reconnectCount!==t.servers.length||(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,e._reconnectCount++),l[t.protocol](e,t)}if("object"!=typeof e||t||(t=e,e=null),t=t||{},e&&(t=a(o.parse(e,!0),t),t.protocol=t.protocol.replace(/\:$/,"")),r(t),t.query&&"string"==typeof t.query.clientId&&(t.clientId=t.query.clientId),t.cert&&t.key){if(!t.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss"].indexOf(t.protocol))switch(t.protocol){case"mqtt":t.protocol="mqtts";break;case"ws":t.protocol="wss";break;default:throw new Error('Unknown protocol for secure conenction: "'+t.protocol+'"!')}}if(l[t.protocol]||(t.protocol=u.filter(function(e){return"function"==typeof l[e]})[0]),!1===t.clean&&!t.clientId)throw new Error("Missing clientId for unclean clients");return new s(n,t)}var s=e("../client"),o=e("url"),a=e("xtend"),l={},u=[];"browser"!==n.title&&(l.mqtt=e("./tcp"),l.tcp=e("./tcp"),l.ssl=e("./tls"),l.tls=e("./tls"),l.mqtts=e("./tls")),l.ws=e("./ws"),l.wss=e("./ws"),u=["mqtt","mqtts","ws","wss"],t.exports=i,t.exports.connect=i}).call(this,e("_process"))},{"../client":31,"./tcp":33,"./tls":34,"./ws":35,_process:10,url:28,xtend:74}],33:[function(e,t,n){"use strict";function r(e,t){var n,r;return t.port=t.port||1883,t.hostname=t.hostname||t.host||"localhost",n=t.port,r=t.hostname,i.createConnection(n,r)}var i=e("net");t.exports=r},{net:1}],34:[function(e,t,n){"use strict";function r(e,t){function n(n){t.rejectUnauthorized&&e.emit("error",n),r.end()}var r;return t.port=t.port||8883,t.host=t.hostname||t.host||"localhost",t.rejectUnauthorized=!(!1===t.rejectUnauthorized),r=i.connect(t),r.on("secureConnect",function(){t.rejectUnauthorized&&!r.authorized?r.emit("error",new Error("TLS not authorized")):r.removeListener("error",n)}),r.on("error",n),r}var i=e("tls");t.exports=r},{tls:1}],35:[function(e,t,n){(function(n){"use strict";function r(e,t){var n=t.hostname||"localhost",r=String(t.port||80),i=t.path||"/",o=t.protocol+"://"+n+":"+r+i,a=s(o,{protocol:"mqttv3.1"});return a}function i(e,t){var n,r=o.parse(document.URL);return"https:"===r.protocol?t.protocol="wss":t.protocol="ws",t.hostname||(t.hostnme=t.host),t.hostname||(t.hostname=r.hostname,t.port||(t.port=r.port)),t.port||("wss"===t.protocol?t.port=443:t.port=80),t.path||(t.path="/"),n=t.protocol+"://"+t.hostname+":"+t.port+t.path,s(n,"mqttv3.1")}var s=e("websocket-stream"),o=e("url");"browser"!==n.title?t.exports=r:t.exports=i}).call(this,e("_process"))},{_process:10,url:28,"websocket-stream":73}],36:[function(e,t,n){"use strict";function r(){return this instanceof r?void(this._inflights={}):new r}var i=e("readable-stream").PassThrough,s={objectMode:!0};r.prototype.put=function(e,t){return this._inflights[e.messageId]=e,t&&t(),this},r.prototype.createStream=function(){var e=new i(s),t=Object.keys(this._inflights),n=0;for(n=0;n<t.length;n++)e.write(this._inflights[t[n]]);return e.end(),e},r.prototype.del=function(e,t){return e=this._inflights[e.messageId],e?(delete this._inflights[e.messageId],t(null,e)):t&&t(new Error("missing packet")),this},r.prototype.get=function(e,t){return e=this._inflights[e.messageId],e?t(null,e):t&&t(new Error("missing packet")),this},r.prototype.close=function(e){this._inflights=null,e&&e()},t.exports=r},{"readable-stream":56}],37:[function(e,t,n){var r=e("once"),i=function(){},s=function(e){return e.setHeader&&"function"==typeof e.abort},o=function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length},a=function(e,t,n){if("function"==typeof t)return a(e,null,t);t||(t={}),n=r(n||i);var l=e._writableState,u=e._readableState,c=t.readable||t.readable!==!1&&e.readable,h=t.writable||t.writable!==!1&&e.writable,d=function(){e.writable||f()},f=function(){h=!1,c||n()},p=function(){c=!1,h||n()},g=function(e){n(e?new Error("exited with error code: "+e):null)},m=function(){return(!c||u&&u.ended)&&(!h||l&&l.ended)?void 0:n(new Error("premature close"))},_=function(){e.req.on("finish",f)};return s(e)?(e.on("complete",f),e.on("abort",m),e.req?_():e.on("request",_)):h&&!l&&(e.on("end",d),e.on("close",d)),o(e)&&e.on("exit",g),e.on("end",p),e.on("finish",f),t.error!==!1&&e.on("error",n),e.on("close",m),function(){e.removeListener("complete",f),e.removeListener("abort",m),e.removeListener("request",_),e.req&&e.req.removeListener("finish",f),e.removeListener("end",d),e.removeListener("close",d),e.removeListener("finish",f),e.removeListener("exit",g),e.removeListener("end",p),e.removeListener("error",n),e.removeListener("close",m)}};t.exports=a},{once:39}],38:[function(e,t,n){function r(e,t){function n(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];var r=e.apply(this,t),i=t[t.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach(function(e){r[e]=i[e]}),r}if(e&&t)return r(e)(t);if("function"!=typeof e)throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(t){n[t]=e[t]}),n}t.exports=r},{}],39:[function(e,t,n){function r(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}var i=e("wrappy");t.exports=i(r),r.proto=r(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return r(this)},configurable:!0})})},{wrappy:38}],40:[function(e,t,n){arguments[4][8][0].apply(n,arguments)},{dup:8}],41:[function(e,t,n){t.exports.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"reserved"},t.exports.codes={};for(var r in t.exports.types){var i=t.exports.types[r];t.exports.codes[i]=r}t.exports.CMD_SHIFT=4,t.exports.CMD_MASK=240,t.exports.DUP_MASK=8,t.exports.QOS_MASK=3,t.exports.QOS_SHIFT=1,t.exports.RETAIN_MASK=1,t.exports.LENGTH_MASK=127,t.exports.LENGTH_FIN_MASK=128,t.exports.SESSIONPRESENT_MASK=1,t.exports.USERNAME_MASK=128,t.exports.PASSWORD_MASK=64,t.exports.WILL_RETAIN_MASK=32,t.exports.WILL_QOS_MASK=24,t.exports.WILL_QOS_SHIFT=3,t.exports.WILL_FLAG_MASK=4,t.exports.CLEAN_SESSION_MASK=2},{}],42:[function(e,t,n){(function(n){"use strict";function r(e){switch(e.cmd){case"connect":return i(e);case"connack":return s(e);case"publish":return o(e);case"puback":case"pubrec":case"pubrel":case"pubcomp":case"unsuback":return a(e);case"subscribe":return l(e);case"suback":return u(e);case"unsubscribe":return c(e);case"pingreq":case"pingresp":case"disconnect":return h(e);default:throw new Error("unknown command")}}function i(e){var e=e||{},t=e.protocolId||"MQTT",r=e.protocolVersion||4,i=e.will,s=e.clean,o=e.keepalive||0,a=e.clientId,l=e.username,u=e.password;void 0===s&&(s=!0);var c=0;if(!t||"string"!=typeof t&&!n.isBuffer(t))throw new Error("Invalid protocol id");if(c+=t.length+2,!r||"number"!=typeof r||r>255||r<0)throw new Error("Invalid protocol version");if(c+=1,!a||"string"!=typeof a&&!n.isBuffer(a))throw new Error("Invalid client id");if(c+=a.length+2,"number"!=typeof o||o<0||o>65535)throw new Error("Invalid keepalive");if(c+=2,c+=1,i){if("object"!=typeof i)throw new Error("Invalid will");if(!i.topic||"string"!=typeof i.topic)throw new Error("Invalid will topic");if(c+=i.topic.length+2,i.payload&&i.payload){if(!(i.payload.length>=0))throw new Error("Invalid will payload");c+="string"==typeof i.payload?n.byteLength(i.payload)+2:i.payload.length+2}else c+=2}if(l){if(!l.length)throw new Error("Invalid username");c+=l.length+2}if(u){if(!u.length)throw new Error("Invalid password");c+=u.length+2}var h=new n(1+d(c)+c),g=0;h.writeUInt8(y.codes.connect<<y.CMD_SHIFT,g++),g+=f(h,g,c),g+=v(h,g,t),h.writeUInt8(r,g++);var m=0;return m|=l?y.USERNAME_MASK:0,m|=u?y.PASSWORD_MASK:0,m|=i&&i.retain?y.WILL_RETAIN_MASK:0,m|=i&&i.qos?i.qos<<y.WILL_QOS_SHIFT:0,m|=i?y.WILL_FLAG_MASK:0,m|=s?y.CLEAN_SESSION_MASK:0,h.writeUInt8(m,g++),g+=_(h,g,o),g+=v(h,g,a),i&&(g+=p(h,g,i.topic),g+=v(h,g,i.payload)),l&&(g+=v(h,g,l)),u&&(g+=v(h,g,u)),h}function s(e){var e=e||{},t=e.returnCode;if("number"!=typeof t)throw new Error("Invalid return code");var r=new n(4),i=0;return r.writeUInt8(y.codes.connack<<y.CMD_SHIFT,i++),i+=f(r,i,2),r.writeUInt8(e.sessionPresent&&y.SESSIONPRESENT_MASK||0,i++),r.writeUInt8(t,i++),r}function o(e){var e=e||{},t=e.dup?y.DUP_MASK:0,r=e.qos,i=e.retain?y.RETAIN_MASK:0,s=e.topic,o=e.payload||b,a=e.messageId,l=0;if("string"==typeof s)l+=n.byteLength(s)+2;else{if(!n.isBuffer(s))throw new Error("Invalid topic");l+=s.length+2}if(l+=n.isBuffer(o)?o.length:n.byteLength(o),r&&"number"!=typeof a)throw new Error("Invalid message id");r&&(l+=2);var u=new n(1+d(l)+l),c=0;return u[c++]=y.codes.publish<<y.CMD_SHIFT|t|r<<y.QOS_SHIFT|i,c+=f(u,c,l),c+=v(u,c,s),r>0&&(c+=_(u,c,a)),n.isBuffer(o)?m(u,c,o):g(u,c,o),u}function a(e){var e=e||{},t=e.cmd||"puback",r=e.messageId,i=e.dup&&"pubrel"===t?y.DUP_MASK:0,s=0;if("pubrel"===t?s=1:"pubcomp"===t&&(s=2),"number"!=typeof r)throw new Error("Invalid message id");var o=new n(4),a=0;return o[a++]=y.codes[t]<<y.CMD_SHIFT|i|s<<y.QOS_SHIFT,a+=f(o,a,2),a+=_(o,a,r),o}function l(e){var e=e||{},t=e.dup?y.DUP_MASK:0,r=e.qos||0,i=e.messageId,s=e.subscriptions,o=0;if("number"!=typeof i)throw new Error("Invalid message id");if(o+=2,"object"!=typeof s||!s.length)throw new Error("Invalid subscriptions");for(var a=0;a<s.length;a+=1){var l=s[a].topic,r=s[a].qos;if("string"!=typeof l)throw new Error("Invalid subscriptions - invalid topic");if("number"!=typeof r)throw new Error("Invalid subscriptions - invalid qos");o+=n.byteLength(l)+2+1}var u=new n(1+d(o)+o),c=0;u.writeUInt8(y.codes.subscribe<<y.CMD_SHIFT|t|1<<y.QOS_SHIFT,c++),c+=f(u,c,o),c+=_(u,c,i);for(var a=0;a<s.length;a++){var h=s[a],l=h.topic,r=h.qos;c+=p(u,c,l),u.writeUInt8(r,c++)}return u}function u(e){var e=e||{},t=e.messageId,r=e.granted,i=0;if("number"!=typeof t)throw new Error("Invalid message id");if(i+=2,"object"!=typeof r||!r.length)throw new Error("Invalid qos vector");for(var s=0;s<r.length;s+=1){if("number"!=typeof r[s])throw new Error("Invalid qos vector");i+=1}var o=new n(1+d(i)+i),a=0;o.writeUInt8(y.codes.suback<<y.CMD_SHIFT,a++),a+=f(o,a,i),a+=_(o,a,t);for(var s=0;s<r.length;s++)o.writeUInt8(r[s],a++);return o}function c(e){var e=e||{},t=e.messageId,r=e.dup?y.DUP_MASK:0,i=e.unsubscriptions,s=0;if("number"!=typeof t)throw new Error("Invalid message id");if(s+=2,"object"!=typeof i||!i.length)throw new Error("Invalid unsubscriptions");for(var o=0;o<i.length;o+=1){if("string"!=typeof i[o])throw new Error("Invalid unsubscriptions");s+=n.byteLength(i[o])+2}var a=new n(1+d(s)+s),l=0;a[l++]=y.codes.unsubscribe<<y.CMD_SHIFT|r|1<<y.QOS_SHIFT,l+=f(a,l,s),l+=_(a,l,t);for(var o=0;o<i.length;o++)l+=p(a,l,i[o]);return a}function h(e){var t=new n(2);return t[0]=y.codes[e.cmd]<<4,t[1]=0,t}function d(e){return e>=0&&e<128?1:e>=128&&e<16384?2:e>=16384&&e<2097152?3:e>=2097152&&e<268435456?4:0}function f(e,t,n){var r=0,i=t;do r=n%128|0,n=n/128|0,n>0&&(r=128|r),e.writeUInt8(r,t++);while(n>0);return t-i}function p(e,t,r){var i=n.byteLength(r);return _(e,t,i),g(e,t+2,r),i+2}function g(e,t,n){e.write(n,t)}function m(e,t,n){return n.copy(e,t),n.length}function _(e,t,n){return e.writeUInt8(n>>8,t),e.writeUInt8(255&n,t+1),2}function v(e,t,n){var r=0;return n&&"string"==typeof n?r+=p(e,t+r,n):n?(r+=_(e,t+r,n.length),r+=m(e,t+r,n)):r+=_(e,t+r,0),r}var y=e("./constants"),b=new n(0);t.exports=r}).call(this,e("buffer").Buffer)},{"./constants":41,buffer:3}],43:[function(e,t,n){"use strict";n.parser=e("./parser"),n.generate=e("./generate")},{"./generate":42,"./parser":46}],44:[function(e,t,n){(function(n){function r(e){if(!(this instanceof r))return new r(e);if(this._bufs=[],this.length=0,"function"==typeof e){this._callback=e;var t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on("pipe",function(e){e.on("error",t)}),this.on("unpipe",function(e){e.removeListener("error",t)})}else n.isBuffer(e)?this.append(e):Array.isArray(e)&&e.forEach(function(e){n.isBuffer(e)&&this.append(e)}.bind(this));i.call(this)}var i=e("readable-stream/duplex"),s=e("util");s.inherits(r,i),r.prototype._offset=function(e){for(var t,n=0,r=0;r<this._bufs.length;r++){if(t=n+this._bufs[r].length,e<t)return[r,e-n];n=t}},r.prototype.append=function(e){var t=n.isBuffer(e)||e instanceof r;return this._bufs.push(t?e:new n(e)),this.length+=e.length,this},r.prototype._write=function(e,t,n){this.append(e),n&&n()},r.prototype._read=function(e){return this.length?(e=Math.min(e,this.length),this.push(this.slice(0,e)),void this.consume(e)):this.push(null)},r.prototype.end=function(e){i.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},r.prototype.get=function(e){return this.slice(e,e+1)[0]},r.prototype.slice=function(e,t){return this.copy(null,0,e,t)},r.prototype.copy=function(e,t,r,i){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof i||i>this.length)&&(i=this.length),r>=this.length)return e||new n(0);if(i<=0)return e||new n(0);var s,o,a=!!e,l=this._offset(r),u=i-r,c=u,h=a&&t||0,d=l[1];if(0===r&&i==this.length){if(!a)return n.concat(this._bufs);for(o=0;o<this._bufs.length;o++)this._bufs[o].copy(e,h),h+=this._bufs[o].length;return e}if(c<=this._bufs[l[0]].length-d)return a?this._bufs[l[0]].copy(e,t,d,d+c):this._bufs[l[0]].slice(d,d+c);for(a||(e=new n(u)),o=l[0];o<this._bufs.length;o++){if(s=this._bufs[o].length-d,!(c>s)){this._bufs[o].copy(e,h,d,d+c);break}this._bufs[o].copy(e,h,d),h+=s,c-=s,d&&(d=0)}return e},r.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)},r.prototype.consume=function(e){for(;this._bufs.length;){if(!(e>this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},r.prototype.duplicate=function(){for(var e=0,t=new r;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},r.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var t in e)!function(t){r.prototype[t]=function(n){return this.slice(n,n+e[t])[t](0)}}(t)}(),t.exports=r}).call(this,e("buffer").Buffer)},{buffer:3,"readable-stream/duplex":47,util:30}],45:[function(e,t,n){function r(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}t.exports=r},{}],46:[function(e,t,n){function r(){return this instanceof r?(this._list=i(),this._newPacket(),this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],void(this._stateCounter=0)):new r}var i=e("bl"),s=e("inherits"),o=e("events").EventEmitter,a=e("./packet"),l=e("./constants");s(r,o),r.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new a,!0},r.prototype.parse=function(e){for(this._list.append(e);(this.packet.length!=-1||this._list.length>0)&&this[this._states[this._stateCounter]]();)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},r.prototype._parseHeader=function(){var e=this._list.readUInt8(0);return this.packet.cmd=l.types[e>>l.CMD_SHIFT],this.packet.retain=0!==(e&l.RETAIN_MASK),this.packet.qos=e>>l.QOS_SHIFT&l.QOS_MASK,this.packet.dup=0!==(e&l.DUP_MASK),this._list.consume(1),!0},r.prototype._parseLength=function(){for(var e,t=0,n=1,r=0,i=!0;t<5&&(e=this._list.readUInt8(t++),r+=n*(e&l.LENGTH_MASK),n*=128,0!==(e&l.LENGTH_FIN_MASK));)if(this._list.length<=t){i=!1;break}return i&&(this.packet.length=r,this._list.consume(t)),i},r.prototype._parsePayload=function(){var e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseMessageId();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":case"disconnect":break;default:this.emit("error",new Error("not supported"))}e=!0}return e},r.prototype._parseConnect=function(){var e,t,n,r,i,s,o={},a=this.packet;if(e=this._parseString(),null===e)return this.emit("error",new Error("cannot parse protocol id"));if(a.protocolId=e,this._pos>this._list.length)return this.emit("error",new Error("packet too short"));if(a.protocolVersion=this._list.readUInt8(this._pos),this._pos++,o.username=this._list.readUInt8(this._pos)&l.USERNAME_MASK,o.password=this._list.readUInt8(this._pos)&l.PASSWORD_MASK,o.will=this._list.readUInt8(this._pos)&l.WILL_FLAG_MASK,o.will&&(a.will={},a.will.retain=0!==(this._list.readUInt8(this._pos)&l.WILL_RETAIN_MASK),a.will.qos=(this._list.readUInt8(this._pos)&l.WILL_QOS_MASK)>>l.WILL_QOS_SHIFT),a.clean=0!==(this._list.readUInt8(this._pos)&l.CLEAN_SESSION_MASK),this._pos++,a.keepalive=this._parseNum(),a.keepalive===-1)return this.emit("error",new Error("packet too short"));if(t=this._parseString(),null===t)return this.emit("error",new Error("packet too short"));if(a.clientId=t,o.will){if(n=this._parseString(),null===n)return this.emit("error",new Error("cannot parse will topic"));if(a.will.topic=n,r=this._parseBuffer(),null===r)return this.emit("error",new Error("cannot parse will payload"));a.will.payload=r}if(o.username){if(s=this._parseString(),null===s)return this.emit("error",new Error("cannot parse username"));a.username=s}if(o.password){if(i=this._parseBuffer(),null===i)return this.emit("error",new Error("cannot parse username"));a.password=i}return a},r.prototype._parseConnack=function(){var e=this.packet;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&l.SESSIONPRESENT_MASK),e.returnCode=this._list.readUInt8(this._pos),e.returnCode===-1)return this.emit("error",new Error("cannot parse return code"))},r.prototype._parsePublish=function(){var e=this.packet;return e.topic=this._parseString(),null===e.topic?this.emit("error",new Error("cannot parse topic")):void(e.qos>0&&!this._parseMessageId()||(e.payload=this._list.slice(this._pos,e.length)))},r.prototype._parseSubscribe=function(){var e,t,n=this.packet;if(1!=n.qos)return this.emit("error",new Error("wrong subscribe header"));if(n.subscriptions=[],this._parseMessageId())for(;this._pos<n.length;){if(e=this._parseString(),null===e)return this.emit("error",new Error("Parse error - cannot parse topic"));t=this._list.readUInt8(this._pos++),n.subscriptions.push({topic:e,qos:t})}},r.prototype._parseSuback=function(){if(this.packet.granted=[],this._parseMessageId())for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))},r.prototype._parseUnsubscribe=function(){var e=this.packet;if(e.unsubscriptions=[],this._parseMessageId())for(;this._pos<e.length;){var t;if(t=this._parseString(),null===t)return this.emit("error",new Error("cannot parse topic"));e.unsubscriptions.push(t)}},r.prototype._parseUnsuback=function(){if(!this._parseMessageId())return this.emit("error",new Error("cannot parse message id"))},r.prototype._parseMessageId=function(){var e=this.packet;return e.messageId=this._parseNum(),null!==e.messageId||(this.emit("error",new Error("cannot parse message id")),!1)},r.prototype._parseString=function(e){var t,n=this._parseNum();return n===-1||n+this._pos>this._list.length?null:(t=this._list.toString("utf8",this._pos,this._pos+n),this._pos+=n,t)},r.prototype._parseBuffer=function(){var e,t=this._parseNum();return t===-1||t+this._pos>this._list.length?null:(e=this._list.slice(this._pos,this._pos+t),this._pos+=t,e)},r.prototype._parseNum=function(){if(2>this._pos+this._list.length)return-1;var e=this._list.readUInt16BE(this._pos);return this._pos+=2,e},t.exports=r},{"./constants":41,"./packet":45,bl:44,events:7,inherits:40}],47:[function(e,t,n){arguments[4][15][0].apply(n,arguments)},{"./lib/_stream_duplex.js":48,dup:15}],48:[function(e,t,n){arguments[4][16][0].apply(n,arguments)},{"./_stream_readable":50,"./_stream_writable":52,_process:10,"core-util-is":53,dup:16,inherits:40}],49:[function(e,t,n){arguments[4][17][0].apply(n,arguments)},{"./_stream_transform":51,"core-util-is":53,dup:17,inherits:40}],50:[function(e,t,n){(function(n){function r(t,n){t=t||{};var r=t.highWaterMark;this.highWaterMark=r||0===r?r:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(I||(I=e("string_decoder/").StringDecoder),this.decoder=new I(t.encoding),this.encoding=t.encoding)}function i(e){return this instanceof i?(this._readableState=new r(e,this),this.readable=!0,void A.call(this)):new i(e)}function s(e,t,n,r,i){var s=u(t,n);if(s)e.emit("error",s);else if(null===n||void 0===n)t.reading=!1,t.ended||c(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&i){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else!t.decoder||i||r||(n=t.decoder.write(n)),t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):(t.reading=!1,t.buffer.push(n)),t.needReadable&&h(e),f(e,t);else i||(t.reading=!1);return o(t)}function o(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length);
}function a(e){if(e>=k)e=k;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}function l(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=a(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function u(e,t){var n=null;return E.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function c(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.length>0?h(e):b(e)}function h(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?n.nextTick(function(){d(e)}):d(e))}function d(e){e.emit("readable")}function f(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(function(){p(e,t)}))}function p(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function g(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&m(e)}}function m(e){function t(e,t,i){var s=e.write(n);!1===s&&r.awaitDrain++}var n,r=e._readableState;for(r.awaitDrain=0;r.pipesCount&&null!==(n=e.read());)if(1===r.pipesCount?t(r.pipes,0,null):T(r.pipes,t),e.emit("data",n),r.awaitDrain>0)return;return 0===r.pipesCount?(r.flowing=!1,void(C.listenerCount(e,"data")>0&&v(e))):void(r.ranOut=!0)}function _(){this._readableState.ranOut&&(this._readableState.ranOut=!1,m(this))}function v(e,t){var r=e._readableState;if(r.flowing)throw new Error("Cannot switch to old mode now.");var i=t||!1,s=!1;e.readable=!0,e.pipe=A.prototype.pipe,e.on=e.addListener=A.prototype.on,e.on("readable",function(){s=!0;for(var t;!i&&null!==(t=e.read());)e.emit("data",t);null===t&&(s=!1,e._readableState.needReadable=!0)}),e.pause=function(){i=!0,this.emit("pause")},e.resume=function(){i=!1,s?n.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function y(e,t){var n,r=t.buffer,i=t.length,s=!!t.decoder,o=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(o)n=r.shift();else if(!e||e>=i)n=s?r.join(""):E.concat(r,i),r.length=0;else if(e<r[0].length){var a=r[0];n=a.slice(0,e),r[0]=a.slice(e)}else if(e===r[0].length)n=r.shift();else{n=s?"":new E(e);for(var l=0,u=0,c=r.length;u<c&&l<e;u++){var a=r[0],h=Math.min(e-l,a.length);s?n+=a.slice(0,h):a.copy(n,l,0,h),h<a.length?r[0]=a.slice(h):r.shift(),l+=h}}return n}function b(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,n.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function T(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function S(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=i;var w=e("isarray"),E=e("buffer").Buffer;i.ReadableState=r;var C=e("events").EventEmitter;C.listenerCount||(C.listenerCount=function(e,t){return e.listeners(t).length});var A=e("stream"),R=e("core-util-is");R.inherits=e("inherits");var I;R.inherits(i,A),i.prototype.push=function(e,t){var n=this._readableState;return"string"!=typeof e||n.objectMode||(t=t||n.defaultEncoding,t!==n.encoding&&(e=new E(e,t),t="")),s(this,n,e,t,!1)},i.prototype.unshift=function(e){var t=this._readableState;return s(this,t,e,"",!0)},i.prototype.setEncoding=function(t){I||(I=e("string_decoder/").StringDecoder),this._readableState.decoder=new I(t),this._readableState.encoding=t};var k=8388608;i.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var n,r=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h(this),null;if(e=l(e,t),0===e&&t.ended)return n=null,t.length>0&&t.decoder&&(n=y(e,t),t.length-=n.length),0===t.length&&b(this),n;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=l(r,t)),n=e>0?y(e,t):null,null===n&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&b(this),n},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function r(e){e===c&&s()}function i(){e.end()}function s(){e.removeListener("close",a),e.removeListener("finish",l),e.removeListener("drain",p),e.removeListener("error",o),e.removeListener("unpipe",r),c.removeListener("end",i),c.removeListener("end",s),e._writableState&&!e._writableState.needDrain||p()}function o(t){u(),e.removeListener("error",o),0===C.listenerCount(e,"error")&&e.emit("error",t)}function a(){e.removeListener("finish",l),u()}function l(){e.removeListener("close",a),u()}function u(){c.unpipe(e)}var c=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1;var d=(!t||t.end!==!1)&&e!==n.stdout&&e!==n.stderr,f=d?i:s;h.endEmitted?n.nextTick(f):c.once("end",f),e.on("unpipe",r);var p=g(c);return e.on("drain",p),e._events&&e._events.error?w(e._events.error)?e._events.error.unshift(o):e._events.error=[o,e._events.error]:e.on("error",o),e.once("close",a),e.once("finish",l),e.emit("pipe",c),h.flowing||(this.on("readable",_),h.flowing=!0,n.nextTick(function(){m(c)})),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",_),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",_),t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var i=S(t.pipes,e);return i===-1?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var n=A.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||v(this),"readable"===e&&this.readable){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&h(this,r):this.read(0))}return n},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){v(this),this.read(0),this.emit("resume")},i.prototype.pause=function(){v(this,!0),this.emit("pause")},i.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){var s=r.push(i);s||(n=!0,e.pause())}});for(var i in e)"function"==typeof e[i]&&"undefined"==typeof this[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var s=["error","close","destroy","pause","resume"];return T(s,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){n&&(n=!1,e.resume())},r},i._fromList=y}).call(this,e("_process"))},{_process:10,buffer:3,"core-util-is":53,events:7,inherits:40,isarray:54,stream:26,"string_decoder/":55}],51:[function(e,t,n){function r(e,t){this.afterTransform=function(e,n){return i(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function i(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&e.push(n),i&&i(t);var s=e._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&e._read(s.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);a.call(this,e);var t=(this._transformState=new r(e,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){o(t,e)}):o(t)})}function o(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=(e._readableState,e._transformState);if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=s;var a=e("./_stream_duplex"),l=e("core-util-is");l.inherits=e("inherits"),l.inherits(s,a),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("not implemented")},s.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":48,"core-util-is":53,inherits:40}],52:[function(e,t,n){(function(n){function r(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function i(e,t){e=e||{};var n=e.highWaterMark;this.highWaterMark=n||0===n?n:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=e.decodeStrings===!1;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){f(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function s(t){var n=e("./_stream_duplex");return this instanceof s||this instanceof n?(this._writableState=new i(t,this),this.writable=!0,void S.call(this)):new s(t)}function o(e,t,r){var i=new Error("write after end");e.emit("error",i),n.nextTick(function(){r(i)})}function a(e,t,r,i){var s=!0;if(!b.isBuffer(r)&&"string"!=typeof r&&null!==r&&void 0!==r&&!t.objectMode){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),n.nextTick(function(){i(o)}),s=!1}return s}function l(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new b(t,n)),t}function u(e,t,n,i,s){n=l(t,n,i),b.isBuffer(n)&&(i="buffer");var o=t.objectMode?1:n.length;t.length+=o;var a=t.length<t.highWaterMark;return a||(t.needDrain=!0),t.writing?t.buffer.push(new r(n,i,s)):c(e,t,o,n,i,s),a}function c(e,t,n,r,i,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,e._write(r,i,t.onwrite),t.sync=!1}function h(e,t,r,i,s){r?n.nextTick(function(){s(i)}):s(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function f(e,t){var r=e._writableState,i=r.sync,s=r.writecb;if(d(r),t)h(e,r,i,t,s);else{var o=_(e,r);o||r.bufferProcessing||!r.buffer.length||m(e,r),i?n.nextTick(function(){p(e,r,o,s)}):p(e,r,o,s)}}function p(e,t,n,r){n||g(e,t),r(),n&&v(e,t)}function g(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function m(e,t){t.bufferProcessing=!0;for(var n=0;n<t.buffer.length;n++){var r=t.buffer[n],i=r.chunk,s=r.encoding,o=r.callback,a=t.objectMode?1:i.length;if(c(e,t,a,i,s,o),t.writing){n++;break}}t.bufferProcessing=!1,n<t.buffer.length?t.buffer=t.buffer.slice(n):t.buffer.length=0}function _(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function v(e,t){var n=_(e,t);return n&&(t.finished=!0,e.emit("finish")),n}function y(e,t,r){t.ending=!0,v(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r)),t.ended=!0}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
t.exports=s;var b=e("buffer").Buffer;s.WritableState=i;var T=e("core-util-is");T.inherits=e("inherits");var S=e("stream");T.inherits(s,S),s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},s.prototype.write=function(e,t,n){var r=this._writableState,i=!1;return"function"==typeof t&&(n=t,t=null),b.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=function(){}),r.ended?o(this,r,n):a(this,r,e,n)&&(i=u(this,r,e,t,n)),i},s.prototype._write=function(e,t,n){n(new Error("not implemented"))},s.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),"undefined"!=typeof e&&null!==e&&this.write(e,t),r.ending||r.finished||y(this,r,n)}}).call(this,e("_process"))},{"./_stream_duplex":48,_process:10,buffer:3,"core-util-is":53,inherits:40,stream:26}],53:[function(e,t,n){arguments[4][21][0].apply(n,arguments)},{buffer:3,dup:21}],54:[function(e,t,n){arguments[4][9][0].apply(n,arguments)},{dup:9}],55:[function(e,t,n){arguments[4][27][0].apply(n,arguments)},{buffer:3,dup:27}],56:[function(e,t,n){var r=e("stream");n=t.exports=e("./lib/_stream_readable.js"),n.Stream=r,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":48,"./lib/_stream_passthrough.js":49,"./lib/_stream_readable.js":50,"./lib/_stream_transform.js":51,"./lib/_stream_writable.js":52,stream:26}],57:[function(e,t,n){arguments[4][24][0].apply(n,arguments)},{"./lib/_stream_transform.js":51,dup:24}],58:[function(e,t,n){(function(n,r){var i=e("readable-stream"),s=e("end-of-stream"),o=e("util"),a=new r([0]),l=function(e,t){e._corked?e.once("uncork",t):t()},u=function(e,t){return function(n){n?e.destroy("premature close"===n.message?null:n):t&&!e._ended&&e.end()}},c=function(e,t){return e?e._writableState&&e._writableState.finished?t():e._writableState?e.end(t):(e.end(),void t()):t()},h=function(e){return new i.Readable({objectMode:!0,highWaterMark:16}).wrap(e)},d=function(e,t,n){return this instanceof d?(i.Duplex.call(this,n),this._writable=null,this._readable=null,this._readable2=null,this._forwardDestroy=!n||n.destroy!==!1,this._forwardEnd=!n||n.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),void(t&&this.setReadable(t))):new d(e,t,n)};o.inherits(d,i.Duplex),d.obj=function(e,t,n){return n||(n={}),n.objectMode=!0,n.highWaterMark=16,new d(e,t,n)},d.prototype.cork=function(){1===++this._corked&&this.emit("cork")},d.prototype.uncork=function(){this._corked&&0===--this._corked&&this.emit("uncork")},d.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed)return void(e&&e.destroy&&e.destroy());if(null===e||e===!1)return void this.end();var t=this,r=s(e,{writable:!0,readable:!1},u(this,this._forwardEnd)),i=function(){var e=t._ondrain;t._ondrain=null,e&&e()},o=function(){t._writable.removeListener("drain",i),r()};this._unwrite&&n.nextTick(i),this._writable=e,this._writable.on("drain",i),this._unwrite=o,this.uncork()},d.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed)return void(e&&e.destroy&&e.destroy());if(null===e||e===!1)return this.push(null),void this.resume();var t=this,n=s(e,{writable:!1,readable:!0},u(this)),r=function(){t._forward()},i=function(){t.push(null)},o=function(){t._readable2.removeListener("readable",r),t._readable2.removeListener("end",i),n()};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:h(e),this._readable2.on("readable",r),this._readable2.on("end",i),this._unread=o,this._forward()},d.prototype._read=function(){this._drained=!0,this._forward()},d.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){this._forwarding=!0;for(var e,t=this._readable2._readableState;null!==(e=this._readable2.read(t.buffer.length?t.buffer[0].length:t.length));)this._drained=this.push(e);this._forwarding=!1}},d.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0;var t=this;n.nextTick(function(){t._destroy(e)})}},d.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit("error",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},d.prototype._write=function(e,t,n){return this.destroyed?n():this._corked?l(this,this._write.bind(this,e,t,n)):e===a?this._finish(n):this._writable?void(this._writable.write(e)===!1?this._ondrain=n:n()):n()},d.prototype._finish=function(e){var t=this;this.emit("preend"),l(this,function(){c(t._forwardEnd&&t._writable,function(){t._writableState.prefinished===!1&&(t._writableState.prefinished=!0),t.emit("prefinish"),l(t,e)})})},d.prototype.end=function(e,t,n){return"function"==typeof e?this.end(null,null,e):"function"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this.write(a),i.Writable.prototype.end.call(this,n))},t.exports=d}).call(this,e("_process"),e("buffer").Buffer)},{_process:10,buffer:3,"end-of-stream":59,"readable-stream":70,util:30}],59:[function(e,t,n){var r=e("once"),i=function(){},s=function(e){return e.setHeader&&"function"==typeof e.abort},o=function(e,t,n){if("function"==typeof t)return o(e,null,t);t||(t={}),n=r(n||i);var a=e._writableState,l=e._readableState,u=t.readable||t.readable!==!1&&e.readable,c=t.writable||t.writable!==!1&&e.writable,h=function(){e.writable||d()},d=function(){c=!1,u||n()},f=function(){u=!1,c||n()},p=function(){return(!u||l&&l.ended)&&(!c||a&&a.ended)?void 0:n(new Error("premature close"))},g=function(){e.req.on("finish",d)};return s(e)?(e.on("complete",d),e.on("abort",p),e.req?g():e.on("request",g)):c&&!a&&(e.on("end",h),e.on("close",h)),e.on("end",f),e.on("finish",d),t.error!==!1&&e.on("error",n),e.on("close",p),function(){e.removeListener("complete",d),e.removeListener("abort",p),e.removeListener("request",g),e.req&&e.req.removeListener("finish",d),e.removeListener("end",h),e.removeListener("close",h),e.removeListener("finish",d),e.removeListener("end",f),e.removeListener("error",n),e.removeListener("close",p)}};t.exports=o},{once:61}],60:[function(e,t,n){arguments[4][38][0].apply(n,arguments)},{dup:38}],61:[function(e,t,n){arguments[4][39][0].apply(n,arguments)},{dup:39,wrappy:60}],62:[function(e,t,n){arguments[4][16][0].apply(n,arguments)},{"./_stream_readable":64,"./_stream_writable":66,_process:10,"core-util-is":67,dup:16,inherits:40}],63:[function(e,t,n){arguments[4][17][0].apply(n,arguments)},{"./_stream_transform":65,"core-util-is":67,dup:17,inherits:40}],64:[function(e,t,n){arguments[4][18][0].apply(n,arguments)},{"./_stream_duplex":62,_process:10,buffer:3,"core-util-is":67,dup:18,events:7,inherits:40,isarray:68,stream:26,"string_decoder/":69,util:2}],65:[function(e,t,n){arguments[4][19][0].apply(n,arguments)},{"./_stream_duplex":62,"core-util-is":67,dup:19,inherits:40}],66:[function(e,t,n){arguments[4][20][0].apply(n,arguments)},{"./_stream_duplex":62,_process:10,buffer:3,"core-util-is":67,dup:20,inherits:40,stream:26}],67:[function(e,t,n){arguments[4][21][0].apply(n,arguments)},{buffer:3,dup:21}],68:[function(e,t,n){arguments[4][9][0].apply(n,arguments)},{dup:9}],69:[function(e,t,n){arguments[4][27][0].apply(n,arguments)},{buffer:3,dup:27}],70:[function(e,t,n){arguments[4][23][0].apply(n,arguments)},{"./lib/_stream_duplex.js":62,"./lib/_stream_passthrough.js":63,"./lib/_stream_readable.js":64,"./lib/_stream_transform.js":65,"./lib/_stream_writable.js":66,dup:23,stream:26}],71:[function(e,t,n){(function(n){function r(e){o.call(this,e),this._destroyed=!1}function i(e,t,n){n(null,e)}function s(e){return function(t,n,r){return"function"==typeof t&&(r=n,n=t,t={}),"function"!=typeof n&&(n=i),"function"!=typeof r&&(r=null),e(t,n,r)}}var o=e("readable-stream/transform"),a=e("util").inherits,l=e("xtend");a(r,o),r.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;n.nextTick(function(){e&&t.emit("error",e),t.emit("close")})}},t.exports=s(function(e,t,n){var i=new r(e);return i._transform=t,n&&(i._flush=n),i}),t.exports.ctor=s(function(e,t,n){function i(t){return this instanceof i?(this.options=l(e,t),void r.call(this,this.options)):new i(t)}return a(i,r),i.prototype._transform=t,n&&(i.prototype._flush=n),i}),t.exports.obj=s(function(e,t,n){var i=new r(l({objectMode:!0,highWaterMark:16},e));return i._transform=t,n&&(i._flush=n),i})}).call(this,e("_process"))},{_process:10,"readable-stream/transform":57,util:30,xtend:74}],72:[function(e,t,n){function r(e,t,n){var r;return r=t?new s(e,t):new s(e)}var i=function(){return this}(),s=i.WebSocket||i.MozWebSocket;t.exports=s?r:null,s&&(r.prototype=s.prototype)},{}],73:[function(e,t,n){(function(n,r){function i(e,t){function i(e,t,n){m.send(e,n)}function l(e,t,n){try{m.send(e)}catch(r){return n(r)}n()}function u(e){m.close(),e()}function c(){g.setReadable(v),g.setWritable(v),g.emit("connect")}function h(){g.end(),g.destroy()}function d(e){g.destroy(e)}function f(e){var t=e.data;t instanceof ArrayBuffer&&(t=new r(new Uint8Array(t))),v.push(t)}function p(){m.close()}var g,m,_="browser"===n.title?l:i,v=s(_,u);return"object"==typeof e?m=e:(m=new a(e,t),m.binaryType="arraybuffer"),1===m.readyState?g=v:(g=o(),m.addEventListener("open",c)),g.socket=m,m.addEventListener("close",h),m.addEventListener("error",d),m.addEventListener("message",f),v.on("close",p),g}var s=e("through2"),o=e("duplexify"),a=e("ws");t.exports=i}).call(this,e("_process"),e("buffer").Buffer)},{_process:10,buffer:3,duplexify:58,through2:71,ws:72}],74:[function(e,t,n){function r(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}t.exports=r},{}],75:[function(e,t,n){function r(){}function i(e){var t=[];if(0==e.indexOf(o))t.push(e);else{var n=e.lastIndexOf("@");t.push(e.substr(0,n)),t.push(e.substr(n+1))}return t}var s=e("mqtt"),o="p@";t.exports.et_client=r,t.exports.pubPrefix=o,r.prototype.etInitConfig=function(e){if(e){var t=this;t.userid=e.userid,t.appkey=e.appkey,t.clean=e.clean,t.im_port=e.im_port,t.im_host=e.im_host}},r.prototype.etConnect=function(e){var t=this,n={port:t.im_port,hostname:t.im_host,pathname:"/mqtt",clean:t.clean,reconnectPeriod:0,keepalive:200,username:t.userid,password:hex_md5(t.appkey+t.userid),clientId:t.userid+"@"+etGetSDKPlatform()+"|"+etGetIMProtocolNo()+"|"+etGetSDKNo()};t.client=s.connect(n),t.client.on("connect",function(){var t={};t.type="connect",e&&e(t)}),t.client.on("reconnect",function(){var t={};t.type="reconnect",e&&e(t)}),t.client.on("close",function(){var t={};t.type="close",e&&e(t)}),t.client.on("offline",function(){var t={};t.type="offline",e&&e(t)}),t.client.on("error",function(t){var n={};n.type="error",n.error=t,e&&e(n)}),t.client.on("message",function(n,r,s){var a={};a.type="message";var l=i(n.toString());if(0==n.toString().indexOf(o))a.topic=l[0],a.message=r;else if(0!=l.length)if("all"==l[1])if(r=r.toString(),"http"==l[0]){var u=r.toString().split(":");t.http_host=u[0],t.http_port=u[1]}else a.topic=l[0],a.message=r;else if("online"==l[0])a.from_userid=l[1],a.topic="friend@online";else if("offline"==l[0])a.from_userid=l[1],a.topic="friend@offline";else if("chat_ex"==l[0])r=$.parseJSON(r.toString()),a.topic=l[0],a.from_userid=l[1],a.from_nickname=r.nickname,a.datatime=r.datetime,a.message=r.content;else if("status"==l[0]){var c=r.toString().split("&");a.topic=l[0],"1"==c[0]?(a.from_userid=c[1],a.status="online"):(a.from_userid=c[1],a.status="offline")}else if("buddy_state_list"==l[0]){var h=r.toString().split(",");"0"==l[1]?(a.topic="friendlist@offline",a.from_userid=h):"1"==l[1]?(a.topic="friendlist@online",a.from_userid=h):(a.topic="friendlist@all",a.from_userid=h)}else a.topic=l[0],a.from_userid=l[1],a.message=r;else a.type="error",a.error||(a.error={}),a.error.message="can not parse im protocols";a.packet=s,e&&e(a)})},r.prototype.etSubscribeAllBuddies=function(e,t){var n=this;"function"==typeof e&&(t=e,e={qos:1});var r={topic:"state_sub_buddies@all",message:""};n.etPublish(r,e,t)},r.prototype.etUnSubscribeAllBuddies=function(e,t){var n=this;"function"==typeof e&&(t=e,e={qos:1});var r={topic:"state_unsub_buddies@all",message:""};n.etPublish(r,e,t)},r.prototype.etGetUserStatus=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={qos:1});var i={topic:"status@"+e.userid,message:e.message};r.etPublish(i,t,n)},r.prototype.etGetBuddysEx=function(e,t,n){var r=this;e.require="buddy_state_list@"+e.require,"function"==typeof t&&(n=t,t={qos:1});var i={topic:"buddy_state_list@"+e.require,message:""};r.etPublish(i,t,n)},r.prototype.etChatTo=function(e,t,n){var r=this;if("function"==typeof t&&(n=t,t={qos:1}),byteLength(e.message)>65515){var i={message:"消息长度过长",type:"error"};n(i)}else{var s={topic:"chat@"+e.userid,message:e.message};r.etPublish(s,t,n)}},r.prototype.etChatToJson=function(e,t,n){var r=this;if("function"==typeof t&&(n=t,t={qos:1}),e.message=JSON.stringify(e.message),byteLength(e.message)>65515){var i={message:"消息长度过长",type:"error"};n&&n(i)}else{var s={topic:"chat_ex@"+e.userid,message:e.message};r.etPublish(s,t,n)}},r.prototype.etStateSubscribe=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={qos:1});var i={topic:"state_sub@"+e.userid,message:""};r.etPublish(i,t,n)},r.prototype.etStateUnsubscribe=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={qos:1});var i={topic:"state_unsub@"+e.userid,message:""};r.etPublish(i,t,n)},r.prototype.etOfflineMessage=function(e,t){var n="offline_msg@0",r=this;"function"==typeof e&&(t=e,e={qos:1});var i={topic:n,message:""};r.etPublish(i,e,t)},r.prototype.etFileTo=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={qos:1});var i={topic:"sfile@"+e.userid,message:e.message};r.etPublish(i,t,n)},r.prototype.etVideoTo=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={qos:1});var i={topic:"svideo@"+e.userid,message:e.message};r.etPublish(i,t,n)},r.prototype.etPublish=function(e,t,n){if(e.topic.indexOf("+")!=-1||e.topic.indexOf("#")!=-1){var r={message:"error：主题或ID中不可以包含+和#号！",type:"error"};return void(n&&n(r))}var i=this;"function"==typeof t&&(n=t,t={qos:1}),i.client.publish(e.topic,e.message,t,n)},r.prototype.etPublishPrefix=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={qos:1});var i={topic:o+e.topic,message:e.message};r.etPublish(i,t,n)},r.prototype.etSubscribe=function(e,t,n){if(e.indexOf("+")!=-1||e.indexOf("#")!=-1){var r={message:"error：+和#号不可以包含在主题中！",type:"error"};return void(n&&n(r))}var i=this;"function"==typeof t&&(n=t,t={qos:1}),i.client.subscribe(e,t,n)},r.prototype.etSubscribePrefix=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={qos:1}),r.etSubscribe(o+e,t,n)},r.prototype.etUnsubscribe=function(e,t){if(e.indexOf("+")!=-1||e.indexOf("#")!=-1){var n={message:"error：+和#号不可以包含在主题中！",type:"error"};return void(t&&t(n))}var r=this;r.client.unsubscribe(e,t)},r.prototype.etUnsubscribePrefix=function(e,t){var n=this;n.etUnsubscribe(o+e,t)},r.prototype.etDisconnect=function(e){var t=this;t.client.end(e)}},{mqtt:32}]},{},[75])(75)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.et_av=e()}}(function(){var e;return function t(e,n,r){function i(o,a){if(!n[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};e[o][0].call(c.exports,function(t){var n=e[o][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),u=n.slice(),r=u.length,l=0;l<r;l++)u[l].apply(this,s);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],3:[function(e,t,n){function r(){c=!1,a.length?u=a.concat(u):h=-1,u.length&&i()}function i(){if(!c){var e=setTimeout(r);c=!0;for(var t=u.length;t;){for(a=u,u=[];++h<t;)a&&a[h].run();h=-1,t=u.length}a=null,c=!1,clearTimeout(e)}}function s(e,t){this.fun=e,this.array=t}function o(){}var a,l=t.exports={},u=[],c=!1,h=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new s(e,t)),1!==u.length||c||setTimeout(i,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=o,l.addListener=o,l.once=o,l.off=o,l.removeListener=o,l.removeAllListeners=o,l.emit=o,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],4:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],5:[function(e,t,n){(function(t,r){function i(e,t){var r={seen:[],stylize:o};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(t)?r.showHidden=t:t&&n._extend(r,t),T(r.showHidden)&&(r.showHidden=!1),T(r.depth)&&(r.depth=2),T(r.colors)&&(r.colors=!1),T(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),l(r,e,r.depth)}function s(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function o(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function l(e,t,r){if(e.customInspect&&t&&A(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return y(i)||(i=l(e,i,r)),i}var s=u(e,t);if(s)return s;var o=Object.keys(t),g=a(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),C(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return c(t);if(0===o.length){if(A(t)){var m=t.name?": "+t.name:"";return e.stylize("[Function"+m+"]","special")}if(S(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(C(t))return c(t)}var _="",v=!1,b=["{","}"];if(p(t)&&(v=!0,b=["[","]"]),A(t)){var T=t.name?": "+t.name:"";_=" [Function"+T+"]"}if(S(t)&&(_=" "+RegExp.prototype.toString.call(t)),E(t)&&(_=" "+Date.prototype.toUTCString.call(t)),C(t)&&(_=" "+c(t)),0===o.length&&(!v||0==t.length))return b[0]+_+b[1];if(r<0)return S(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var w;return w=v?h(e,t,r,g,o):o.map(function(n){return d(e,t,r,g,n,v)}),e.seen.pop(),f(w,_,b)}function u(e,t){if(T(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return v(t)?e.stylize(""+t,"number"):g(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,i){for(var s=[],o=0,a=t.length;o<a;++o)U(t,String(o))?s.push(d(e,t,n,r,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(d(e,t,n,r,i,!0))}),s}function d(e,t,n,r,i,s){var o,a,u;if(u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),U(r,i)||(o="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=m(n)?l(e,u.value,null):l(e,u.value,n-1),a.indexOf("\n")>-1&&(a=s?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),T(o)){if(s&&i.match(/^\d+$/))return a;o=JSON.stringify(""+i),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function f(e,t,n){var r=0,i=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function m(e){return null===e}function _(e){return null==e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function T(e){return void 0===e}function S(e){return w(e)&&"[object RegExp]"===I(e)}function w(e){return"object"==typeof e&&null!==e}function E(e){return w(e)&&"[object Date]"===I(e)}function C(e){return w(e)&&("[object Error]"===I(e)||e instanceof Error)}function A(e){return"function"==typeof e}function R(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function I(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}function x(){var e=new Date,t=[k(e.getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":");return[e.getDate(),L[e.getMonth()],t].join(" ")}function U(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var D=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,s=r.length,o=String(e).replace(D,function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return e}}),a=r[n];n<s;a=r[++n])o+=m(a)||!w(a)?" "+a:" "+i(a);return o},n.deprecate=function(e,i){function s(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}if(T(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var o=!1;return s};var O,N={};n.debuglog=function(e){if(T(O)&&(O=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!N[e])if(new RegExp("\\b"+e+"\\b","i").test(O)){var r=t.pid;N[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else N[e]=function(){};return N[e]},n.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=g,n.isNull=m,n.isNullOrUndefined=_,n.isNumber=v,n.isString=y,n.isSymbol=b,n.isUndefined=T,n.isRegExp=S,n.isObject=w,n.isDate=E,n.isError=C,n.isFunction=A,n.isPrimitive=R,n.isBuffer=e("./support/isBuffer");var L=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",x(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":4,_process:3,inherits:2}],6:[function(e,t,n){function r(e){this.video_local=e.video_local,this.video_remote=e.video_remote,this.UAeventListener=e.ua_events_listener,this.SessionEventListener=e.session_events_listener,this.pcConfig=e.pcConfig,e.logDebug&&i.debug.enable("*"),this.ua=new i.UA(e.sip_ua)}var i=e("jssip"),s=function(){return i.rtcninja.canRenegotiate};t.exports.et_av=r,r.prototype.start=function(){var e=this;e.ua.on("connected",function(t){t.type="connected",e.UAeventListener(t)}),e.ua.on("disconnected",function(t){t.type="disconnected",e.UAeventListener(t)}),e.ua.on("newRTCSession",function(t){e.session=t.session,t.type="newRTCSession",e.UAeventListener(t),"incoming"===e.session.direction&&("false"===t.request.getHeader("X-Can-Renegotiate")?e.session.data.remoteCanRenegotiateRTC=!1:e.session.data.remoteCanRenegotiateRTC=!0),e.session.on("connecting",function(t){t.type="connecting",e.SessionEventListener(t),e.session.connection.getLocalStreams().length>0&&(window.localStream=e.session.connection.getLocalStreams()[0])}),e.session.on("progress",function(t){t.type="progress",t.session=e.session,e.SessionEventListener(t)}),e.session.on("accepted",function(t){t.type="accepted",e.SessionEventListener(t),e.session.connection.getLocalStreams().length>0&&(e.localStream=e.session.connection.getLocalStreams()[0],e.video_local=t.video_local||e.video_local,e.video_local=i.rtcninja.attachMediaStream(e.video_local,e.localStream),e.video_local.volume=0,window.localStream=e.localStream),"remote"===t.originator&&("false"===t.response.getHeader("X-Can-Renegotiate")?e.session.data.remoteCanRenegotiateRTC=!1:e.session.data.remoteCanRenegotiateRTC=!0)}),e.session.on("addstream",function(t){t.type="addstream",e.SessionEventListener(t),console.log("Tryit: addstream()"),e.remoteStream=t.stream,e.video_remote=t.video_remote||e.video_remote,e.video_remote=i.rtcninja.attachMediaStream(e.video_remote,e.remoteStream)}),e.session.on("failed",function(t){t.type="failed",e.SessionEventListener(t),e.video_local&&(e.video_local.src=""),e.video_remote&&(e.video_remote.src=""),e.session=null,e.localStream&&i.rtcninja.closeMediaStream(e.localStream),e.localStream=null}),e.session.on("newDTMF",function(t){t.type="newDTMF",e.SessionEventListener(t)}),e.session.on("hold",function(t){t.type="hold",e.SessionEventListener(t)}),e.session.on("unhold",function(t){t.type="unhold",e.SessionEventListener(t)}),e.session.on("ended",function(t){t.type="ended",e.SessionEventListener(t),e.video_local&&(e.video_local.src=""),e.video_remote&&(e.video_remote.src=""),e.session=null,e.localStream&&i.rtcninja.closeMediaStream(e.localStream),e.localStream=null}),e.session.on("update",function(t){t.type="update",e.SessionEventListener(t);var n=t.request;n.body&&(s()&&e.session.data.remoteCanRenegotiateRTC||(console.warn("Tryit: UPDATE received, resetting PeerConnection"),e.session.connection.reset(),e.session.connection.addStream(e.localStream)))}),e.session.on("reinvite",function(t){t.type="reinvite",e.SessionEventListener(t);var n=t.request;n.body&&(s()&&e.session.data.remoteCanRenegotiateRTC||(console.warn("Tryit: reINVITE received, resetting PeerConnection"),e.session.connection.reset(),e.session.connection.addStream(e.localStream)))})}),e.ua.on("newMessage",function(t){t.type="newMessage",e.UAeventListener(t)}),e.ua.on("registered",function(t){t.type="registered",e.UAeventListener(t),console.info("Registered")}),e.ua.on("unregistered",function(t){t.type="unregistered",e.UAeventListener(t),console.info("Deregistered")}),e.ua.on("registrationFailed",function(t){t.type="registrationFailed",e.UAeventListener(t),console.info("Registration failure")}),e.ua.start()},r.prototype.stop=function(){var e=this;e.ua.stop()},r.prototype.register=function(){var e=this;e.ua.register()},r.prototype.unregister=function(e){var t=this;t.config=e,t.ua.unregister(e)},r.prototype.call=function(e,t){var n=this;t=t||{},t.pcConfig=t.pcConfig||n.pcConfig,t.mediaConstraints=t.mediaConstraints||{audio:!0,video:!0},t.rtcOfferConstraints=t.rtcOfferConstraints||{offerToReceiveAudio:t.mediaConstraints.audio?1:0,offerToReceiveVideo:t.mediaConstraints.video?1:0},t.extraHeaders=t.extraHeaders||["X-Foo: foo","X-Bar: bar"],t.rtcConstraints=t.rtcConstraints||{optional:[{DtlsSrtpKeyAgreement:"true"},{googIPv6:!1}]},n.ua.call(e,t)},r.prototype.answer=function(e){var t=this;t.session&&(e=e||{},e.pcConfig=e.pcConfig||t.pcConfig,e.mediaConstraints=e.mediaConstraints||{audio:!0,video:!0},e.rtcOfferConstraints=e.rtcOfferConstraints||{offerToReceiveAudio:e.mediaConstraints.audio?1:0,offerToReceiveVideo:e.mediaConstraints.video?1:0},e.extraHeaders=e.extraHeaders||["X-Can-Renegotiate: "+String(s())],e.rtcConstraints=e.rtcConstraints||{optional:[{DtlsSrtpKeyAgreement:"true"},{googIPv6:!1}]},t.session.answer(e))},r.prototype.hangup=function(){var e=this;e.session&&8!=e.session.status&&e.session.terminate()},r.prototype.mute=function(e){var t=this;t.session&&t.session.mute(e)},r.prototype.unmute=function(e){var t=this;t.session&&t.session.unmute(e)},r.prototype.hasWebRTC=function(){return i.rtcninja.hasWebRTC()}},{jssip:13}],7:[function(e,t,n){var r=e("../package.json"),i={USER_AGENT:r.title+" "+r.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:300,MIN_SESSION_EXPIRES:200};t.exports=i},{"../package.json":49}],8:[function(e,t,n){function r(e,t,n,r){var a;return this.uac_pending_reply=!1,this.uas_pending_reply=!1,t.hasHeader("contact")?(r=t instanceof o.IncomingResponse?t.status_code<200?i.STATUS_EARLY:i.STATUS_CONFIRMED:r||i.STATUS_CONFIRMED,a=t.parseHeader("contact"),"UAS"===n?(this.id={call_id:t.call_id,local_tag:t.to_tag,remote_tag:t.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.remote_seqnum=t.cseq,this.local_uri=t.parseHeader("to").uri,this.remote_uri=t.parseHeader("from").uri,this.remote_target=a.uri,this.route_set=t.getHeaders("record-route")):"UAC"===n&&(this.id={call_id:t.call_id,local_tag:t.from_tag,remote_tag:t.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.local_seqnum=t.cseq,this.local_uri=t.parseHeader("from").uri,this.remote_uri=t.parseHeader("to").uri,this.remote_target=a.uri,this.route_set=t.getHeaders("record-route").reverse()),this.owner=e,e.ua.dialogs[this.id.toString()]=this,void s("new "+n+" dialog created with status "+(this.state===i.STATUS_EARLY?"EARLY":"CONFIRMED"))):{error:"unable to create a Dialog without Contact header field"}}t.exports=r;var i={STATUS_EARLY:1,STATUS_CONFIRMED:2};r.C=i;var s=e("debug")("JsSIP:Dialog"),o=e("./SIPMessage"),a=e("./Constants"),l=e("./Transactions"),u=e("./Dialog/RequestSender");r.prototype={update:function(e,t){this.state=i.STATUS_CONFIRMED,s("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){s("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(e,t,n){var r,i;return t=t&&t.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),r=e===a.CANCEL||e===a.ACK?this.local_seqnum:this.local_seqnum+=1,i=new o.OutgoingRequest(e,this.remote_target,this.owner.ua,{cseq:r,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},t,n),i.dialog=this,i},checkInDialogRequest:function(e){var t=this;if(this.remote_seqnum){if(e.cseq<this.remote_seqnum)return e.method!==a.ACK&&e.reply(500),!1;e.cseq>this.remote_seqnum&&(this.remote_seqnum=e.cseq)}else this.remote_seqnum=e.cseq;if(e.method===a.INVITE||e.method===a.UPDATE&&e.body){if(this.uac_pending_reply===!0)e.reply(491);else{if(this.uas_pending_reply===!0){var n=(10*Math.random()|0)+1;return e.reply(500,null,["Retry-After:"+n]),!1}this.uas_pending_reply=!0,e.server_transaction.on("stateChanged",function r(){this.state!==l.C.STATUS_ACCEPTED&&this.state!==l.C.STATUS_COMPLETED&&this.state!==l.C.STATUS_TERMINATED||(e.server_transaction.removeListener("stateChanged",r),t.uas_pending_reply=!1)})}e.hasHeader("contact")&&e.server_transaction.on("stateChanged",function(){this.state===l.C.STATUS_ACCEPTED&&(t.remote_target=e.parseHeader("contact").uri)})}else e.method===a.NOTIFY&&e.hasHeader("contact")&&e.server_transaction.on("stateChanged",function(){this.state===l.C.STATUS_COMPLETED&&(t.remote_target=e.parseHeader("contact").uri)});return!0},sendRequest:function(e,t,n){n=n||{};var r=n.extraHeaders&&n.extraHeaders.slice()||[],i=n.body||null,s=this.createRequest(t,r,i),o=new u(this,e,s);o.send()},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}}},{"./Constants":7,"./Dialog/RequestSender":9,"./SIPMessage":24,"./Transactions":26,debug:32}],9:[function(e,t,n){function r(e,t,n){this.dialog=e,this.applicant=t,this.request=n,this.reattempt=!1,this.reattemptTimer=null}t.exports=r;var i=e("../Constants"),s=e("../Transactions"),o=e("../RTCSession"),a=e("../RequestSender");r.prototype={send:function(){var e=this,t=new a(this,this.dialog.owner.ua);t.send(),(this.request.method===i.INVITE||this.request.method===i.UPDATE&&this.request.body)&&t.clientTransaction.state!==s.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,t.clientTransaction.on("stateChanged",function n(){this.state!==s.C.STATUS_ACCEPTED&&this.state!==s.C.STATUS_COMPLETED&&this.state!==s.C.STATUS_TERMINATED||(t.clientTransaction.removeListener("stateChanged",n),e.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(e){var t=this;408===e.status_code||481===e.status_code?this.applicant.onDialogError(e):e.method===i.INVITE&&491===e.status_code?this.reattempt?this.applicant.receiveResponse(e):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){t.applicant.owner.status!==o.C.STATUS_TERMINATED&&(t.reattempt=!0,t.request_sender.send())},1e3)):this.applicant.receiveResponse(e)}}},{"../Constants":7,"../RTCSession":17,"../RequestSender":23,"../Transactions":26}],10:[function(e,t,n){function r(e){this.username=e.configuration.authorization_user,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}t.exports=r;var i=e("debug")("JsSIP:DigestAuthentication"),s=e("./Utils");r.prototype.authenticate=function(e,t){if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return i('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return i("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return i("challenge without Digest nonce, authentication aborted"),!1;if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return i('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=e.method,this.uri=e.ruri,this.cnonce=s.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},r.prototype.calculateResponse=function(){var e,t;e=s.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(t=s.calculateMD5(this.method+":"+this.uri),this.response=s.calculateMD5(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=s.calculateMD5(this.method+":"+this.uri+":"+s.calculateMD5(this.body?this.body:"")),this.response=s.calculateMD5(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):null===this.qop&&(t=s.calculateMD5(this.method+":"+this.uri),this.response=s.calculateMD5(e+":"+this.nonce+":"+t))},r.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},r.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e}},{"./Utils":30,debug:32}],11:[function(e,t,n){var r={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),NotReadyError:function(){var e=function(e){this.code=4,this.name="NOT_READY_ERROR",this.message=e};return e.prototype=new Error,e}()};t.exports=r},{}],12:[function(e,t,n){t.exports=function(){function t(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var n={parse:function(n,r){function i(e){mr<vr||(mr>vr&&(vr=mr,yr=[]),yr.push(e))}function s(){var e;return"\r\n"===n.substr(mr,2)?(e="\r\n",mr+=2):(e=null,0===_r&&i('"\\r\\n"')),e}function o(){var e;return/^[0-9]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[0-9]")),e}function a(){var e;return/^[a-zA-Z]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[a-zA-Z]")),e}function l(){var e;return/^[0-9a-fA-F]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[0-9a-fA-F]")),e}function u(){var e;return e=d(),null===e&&(e=f()),e}function c(){var e;return/^[\0-\xFF]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[\\0-\\xFF]")),e}function h(){var e;return/^["]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i('["]')),e}function d(){var e;return 32===n.charCodeAt(mr)?(e=" ",mr++):(e=null,0===_r&&i('" "')),e}function f(){var e;return 9===n.charCodeAt(mr)?(e="\t",mr++):(e=null,0===_r&&i('"\\t"')),e}function p(){var e;return/^[a-zA-Z0-9]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[a-zA-Z0-9]")),e}function g(){var e;return 59===n.charCodeAt(mr)?(e=";",mr++):(e=null,0===_r&&i('";"')),null===e&&(47===n.charCodeAt(mr)?(e="/",mr++):(e=null,0===_r&&i('"/"')),null===e&&(63===n.charCodeAt(mr)?(e="?",mr++):(e=null,0===_r&&i('"?"')),null===e&&(58===n.charCodeAt(mr)?(e=":",mr++):(e=null,0===_r&&i('":"')),null===e&&(64===n.charCodeAt(mr)?(e="@",mr++):(e=null,0===_r&&i('"@"')),null===e&&(38===n.charCodeAt(mr)?(e="&",mr++):(e=null,0===_r&&i('"&"')),null===e&&(61===n.charCodeAt(mr)?(e="=",mr++):(e=null,0===_r&&i('"="')),null===e&&(43===n.charCodeAt(mr)?(e="+",mr++):(e=null,0===_r&&i('"+"')),null===e&&(36===n.charCodeAt(mr)?(e="$",mr++):(e=null,0===_r&&i('"$"')),null===e&&(44===n.charCodeAt(mr)?(e=",",mr++):(e=null,0===_r&&i('","'))))))))))),e}function m(){var e;return e=p(),null===e&&(e=_()),e}function _(){var e;return 45===n.charCodeAt(mr)?(e="-",mr++):(e=null,0===_r&&i('"-"')),null===e&&(95===n.charCodeAt(mr)?(e="_",mr++):(e=null,0===_r&&i('"_"')),null===e&&(46===n.charCodeAt(mr)?(e=".",mr++):(e=null,0===_r&&i('"."')),null===e&&(33===n.charCodeAt(mr)?(e="!",mr++):(e=null,0===_r&&i('"!"')),null===e&&(126===n.charCodeAt(mr)?(e="~",mr++):(e=null,0===_r&&i('"~"')),null===e&&(42===n.charCodeAt(mr)?(e="*",mr++):(e=null,0===_r&&i('"*"')),null===e&&(39===n.charCodeAt(mr)?(e="'",mr++):(e=null,0===_r&&i('"\'"')),null===e&&(40===n.charCodeAt(mr)?(e="(",mr++):(e=null,0===_r&&i('"("')),null===e&&(41===n.charCodeAt(mr)?(e=")",mr++):(e=null,0===_r&&i('")"')))))))))),e}function v(){var e,t,r,s,o;return s=mr,o=mr,37===n.charCodeAt(mr)?(e="%",mr++):(e=null,0===_r&&i('"%"')),null!==e?(t=l(),null!==t?(r=l(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){return t.join("")}(s,e)),null===e&&(mr=s),e}function y(){var e,t,n,r,i,o;for(r=mr,i=mr,o=mr,e=[],t=u();null!==t;)e.push(t),t=u();if(null!==e?(t=s(),null!==t?e=[e,t]:(e=null,mr=o)):(e=null,mr=o),e=null!==e?e:"",null!==e){if(n=u(),null!==n)for(t=[];null!==n;)t.push(n),n=u();else t=null;null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return null!==e&&(e=function(e){return" "}(r)),null===e&&(mr=r),e}function b(){var e;return e=y(),e=null!==e?e:""}function T(){var e,t,r,s,o;for(s=mr,o=mr,e=[],t=d(),null===t&&(t=f());null!==t;)e.push(t),t=d(),null===t&&(t=f());return null!==e?(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return":"}(s)),null===e&&(mr=s),e}function S(){var e,t,r,i,s,o,a;if(s=mr,o=mr,t=w(),null!==t)for(e=[];null!==t;)e.push(t),t=w();else e=null;if(null!==e){for(t=[],a=mr,r=[],i=y();null!==i;)r.push(i),i=y();for(null!==r?(i=w(),null!==i?r=[r,i]:(r=null,mr=a)):(r=null,mr=a);null!==r;){for(t.push(r),a=mr,r=[],i=y();null!==i;)r.push(i),i=y();null!==r?(i=w(),null!==i?r=[r,i]:(r=null,mr=a)):(r=null,mr=a)}null!==t?e=[e,t]:(e=null,mr=o)}else e=null,mr=o;return null!==e&&(e=function(e){return n.substring(mr,e)}(s)),null===e&&(mr=s),e}function w(){var e;return/^[!-~]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[!-~]")),null===e&&(e=E()),e}function E(){var e;return/^[\x80-\uFFFF]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[\\x80-\\uFFFF]")),e}function C(){var e;return/^[\x80-\xBF]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[\\x80-\\xBF]")),e}function A(){var e;return e=o(),null===e&&(/^[a-f]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[a-f]"))),e}function R(){var e,t,r;if(r=mr,t=p(),null===t&&(45===n.charCodeAt(mr)?(t="-",mr++):(t=null,0===_r&&i('"-"')),null===t&&(46===n.charCodeAt(mr)?(t=".",mr++):(t=null,0===_r&&i('"."')),null===t&&(33===n.charCodeAt(mr)?(t="!",mr++):(t=null,0===_r&&i('"!"')),null===t&&(37===n.charCodeAt(mr)?(t="%",mr++):(t=null,0===_r&&i('"%"')),null===t&&(42===n.charCodeAt(mr)?(t="*",mr++):(t=null,0===_r&&i('"*"')),null===t&&(95===n.charCodeAt(mr)?(t="_",mr++):(t=null,0===_r&&i('"_"')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')),null===t&&(96===n.charCodeAt(mr)?(t="`",mr++):(t=null,0===_r&&i('"`"')),null===t&&(39===n.charCodeAt(mr)?(t="'",mr++):(t=null,0===_r&&i('"\'"')),null===t&&(126===n.charCodeAt(mr)?(t="~",mr++):(t=null,0===_r&&i('"~"')))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=p(),null===t&&(45===n.charCodeAt(mr)?(t="-",mr++):(t=null,0===_r&&i('"-"')),null===t&&(46===n.charCodeAt(mr)?(t=".",mr++):(t=null,0===_r&&i('"."')),null===t&&(33===n.charCodeAt(mr)?(t="!",mr++):(t=null,0===_r&&i('"!"')),null===t&&(37===n.charCodeAt(mr)?(t="%",mr++):(t=null,0===_r&&i('"%"')),null===t&&(42===n.charCodeAt(mr)?(t="*",mr++):(t=null,0===_r&&i('"*"')),null===t&&(95===n.charCodeAt(mr)?(t="_",mr++):(t=null,0===_r&&i('"_"')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')),null===t&&(96===n.charCodeAt(mr)?(t="`",mr++):(t=null,0===_r&&i('"`"')),null===t&&(39===n.charCodeAt(mr)?(t="'",mr++):(t=null,0===_r&&i('"\'"')),null===t&&(126===n.charCodeAt(mr)?(t="~",mr++):(t=null,0===_r&&i('"~"'))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(mr,e)}(r)),null===e&&(mr=r),e}function I(){var e,t,r;if(r=mr,t=p(),null===t&&(45===n.charCodeAt(mr)?(t="-",mr++):(t=null,0===_r&&i('"-"')),null===t&&(33===n.charCodeAt(mr)?(t="!",mr++):(t=null,0===_r&&i('"!"')),null===t&&(37===n.charCodeAt(mr)?(t="%",mr++):(t=null,0===_r&&i('"%"')),null===t&&(42===n.charCodeAt(mr)?(t="*",mr++):(t=null,0===_r&&i('"*"')),null===t&&(95===n.charCodeAt(mr)?(t="_",mr++):(t=null,0===_r&&i('"_"')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')),null===t&&(96===n.charCodeAt(mr)?(t="`",mr++):(t=null,0===_r&&i('"`"')),null===t&&(39===n.charCodeAt(mr)?(t="'",mr++):(t=null,0===_r&&i('"\'"')),null===t&&(126===n.charCodeAt(mr)?(t="~",mr++):(t=null,0===_r&&i('"~"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=p(),null===t&&(45===n.charCodeAt(mr)?(t="-",mr++):(t=null,0===_r&&i('"-"')),null===t&&(33===n.charCodeAt(mr)?(t="!",mr++):(t=null,0===_r&&i('"!"')),null===t&&(37===n.charCodeAt(mr)?(t="%",mr++):(t=null,0===_r&&i('"%"')),null===t&&(42===n.charCodeAt(mr)?(t="*",mr++):(t=null,0===_r&&i('"*"')),null===t&&(95===n.charCodeAt(mr)?(t="_",mr++):(t=null,0===_r&&i('"_"')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')),null===t&&(96===n.charCodeAt(mr)?(t="`",mr++):(t=null,0===_r&&i('"`"')),null===t&&(39===n.charCodeAt(mr)?(t="'",mr++):(t=null,0===_r&&i('"\'"')),null===t&&(126===n.charCodeAt(mr)?(t="~",mr++):(t=null,0===_r&&i('"~"')))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(mr,e)}(r)),null===e&&(mr=r),e}function k(){var e;return 40===n.charCodeAt(mr)?(e="(",mr++):(e=null,0===_r&&i('"("')),null===e&&(41===n.charCodeAt(mr)?(e=")",mr++):(e=null,0===_r&&i('")"')),null===e&&(60===n.charCodeAt(mr)?(e="<",mr++):(e=null,0===_r&&i('"<"')),null===e&&(62===n.charCodeAt(mr)?(e=">",mr++):(e=null,0===_r&&i('">"')),null===e&&(64===n.charCodeAt(mr)?(e="@",mr++):(e=null,0===_r&&i('"@"')),null===e&&(44===n.charCodeAt(mr)?(e=",",mr++):(e=null,0===_r&&i('","')),null===e&&(59===n.charCodeAt(mr)?(e=";",mr++):(e=null,0===_r&&i('";"')),null===e&&(58===n.charCodeAt(mr)?(e=":",mr++):(e=null,0===_r&&i('":"')),null===e&&(92===n.charCodeAt(mr)?(e="\\",mr++):(e=null,0===_r&&i('"\\\\"')),null===e&&(e=h(),null===e&&(47===n.charCodeAt(mr)?(e="/",mr++):(e=null,0===_r&&i('"/"')),null===e&&(91===n.charCodeAt(mr)?(e="[",mr++):(e=null,0===_r&&i('"["')),null===e&&(93===n.charCodeAt(mr)?(e="]",mr++):(e=null,0===_r&&i('"]"')),null===e&&(63===n.charCodeAt(mr)?(e="?",mr++):(e=null,0===_r&&i('"?"')),null===e&&(61===n.charCodeAt(mr)?(e="=",mr++):(e=null,0===_r&&i('"="')),null===e&&(123===n.charCodeAt(mr)?(e="{",mr++):(e=null,0===_r&&i('"{"')),null===e&&(125===n.charCodeAt(mr)?(e="}",mr++):(e=null,0===_r&&i('"}"')),null===e&&(e=d(),null===e&&(e=f())))))))))))))))))),e}function x(){var e,t,r;if(r=mr,t=p(),null===t&&(45===n.charCodeAt(mr)?(t="-",mr++):(t=null,0===_r&&i('"-"')),null===t&&(46===n.charCodeAt(mr)?(t=".",mr++):(t=null,0===_r&&i('"."')),null===t&&(33===n.charCodeAt(mr)?(t="!",mr++):(t=null,0===_r&&i('"!"')),null===t&&(37===n.charCodeAt(mr)?(t="%",mr++):(t=null,0===_r&&i('"%"')),null===t&&(42===n.charCodeAt(mr)?(t="*",mr++):(t=null,0===_r&&i('"*"')),null===t&&(95===n.charCodeAt(mr)?(t="_",mr++):(t=null,0===_r&&i('"_"')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')),null===t&&(96===n.charCodeAt(mr)?(t="`",mr++):(t=null,0===_r&&i('"`"')),null===t&&(39===n.charCodeAt(mr)?(t="'",mr++):(t=null,0===_r&&i('"\'"')),null===t&&(126===n.charCodeAt(mr)?(t="~",mr++):(t=null,0===_r&&i('"~"')),null===t&&(40===n.charCodeAt(mr)?(t="(",mr++):(t=null,0===_r&&i('"("')),null===t&&(41===n.charCodeAt(mr)?(t=")",mr++):(t=null,0===_r&&i('")"')),null===t&&(60===n.charCodeAt(mr)?(t="<",mr++):(t=null,0===_r&&i('"<"')),null===t&&(62===n.charCodeAt(mr)?(t=">",mr++):(t=null,0===_r&&i('">"')),null===t&&(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null===t&&(92===n.charCodeAt(mr)?(t="\\",mr++):(t=null,0===_r&&i('"\\\\"')),null===t&&(t=h(),null===t&&(47===n.charCodeAt(mr)?(t="/",mr++):(t=null,0===_r&&i('"/"')),null===t&&(91===n.charCodeAt(mr)?(t="[",mr++):(t=null,0===_r&&i('"["')),null===t&&(93===n.charCodeAt(mr)?(t="]",mr++):(t=null,0===_r&&i('"]"')),null===t&&(63===n.charCodeAt(mr)?(t="?",mr++):(t=null,0===_r&&i('"?"')),null===t&&(123===n.charCodeAt(mr)?(t="{",mr++):(t=null,0===_r&&i('"{"')),null===t&&(125===n.charCodeAt(mr)?(t="}",mr++):(t=null,0===_r&&i('"}"'))))))))))))))))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=p(),null===t&&(45===n.charCodeAt(mr)?(t="-",mr++):(t=null,0===_r&&i('"-"')),null===t&&(46===n.charCodeAt(mr)?(t=".",mr++):(t=null,0===_r&&i('"."')),null===t&&(33===n.charCodeAt(mr)?(t="!",mr++):(t=null,0===_r&&i('"!"')),null===t&&(37===n.charCodeAt(mr)?(t="%",mr++):(t=null,0===_r&&i('"%"')),null===t&&(42===n.charCodeAt(mr)?(t="*",mr++):(t=null,0===_r&&i('"*"')),null===t&&(95===n.charCodeAt(mr)?(t="_",mr++):(t=null,0===_r&&i('"_"')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')),null===t&&(96===n.charCodeAt(mr)?(t="`",mr++):(t=null,0===_r&&i('"`"')),null===t&&(39===n.charCodeAt(mr)?(t="'",mr++):(t=null,0===_r&&i('"\'"')),null===t&&(126===n.charCodeAt(mr)?(t="~",mr++):(t=null,0===_r&&i('"~"')),null===t&&(40===n.charCodeAt(mr)?(t="(",mr++):(t=null,0===_r&&i('"("')),null===t&&(41===n.charCodeAt(mr)?(t=")",mr++):(t=null,0===_r&&i('")"')),null===t&&(60===n.charCodeAt(mr)?(t="<",mr++):(t=null,0===_r&&i('"<"')),null===t&&(62===n.charCodeAt(mr)?(t=">",mr++):(t=null,0===_r&&i('">"')),null===t&&(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null===t&&(92===n.charCodeAt(mr)?(t="\\",mr++):(t=null,0===_r&&i('"\\\\"')),null===t&&(t=h(),null===t&&(47===n.charCodeAt(mr)?(t="/",mr++):(t=null,0===_r&&i('"/"')),null===t&&(91===n.charCodeAt(mr)?(t="[",mr++):(t=null,0===_r&&i('"["')),null===t&&(93===n.charCodeAt(mr)?(t="]",mr++):(t=null,0===_r&&i('"]"')),null===t&&(63===n.charCodeAt(mr)?(t="?",mr++):(t=null,0===_r&&i('"?"')),null===t&&(123===n.charCodeAt(mr)?(t="{",mr++):(t=null,0===_r&&i('"{"')),null===t&&(125===n.charCodeAt(mr)?(t="}",mr++):(t=null,0===_r&&i('"}"')))))))))))))))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(mr,e)}(r)),null===e&&(mr=r),e}function U(){var e,t,r,s,o;return s=mr,o=mr,e=b(),null!==e?(42===n.charCodeAt(mr)?(t="*",mr++):(t=null,0===_r&&i('"*"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return"*"}(s)),null===e&&(mr=s),e}function D(){var e,t,r,s,o;return s=mr,o=mr,e=b(),null!==e?(47===n.charCodeAt(mr)?(t="/",mr++):(t=null,0===_r&&i('"/"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return"/"}(s)),null===e&&(mr=s),e}function O(){var e,t,r,s,o;return s=mr,o=mr,e=b(),null!==e?(61===n.charCodeAt(mr)?(t="=",mr++):(t=null,0===_r&&i('"="')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return"="}(s)),null===e&&(mr=s),e}function N(){var e,t,r,s,o;return s=mr,o=mr,e=b(),null!==e?(40===n.charCodeAt(mr)?(t="(",mr++):(t=null,0===_r&&i('"("')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return"(";
}(s)),null===e&&(mr=s),e}function L(){var e,t,r,s,o;return s=mr,o=mr,e=b(),null!==e?(41===n.charCodeAt(mr)?(t=")",mr++):(t=null,0===_r&&i('")"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return")"}(s)),null===e&&(mr=s),e}function M(){var e,t,r,s;return r=mr,s=mr,62===n.charCodeAt(mr)?(e=">",mr++):(e=null,0===_r&&i('">"')),null!==e?(t=b(),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null!==e&&(e=function(e){return">"}(r)),null===e&&(mr=r),e}function P(){var e,t,r,s;return r=mr,s=mr,e=b(),null!==e?(60===n.charCodeAt(mr)?(t="<",mr++):(t=null,0===_r&&i('"<"')),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null!==e&&(e=function(e){return"<"}(r)),null===e&&(mr=r),e}function q(){var e,t,r,s,o;return s=mr,o=mr,e=b(),null!==e?(44===n.charCodeAt(mr)?(t=",",mr++):(t=null,0===_r&&i('","')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return","}(s)),null===e&&(mr=s),e}function B(){var e,t,r,s,o;return s=mr,o=mr,e=b(),null!==e?(59===n.charCodeAt(mr)?(t=";",mr++):(t=null,0===_r&&i('";"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return";"}(s)),null===e&&(mr=s),e}function j(){var e,t,r,s,o;return s=mr,o=mr,e=b(),null!==e?(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=b(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return":"}(s)),null===e&&(mr=s),e}function H(){var e,t,n,r;return n=mr,r=mr,e=b(),null!==e?(t=h(),null!==t?e=[e,t]:(e=null,mr=r)):(e=null,mr=r),null!==e&&(e=function(e){return'"'}(n)),null===e&&(mr=n),e}function F(){var e,t,n,r;return n=mr,r=mr,e=h(),null!==e?(t=b(),null!==t?e=[e,t]:(e=null,mr=r)):(e=null,mr=r),null!==e&&(e=function(e){return'"'}(n)),null===e&&(mr=n),e}function G(){var e,t,n,r;if(r=mr,e=N(),null!==e){for(t=[],n=W(),null===n&&(n=K(),null===n&&(n=G()));null!==n;)t.push(n),n=W(),null===n&&(n=K(),null===n&&(n=G()));null!==t?(n=L(),null!==n?e=[e,t,n]:(e=null,mr=r)):(e=null,mr=r)}else e=null,mr=r;return e}function W(){var e;return/^[!-']/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[!-']")),null===e&&(/^[*-[]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[*-[]")),null===e&&(/^[\]-~]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[\\]-~]")),null===e&&(e=E(),null===e&&(e=y())))),e}function V(){var e,t,r,i,s,o;if(s=mr,o=mr,e=b(),null!==e)if(t=h(),null!==t){for(r=[],i=Y(),null===i&&(i=K());null!==i;)r.push(i),i=Y(),null===i&&(i=K());null!==r?(i=h(),null!==i?e=[e,t,r,i]:(e=null,mr=o)):(e=null,mr=o)}else e=null,mr=o;else e=null,mr=o;return null!==e&&(e=function(e){return n.substring(mr,e)}(s)),null===e&&(mr=s),e}function z(){var e,t,r,i,s,o;if(s=mr,o=mr,e=b(),null!==e)if(t=h(),null!==t){for(r=[],i=Y(),null===i&&(i=K());null!==i;)r.push(i),i=Y(),null===i&&(i=K());null!==r?(i=h(),null!==i?e=[e,t,r,i]:(e=null,mr=o)):(e=null,mr=o)}else e=null,mr=o;else e=null,mr=o;return null!==e&&(e=function(e){return n.substring(mr-1,e+1)}(s)),null===e&&(mr=s),e}function Y(){var e;return e=y(),null===e&&(33===n.charCodeAt(mr)?(e="!",mr++):(e=null,0===_r&&i('"!"')),null===e&&(/^[#-[]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[#-[]")),null===e&&(/^[\]-~]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[\\]-~]")),null===e&&(e=E())))),e}function K(){var e,t,r;return r=mr,92===n.charCodeAt(mr)?(e="\\",mr++):(e=null,0===_r&&i('"\\\\"')),null!==e?(/^[\0-\t]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[\\0-\\t]")),null===t&&(/^[\x0B-\f]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[\\x0B-\\f]")),null===t&&(/^[\x0E-]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[\\x0E-]")))),null!==t?e=[e,t]:(e=null,mr=r)):(e=null,mr=r),e}function J(){var e,t,r,s,o,a;return o=mr,a=mr,e=X(),null!==e?(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=Q(),r=null!==r?r:"",null!==r?(s=ne(),null!==s?e=[e,t,r,s]:(e=null,mr=a)):(e=null,mr=a)):(e=null,mr=a)):(e=null,mr=a),null!==e&&(e=function(e){try{Sr.uri=new br(Sr.scheme,Sr.user,Sr.host,Sr.port),delete Sr.scheme,delete Sr.user,delete Sr.host,delete Sr.host_type,delete Sr.port}catch(t){Sr=-1}}(o)),null===e&&(mr=o),e}function $(){var e,t,s,o,a,l,u,c;return u=mr,c=mr,e=X(),null!==e?(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(s=Q(),s=null!==s?s:"",null!==s?(o=ne(),null!==o?(a=pe(),null!==a?(l=Re(),l=null!==l?l:"",null!==l?e=[e,t,s,o,a,l]:(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c),null!==e&&(e=function(e){try{Sr.uri=new br(Sr.scheme,Sr.user,Sr.host,Sr.port,Sr.uri_params,Sr.uri_headers),delete Sr.scheme,delete Sr.user,delete Sr.host,delete Sr.host_type,delete Sr.port,delete Sr.uri_params,"SIP_URI"===r&&(Sr=Sr.uri)}catch(t){Sr=-1}}(u)),null===e&&(mr=u),e}function X(){var e,t;return"sip"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"sip"')),null===e&&(t=mr,"sips"===n.substr(mr,4).toLowerCase()?(e=n.substr(mr,4),mr+=4):(e=null,0===_r&&i('"sips"')),null!==e&&(e=function(e){Sr.scheme=uri_scheme.toLowerCase()}(t)),null===e&&(mr=t)),e}function Q(){var e,t,r,s,o,a;return s=mr,o=mr,e=Z(),null!==e?(a=mr,58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=te(),null!==r?t=[t,r]:(t=null,mr=a)):(t=null,mr=a),t=null!==t?t:"",null!==t?(64===n.charCodeAt(mr)?(r="@",mr++):(r=null,0===_r&&i('"@"')),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){Sr.user=decodeURIComponent(n.substring(mr-1,e))}(s)),null===e&&(mr=s),e}function Z(){var e,t;if(t=m(),null===t&&(t=v(),null===t&&(t=ee())),null!==t)for(e=[];null!==t;)e.push(t),t=m(),null===t&&(t=v(),null===t&&(t=ee()));else e=null;return e}function ee(){var e;return 38===n.charCodeAt(mr)?(e="&",mr++):(e=null,0===_r&&i('"&"')),null===e&&(61===n.charCodeAt(mr)?(e="=",mr++):(e=null,0===_r&&i('"="')),null===e&&(43===n.charCodeAt(mr)?(e="+",mr++):(e=null,0===_r&&i('"+"')),null===e&&(36===n.charCodeAt(mr)?(e="$",mr++):(e=null,0===_r&&i('"$"')),null===e&&(44===n.charCodeAt(mr)?(e=",",mr++):(e=null,0===_r&&i('","')),null===e&&(59===n.charCodeAt(mr)?(e=";",mr++):(e=null,0===_r&&i('";"')),null===e&&(63===n.charCodeAt(mr)?(e="?",mr++):(e=null,0===_r&&i('"?"')),null===e&&(47===n.charCodeAt(mr)?(e="/",mr++):(e=null,0===_r&&i('"/"'))))))))),e}function te(){var e,t,r;for(r=mr,e=[],t=m(),null===t&&(t=v(),null===t&&(38===n.charCodeAt(mr)?(t="&",mr++):(t=null,0===_r&&i('"&"')),null===t&&(61===n.charCodeAt(mr)?(t="=",mr++):(t=null,0===_r&&i('"="')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')),null===t&&(36===n.charCodeAt(mr)?(t="$",mr++):(t=null,0===_r&&i('"$"')),null===t&&(44===n.charCodeAt(mr)?(t=",",mr++):(t=null,0===_r&&i('","'))))))));null!==t;)e.push(t),t=m(),null===t&&(t=v(),null===t&&(38===n.charCodeAt(mr)?(t="&",mr++):(t=null,0===_r&&i('"&"')),null===t&&(61===n.charCodeAt(mr)?(t="=",mr++):(t=null,0===_r&&i('"="')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')),null===t&&(36===n.charCodeAt(mr)?(t="$",mr++):(t=null,0===_r&&i('"$"')),null===t&&(44===n.charCodeAt(mr)?(t=",",mr++):(t=null,0===_r&&i('","'))))))));return null!==e&&(e=function(e){Sr.password=n.substring(mr,e)}(r)),null===e&&(mr=r),e}function ne(){var e,t,r,s,o;return s=mr,e=re(),null!==e?(o=mr,58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=fe(),null!==r?t=[t,r]:(t=null,mr=o)):(t=null,mr=o),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),e}function re(){var e,t;return t=mr,e=he(),null===e&&(e=ae(),null===e&&(e=ie())),null!==e&&(e=function(e){return Sr.host=n.substring(mr,e).toLowerCase(),Sr.host}(t)),null===e&&(mr=t),e}function ie(){var e,t,r,s,o,a;for(s=mr,o=mr,e=[],a=mr,t=se(),null!==t?(46===n.charCodeAt(mr)?(r=".",mr++):(r=null,0===_r&&i('"."')),null!==r?t=[t,r]:(t=null,mr=a)):(t=null,mr=a);null!==t;)e.push(t),a=mr,t=se(),null!==t?(46===n.charCodeAt(mr)?(r=".",mr++):(r=null,0===_r&&i('"."')),null!==r?t=[t,r]:(t=null,mr=a)):(t=null,mr=a);return null!==e?(t=oe(),null!==t?(46===n.charCodeAt(mr)?(r=".",mr++):(r=null,0===_r&&i('"."')),r=null!==r?r:"",null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return Sr.host_type="domain",n.substring(mr,e)}(s)),null===e&&(mr=s),e}function se(){var e,t;if(/^[a-zA-Z0-9_\-]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[a-zA-Z0-9_\\-]")),null!==t)for(e=[];null!==t;)e.push(t),/^[a-zA-Z0-9_\-]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[a-zA-Z0-9_\\-]"));else e=null;return e}function oe(){var e,t;if(/^[a-zA-Z0-9_\-]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[a-zA-Z0-9_\\-]")),null!==t)for(e=[];null!==t;)e.push(t),/^[a-zA-Z0-9_\-]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[a-zA-Z0-9_\\-]"));else e=null;return e}function ae(){var e,t,r,s,o;return s=mr,o=mr,91===n.charCodeAt(mr)?(e="[",mr++):(e=null,0===_r&&i('"["')),null!==e?(t=le(),null!==t?(93===n.charCodeAt(mr)?(r="]",mr++):(r=null,0===_r&&i('"]"')),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){return Sr.host_type="IPv6",n.substring(mr,e)}(s)),null===e&&(mr=s),e}function le(){var e,t,r,s,o,a,l,u,c,h,d,f,p,g,m,_;return g=mr,m=mr,e=ue(),null!==e?(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=ue(),null!==r?(58===n.charCodeAt(mr)?(s=":",mr++):(s=null,0===_r&&i('":"')),null!==s?(o=ue(),null!==o?(58===n.charCodeAt(mr)?(a=":",mr++):(a=null,0===_r&&i('":"')),null!==a?(l=ue(),null!==l?(58===n.charCodeAt(mr)?(u=":",mr++):(u=null,0===_r&&i('":"')),null!==u?(c=ue(),null!==c?(58===n.charCodeAt(mr)?(h=":",mr++):(h=null,0===_r&&i('":"')),null!==h?(d=ue(),null!==d?(58===n.charCodeAt(mr)?(f=":",mr++):(f=null,0===_r&&i('":"')),null!==f?(p=ce(),null!==p?e=[e,t,r,s,o,a,l,u,c,h,d,f,p]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,"::"===n.substr(mr,2)?(e="::",mr+=2):(e=null,0===_r&&i('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?(58===n.charCodeAt(mr)?(o=":",mr++):(o=null,0===_r&&i('":"')),null!==o?(a=ue(),null!==a?(58===n.charCodeAt(mr)?(l=":",mr++):(l=null,0===_r&&i('":"')),null!==l?(u=ue(),null!==u?(58===n.charCodeAt(mr)?(c=":",mr++):(c=null,0===_r&&i('":"')),null!==c?(h=ue(),null!==h?(58===n.charCodeAt(mr)?(d=":",mr++):(d=null,0===_r&&i('":"')),null!==d?(f=ce(),null!==f?e=[e,t,r,s,o,a,l,u,c,h,d,f]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,"::"===n.substr(mr,2)?(e="::",mr+=2):(e=null,0===_r&&i('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?(58===n.charCodeAt(mr)?(o=":",mr++):(o=null,0===_r&&i('":"')),null!==o?(a=ue(),null!==a?(58===n.charCodeAt(mr)?(l=":",mr++):(l=null,0===_r&&i('":"')),null!==l?(u=ue(),null!==u?(58===n.charCodeAt(mr)?(c=":",mr++):(c=null,0===_r&&i('":"')),null!==c?(h=ce(),null!==h?e=[e,t,r,s,o,a,l,u,c,h]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,"::"===n.substr(mr,2)?(e="::",mr+=2):(e=null,0===_r&&i('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?(58===n.charCodeAt(mr)?(o=":",mr++):(o=null,0===_r&&i('":"')),null!==o?(a=ue(),null!==a?(58===n.charCodeAt(mr)?(l=":",mr++):(l=null,0===_r&&i('":"')),null!==l?(u=ce(),null!==u?e=[e,t,r,s,o,a,l,u]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,"::"===n.substr(mr,2)?(e="::",mr+=2):(e=null,0===_r&&i('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?(58===n.charCodeAt(mr)?(o=":",mr++):(o=null,0===_r&&i('":"')),null!==o?(a=ce(),null!==a?e=[e,t,r,s,o,a]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,"::"===n.substr(mr,2)?(e="::",mr+=2):(e=null,0===_r&&i('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ce(),null!==s?e=[e,t,r,s]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,"::"===n.substr(mr,2)?(e="::",mr+=2):(e=null,0===_r&&i('"::"')),null!==e?(t=ce(),null!==t?e=[e,t]:(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,"::"===n.substr(mr,2)?(e="::",mr+=2):(e=null,0===_r&&i('"::"')),null!==e?(t=ue(),null!==t?e=[e,t]:(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,e=ue(),null!==e?("::"===n.substr(mr,2)?(t="::",mr+=2):(t=null,0===_r&&i('"::"')),null!==t?(r=ue(),null!==r?(58===n.charCodeAt(mr)?(s=":",mr++):(s=null,0===_r&&i('":"')),null!==s?(o=ue(),null!==o?(58===n.charCodeAt(mr)?(a=":",mr++):(a=null,0===_r&&i('":"')),null!==a?(l=ue(),null!==l?(58===n.charCodeAt(mr)?(u=":",mr++):(u=null,0===_r&&i('":"')),null!==u?(c=ue(),null!==c?(58===n.charCodeAt(mr)?(h=":",mr++):(h=null,0===_r&&i('":"')),null!==h?(d=ce(),null!==d?e=[e,t,r,s,o,a,l,u,c,h,d]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,e=ue(),null!==e?(_=mr,58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,mr=_)):(t=null,mr=_),t=null!==t?t:"",null!==t?("::"===n.substr(mr,2)?(r="::",mr+=2):(r=null,0===_r&&i('"::"')),null!==r?(s=ue(),null!==s?(58===n.charCodeAt(mr)?(o=":",mr++):(o=null,0===_r&&i('":"')),null!==o?(a=ue(),null!==a?(58===n.charCodeAt(mr)?(l=":",mr++):(l=null,0===_r&&i('":"')),null!==l?(u=ue(),null!==u?(58===n.charCodeAt(mr)?(c=":",mr++):(c=null,0===_r&&i('":"')),null!==c?(h=ce(),null!==h?e=[e,t,r,s,o,a,l,u,c,h]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,e=ue(),null!==e?(_=mr,58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,mr=_)):(t=null,mr=_),t=null!==t?t:"",null!==t?(_=mr,58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?r=[r,s]:(r=null,mr=_)):(r=null,mr=_),r=null!==r?r:"",null!==r?("::"===n.substr(mr,2)?(s="::",mr+=2):(s=null,0===_r&&i('"::"')),null!==s?(o=ue(),null!==o?(58===n.charCodeAt(mr)?(a=":",mr++):(a=null,0===_r&&i('":"')),null!==a?(l=ue(),null!==l?(58===n.charCodeAt(mr)?(u=":",mr++):(u=null,0===_r&&i('":"')),null!==u?(c=ce(),null!==c?e=[e,t,r,s,o,a,l,u,c]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,e=ue(),null!==e?(_=mr,58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,mr=_)):(t=null,mr=_),t=null!==t?t:"",null!==t?(_=mr,58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?r=[r,s]:(r=null,mr=_)):(r=null,mr=_),r=null!==r?r:"",null!==r?(_=mr,58===n.charCodeAt(mr)?(s=":",mr++):(s=null,0===_r&&i('":"')),null!==s?(o=ue(),null!==o?s=[s,o]:(s=null,mr=_)):(s=null,mr=_),s=null!==s?s:"",null!==s?("::"===n.substr(mr,2)?(o="::",mr+=2):(o=null,0===_r&&i('"::"')),null!==o?(a=ue(),null!==a?(58===n.charCodeAt(mr)?(l=":",mr++):(l=null,0===_r&&i('":"')),null!==l?(u=ce(),null!==u?e=[e,t,r,s,o,a,l,u]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,e=ue(),null!==e?(_=mr,58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,mr=_)):(t=null,mr=_),t=null!==t?t:"",null!==t?(_=mr,58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?r=[r,s]:(r=null,mr=_)):(r=null,mr=_),r=null!==r?r:"",null!==r?(_=mr,58===n.charCodeAt(mr)?(s=":",mr++):(s=null,0===_r&&i('":"')),null!==s?(o=ue(),null!==o?s=[s,o]:(s=null,mr=_)):(s=null,mr=_),s=null!==s?s:"",null!==s?(_=mr,58===n.charCodeAt(mr)?(o=":",mr++):(o=null,0===_r&&i('":"')),null!==o?(a=ue(),null!==a?o=[o,a]:(o=null,mr=_)):(o=null,mr=_),o=null!==o?o:"",null!==o?("::"===n.substr(mr,2)?(a="::",mr+=2):(a=null,0===_r&&i('"::"')),null!==a?(l=ce(),null!==l?e=[e,t,r,s,o,a,l]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,e=ue(),null!==e?(_=mr,58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,mr=_)):(t=null,mr=_),t=null!==t?t:"",null!==t?(_=mr,58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?r=[r,s]:(r=null,mr=_)):(r=null,mr=_),r=null!==r?r:"",null!==r?(_=mr,58===n.charCodeAt(mr)?(s=":",mr++):(s=null,0===_r&&i('":"')),null!==s?(o=ue(),null!==o?s=[s,o]:(s=null,mr=_)):(s=null,mr=_),s=null!==s?s:"",null!==s?(_=mr,58===n.charCodeAt(mr)?(o=":",mr++):(o=null,0===_r&&i('":"')),null!==o?(a=ue(),null!==a?o=[o,a]:(o=null,mr=_)):(o=null,mr=_),o=null!==o?o:"",null!==o?(_=mr,58===n.charCodeAt(mr)?(a=":",mr++):(a=null,0===_r&&i('":"')),null!==a?(l=ue(),null!==l?a=[a,l]:(a=null,mr=_)):(a=null,mr=_),a=null!==a?a:"",null!==a?("::"===n.substr(mr,2)?(l="::",mr+=2):(l=null,0===_r&&i('"::"')),null!==l?(u=ue(),null!==u?e=[e,t,r,s,o,a,l,u]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m),null===e&&(m=mr,e=ue(),null!==e?(_=mr,58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,mr=_)):(t=null,mr=_),t=null!==t?t:"",null!==t?(_=mr,58===n.charCodeAt(mr)?(r=":",mr++):(r=null,0===_r&&i('":"')),null!==r?(s=ue(),null!==s?r=[r,s]:(r=null,mr=_)):(r=null,mr=_),r=null!==r?r:"",null!==r?(_=mr,58===n.charCodeAt(mr)?(s=":",mr++):(s=null,0===_r&&i('":"')),null!==s?(o=ue(),null!==o?s=[s,o]:(s=null,mr=_)):(s=null,mr=_),s=null!==s?s:"",null!==s?(_=mr,58===n.charCodeAt(mr)?(o=":",mr++):(o=null,0===_r&&i('":"')),null!==o?(a=ue(),null!==a?o=[o,a]:(o=null,mr=_)):(o=null,mr=_),o=null!==o?o:"",null!==o?(_=mr,58===n.charCodeAt(mr)?(a=":",mr++):(a=null,0===_r&&i('":"')),null!==a?(l=ue(),null!==l?a=[a,l]:(a=null,mr=_)):(a=null,mr=_),a=null!==a?a:"",null!==a?(_=mr,58===n.charCodeAt(mr)?(l=":",mr++):(l=null,0===_r&&i('":"')),null!==l?(u=ue(),null!==u?l=[l,u]:(l=null,mr=_)):(l=null,mr=_),l=null!==l?l:"",null!==l?("::"===n.substr(mr,2)?(u="::",mr+=2):(u=null,0===_r&&i('"::"')),null!==u?e=[e,t,r,s,o,a,l,u]:(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m)):(e=null,mr=m))))))))))))))),null!==e&&(e=function(e){return Sr.host_type="IPv6",n.substring(mr,e)}(g)),null===e&&(mr=g),e}function ue(){var e,t,n,r,i;return i=mr,e=l(),null!==e?(t=l(),t=null!==t?t:"",null!==t?(n=l(),n=null!==n?n:"",null!==n?(r=l(),r=null!==r?r:"",null!==r?e=[e,t,n,r]:(e=null,mr=i)):(e=null,mr=i)):(e=null,mr=i)):(e=null,mr=i),e}function ce(){var e,t,r,s;return s=mr,e=ue(),null!==e?(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=ue(),null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),null===e&&(e=he()),e}function he(){var e,t,r,s,o,a,l,u,c;return u=mr,c=mr,e=de(),null!==e?(46===n.charCodeAt(mr)?(t=".",mr++):(t=null,0===_r&&i('"."')),null!==t?(r=de(),null!==r?(46===n.charCodeAt(mr)?(s=".",mr++):(s=null,0===_r&&i('"."')),null!==s?(o=de(),null!==o?(46===n.charCodeAt(mr)?(a=".",mr++):(a=null,0===_r&&i('"."')),null!==a?(l=de(),null!==l?e=[e,t,r,s,o,a,l]:(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c)):(e=null,mr=c),null!==e&&(e=function(e){return Sr.host_type="IPv4",n.substring(mr,e)}(u)),null===e&&(mr=u),e}function de(){var e,t,r,s;return s=mr,"25"===n.substr(mr,2)?(e="25",mr+=2):(e=null,0===_r&&i('"25"')),null!==e?(/^[0-5]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[0-5]")),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null===e&&(s=mr,50===n.charCodeAt(mr)?(e="2",mr++):(e=null,0===_r&&i('"2"')),null!==e?(/^[0-4]/.test(n.charAt(mr))?(t=n.charAt(mr),mr++):(t=null,0===_r&&i("[0-4]")),null!==t?(r=o(),null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),null===e&&(s=mr,49===n.charCodeAt(mr)?(e="1",mr++):(e=null,0===_r&&i('"1"')),null!==e?(t=o(),null!==t?(r=o(),null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),null===e&&(s=mr,/^[1-9]/.test(n.charAt(mr))?(e=n.charAt(mr),mr++):(e=null,0===_r&&i("[1-9]")),null!==e?(t=o(),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null===e&&(e=o())))),e}function fe(){var e,t,n,r,i,s,a;return s=mr,a=mr,e=o(),e=null!==e?e:"",null!==e?(t=o(),t=null!==t?t:"",null!==t?(n=o(),n=null!==n?n:"",null!==n?(r=o(),r=null!==r?r:"",null!==r?(i=o(),i=null!==i?i:"",null!==i?e=[e,t,n,r,i]:(e=null,mr=a)):(e=null,mr=a)):(e=null,mr=a)):(e=null,mr=a)):(e=null,mr=a),null!==e&&(e=function(e,t){return t=parseInt(t.join("")),Sr.port=t,t}(s,e)),null===e&&(mr=s),e}function pe(){var e,t,r,s;for(e=[],s=mr,59===n.charCodeAt(mr)?(t=";",mr++):(t=null,0===_r&&i('";"')),null!==t?(r=ge(),null!==r?t=[t,r]:(t=null,mr=s)):(t=null,mr=s);null!==t;)e.push(t),s=mr,59===n.charCodeAt(mr)?(t=";",mr++):(t=null,0===_r&&i('";"')),null!==t?(r=ge(),null!==r?t=[t,r]:(t=null,mr=s)):(t=null,mr=s);return e}function ge(){var e;return e=me(),null===e&&(e=_e(),null===e&&(e=ve(),null===e&&(e=ye(),null===e&&(e=be(),null===e&&(e=Te(),null===e&&(e=Se())))))),e}function me(){var e,t,r,s;return r=mr,s=mr,"transport="===n.substr(mr,10).toLowerCase()?(e=n.substr(mr,10),mr+=10):(e=null,0===_r&&i('"transport="')),null!==e?("udp"===n.substr(mr,3).toLowerCase()?(t=n.substr(mr,3),mr+=3):(t=null,0===_r&&i('"udp"')),null===t&&("tcp"===n.substr(mr,3).toLowerCase()?(t=n.substr(mr,3),mr+=3):(t=null,0===_r&&i('"tcp"')),null===t&&("sctp"===n.substr(mr,4).toLowerCase()?(t=n.substr(mr,4),mr+=4):(t=null,0===_r&&i('"sctp"')),null===t&&("tls"===n.substr(mr,3).toLowerCase()?(t=n.substr(mr,3),mr+=3):(t=null,0===_r&&i('"tls"')),null===t&&(t=R())))),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null!==e&&(e=function(e,t){Sr.uri_params||(Sr.uri_params={}),Sr.uri_params.transport=t.toLowerCase()}(r,e[1])),null===e&&(mr=r),e}function _e(){var e,t,r,s;return r=mr,s=mr,"user="===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"user="')),null!==e?("phone"===n.substr(mr,5).toLowerCase()?(t=n.substr(mr,5),mr+=5):(t=null,0===_r&&i('"phone"')),null===t&&("ip"===n.substr(mr,2).toLowerCase()?(t=n.substr(mr,2),mr+=2):(t=null,0===_r&&i('"ip"')),null===t&&(t=R())),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null!==e&&(e=function(e,t){Sr.uri_params||(Sr.uri_params={}),Sr.uri_params.user=t.toLowerCase()}(r,e[1])),null===e&&(mr=r),e}function ve(){var e,t,r,s;return r=mr,s=mr,"method="===n.substr(mr,7).toLowerCase()?(e=n.substr(mr,7),mr+=7):(e=null,0===_r&&i('"method="')),null!==e?(t=at(),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null!==e&&(e=function(e,t){Sr.uri_params||(Sr.uri_params={}),Sr.uri_params.method=t}(r,e[1])),null===e&&(mr=r),e}function ye(){var e,t,r,s;return r=mr,s=mr,"ttl="===n.substr(mr,4).toLowerCase()?(e=n.substr(mr,4),mr+=4):(e=null,0===_r&&i('"ttl="')),null!==e?(t=zn(),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null!==e&&(e=function(e,t){Sr.params||(Sr.params={}),Sr.params.ttl=t}(r,e[1])),null===e&&(mr=r),e}function be(){var e,t,r,s;return r=mr,s=mr,"maddr="===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"maddr="')),null!==e?(t=re(),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),null!==e&&(e=function(e,t){Sr.uri_params||(Sr.uri_params={}),Sr.uri_params.maddr=t}(r,e[1])),null===e&&(mr=r),e}function Te(){var e,t,r,s,o,a;return s=mr,o=mr,"lr"===n.substr(mr,2).toLowerCase()?(e=n.substr(mr,2),mr+=2):(e=null,0===_r&&i('"lr"')),null!==e?(a=mr,61===n.charCodeAt(mr)?(t="=",mr++):(t=null,0===_r&&i('"="')),null!==t?(r=R(),null!==r?t=[t,r]:(t=null,mr=a)):(t=null,mr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){Sr.uri_params||(Sr.uri_params={}),Sr.uri_params.lr=void 0}(s)),null===e&&(mr=s),e}function Se(){var e,t,r,s,o,a;return s=mr,o=mr,e=we(),null!==e?(a=mr,61===n.charCodeAt(mr)?(t="=",mr++):(t=null,0===_r&&i('"="')),null!==t?(r=Ee(),null!==r?t=[t,r]:(t=null,mr=a)):(t=null,mr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t,n){Sr.uri_params||(Sr.uri_params={}),n="undefined"==typeof n?void 0:n[1],Sr.uri_params[t.toLowerCase()]=n&&n.toLowerCase()}(s,e[0],e[1])),null===e&&(mr=s),e}function we(){var e,t,n;if(n=mr,t=Ce(),null!==t)for(e=[];null!==t;)e.push(t),t=Ce();else e=null;return null!==e&&(e=function(e,t){return t.join("")}(n,e)),null===e&&(mr=n),e}function Ee(){var e,t,n;if(n=mr,t=Ce(),null!==t)for(e=[];null!==t;)e.push(t),t=Ce();else e=null;return null!==e&&(e=function(e,t){return t.join("")}(n,e)),null===e&&(mr=n),e}function Ce(){var e;return e=Ae(),null===e&&(e=m(),null===e&&(e=v())),e}function Ae(){var e;return 91===n.charCodeAt(mr)?(e="[",mr++):(e=null,0===_r&&i('"["')),null===e&&(93===n.charCodeAt(mr)?(e="]",mr++):(e=null,0===_r&&i('"]"')),null===e&&(47===n.charCodeAt(mr)?(e="/",mr++):(e=null,0===_r&&i('"/"')),null===e&&(58===n.charCodeAt(mr)?(e=":",mr++):(e=null,0===_r&&i('":"')),null===e&&(38===n.charCodeAt(mr)?(e="&",mr++):(e=null,0===_r&&i('"&"')),null===e&&(43===n.charCodeAt(mr)?(e="+",mr++):(e=null,0===_r&&i('"+"')),null===e&&(36===n.charCodeAt(mr)?(e="$",mr++):(e=null,0===_r&&i('"$"')))))))),e}function Re(){var e,t,r,s,o,a,l;if(a=mr,63===n.charCodeAt(mr)?(e="?",mr++):(e=null,0===_r&&i('"?"')),null!==e)if(t=Ie(),null!==t){for(r=[],l=mr,38===n.charCodeAt(mr)?(s="&",mr++):(s=null,0===_r&&i('"&"')),null!==s?(o=Ie(),null!==o?s=[s,o]:(s=null,mr=l)):(s=null,mr=l);null!==s;)r.push(s),l=mr,38===n.charCodeAt(mr)?(s="&",mr++):(s=null,0===_r&&i('"&"')),null!==s?(o=Ie(),null!==o?s=[s,o]:(s=null,mr=l)):(s=null,mr=l);null!==r?e=[e,t,r]:(e=null,mr=a)}else e=null,mr=a;else e=null,mr=a;return e}function Ie(){var e,t,r,s,o;return s=mr,o=mr,e=ke(),null!==e?(61===n.charCodeAt(mr)?(t="=",mr++):(t=null,0===_r&&i('"="')),null!==t?(r=xe(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t,n){t=t.join("").toLowerCase(),n=n.join(""),Sr.uri_headers||(Sr.uri_headers={}),Sr.uri_headers[t]?Sr.uri_headers[t].push(n):Sr.uri_headers[t]=[n]}(s,e[0],e[2])),null===e&&(mr=s),e}function ke(){var e,t;if(t=Ue(),null===t&&(t=m(),null===t&&(t=v())),null!==t)for(e=[];null!==t;)e.push(t),t=Ue(),null===t&&(t=m(),null===t&&(t=v()));else e=null;return e}function xe(){var e,t;for(e=[],t=Ue(),null===t&&(t=m(),null===t&&(t=v()));null!==t;)e.push(t),t=Ue(),null===t&&(t=m(),null===t&&(t=v()));return e}function Ue(){var e;return 91===n.charCodeAt(mr)?(e="[",mr++):(e=null,0===_r&&i('"["')),null===e&&(93===n.charCodeAt(mr)?(e="]",mr++):(e=null,0===_r&&i('"]"')),null===e&&(47===n.charCodeAt(mr)?(e="/",mr++):(e=null,0===_r&&i('"/"')),null===e&&(63===n.charCodeAt(mr)?(e="?",mr++):(e=null,0===_r&&i('"?"')),null===e&&(58===n.charCodeAt(mr)?(e=":",mr++):(e=null,0===_r&&i('":"')),null===e&&(43===n.charCodeAt(mr)?(e="+",mr++):(e=null,0===_r&&i('"+"')),null===e&&(36===n.charCodeAt(mr)?(e="$",mr++):(e=null,0===_r&&i('"$"')))))))),e}function De(){var e;return e=lt(),null===e&&(e=Oe()),e}function Oe(){var e,t,n,r,i,s;return s=mr,e=at(),null!==e?(t=d(),null!==t?(n=Ne(),null!==n?(r=d(),null!==r?(i=Xe(),null!==i?e=[e,t,n,r,i]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function Ne(){var e;return e=$(),null===e&&(e=Le()),e}function Le(){var e,t,r,s;return s=mr,e=ze(),null!==e?(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null!==t?(r=Me(),null===r&&(r=Be()),null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function Me(){var e,t,r,s,o;return s=mr,e=Pe(),null===e&&(e=qe()),null!==e?(o=mr,63===n.charCodeAt(mr)?(t="?",mr++):(t=null,0===_r&&i('"?"')),null!==t?(r=$e(),null!==r?t=[t,r]:(t=null,mr=o)):(t=null,mr=o),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),e}function Pe(){var e,t,r,s;return s=mr,"//"===n.substr(mr,2)?(e="//",mr+=2):(e=null,0===_r&&i('"//"')),null!==e?(t=Ye(),null!==t?(r=qe(),r=null!==r?r:"",null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function qe(){var e,t,r;return r=mr,47===n.charCodeAt(mr)?(e="/",mr++):(e=null,0===_r&&i('"/"')),null!==e?(t=Fe(),null!==t?e=[e,t]:(e=null,mr=r)):(e=null,mr=r),e}function Be(){var e,t,n,r;if(r=mr,e=He(),null!==e){for(t=[],n=je();null!==n;)t.push(n),n=je();null!==t?e=[e,t]:(e=null,mr=r)}else e=null,mr=r;return e}function je(){var e;return e=g(),null===e&&(e=m(),null===e&&(e=v())),e}function He(){var e;return e=m(),null===e&&(e=v(),null===e&&(59===n.charCodeAt(mr)?(e=";",mr++):(e=null,0===_r&&i('";"')),null===e&&(63===n.charCodeAt(mr)?(e="?",mr++):(e=null,0===_r&&i('"?"')),null===e&&(58===n.charCodeAt(mr)?(e=":",mr++):(e=null,0===_r&&i('":"')),null===e&&(64===n.charCodeAt(mr)?(e="@",mr++):(e=null,0===_r&&i('"@"')),null===e&&(38===n.charCodeAt(mr)?(e="&",mr++):(e=null,0===_r&&i('"&"')),null===e&&(61===n.charCodeAt(mr)?(e="=",mr++):(e=null,0===_r&&i('"="')),null===e&&(43===n.charCodeAt(mr)?(e="+",mr++):(e=null,0===_r&&i('"+"')),null===e&&(36===n.charCodeAt(mr)?(e="$",mr++):(e=null,0===_r&&i('"$"')),null===e&&(44===n.charCodeAt(mr)?(e=",",mr++):(e=null,0===_r&&i('","')))))))))))),e}function Fe(){var e,t,r,s,o,a;if(o=mr,e=Ge(),null!==e){for(t=[],a=mr,47===n.charCodeAt(mr)?(r="/",mr++):(r=null,0===_r&&i('"/"')),null!==r?(s=Ge(),null!==s?r=[r,s]:(r=null,mr=a)):(r=null,mr=a);null!==r;)t.push(r),a=mr,47===n.charCodeAt(mr)?(r="/",mr++):(r=null,0===_r&&i('"/"')),null!==r?(s=Ge(),null!==s?r=[r,s]:(r=null,mr=a)):(r=null,mr=a);null!==t?e=[e,t]:(e=null,mr=o)}else e=null,mr=o;return e}function Ge(){var e,t,r,s,o,a;for(o=mr,e=[],t=Ve();null!==t;)e.push(t),t=Ve();if(null!==e){for(t=[],a=mr,59===n.charCodeAt(mr)?(r=";",mr++):(r=null,0===_r&&i('";"')),null!==r?(s=We(),null!==s?r=[r,s]:(r=null,mr=a)):(r=null,mr=a);null!==r;)t.push(r),a=mr,59===n.charCodeAt(mr)?(r=";",mr++):(r=null,0===_r&&i('";"')),null!==r?(s=We(),null!==s?r=[r,s]:(r=null,mr=a)):(r=null,mr=a);null!==t?e=[e,t]:(e=null,mr=o)}else e=null,mr=o;return e}function We(){var e,t;for(e=[],t=Ve();null!==t;)e.push(t),t=Ve();return e}function Ve(){var e;return e=m(),null===e&&(e=v(),null===e&&(58===n.charCodeAt(mr)?(e=":",mr++):(e=null,0===_r&&i('":"')),null===e&&(64===n.charCodeAt(mr)?(e="@",mr++):(e=null,0===_r&&i('"@"')),null===e&&(38===n.charCodeAt(mr)?(e="&",mr++):(e=null,0===_r&&i('"&"')),null===e&&(61===n.charCodeAt(mr)?(e="=",mr++):(e=null,0===_r&&i('"="')),null===e&&(43===n.charCodeAt(mr)?(e="+",mr++):(e=null,0===_r&&i('"+"')),null===e&&(36===n.charCodeAt(mr)?(e="$",mr++):(e=null,0===_r&&i('"$"')),null===e&&(44===n.charCodeAt(mr)?(e=",",mr++):(e=null,0===_r&&i('","')))))))))),e}function ze(){var e,t,r,s,l;if(s=mr,l=mr,e=a(),null!==e){for(t=[],r=a(),null===r&&(r=o(),null===r&&(43===n.charCodeAt(mr)?(r="+",mr++):(r=null,0===_r&&i('"+"')),null===r&&(45===n.charCodeAt(mr)?(r="-",mr++):(r=null,0===_r&&i('"-"')),null===r&&(46===n.charCodeAt(mr)?(r=".",mr++):(r=null,0===_r&&i('"."'))))));null!==r;)t.push(r),r=a(),null===r&&(r=o(),null===r&&(43===n.charCodeAt(mr)?(r="+",mr++):(r=null,0===_r&&i('"+"')),null===r&&(45===n.charCodeAt(mr)?(r="-",mr++):(r=null,0===_r&&i('"-"')),null===r&&(46===n.charCodeAt(mr)?(r=".",mr++):(r=null,0===_r&&i('"."'))))));null!==t?e=[e,t]:(e=null,mr=l)}else e=null,mr=l;return null!==e&&(e=function(e){Sr.scheme=n.substring(mr,e)}(s)),null===e&&(mr=s),e}function Ye(){var e;return e=Ke(),null===e&&(e=Je()),e}function Ke(){var e,t,r,s;return r=mr,s=mr,e=Q(),null!==e?(64===n.charCodeAt(mr)?(t="@",
mr++):(t=null,0===_r&&i('"@"')),null!==t?e=[e,t]:(e=null,mr=s)):(e=null,mr=s),e=null!==e?e:"",null!==e?(t=ne(),null!==t?e=[e,t]:(e=null,mr=r)):(e=null,mr=r),e=null!==e?e:""}function Je(){var e,t;if(t=m(),null===t&&(t=v(),null===t&&(36===n.charCodeAt(mr)?(t="$",mr++):(t=null,0===_r&&i('"$"')),null===t&&(44===n.charCodeAt(mr)?(t=",",mr++):(t=null,0===_r&&i('","')),null===t&&(59===n.charCodeAt(mr)?(t=";",mr++):(t=null,0===_r&&i('";"')),null===t&&(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null===t&&(64===n.charCodeAt(mr)?(t="@",mr++):(t=null,0===_r&&i('"@"')),null===t&&(38===n.charCodeAt(mr)?(t="&",mr++):(t=null,0===_r&&i('"&"')),null===t&&(61===n.charCodeAt(mr)?(t="=",mr++):(t=null,0===_r&&i('"="')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=m(),null===t&&(t=v(),null===t&&(36===n.charCodeAt(mr)?(t="$",mr++):(t=null,0===_r&&i('"$"')),null===t&&(44===n.charCodeAt(mr)?(t=",",mr++):(t=null,0===_r&&i('","')),null===t&&(59===n.charCodeAt(mr)?(t=";",mr++):(t=null,0===_r&&i('";"')),null===t&&(58===n.charCodeAt(mr)?(t=":",mr++):(t=null,0===_r&&i('":"')),null===t&&(64===n.charCodeAt(mr)?(t="@",mr++):(t=null,0===_r&&i('"@"')),null===t&&(38===n.charCodeAt(mr)?(t="&",mr++):(t=null,0===_r&&i('"&"')),null===t&&(61===n.charCodeAt(mr)?(t="=",mr++):(t=null,0===_r&&i('"="')),null===t&&(43===n.charCodeAt(mr)?(t="+",mr++):(t=null,0===_r&&i('"+"')))))))))));else e=null;return e}function $e(){var e,t;for(e=[],t=je();null!==t;)e.push(t),t=je();return e}function Xe(){var e,t,r,s,a,l,u,c;if(u=mr,c=mr,"sip"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"SIP"')),null!==e)if(47===n.charCodeAt(mr)?(t="/",mr++):(t=null,0===_r&&i('"/"')),null!==t){if(s=o(),null!==s)for(r=[];null!==s;)r.push(s),s=o();else r=null;if(null!==r)if(46===n.charCodeAt(mr)?(s=".",mr++):(s=null,0===_r&&i('"."')),null!==s){if(l=o(),null!==l)for(a=[];null!==l;)a.push(l),l=o();else a=null;null!==a?e=[e,t,r,s,a]:(e=null,mr=c)}else e=null,mr=c;else e=null,mr=c}else e=null,mr=c;else e=null,mr=c;return null!==e&&(e=function(e){Sr.sip_version=n.substring(mr,e)}(u)),null===e&&(mr=u),e}function Qe(){var e;return"INVITE"===n.substr(mr,6)?(e="INVITE",mr+=6):(e=null,0===_r&&i('"INVITE"')),e}function Ze(){var e;return"ACK"===n.substr(mr,3)?(e="ACK",mr+=3):(e=null,0===_r&&i('"ACK"')),e}function et(){var e;return"OPTIONS"===n.substr(mr,7)?(e="OPTIONS",mr+=7):(e=null,0===_r&&i('"OPTIONS"')),e}function tt(){var e;return"BYE"===n.substr(mr,3)?(e="BYE",mr+=3):(e=null,0===_r&&i('"BYE"')),e}function nt(){var e;return"CANCEL"===n.substr(mr,6)?(e="CANCEL",mr+=6):(e=null,0===_r&&i('"CANCEL"')),e}function rt(){var e;return"REGISTER"===n.substr(mr,8)?(e="REGISTER",mr+=8):(e=null,0===_r&&i('"REGISTER"')),e}function it(){var e;return"SUBSCRIBE"===n.substr(mr,9)?(e="SUBSCRIBE",mr+=9):(e=null,0===_r&&i('"SUBSCRIBE"')),e}function st(){var e;return"NOTIFY"===n.substr(mr,6)?(e="NOTIFY",mr+=6):(e=null,0===_r&&i('"NOTIFY"')),e}function ot(){var e;return"REFER"===n.substr(mr,5)?(e="REFER",mr+=5):(e=null,0===_r&&i('"REFER"')),e}function at(){var e,t;return t=mr,e=Qe(),null===e&&(e=Ze(),null===e&&(e=et(),null===e&&(e=tt(),null===e&&(e=nt(),null===e&&(e=rt(),null===e&&(e=it(),null===e&&(e=st(),null===e&&(e=ot(),null===e&&(e=R()))))))))),null!==e&&(e=function(e){return Sr.method=n.substring(mr,e),Sr.method}(t)),null===e&&(mr=t),e}function lt(){var e,t,n,r,i,s;return s=mr,e=Xe(),null!==e?(t=d(),null!==t?(n=ut(),null!==n?(r=d(),null!==r?(i=ht(),null!==i?e=[e,t,n,r,i]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function ut(){var e,t;return t=mr,e=ct(),null!==e&&(e=function(e,t){Sr.status_code=parseInt(t.join(""))}(t,e)),null===e&&(mr=t),e}function ct(){var e,t,n,r;return r=mr,e=o(),null!==e?(t=o(),null!==t?(n=o(),null!==n?e=[e,t,n]:(e=null,mr=r)):(e=null,mr=r)):(e=null,mr=r),e}function ht(){var e,t,r;for(r=mr,e=[],t=g(),null===t&&(t=m(),null===t&&(t=v(),null===t&&(t=E(),null===t&&(t=C(),null===t&&(t=d(),null===t&&(t=f()))))));null!==t;)e.push(t),t=g(),null===t&&(t=m(),null===t&&(t=v(),null===t&&(t=E(),null===t&&(t=C(),null===t&&(t=d(),null===t&&(t=f()))))));return null!==e&&(e=function(e){Sr.reason_phrase=n.substring(mr,e)}(r)),null===e&&(mr=r),e}function dt(){var e,t,n,r,i,s;if(i=mr,e=Vt(),null!==e){for(t=[],s=mr,n=q(),null!==n?(r=Vt(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=q(),null!==n?(r=Vt(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function ft(){var e,t,r,s,o,a;return s=mr,o=mr,e=x(),null!==e?(a=mr,64===n.charCodeAt(mr)?(t="@",mr++):(t=null,0===_r&&i('"@"')),null!==t?(r=x(),null!==r?t=[t,r]:(t=null,mr=a)):(t=null,mr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){Sr=n.substring(mr,e)}(s)),null===e&&(mr=s),e}function pt(){var e,t,n,r,i,s,o;if(i=mr,e=U(),null===e)if(s=mr,e=gt(),null!==e){for(t=[],o=mr,n=q(),null!==n?(r=gt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==n;)t.push(n),o=mr,n=q(),null!==n?(r=gt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==t?e=[e,t]:(e=null,mr=s)}else e=null,mr=s;return null!==e&&(e=function(e){var t,n;for(n=Sr.multi_header.length,t=0;t<n;t++)if(null===Sr.multi_header[t].parsed){Sr=null;break}Sr=null!==Sr?Sr.multi_header:-1}(i)),null===e&&(mr=i),e}function gt(){var e,t,n,r,i,s,o;if(i=mr,s=mr,e=J(),null===e&&(e=mt()),null!==e){for(t=[],o=mr,n=B(),null!==n?(r=vt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==n;)t.push(n),o=mr,n=B(),null!==n?(r=vt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==t?e=[e,t]:(e=null,mr=s)}else e=null,mr=s;return null!==e&&(e=function(e){var t;Sr.multi_header||(Sr.multi_header=[]);try{t=new Tr(Sr.uri,Sr.display_name,Sr.params),delete Sr.uri,delete Sr.display_name,delete Sr.params}catch(n){t=null}Sr.multi_header.push({possition:mr,offset:e,parsed:t})}(i)),null===e&&(mr=i),e}function mt(){var e,t,n,r,i;return i=mr,e=_t(),e=null!==e?e:"",null!==e?(t=P(),null!==t?(n=$(),null!==n?(r=M(),null!==r?e=[e,t,n,r]:(e=null,mr=i)):(e=null,mr=i)):(e=null,mr=i)):(e=null,mr=i),e}function _t(){var e,t,r,i,s,o,a;if(s=mr,o=mr,e=R(),null!==e){for(t=[],a=mr,r=y(),null!==r?(i=R(),null!==i?r=[r,i]:(r=null,mr=a)):(r=null,mr=a);null!==r;)t.push(r),a=mr,r=y(),null!==r?(i=R(),null!==i?r=[r,i]:(r=null,mr=a)):(r=null,mr=a);null!==t?e=[e,t]:(e=null,mr=o)}else e=null,mr=o;return null===e&&(e=V()),null!==e&&(e=function(e,t){t=n.substring(mr,e).trim(),'"'===t[0]&&(t=t.substring(1,t.length-1)),Sr.display_name=t}(s,e)),null===e&&(mr=s),e}function vt(){var e;return e=yt(),null===e&&(e=bt(),null===e&&(e=wt())),e}function yt(){var e,t,r,s,o;return s=mr,o=mr,"q"===n.substr(mr,1).toLowerCase()?(e=n.substr(mr,1),mr++):(e=null,0===_r&&i('"q"')),null!==e?(t=O(),null!==t?(r=St(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.params||(Sr.params={}),Sr.params.q=t}(s,e[2])),null===e&&(mr=s),e}function bt(){var e,t,r,s,o;return s=mr,o=mr,"expires"===n.substr(mr,7).toLowerCase()?(e=n.substr(mr,7),mr+=7):(e=null,0===_r&&i('"expires"')),null!==e?(t=O(),null!==t?(r=Tt(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.params||(Sr.params={}),Sr.params.expires=t}(s,e[2])),null===e&&(mr=s),e}function Tt(){var e,t,n;if(n=mr,t=o(),null!==t)for(e=[];null!==t;)e.push(t),t=o();else e=null;return null!==e&&(e=function(e,t){return parseInt(t.join(""))}(n,e)),null===e&&(mr=n),e}function St(){var e,t,r,s,a,l,u,c;return l=mr,u=mr,48===n.charCodeAt(mr)?(e="0",mr++):(e=null,0===_r&&i('"0"')),null!==e?(c=mr,46===n.charCodeAt(mr)?(t=".",mr++):(t=null,0===_r&&i('"."')),null!==t?(r=o(),r=null!==r?r:"",null!==r?(s=o(),s=null!==s?s:"",null!==s?(a=o(),a=null!==a?a:"",null!==a?t=[t,r,s,a]:(t=null,mr=c)):(t=null,mr=c)):(t=null,mr=c)):(t=null,mr=c),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=u)):(e=null,mr=u),null!==e&&(e=function(e){return parseFloat(n.substring(mr,e))}(l)),null===e&&(mr=l),e}function wt(){var e,t,n,r,i,s;return r=mr,i=mr,e=R(),null!==e?(s=mr,t=O(),null!==t?(n=Et(),null!==n?t=[t,n]:(t=null,mr=s)):(t=null,mr=s),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=i)):(e=null,mr=i),null!==e&&(e=function(e,t,n){Sr.params||(Sr.params={}),n="undefined"==typeof n?void 0:n[1],Sr.params[t.toLowerCase()]=n}(r,e[0],e[1])),null===e&&(mr=r),e}function Et(){var e;return e=R(),null===e&&(e=re(),null===e&&(e=V())),e}function Ct(){var e,t,n,r,i,s;if(i=mr,e=At(),null!==e){for(t=[],s=mr,n=B(),null!==n?(r=Rt(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=B(),null!==n?(r=Rt(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function At(){var e;return"render"===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"render"')),null===e&&("session"===n.substr(mr,7).toLowerCase()?(e=n.substr(mr,7),mr+=7):(e=null,0===_r&&i('"session"')),null===e&&("icon"===n.substr(mr,4).toLowerCase()?(e=n.substr(mr,4),mr+=4):(e=null,0===_r&&i('"icon"')),null===e&&("alert"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"alert"')),null===e&&(e=R())))),e}function Rt(){var e;return e=It(),null===e&&(e=wt()),e}function It(){var e,t,r,s;return s=mr,"handling"===n.substr(mr,8).toLowerCase()?(e=n.substr(mr,8),mr+=8):(e=null,0===_r&&i('"handling"')),null!==e?(t=O(),null!==t?("optional"===n.substr(mr,8).toLowerCase()?(r=n.substr(mr,8),mr+=8):(r=null,0===_r&&i('"optional"')),null===r&&("required"===n.substr(mr,8).toLowerCase()?(r=n.substr(mr,8),mr+=8):(r=null,0===_r&&i('"required"')),null===r&&(r=R())),null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function kt(){var e,t,n,r,i,s;if(i=mr,e=R(),null!==e){for(t=[],s=mr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function xt(){var e,t,n;if(n=mr,t=o(),null!==t)for(e=[];null!==t;)e.push(t),t=o();else e=null;return null!==e&&(e=function(e,t){Sr=parseInt(t.join(""))}(n,e)),null===e&&(mr=n),e}function Ut(){var e,t;return t=mr,e=Dt(),null!==e&&(e=function(e){Sr=n.substring(mr,e)}(t)),null===e&&(mr=t),e}function Dt(){var e,t,n,r,i,s,o,a;if(o=mr,e=Ot(),null!==e)if(t=D(),null!==t)if(n=qt(),null!==n){for(r=[],a=mr,i=B(),null!==i?(s=Bt(),null!==s?i=[i,s]:(i=null,mr=a)):(i=null,mr=a);null!==i;)r.push(i),a=mr,i=B(),null!==i?(s=Bt(),null!==s?i=[i,s]:(i=null,mr=a)):(i=null,mr=a);null!==r?e=[e,t,n,r]:(e=null,mr=o)}else e=null,mr=o;else e=null,mr=o;else e=null,mr=o;return e}function Ot(){var e;return e=Nt(),null===e&&(e=Lt()),e}function Nt(){var e;return"text"===n.substr(mr,4).toLowerCase()?(e=n.substr(mr,4),mr+=4):(e=null,0===_r&&i('"text"')),null===e&&("image"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"image"')),null===e&&("audio"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"audio"')),null===e&&("video"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"video"')),null===e&&("application"===n.substr(mr,11).toLowerCase()?(e=n.substr(mr,11),mr+=11):(e=null,0===_r&&i('"application"')),null===e&&(e=Mt()))))),e}function Lt(){var e;return"message"===n.substr(mr,7).toLowerCase()?(e=n.substr(mr,7),mr+=7):(e=null,0===_r&&i('"message"')),null===e&&("multipart"===n.substr(mr,9).toLowerCase()?(e=n.substr(mr,9),mr+=9):(e=null,0===_r&&i('"multipart"')),null===e&&(e=Mt())),e}function Mt(){var e;return e=R(),null===e&&(e=Pt()),e}function Pt(){var e,t,r;return r=mr,"x-"===n.substr(mr,2).toLowerCase()?(e=n.substr(mr,2),mr+=2):(e=null,0===_r&&i('"x-"')),null!==e?(t=R(),null!==t?e=[e,t]:(e=null,mr=r)):(e=null,mr=r),e}function qt(){var e;return e=Mt(),null===e&&(e=R()),e}function Bt(){var e,t,n,r;return r=mr,e=R(),null!==e?(t=O(),null!==t?(n=jt(),null!==n?e=[e,t,n]:(e=null,mr=r)):(e=null,mr=r)):(e=null,mr=r),e}function jt(){var e;return e=R(),null===e&&(e=V()),e}function Ht(){var e,t,n,r;return r=mr,e=Ft(),null!==e?(t=y(),null!==t?(n=at(),null!==n?e=[e,t,n]:(e=null,mr=r)):(e=null,mr=r)):(e=null,mr=r),e}function Ft(){var e,t,n;if(n=mr,t=o(),null!==t)for(e=[];null!==t;)e.push(t),t=o();else e=null;return null!==e&&(e=function(e,t){Sr.value=parseInt(t.join(""))}(n,e)),null===e&&(mr=n),e}function Gt(){var e,t;return t=mr,e=Tt(),null!==e&&(e=function(e,t){Sr=t}(t,e)),null===e&&(mr=t),e}function Wt(){var e,t,n,r,i,s,o;if(i=mr,s=mr,e=Vt(),null!==e){for(t=[],o=mr,n=B(),null!==n?(r=wt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==n;)t.push(n),o=mr,n=B(),null!==n?(r=wt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==t?e=[e,t]:(e=null,mr=s)}else e=null,mr=s;return null!==e&&(e=function(e,t){Sr.event=t.join("").toLowerCase()}(i,e[0])),null===e&&(mr=i),e}function Vt(){var e,t,r,s,o,a;if(o=mr,e=I(),null!==e){for(t=[],a=mr,46===n.charCodeAt(mr)?(r=".",mr++):(r=null,0===_r&&i('"."')),null!==r?(s=I(),null!==s?r=[r,s]:(r=null,mr=a)):(r=null,mr=a);null!==r;)t.push(r),a=mr,46===n.charCodeAt(mr)?(r=".",mr++):(r=null,0===_r&&i('"."')),null!==r?(s=I(),null!==s?r=[r,s]:(r=null,mr=a)):(r=null,mr=a);null!==t?e=[e,t]:(e=null,mr=o)}else e=null,mr=o;return e}function zt(){var e,t,n,r,i,s,o;if(i=mr,s=mr,e=J(),null===e&&(e=mt()),null!==e){for(t=[],o=mr,n=B(),null!==n?(r=Yt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==n;)t.push(n),o=mr,n=B(),null!==n?(r=Yt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==t?e=[e,t]:(e=null,mr=s)}else e=null,mr=s;return null!==e&&(e=function(e){var t=Sr.tag;try{Sr=new Tr(Sr.uri,Sr.display_name,Sr.params),t&&Sr.setParam("tag",t)}catch(n){Sr=-1}}(i)),null===e&&(mr=i),e}function Yt(){var e;return e=Kt(),null===e&&(e=wt()),e}function Kt(){var e,t,r,s,o;return s=mr,o=mr,"tag"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"tag"')),null!==e?(t=O(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.tag=t}(s,e[2])),null===e&&(mr=s),e}function Jt(){var e,t,n;if(n=mr,t=o(),null!==t)for(e=[];null!==t;)e.push(t),t=o();else e=null;return null!==e&&(e=function(e,t){Sr=parseInt(t.join(""))}(n,e)),null===e&&(mr=n),e}function $t(){var e,t;return t=mr,e=Tt(),null!==e&&(e=function(e,t){Sr=t}(t,e)),null===e&&(mr=t),e}function Xt(){var e,t,n,r,i,s,o,a,l,u;for(a=mr,l=mr,e=[],t=_t();null!==t;)e.push(t),t=_t();if(null!==e)if(t=P(),null!==t)if(n=$(),null!==n)if(r=M(),null!==r){for(i=[],u=mr,s=B(),null!==s?(o=wt(),null!==o?s=[s,o]:(s=null,mr=u)):(s=null,mr=u);null!==s;)i.push(s),u=mr,s=B(),null!==s?(o=wt(),null!==o?s=[s,o]:(s=null,mr=u)):(s=null,mr=u);null!==i?e=[e,t,n,r,i]:(e=null,mr=l)}else e=null,mr=l;else e=null,mr=l;else e=null,mr=l;else e=null,mr=l;return null!==e&&(e=function(e){try{Sr=new Tr(Sr.uri,Sr.display_name,Sr.params)}catch(t){Sr=-1}}(a)),null===e&&(mr=a),e}function Qt(){var e;return e=Zt()}function Zt(){var e,t,r,s,o,a,l,u;if(l=mr,"digest"===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"Digest"')),null!==e)if(t=y(),null!==t)if(r=nn(),null!==r){for(s=[],u=mr,o=q(),null!==o?(a=nn(),null!==a?o=[o,a]:(o=null,mr=u)):(o=null,mr=u);null!==o;)s.push(o),u=mr,o=q(),null!==o?(a=nn(),null!==a?o=[o,a]:(o=null,mr=u)):(o=null,mr=u);null!==s?e=[e,t,r,s]:(e=null,mr=l)}else e=null,mr=l;else e=null,mr=l;else e=null,mr=l;return null===e&&(e=en()),e}function en(){var e,t,n,r,i,s,o,a;if(o=mr,e=R(),null!==e)if(t=y(),null!==t)if(n=tn(),null!==n){for(r=[],a=mr,i=q(),null!==i?(s=tn(),null!==s?i=[i,s]:(i=null,mr=a)):(i=null,mr=a);null!==i;)r.push(i),a=mr,i=q(),null!==i?(s=tn(),null!==s?i=[i,s]:(i=null,mr=a)):(i=null,mr=a);null!==r?e=[e,t,n,r]:(e=null,mr=o)}else e=null,mr=o;else e=null,mr=o;else e=null,mr=o;return e}function tn(){var e,t,n,r;return r=mr,e=R(),null!==e?(t=O(),null!==t?(n=R(),null===n&&(n=V()),null!==n?e=[e,t,n]:(e=null,mr=r)):(e=null,mr=r)):(e=null,mr=r),e}function nn(){var e;return e=rn(),null===e&&(e=on(),null===e&&(e=ln(),null===e&&(e=cn(),null===e&&(e=hn(),null===e&&(e=dn(),null===e&&(e=fn(),null===e&&(e=tn()))))))),e}function rn(){var e,t,r,s;return s=mr,"realm"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"realm"')),null!==e?(t=O(),null!==t?(r=sn(),null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function sn(){var e,t;return t=mr,e=z(),null!==e&&(e=function(e,t){Sr.realm=t}(t,e)),null===e&&(mr=t),e}function on(){var e,t,r,s,o,a,l,u,c;if(u=mr,"domain"===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"domain"')),null!==e)if(t=O(),null!==t)if(r=H(),null!==r)if(s=an(),null!==s){if(o=[],c=mr,l=d(),null!==l)for(a=[];null!==l;)a.push(l),l=d();else a=null;for(null!==a?(l=an(),null!==l?a=[a,l]:(a=null,mr=c)):(a=null,mr=c);null!==a;){if(o.push(a),c=mr,l=d(),null!==l)for(a=[];null!==l;)a.push(l),l=d();else a=null;null!==a?(l=an(),null!==l?a=[a,l]:(a=null,mr=c)):(a=null,mr=c)}null!==o?(a=F(),null!==a?e=[e,t,r,s,o,a]:(e=null,mr=u)):(e=null,mr=u)}else e=null,mr=u;else e=null,mr=u;else e=null,mr=u;else e=null,mr=u;return e}function an(){var e;return e=Le(),null===e&&(e=qe()),e}function ln(){var e,t,r,s;return s=mr,"nonce"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"nonce"')),null!==e?(t=O(),null!==t?(r=un(),null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function un(){var e,t;return t=mr,e=z(),null!==e&&(e=function(e,t){Sr.nonce=t}(t,e)),null===e&&(mr=t),e}function cn(){var e,t,r,s,o;return s=mr,o=mr,"opaque"===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"opaque"')),null!==e?(t=O(),null!==t?(r=z(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.opaque=t}(s,e[2])),null===e&&(mr=s),e}function hn(){var e,t,r,s,o;return s=mr,"stale"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"stale"')),null!==e?(t=O(),null!==t?(o=mr,"true"===n.substr(mr,4).toLowerCase()?(r=n.substr(mr,4),mr+=4):(r=null,0===_r&&i('"true"')),null!==r&&(r=function(e){Sr.stale=!0}(o)),null===r&&(mr=o),null===r&&(o=mr,"false"===n.substr(mr,5).toLowerCase()?(r=n.substr(mr,5),mr+=5):(r=null,0===_r&&i('"false"')),null!==r&&(r=function(e){Sr.stale=!1}(o)),null===r&&(mr=o)),null!==r?e=[e,t,r]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function dn(){var e,t,r,s,o;return s=mr,o=mr,"algorithm"===n.substr(mr,9).toLowerCase()?(e=n.substr(mr,9),mr+=9):(e=null,0===_r&&i('"algorithm"')),null!==e?(t=O(),null!==t?("md5"===n.substr(mr,3).toLowerCase()?(r=n.substr(mr,3),mr+=3):(r=null,0===_r&&i('"MD5"')),null===r&&("md5-sess"===n.substr(mr,8).toLowerCase()?(r=n.substr(mr,8),mr+=8):(r=null,0===_r&&i('"MD5-sess"')),null===r&&(r=R())),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.algorithm=t.toUpperCase()}(s,e[2])),null===e&&(mr=s),e}function fn(){var e,t,r,s,o,a,l,u,c,h;if(u=mr,"qop"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"qop"')),null!==e)if(t=O(),null!==t)if(r=H(),null!==r){if(c=mr,s=pn(),null!==s){for(o=[],h=mr,44===n.charCodeAt(mr)?(a=",",mr++):(a=null,0===_r&&i('","')),null!==a?(l=pn(),null!==l?a=[a,l]:(a=null,mr=h)):(a=null,mr=h);null!==a;)o.push(a),h=mr,44===n.charCodeAt(mr)?(a=",",mr++):(a=null,0===_r&&i('","')),null!==a?(l=pn(),null!==l?a=[a,l]:(a=null,mr=h)):(a=null,mr=h);null!==o?s=[s,o]:(s=null,mr=c)}else s=null,mr=c;null!==s?(o=F(),null!==o?e=[e,t,r,s,o]:(e=null,mr=u)):(e=null,mr=u)}else e=null,mr=u;else e=null,mr=u;else e=null,mr=u;return e}function pn(){var e,t;return t=mr,"auth-int"===n.substr(mr,8).toLowerCase()?(e=n.substr(mr,8),mr+=8):(e=null,0===_r&&i('"auth-int"')),null===e&&("auth"===n.substr(mr,4).toLowerCase()?(e=n.substr(mr,4),mr+=4):(e=null,0===_r&&i('"auth"')),null===e&&(e=R())),null!==e&&(e=function(e,t){Sr.qop||(Sr.qop=[]),Sr.qop.push(t.toLowerCase())}(t,e)),null===e&&(mr=t),e}function gn(){var e,t,n,r,i,s;if(i=mr,e=R(),null!==e){for(t=[],s=mr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function mn(){var e,t,n,r,i,s,o;if(i=mr,s=mr,e=_n(),null!==e){for(t=[],o=mr,n=q(),null!==n?(r=_n(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==n;)t.push(n),o=mr,n=q(),null!==n?(r=_n(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==t?e=[e,t]:(e=null,mr=s)}else e=null,mr=s;return null!==e&&(e=function(e){var t,n;for(n=Sr.multi_header.length,t=0;t<n;t++)if(null===Sr.multi_header[t].parsed){Sr=null;break}Sr=null!==Sr?Sr.multi_header:-1}(i)),null===e&&(mr=i),e}function _n(){var e,t,n,r,i,s,o;if(i=mr,s=mr,e=mt(),null!==e){for(t=[],o=mr,n=B(),null!==n?(r=wt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==n;)t.push(n),o=mr,n=B(),null!==n?(r=wt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==t?e=[e,t]:(e=null,mr=s)}else e=null,mr=s;return null!==e&&(e=function(e){var t;Sr.multi_header||(Sr.multi_header=[]);try{t=new Tr(Sr.uri,Sr.display_name,Sr.params),delete Sr.uri,delete Sr.display_name,delete Sr.params}catch(n){t=null}Sr.multi_header.push({possition:mr,offset:e,parsed:t})}(i)),null===e&&(mr=i),e}function vn(){var e,t,r,s,o,a,l;if(o=mr,a=mr,"sip"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"SIP"')),null===e&&(e=R()),null!==e){for(t=[],l=mr,r=B(),null!==r?(s=yn(),null!==s?r=[r,s]:(r=null,mr=l)):(r=null,mr=l);null!==r;)t.push(r),l=mr,r=B(),null!==r?(s=yn(),null!==s?r=[r,s]:(r=null,mr=l)):(r=null,mr=l);null!==t?e=[e,t]:(e=null,mr=a)}else e=null,mr=a;return null!==e&&(e=function(e,t){if(Sr.protocol=t.toLowerCase(),Sr.params||(Sr.params={}),Sr.params.text&&'"'===Sr.params.text[0]){var n=Sr.params.text;Sr.text=n.substring(1,n.length-1),delete Sr.params.text}}(o,e[0])),null===e&&(mr=o),e}function yn(){var e;return e=bn(),null===e&&(e=wt()),e}function bn(){var e,t,r,s,a,l;if(a=mr,l=mr,"cause"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"cause"')),null!==e)if(t=O(),null!==t){if(s=o(),null!==s)for(r=[];null!==s;)r.push(s),s=o();else r=null;null!==r?e=[e,t,r]:(e=null,mr=l)}else e=null,mr=l;else e=null,mr=l;return null!==e&&(e=function(e,t){Sr.cause=parseInt(t.join(""))}(a,e[2])),null===e&&(mr=a),e}function Tn(){var e,t,n,r,i,s;if(i=mr,e=R(),null!==e){for(t=[],s=mr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function Sn(){var e,t,n,r,i,s;if(i=mr,e=wn(),null!==e){for(t=[],s=mr,n=q(),null!==n?(r=wn(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=q(),null!==n?(r=wn(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function wn(){var e,t,n,r,i,s;if(i=mr,e=mt(),null!==e){for(t=[],s=mr,n=B(),null!==n?(r=wt(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=B(),null!==n?(r=wt(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function En(){var e,t,n,r,i,s;if(i=mr,e=Cn(),null!==e){for(t=[],s=mr,n=B(),null!==n?(r=An(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=B(),null!==n?(r=An(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function Cn(){var e,t;return t=mr,"active"===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"active"')),null===e&&("pending"===n.substr(mr,7).toLowerCase()?(e=n.substr(mr,7),mr+=7):(e=null,0===_r&&i('"pending"')),null===e&&("terminated"===n.substr(mr,10).toLowerCase()?(e=n.substr(mr,10),mr+=10):(e=null,0===_r&&i('"terminated"')),null===e&&(e=R()))),null!==e&&(e=function(e){Sr.state=n.substring(mr,e)}(t)),null===e&&(mr=t),e}function An(){var e,t,r,s,o;return s=mr,o=mr,"reason"===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"reason"')),null!==e?(t=O(),null!==t?(r=Rn(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){"undefined"!=typeof t&&(Sr.reason=t)}(s,e[2])),null===e&&(mr=s),null===e&&(s=mr,o=mr,"expires"===n.substr(mr,7).toLowerCase()?(e=n.substr(mr,7),mr+=7):(e=null,0===_r&&i('"expires"')),null!==e?(t=O(),null!==t?(r=Tt(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){"undefined"!=typeof t&&(Sr.expires=t)}(s,e[2])),null===e&&(mr=s),null===e&&(s=mr,o=mr,"retry_after"===n.substr(mr,11).toLowerCase()?(e=n.substr(mr,11),mr+=11):(e=null,0===_r&&i('"retry_after"')),null!==e?(t=O(),null!==t?(r=Tt(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){"undefined"!=typeof t&&(Sr.retry_after=t)}(s,e[2])),null===e&&(mr=s),null===e&&(e=wt()))),e}function Rn(){var e;return"deactivated"===n.substr(mr,11).toLowerCase()?(e=n.substr(mr,11),mr+=11):(e=null,0===_r&&i('"deactivated"')),null===e&&("probation"===n.substr(mr,9).toLowerCase()?(e=n.substr(mr,9),mr+=9):(e=null,0===_r&&i('"probation"')),null===e&&("rejected"===n.substr(mr,8).toLowerCase()?(e=n.substr(mr,8),mr+=8):(e=null,0===_r&&i('"rejected"')),null===e&&("timeout"===n.substr(mr,7).toLowerCase()?(e=n.substr(mr,7),mr+=7):(e=null,0===_r&&i('"timeout"')),null===e&&("giveup"===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"giveup"')),null===e&&("noresource"===n.substr(mr,10).toLowerCase()?(e=n.substr(mr,10),mr+=10):(e=null,0===_r&&i('"noresource"')),null===e&&("invariant"===n.substr(mr,9).toLowerCase()?(e=n.substr(mr,9),mr+=9):(e=null,0===_r&&i('"invariant"')),null===e&&(e=R()))))))),e}function In(){var e;return e=S(),e=null!==e?e:""}function kn(){var e,t,n,r,i,s;if(i=mr,e=R(),null!==e){for(t=[],s=mr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e=null!==e?e:""}function xn(){var e,t,n,r,i,s,o;if(i=mr,s=mr,e=J(),null===e&&(e=mt()),null!==e){for(t=[],o=mr,n=B(),null!==n?(r=Un(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==n;)t.push(n),o=mr,n=B(),null!==n?(r=Un(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==t?e=[e,t]:(e=null,mr=s)}else e=null,mr=s;return null!==e&&(e=function(e){var t=Sr.tag;try{Sr=new Tr(Sr.uri,Sr.display_name,Sr.params),t&&Sr.setParam("tag",t)}catch(n){Sr=-1}}(i)),null===e&&(mr=i),e}function Un(){var e;return e=Kt(),null===e&&(e=wt()),e}function Dn(){var e,t,n,r,i,s;if(i=mr,e=On(),null!==e){for(t=[],s=mr,n=q(),null!==n?(r=On(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=q(),null!==n?(r=On(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function On(){var e,t,n,r,i,s,o,a;if(o=mr,e=jn(),null!==e)if(t=y(),null!==t)if(n=Gn(),null!==n){for(r=[],a=mr,i=B(),null!==i?(s=Nn(),null!==s?i=[i,s]:(i=null,mr=a)):(i=null,mr=a);null!==i;)r.push(i),a=mr,i=B(),null!==i?(s=Nn(),null!==s?i=[i,s]:(i=null,mr=a)):(i=null,mr=a);null!==r?e=[e,t,n,r]:(e=null,mr=o)}else e=null,mr=o;else e=null,mr=o;else e=null,mr=o;return e}function Nn(){var e;return e=Ln(),null===e&&(e=Mn(),null===e&&(e=Pn(),null===e&&(e=qn(),null===e&&(e=Bn(),null===e&&(e=wt()))))),e}function Ln(){var e,t,r,s,o;return s=mr,o=mr,"ttl"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"ttl"')),null!==e?(t=O(),null!==t?(r=zn(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.ttl=t}(s,e[2])),null===e&&(mr=s),e}function Mn(){var e,t,r,s,o;return s=mr,o=mr,"maddr"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"maddr"')),null!==e?(t=O(),null!==t?(r=re(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.maddr=t}(s,e[2])),null===e&&(mr=s),e}function Pn(){var e,t,r,s,o;return s=mr,o=mr,"received"===n.substr(mr,8).toLowerCase()?(e=n.substr(mr,8),mr+=8):(e=null,0===_r&&i('"received"')),null!==e?(t=O(),null!==t?(r=he(),null===r&&(r=le()),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.received=t}(s,e[2])),null===e&&(mr=s),e}function qn(){var e,t,r,s,o;return s=mr,o=mr,"branch"===n.substr(mr,6).toLowerCase()?(e=n.substr(mr,6),mr+=6):(e=null,0===_r&&i('"branch"')),null!==e?(t=O(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.branch=t}(s,e[2])),null===e&&(mr=s),e}function Bn(){var e,t,r,s,a,l,u;if(a=mr,l=mr,"rport"===n.substr(mr,5).toLowerCase()?(e=n.substr(mr,5),mr+=5):(e=null,0===_r&&i('"rport"')),null!==e){if(u=mr,t=O(),null!==t){for(r=[],s=o();null!==s;)r.push(s),s=o();null!==r?t=[t,r]:(t=null,mr=u)}else t=null,mr=u;t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=l)}else e=null,mr=l;return null!==e&&(e=function(e){"undefined"!=typeof response_port&&(Sr.rport=response_port.join(""))}(a)),null===e&&(mr=a),e}function jn(){var e,t,n,r,i,s;return s=mr,e=Hn(),null!==e?(t=D(),null!==t?(n=R(),null!==n?(r=D(),null!==r?(i=Fn(),null!==i?e=[e,t,n,r,i]:(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s)):(e=null,mr=s),e}function Hn(){var e,t;return t=mr,"sip"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"SIP"')),null===e&&(e=R()),null!==e&&(e=function(e,t){Sr.protocol=t}(t,e)),null===e&&(mr=t),e}function Fn(){var e,t;return t=mr,"udp"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"UDP"')),null===e&&("tcp"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"TCP"')),null===e&&("tls"===n.substr(mr,3).toLowerCase()?(e=n.substr(mr,3),mr+=3):(e=null,0===_r&&i('"TLS"')),null===e&&("sctp"===n.substr(mr,4).toLowerCase()?(e=n.substr(mr,4),mr+=4):(e=null,0===_r&&i('"SCTP"')),null===e&&(e=R())))),null!==e&&(e=function(e,t){Sr.transport=t}(t,e)),null===e&&(mr=t),e}function Gn(){var e,t,n,r,i;return r=mr,e=Wn(),null!==e?(i=mr,t=j(),null!==t?(n=Vn(),null!==n?t=[t,n]:(t=null,mr=i)):(t=null,mr=i),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=r)):(e=null,mr=r),e}function Wn(){var e,t;return t=mr,e=he(),null===e&&(e=ae(),null===e&&(e=ie())),null!==e&&(e=function(e){Sr.host=n.substring(mr,e)}(t)),null===e&&(mr=t),e}function Vn(){var e,t,n,r,i,s,a;return s=mr,a=mr,e=o(),e=null!==e?e:"",null!==e?(t=o(),t=null!==t?t:"",null!==t?(n=o(),n=null!==n?n:"",null!==n?(r=o(),r=null!==r?r:"",null!==r?(i=o(),i=null!==i?i:"",null!==i?e=[e,t,n,r,i]:(e=null,mr=a)):(e=null,mr=a)):(e=null,mr=a)):(e=null,mr=a)):(e=null,mr=a),null!==e&&(e=function(e,t){Sr.port=parseInt(t.join(""))}(s,e)),null===e&&(mr=s),e}function zn(){var e,t,n,r,i;return r=mr,i=mr,e=o(),null!==e?(t=o(),t=null!==t?t:"",null!==t?(n=o(),n=null!==n?n:"",null!==n?e=[e,t,n]:(e=null,mr=i)):(e=null,mr=i)):(e=null,mr=i),null!==e&&(e=function(e,t){return parseInt(t.join(""))}(r,e)),null===e&&(mr=r),e}function Yn(){var e;return e=Zt()}function Kn(){var e,t,n,r,i,s;if(i=mr,e=Jn(),null!==e){for(t=[],s=mr,n=B(),null!==n?(r=$n(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=B(),null!==n?(r=$n(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function Jn(){var e,t;return t=mr,e=Tt(),null!==e&&(e=function(e,t){Sr.expires=t}(t,e)),null===e&&(mr=t),e}function $n(){var e;return e=Xn(),null===e&&(e=wt()),e}function Xn(){var e,t,r,s,o;return s=mr,o=mr,"refresher"===n.substr(mr,9).toLowerCase()?(e=n.substr(mr,9),mr+=9):(e=null,0===_r&&i('"refresher"')),null!==e?(t=O(),null!==t?("uac"===n.substr(mr,3).toLowerCase()?(r=n.substr(mr,3),mr+=3):(r=null,0===_r&&i('"uac"')),null===r&&("uas"===n.substr(mr,3).toLowerCase()?(r=n.substr(mr,3),mr+=3):(r=null,0===_r&&i('"uas"'))),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.refresher=t.toLowerCase()}(s,e[2])),null===e&&(mr=s),e}function Qn(){var e,t,n,r;return r=mr,
e=R(),null!==e?(t=T(),null!==t?(n=Zn(),null!==n?e=[e,t,n]:(e=null,mr=r)):(e=null,mr=r)):(e=null,mr=r),e}function Zn(){var e,t;for(e=[],t=w(),null===t&&(t=C(),null===t&&(t=y()));null!==t;)e.push(t),t=w(),null===t&&(t=C(),null===t&&(t=y()));return e}function er(){var e,t;for(e=[],t=c();null!==t;)e.push(t),t=c();return e}function tr(){var e,t,r;return r=mr,"uuid:"===n.substr(mr,5)?(e="uuid:",mr+=5):(e=null,0===_r&&i('"uuid:"')),null!==e?(t=nr(),null!==t?e=[e,t]:(e=null,mr=r)):(e=null,mr=r),e}function nr(){var e,t,r,s,o,a,l,u,c,h,d;return h=mr,d=mr,e=ir(),null!==e?(45===n.charCodeAt(mr)?(t="-",mr++):(t=null,0===_r&&i('"-"')),null!==t?(r=rr(),null!==r?(45===n.charCodeAt(mr)?(s="-",mr++):(s=null,0===_r&&i('"-"')),null!==s?(o=rr(),null!==o?(45===n.charCodeAt(mr)?(a="-",mr++):(a=null,0===_r&&i('"-"')),null!==a?(l=rr(),null!==l?(45===n.charCodeAt(mr)?(u="-",mr++):(u=null,0===_r&&i('"-"')),null!==u?(c=sr(),null!==c?e=[e,t,r,s,o,a,l,u,c]:(e=null,mr=d)):(e=null,mr=d)):(e=null,mr=d)):(e=null,mr=d)):(e=null,mr=d)):(e=null,mr=d)):(e=null,mr=d)):(e=null,mr=d)):(e=null,mr=d),null!==e&&(e=function(e,t){Sr=n.substring(mr+5,e)}(h,e[0])),null===e&&(mr=h),e}function rr(){var e,t,n,r,i;return i=mr,e=l(),null!==e?(t=l(),null!==t?(n=l(),null!==n?(r=l(),null!==r?e=[e,t,n,r]:(e=null,mr=i)):(e=null,mr=i)):(e=null,mr=i)):(e=null,mr=i),e}function ir(){var e,t,n;return n=mr,e=rr(),null!==e?(t=rr(),null!==t?e=[e,t]:(e=null,mr=n)):(e=null,mr=n),e}function sr(){var e,t,n,r;return r=mr,e=rr(),null!==e?(t=rr(),null!==t?(n=rr(),null!==n?e=[e,t,n]:(e=null,mr=r)):(e=null,mr=r)):(e=null,mr=r),e}function or(){var e,t,n,r,i,s,o;if(i=mr,s=mr,e=J(),null===e&&(e=mt()),null!==e){for(t=[],o=mr,n=B(),null!==n?(r=wt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==n;)t.push(n),o=mr,n=B(),null!==n?(r=wt(),null!==r?n=[n,r]:(n=null,mr=o)):(n=null,mr=o);null!==t?e=[e,t]:(e=null,mr=s)}else e=null,mr=s;return null!==e&&(e=function(e){try{Sr=new Tr(Sr.uri,Sr.display_name,Sr.params)}catch(t){Sr=-1}}(i)),null===e&&(mr=i),e}function ar(){var e,t,n,r,i,s;if(i=mr,e=lr(),null!==e){for(t=[],s=mr,n=B(),null!==n?(r=ur(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==n;)t.push(n),s=mr,n=B(),null!==n?(r=ur(),null!==r?n=[n,r]:(n=null,mr=s)):(n=null,mr=s);null!==t?e=[e,t]:(e=null,mr=i)}else e=null,mr=i;return e}function lr(){var e,t,r,s,o,a;return s=mr,o=mr,e=x(),null!==e?(a=mr,64===n.charCodeAt(mr)?(t="@",mr++):(t=null,0===_r&&i('"@"')),null!==t?(r=x(),null!==r?t=[t,r]:(t=null,mr=a)):(t=null,mr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e){Sr.call_id=n.substring(mr,e)}(s)),null===e&&(mr=s),e}function ur(){var e;return e=cr(),null===e&&(e=hr(),null===e&&(e=dr(),null===e&&(e=wt()))),e}function cr(){var e,t,r,s,o;return s=mr,o=mr,"to-tag"===n.substr(mr,6)?(e="to-tag",mr+=6):(e=null,0===_r&&i('"to-tag"')),null!==e?(t=O(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.to_tag=t}(s,e[2])),null===e&&(mr=s),e}function hr(){var e,t,r,s,o;return s=mr,o=mr,"from-tag"===n.substr(mr,8)?(e="from-tag",mr+=8):(e=null,0===_r&&i('"from-tag"')),null!==e?(t=O(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,mr=o)):(e=null,mr=o)):(e=null,mr=o),null!==e&&(e=function(e,t){Sr.from_tag=t}(s,e[2])),null===e&&(mr=s),e}function dr(){var e,t;return t=mr,"early-only"===n.substr(mr,10)?(e="early-only",mr+=10):(e=null,0===_r&&i('"early-only"')),null!==e&&(e=function(e){Sr.early_only=!0}(t)),null===e&&(mr=t),e}function fr(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}function pr(){for(var e=1,t=1,r=!1,i=0;i<Math.max(mr,vr);i++){var s=n.charAt(i);"\n"===s?(r||e++,t=1,r=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(e++,t=1,r=!0):(t++,r=!1)}return{line:e,column:t}}var gr={CRLF:s,DIGIT:o,ALPHA:a,HEXDIG:l,WSP:u,OCTET:c,DQUOTE:h,SP:d,HTAB:f,alphanum:p,reserved:g,unreserved:m,mark:_,escaped:v,LWS:y,SWS:b,HCOLON:T,TEXT_UTF8_TRIM:S,TEXT_UTF8char:w,UTF8_NONASCII:E,UTF8_CONT:C,LHEX:A,token:R,token_nodot:I,separators:k,word:x,STAR:U,SLASH:D,EQUAL:O,LPAREN:N,RPAREN:L,RAQUOT:M,LAQUOT:P,COMMA:q,SEMI:B,COLON:j,LDQUOT:H,RDQUOT:F,comment:G,ctext:W,quoted_string:V,quoted_string_clean:z,qdtext:Y,quoted_pair:K,SIP_URI_noparams:J,SIP_URI:$,uri_scheme:X,userinfo:Q,user:Z,user_unreserved:ee,password:te,hostport:ne,host:re,hostname:ie,domainlabel:se,toplabel:oe,IPv6reference:ae,IPv6address:le,h16:ue,ls32:ce,IPv4address:he,dec_octet:de,port:fe,uri_parameters:pe,uri_parameter:ge,transport_param:me,user_param:_e,method_param:ve,ttl_param:ye,maddr_param:be,lr_param:Te,other_param:Se,pname:we,pvalue:Ee,paramchar:Ce,param_unreserved:Ae,headers:Re,header:Ie,hname:ke,hvalue:xe,hnv_unreserved:Ue,Request_Response:De,Request_Line:Oe,Request_URI:Ne,absoluteURI:Le,hier_part:Me,net_path:Pe,abs_path:qe,opaque_part:Be,uric:je,uric_no_slash:He,path_segments:Fe,segment:Ge,param:We,pchar:Ve,scheme:ze,authority:Ye,srvr:Ke,reg_name:Je,query:$e,SIP_Version:Xe,INVITEm:Qe,ACKm:Ze,OPTIONSm:et,BYEm:tt,CANCELm:nt,REGISTERm:rt,SUBSCRIBEm:it,NOTIFYm:st,REFERm:ot,Method:at,Status_Line:lt,Status_Code:ut,extension_code:ct,Reason_Phrase:ht,Allow_Events:dt,Call_ID:ft,Contact:pt,contact_param:gt,name_addr:mt,display_name:_t,contact_params:vt,c_p_q:yt,c_p_expires:bt,delta_seconds:Tt,qvalue:St,generic_param:wt,gen_value:Et,Content_Disposition:Ct,disp_type:At,disp_param:Rt,handling_param:It,Content_Encoding:kt,Content_Length:xt,Content_Type:Ut,media_type:Dt,m_type:Ot,discrete_type:Nt,composite_type:Lt,extension_token:Mt,x_token:Pt,m_subtype:qt,m_parameter:Bt,m_value:jt,CSeq:Ht,CSeq_value:Ft,Expires:Gt,Event:Wt,event_type:Vt,From:zt,from_param:Yt,tag_param:Kt,Max_Forwards:Jt,Min_Expires:$t,Name_Addr_Header:Xt,Proxy_Authenticate:Qt,challenge:Zt,other_challenge:en,auth_param:tn,digest_cln:nn,realm:rn,realm_value:sn,domain:on,URI:an,nonce:ln,nonce_value:un,opaque:cn,stale:hn,algorithm:dn,qop_options:fn,qop_value:pn,Proxy_Require:gn,Record_Route:mn,rec_route:_n,Reason:vn,reason_param:yn,reason_cause:bn,Require:Tn,Route:Sn,route_param:wn,Subscription_State:En,substate_value:Cn,subexp_params:An,event_reason_value:Rn,Subject:In,Supported:kn,To:xn,to_param:Un,Via:Dn,via_param:On,via_params:Nn,via_ttl:Ln,via_maddr:Mn,via_received:Pn,via_branch:qn,response_port:Bn,sent_protocol:jn,protocol_name:Hn,transport:Fn,sent_by:Gn,via_host:Wn,via_port:Vn,ttl:zn,WWW_Authenticate:Yn,Session_Expires:Kn,s_e_expires:Jn,s_e_params:$n,s_e_refresher:Xn,extension_header:Qn,header_value:Zn,message_body:er,uuid_URI:tr,uuid:nr,hex4:rr,hex8:ir,hex12:sr,Refer_To:or,Replaces:ar,call_id:lr,replaces_param:ur,to_tag:cr,from_tag:hr,early_flag:dr};if(void 0!==r){if(void 0===gr[r])throw new Error("Invalid rule name: "+t(r)+".")}else r="CRLF";var mr=0,_r=0,vr=0,yr=[],br=e("./URI"),Tr=e("./NameAddrHeader"),Sr={},wr=gr[r]();if(null===wr||mr!==n.length){var Er=Math.max(mr,vr),Cr=Er<n.length?n.charAt(Er):null,Ar=pr();return new this.SyntaxError(fr(yr),Cr,Er,Ar.line,Ar.column),-1}return Sr},toSource:function(){return this._source}};return n.SyntaxError=function(e,n,r,i,s){function o(e,n){var r,i;switch(e.length){case 0:r="end of input";break;case 1:r=e[0];break;default:r=e.slice(0,e.length-1).join(", ")+" or "+e[e.length-1]}return i=n?t(n):"end of input","Expected "+r+" but "+i+" found."}this.name="SyntaxError",this.expected=e,this.found=n,this.message=o(e,n),this.offset=r,this.line=i,this.column=s},n.SyntaxError.prototype=Error.prototype,n}()},{"./NameAddrHeader":15,"./URI":29}],13:[function(e,t,n){var r=e("debug")("JsSIP"),i=e("../package.json");r("version %s",i.version);var s=e("rtcninja"),o=e("./Constants"),a=e("./Exceptions"),l=e("./Utils"),u=e("./UA"),c=e("./URI"),h=e("./NameAddrHeader"),d=e("./Grammar"),f=t.exports={C:o,Exceptions:a,Utils:l,UA:u,URI:c,NameAddrHeader:h,Grammar:d,debug:e("debug"),rtcninja:s};Object.defineProperties(f,{name:{get:function(){return i.title}},version:{get:function(){return i.version}}})},{"../package.json":49,"./Constants":7,"./Exceptions":11,"./Grammar":12,"./NameAddrHeader":15,"./UA":28,"./URI":29,"./Utils":30,debug:32,rtcninja:37}],14:[function(e,t,n){function r(e){this.ua=e,this.data={},s.EventEmitter.call(this)}t.exports=r;var i=e("util"),s=e("events"),o=e("./Constants"),a=e("./SIPMessage"),l=e("./Utils"),u=e("./RequestSender"),c=e("./Transactions"),h=e("./Exceptions");i.inherits(r,s.EventEmitter),r.prototype.send=function(e,t,n){var r,i,s,l,c,h=e;if(void 0===e||void 0===t)throw new TypeError("Not enough arguments");if(e=this.ua.normalizeTarget(e),!e)throw new TypeError("Invalid target: "+h);n=n||{},c=n.extraHeaders&&n.extraHeaders.slice()||[],l=n.eventHandlers||{},s=n.contentType||"text/plain",this.content_type=s;for(i in l)this.on(i,l[i]);this.closed=!1,this.ua.applicants[this]=this,c.push("Content-Type: "+s),this.request=new a.OutgoingRequest(o.MESSAGE,e,this.ua,null,c),t?(this.request.body=t,this.content=t):this.content=null,r=new u(this,this.ua),this.newMessage("local",this.request),r.send()},r.prototype.receiveResponse=function(e){var t;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):delete this.ua.applicants[this],this.emit("succeeded",{originator:"remote",response:e});break;default:delete this.ua.applicants[this],t=l.sipErrorCause(e.status_code),this.emit("failed",{originator:"remote",response:e,cause:t})}},r.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",{originator:"system",cause:o.causes.REQUEST_TIMEOUT})},r.prototype.onTransportError=function(){this.closed||this.emit("failed",{originator:"system",cause:o.causes.CONNECTION_ERROR})},r.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},r.prototype.init_incoming=function(e){var t;this.request=e,this.content_type=e.getHeader("Content-Type"),e.body?this.content=e.body:this.content=null,this.newMessage("remote",e),t=this.ua.transactions.nist[e.via_branch],!t||t.state!==c.C.STATUS_TRYING&&t.state!==c.C.STATUS_PROCEEDING||e.reply(200)},r.prototype.accept=function(e){e=e||{};var t=e.extraHeaders&&e.extraHeaders.slice()||[],n=e.body;if("incoming"!==this.direction)throw new h.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,t,n)},r.prototype.reject=function(e){e=e||{};var t=e.status_code||480,n=e.reason_phrase,r=e.extraHeaders&&e.extraHeaders.slice()||[],i=e.body;if("incoming"!==this.direction)throw new h.NotSupportedError('"reject" not supported for outgoing Message');if(t<300||t>=700)throw new TypeError("Invalid status_code: "+t);this.request.reply(t,n,r,i)},r.prototype.newMessage=function(e,t){"remote"===e?(this.direction="incoming",this.local_identity=t.to,this.remote_identity=t.from):"local"===e&&(this.direction="outgoing",this.local_identity=t.from,this.remote_identity=t.to),this.ua.newMessage({originator:e,message:this,request:t})}},{"./Constants":7,"./Exceptions":11,"./RequestSender":23,"./SIPMessage":24,"./Transactions":26,"./Utils":30,events:1,util:5}],15:[function(e,t,n){function r(e,t,n){var r;if(!(e&&e instanceof i))throw new TypeError('missing or invalid "uri" parameter');this.uri=e,this.parameters={};for(r in n)this.setParam(r,n[r]);Object.defineProperties(this,{display_name:{get:function(){return t},set:function(e){t=0===e?"0":e}}})}t.exports=r;var i=e("./URI"),s=e("./Grammar");r.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]="undefined"==typeof t||null===t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},clone:function(){return new r(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;e=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",e+="<"+this.uri.toString()+">";for(t in this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},r.parse=function(e){return e=s.parse(e,"Name_Addr_Header"),e!==-1?e:void 0}},{"./Grammar":12,"./URI":29}],16:[function(e,t,n){function r(e,t){var n=t,r=0,i=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(i=e.indexOf("\r\n",n),i===-1)return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?n=i+2:r=i}return r}function i(e,t,n,r){var i,s,o,u,c=t.indexOf(":",n),h=t.substring(n,c).trim(),d=t.substring(c+1,r).trim();switch(h.toLowerCase()){case"via":case"v":e.addHeader("via",d),1===e.getHeaders("via").length?(u=e.parseHeader("Via"),u&&(e.via=u,e.via_branch=u.branch)):u=0;break;case"from":case"f":e.setHeader("from",d),u=e.parseHeader("from"),u&&(e.from=u,e.from_tag=u.getParam("tag"));break;case"to":case"t":e.setHeader("to",d),u=e.parseHeader("to"),u&&(e.to=u,e.to_tag=u.getParam("tag"));break;case"record-route":for(u=a.parse(d,"Record_Route"),u===-1&&(u=void 0),o=u.length,s=0;s<o;s++)i=u[s],e.addHeader("record-route",d.substring(i.possition,i.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=i.parsed;break;case"call-id":case"i":e.setHeader("call-id",d),u=e.parseHeader("call-id"),u&&(e.call_id=d);break;case"contact":case"m":for(u=a.parse(d,"Contact"),u===-1&&(u=void 0),o=u.length,s=0;s<o;s++)i=u[s],e.addHeader("contact",d.substring(i.possition,i.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=i.parsed;break;case"content-length":case"l":e.setHeader("content-length",d),u=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",d),u=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",d),u=e.parseHeader("cseq"),u&&(e.cseq=u.value),e instanceof l.IncomingResponse&&(e.method=u.method);break;case"max-forwards":e.setHeader("max-forwards",d),u=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",d),u=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",d),u=e.parseHeader("proxy-authenticate");break;case"session-expires":case"x":e.setHeader("session-expires",d),u=e.parseHeader("session-expires"),u&&(e.session_expires=u.expires,e.session_expires_refresher=u.refresher);break;case"refer-to":case"r":e.setHeader("refer-to",d),u=e.parseHeader("refer-to"),u&&(e.refer_to=u);break;case"replaces":e.setHeader("replaces",d),u=e.parseHeader("replaces"),u&&(e.replaces=u);break;case"event":case"o":e.setHeader("event",d),u=e.parseHeader("event"),u&&(e.event=u);break;default:e.setHeader(h,d),u=0}return void 0!==u||{error:'error parsing header "'+h+'"'}}var s={};t.exports=s;var o=e("debug")("JsSIP:ERROR:Parser");o.log=console.warn.bind(console);var a=e("./Grammar"),l=e("./SIPMessage");s.parseMessage=function(e,t){var n,s,u,c,h,d=0,f=e.indexOf("\r\n");if(f===-1)return void o("parseMessage() | no CRLF found, not a SIP message");if(s=e.substring(0,f),h=a.parse(s,"Request_Response"),h===-1)return void o('parseMessage() | error parsing first line of SIP message: "'+s+'"');for(h.status_code?(n=new l.IncomingResponse,n.status_code=h.status_code,n.reason_phrase=h.reason_phrase):(n=new l.IncomingRequest(t),n.method=h.method,n.ruri=h.uri),n.data=e,d=f+2;;){if(f=r(e,d),f===-2){c=d+2;break}if(f===-1)return void h.error("parseMessage() | malformed message");if(h=i(n,e,d,f),h!==!0)return void o("parseMessage() |",h.error);d=f+2}return n.hasHeader("content-length")?(u=n.getHeader("content-length"),n.body=e.substr(c,u)):n.body=e.substring(c),n}},{"./Grammar":12,"./SIPMessage":24,debug:32}],17:[function(e,t,n){function r(e){H("new"),this.ua=e,this.status=q.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.connection=null,this.is_confirmed=!1,this.late_sdp=!1,this.rtcOfferConstraints=null,this.rtcAnswerConstraints=null,this.localMediaStream=null,this.localMediaStreamLocallyGenerated=!1,this.rtcReady=!0,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.localHold=!1,this.remoteHold=!1,this.sessionTimers={enabled:this.ua.configuration.session_timers,defaultExpires:V.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this.data={},j.EventEmitter.call(this)}function i(e,t){var n=this,r=J.T1;this.timers.invite2xxTimer=setTimeout(function i(){n.status===q.STATUS_WAITING_FOR_ACK&&(e.reply(200,null,["Contact: "+n.contact],t),r<J.T2&&(r=2*r,r>J.T2&&(r=J.T2)),n.timers.invite2xxTimer=setTimeout(i,r))},r)}function s(){var e=this;this.timers.ackTimer=setTimeout(function(){e.status===q.STATUS_WAITING_FOR_ACK&&(H("no ACK received, terminating the session"),clearTimeout(e.timers.invite2xxTimer),y.call(e,V.BYE),D.call(e,"remote",null,V.causes.NO_ACK))},J.TIMER_H)}function o(e,t){var n=this;this.connection=new G.RTCPeerConnection(e,t),this.connection.onaddstream=function(e,t){n.emit("addstream",{stream:t})},this.connection.onremovestream=function(e,t){n.emit("removestream",{stream:t})},this.connection.oniceconnectionstatechange=function(e,t){n.emit("iceconnetionstatechange",{state:t}),"failed"===t&&n.terminate({cause:V.causes.RTP_TIMEOUT,status_code:200,reason_phrase:V.causes.RTP_TIMEOUT})}}function a(e,t,n,r){function i(e){var t=e.split("\n");e="";var n=/^([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}$/;for(var r in t){var i=t[r],s=!1;if(i.indexOf("a=candidate:")!=-1){var o=i.split(" ");for(var a in o){var l=o[a],u=n.exec(l);if(u){s=!0;break}}if(s)continue}else if(i.indexOf("m=audio")!=-1)i=i.replace(/109/,""),i=i.replace(/101/,"");else{if(i.indexOf("a=rtpmap:109 opus/48000/2")!=-1)continue;if(i.indexOf("a=fmtp:109")!=-1)continue;if(i.indexOf("a=rtpmap:101")!=-1)continue;if(i.indexOf("a=fmtp:101")!=-1)continue;if(i.indexOf("m=video")!=-1)i=i.replace(/126/,""),i=i.replace(/120/,"");else{if(i.indexOf("a=rtpmap:126 H264/90000")!=-1)continue;if(i.indexOf("a=rtpmap:120 VP8/90000")!=-1)continue;if(i.indexOf("a=fmtp:120")!=-1)continue}}e+=i+"\n"}return e}function s(e){a.onicecandidate=function(e,n){if(!n){a.onicecandidate=null,o.rtcReady=!0;var r=a.localDescription.sdp;r=i(r),t&&t(r),t=null}},a.setLocalDescription(e,function(){if("complete"===a.iceGatheringState){o.rtcReady=!0;var e=a.localDescription.sdp;e=i(e),t&&t(e),t=null}},function(e){o.rtcReady=!0,n&&n(e)})}H("createLocalDescription()");var o=this,a=this.connection;if(this.rtcReady=!1,"offer"===e)a.createOffer(s,function(e){o.rtcReady=!0,n&&n(e)},r);else{if("answer"!==e)throw new Error('createLocalDescription() | type must be "offer" or "answer", but "'+e+'" was given');a.createAnswer(s,function(e){o.rtcReady=!0,n&&n(e)},r)}}function l(e,t,n){var r,i,s="UAS"===t?e.to_tag:e.from_tag,o="UAS"===t?e.from_tag:e.to_tag,a=e.call_id+s+o;return i=this.earlyDialogs[a],n?!!i||(i=new X(this,e,t,X.C.STATUS_EARLY),i.error?(H(i.error),O.call(this,"remote",e,V.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[a]=i,!0)):(this.from_tag=e.from_tag,this.to_tag=e.to_tag,i?(i.update(e,t),this.dialog=i,delete this.earlyDialogs[a],!0):(r=new X(this,e,t),r.error?(H(r.error),O.call(this,"remote",e,V.causes.INTERNAL_ERROR),!1):(this.dialog=r,!0)))}function u(e){function t(t){t=t||{},p=!0;var n=t.status_code||403,r=t.reason_phrase||"",i=t.extraHeaders&&t.extraHeaders.slice()||[];if(this.status!==q.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError("Invalid status_code: "+n);e.reply(n,r,i)}function n(){r(function(t){var n=["Contact: "+h.contact];S.call(h,e,n),h.late_sdp&&(t=b.call(h,t)),e.reply(200,null,n,t,function(){h.status=q.STATUS_WAITING_FOR_ACK,i.call(h,e,t),s.call(h)}),"function"==typeof g.callback&&g.callback()},function(){e.reply(500)})}function r(e,t){h.late_sdp?a.call(h,"offer",e,t,h.rtcOfferConstraints):(h.remoteHold===!0&&f===!1?(h.remoteHold=!1,L.call(h,"remote")):h.remoteHold===!1&&f===!0&&(h.remoteHold=!0,N.call(h,"remote")),a.call(h,"answer",e,t,h.rtcAnswerConstraints))}H("receiveReinvite()");var o,l,u,c,h=this,d=e.getHeader("Content-Type"),f=!1,p=!1,g={request:e,callback:void 0,reject:t.bind(this)};if(this.emit("reinvite",g),!p)if(e.body){if(this.late_sdp=!1,"application/sdp"!==d)return H("invalid Content-Type"),void e.reply(415);for(o=e.parseSDP(),l=0;l<o.media.length;l++)if(c=o.media[l],re.indexOf(c.type)!==-1){if(u=c.direction||o.direction||"sendrecv","sendonly"!==u&&"inactive"!==u){f=!1;break}f=!0}this.connection.setRemoteDescription(new G.RTCSessionDescription({type:"offer",sdp:e.body}),n,function(){e.reply(488)})}else this.late_sdp=!0,n()}function c(e){function t(t){t=t||{},u=!0;var n=t.status_code||403,r=t.reason_phrase||"",i=t.extraHeaders&&t.extraHeaders.slice()||[];if(this.status!==q.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError("Invalid status_code: "+n);e.reply(n,r,i)}H("receiveUpdate()");var n,r,i,s,o=this,l=e.getHeader("Content-Type"),u=!1,c=!1,h={request:e,callback:void 0,reject:t.bind(this)};if(this.emit("update",h),!u){if(!e.body){var d=[];return S.call(this,e,d),void e.reply(200,null,d)}if("application/sdp"!==l)return H("invalid Content-Type"),void e.reply(415);for(n=e.parseSDP(),r=0;r<n.media.length;r++)if(s=n.media[r],re.indexOf(s.type)!==-1){if(i=s.direction||n.direction||"sendrecv","sendonly"!==i&&"inactive"!==i){c=!1;break}c=!0}this.connection.setRemoteDescription(new G.RTCSessionDescription({type:"offer",sdp:e.body}),function(){o.remoteHold===!0&&c===!1?(o.remoteHold=!1,L.call(o,"remote")):o.remoteHold===!1&&c===!0&&(o.remoteHold=!0,N.call(o,"remote")),a.call(o,"answer",function(t){var n=["Contact: "+o.contact];S.call(o,e,n),e.reply(200,null,n,t),"function"==typeof h.callback&&h.callback()},function(){e.reply(500)})},function(){e.reply(488)},this.rtcAnswerConstraints)}}function h(e){function t(t,n){var s,o;return n=n||{},t="function"==typeof t?t:null,(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(s=new r(this.ua),s.on("progress",function(e){i.notify(e.response.status_code,e.response.reason_phrase)}),s.on("accepted",function(e){i.notify(e.response.status_code,e.response.reason_phrase)}),s.on("failed",function(e){e.message?i.notify(e.message.status_code,e.message.reason_phrase):i.notify(487,e.cause)}),e.refer_to.uri.hasHeader("replaces")&&(o=decodeURIComponent(e.refer_to.uri.getHeader("replaces")),n.extraHeaders=n.extraHeaders||[],n.extraHeaders.push("Replaces: "+o)),void s.connect(e.refer_to.uri.toAor(),n,t))}function n(){i.notify(603)}H("receiveRefer()");var i,s=this;return void 0===typeof e.refer_to?(H("no Refer-To header field present in REFER"),void e.reply(400)):e.refer_to.uri.scheme!==V.SIP?(H("Refer-To header field points to a non-SIP URI scheme"),void e.reply(416)):(e.reply(202),i=new te(this,e.cseq),void this.emit("refer",{request:e,accept:function(e,n){t.call(s,e,n)},reject:function(){n.call(s)}}))}function d(e){H("receiveNotify()"),void 0===typeof e.event?e.reply(400):"refer"!==e.event.event?e.reply(489):this.referSubscriber?(this.referSubscriber.receiveNotify(e),e.reply(200)):e.reply(481,"Subscription does not exist")}function f(e){function t(t){var n;return(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(n=new r(this.ua),n.on("confirmed",function(){i.terminate()}),void n.init_incoming(e,t))}function n(){H("Replaced INVITE rejected by the user"),e.reply(486)}H("receiveReplaces()");var i=this;this.emit("replaces",{request:e,accept:function(e){t.call(i,e)},reject:function(){n.call(i)}})}function p(e,t,n){function r(e){l.status!==q.STATUS_TERMINATED&&(l.localMediaStream=e,e&&l.connection.addStream(e),l.emit("peerconnection",{peerconnection:l.connection}),I.call(l,l.request),a.call(l,"offer",s,o,t))}function i(){l.status!==q.STATUS_TERMINATED&&O.call(l,"local",null,V.causes.USER_DENIED_MEDIA_ACCESS)}function s(e){l.isCanceled||l.status===q.STATUS_TERMINATED||(l.request.body=e,l.status=q.STATUS_INVITE_SENT,l.emit("sending",{request:l.request}),u.send())}function o(){l.status!==q.STATUS_TERMINATED&&O.call(l,"system",null,V.causes.WEBRTC_ERROR)}var l=this,u=new Q(l,this.ua);this.receiveResponse=function(e){g.call(l,e)},n?setTimeout(function(){r(n)}):e.audio||e.video?(this.localMediaStreamLocallyGenerated=!0,G.getUserMedia(e,r,i)):r(null)}function g(e){H("receiveInviteResponse()");var t,n,r=this;if(this.dialog&&e.status_code>=200&&e.status_code<=299)return this.dialog.id.call_id===e.call_id&&this.dialog.id.local_tag===e.from_tag&&this.dialog.id.remote_tag===e.to_tag?void y.call(this,V.ACK):(n=new X(this,e,"UAC"),void 0!==n.error?void H(n.error):(n.sendRequest({owner:{status:q.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},V.ACK),void n.sendRequest({owner:{status:q.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},V.BYE)));if(this.isCanceled)return this.isCanceled=!1,void(e.status_code>=100&&e.status_code<200?this.request.cancel(this.cancelReason):e.status_code>=200&&e.status_code<299&&v.call(this,e));if(this.status===q.STATUS_INVITE_SENT||this.status===q.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(e.status_code):this.status=q.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(e.status_code):if(!e.to_tag){H("1xx response received without to tag");break}if(e.hasHeader("contact")&&!l.call(this,e,"UAC",!0))break;if(this.status=q.STATUS_1XX_RECEIVED,k.call(this,"remote",e),!e.body)break;this.connection.setRemoteDescription(new G.RTCSessionDescription({type:"pranswer",sdp:e.body}),null,null);break;case/^2[0-9]{2}$/.test(e.status_code):if(this.status=q.STATUS_CONFIRMED,!e.body){v.call(this,e,400,V.causes.MISSING_SDP),O.call(this,"remote",e,V.causes.BAD_MEDIA_DESCRIPTION);break}if(!l.call(this,e,"UAC"))break;this.connection.setRemoteDescription(new G.RTCSessionDescription({type:"answer",sdp:e.body}),function(){w.call(r,e),x.call(r,"remote",e),y.call(r,V.ACK),U.call(r,"local",null)},function(){v.call(r,e,488,"Not Acceptable Here"),O.call(r,"remote",e,V.causes.BAD_MEDIA_DESCRIPTION)});break;default:t=K.sipErrorCause(e.status_code),O.call(this,"remote",e,t)}}function m(e){function t(e){if(r.status!==q.STATUS_TERMINATED&&(y.call(r,V.ACK),!l))return w.call(r,e),e.body?"application/sdp"!==e.getHeader("Content-Type")?void n():void r.connection.setRemoteDescription(new G.RTCSessionDescription({type:"answer",sdp:e.body}),function(){s.succeeded&&s.succeeded(e)},function(){n()}):void n()}function n(e){s.failed&&s.failed(e)}H("sendReinvite()"),e=e||{};var r=this,i=e.extraHeaders||[],s=e.eventHandlers||{},o=e.rtcOfferConstraints||this.rtcOfferConstraints||null,l=!1;i.push("Contact: "+this.contact),i.push("Content-Type: application/sdp"),this.sessionTimers.running&&i.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),a.call(this,"offer",function(e){e=b.call(r,e);var s=new Z(r,V.INVITE);s.send({extraHeaders:i,body:e,eventHandlers:{onSuccessResponse:function(e){t(e),l=!0},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})},function(){n()},o)}function _(e){function t(e){if(r.status!==q.STATUS_TERMINATED&&!u)if(w.call(r,e),l){if(!e.body)return void n();if("application/sdp"!==e.getHeader("Content-Type"))return void n();r.connection.setRemoteDescription(new G.RTCSessionDescription({type:"answer",sdp:e.body}),function(){s.succeeded&&s.succeeded(e)},function(){n()})}else s.succeeded&&s.succeeded(e)}function n(e){s.failed&&s.failed(e)}H("sendUpdate()"),e=e||{};var r=this,i=e.extraHeaders||[],s=e.eventHandlers||{},o=e.rtcOfferConstraints||this.rtcOfferConstraints||null,l=e.sdpOffer||!1,u=!1;if(i.push("Contact: "+this.contact),this.sessionTimers.running&&i.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),l)i.push("Content-Type: application/sdp"),a.call(this,"offer",function(e){e=b.call(r,e);var s=new Z(r,V.UPDATE);s.send({extraHeaders:i,body:e,eventHandlers:{onSuccessResponse:function(e){t(e),u=!0},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})},function(){n()},o);else{var c=new Z(r,V.UPDATE);c.send({extraHeaders:i,eventHandlers:{onSuccessResponse:function(e){t(e)},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})}}function v(e,t,n){H("acceptAndTerminate()");var r=[];t&&(n=n||V.REASON_PHRASE[t]||"",r.push("Reason: SIP ;cause="+t+'; text="'+n+'"')),(this.dialog||l.call(this,e,"UAC"))&&(y.call(this,V.ACK),y.call(this,V.BYE,{extraHeaders:r})),this.status=q.STATUS_TERMINATED}function y(e,t){H("sendRequest()");var n=new Z(this,e);n.send(t)}function b(e){var t,n,r;if(!this.localHold&&!this.remoteHold)return e;if(e=W.parse(e),this.localHold&&!this.remoteHold)for(H("mangleOffer() | me on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],re.indexOf(r.type)!==-1&&(r.direction?"sendrecv"===r.direction?r.direction="sendonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="sendonly");else if(this.localHold&&this.remoteHold)for(H("mangleOffer() | both on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],re.indexOf(r.type)!==-1&&(r.direction="inactive");else if(this.remoteHold)for(H("mangleOffer() | remote on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],re.indexOf(r.type)!==-1&&(r.direction?"sendrecv"===r.direction?r.direction="recvonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="recvonly");return W.write(e)}function T(){var e=!0,t=!0;(this.localHold||this.remoteHold)&&(e=!1,t=!1),this.audioMuted&&(e=!1),this.videoMuted&&(t=!1),C.call(this,!e),A.call(this,!t)}function S(e,t){if(this.sessionTimers.enabled){var n;e.session_expires&&e.session_expires>=V.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=e.session_expires,n=e.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,n="uas"),t.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+n),this.sessionTimers.refresher="uas"===n,E.call(this)}}function w(e){if(this.sessionTimers.enabled){var t;e.session_expires&&e.session_expires>=V.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=e.session_expires,t=e.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,t="uac"),this.sessionTimers.refresher="uac"===t,E.call(this)}}function E(){var e=this,t=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.refresher?this.sessionTimers.timer=setTimeout(function(){e.status!==q.STATUS_TERMINATED&&(H("runSessionTimer() | sending session refresh request"),_.call(e,{eventHandlers:{succeeded:function(t){w.call(e,t)}}}))},500*t):this.sessionTimers.timer=setTimeout(function(){e.status!==q.STATUS_TERMINATED&&(F("runSessionTimer() | timer expired, terminating the session"),e.terminate({cause:V.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*t)}function C(e){var t,n,r,i,s,o=this.connection.getLocalStreams();for(r=o.length,t=0;t<r;t++)for(s=o[t].getAudioTracks(),i=s.length,n=0;n<i;n++)s[n].enabled=!e}function A(e){var t,n,r,i,s,o=this.connection.getLocalStreams();for(r=o.length,t=0;t<r;t++)for(s=o[t].getVideoTracks(),i=s.length,n=0;n<i;n++)s[n].enabled=!e}function R(e,t){H("newRTCSession"),this.ua.newRTCSession({originator:e,session:this,request:t})}function I(e){H("session connecting"),this.emit("connecting",{request:e})}function k(e,t){H("session progress"),this.emit("progress",{originator:e,response:t||null})}
function x(e,t){H("session accepted"),this.start_time=new Date,this.emit("accepted",{originator:e,response:t||null})}function U(e,t){H("session confirmed"),this.is_confirmed=!0,this.emit("confirmed",{originator:e,ack:t||null})}function D(e,t,n){H("session ended"),this.end_time=new Date,this.close(),this.emit("ended",{originator:e,message:t||null,cause:n})}function O(e,t,n){H("session failed"),this.close(),this.emit("failed",{originator:e,message:t||null,cause:n})}function N(e){H("session onhold"),T.call(this),this.emit("hold",{originator:e})}function L(e){H("session onunhold"),T.call(this),this.emit("unhold",{originator:e})}function M(e){H("session onmute"),T.call(this),this.emit("muted",{audio:e.audio,video:e.video})}function P(e){H("session onunmute"),T.call(this),this.emit("unmuted",{audio:e.audio,video:e.video})}t.exports=r;var q={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};r.C=q;var B=e("util"),j=e("events"),H=e("debug")("JsSIP:RTCSession"),F=e("debug")("JsSIP:ERROR:RTCSession");F.log=console.warn.bind(console);var G=e("rtcninja"),W=e("sdp-transform"),V=e("./Constants"),z=e("./Exceptions"),Y=e("./Transactions"),K=e("./Utils"),J=e("./Timers"),$=e("./SIPMessage"),X=e("./Dialog"),Q=e("./RequestSender"),Z=e("./RTCSession/Request"),ee=e("./RTCSession/DTMF"),te=e("./RTCSession/ReferNotifier"),ne=e("./RTCSession/ReferSubscriber"),re=["audio","video"];B.inherits(r,j.EventEmitter),r.prototype.isInProgress=function(){switch(this.status){case q.STATUS_NULL:case q.STATUS_INVITE_SENT:case q.STATUS_1XX_RECEIVED:case q.STATUS_INVITE_RECEIVED:case q.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}},r.prototype.isEstablished=function(){switch(this.status){case q.STATUS_ANSWERED:case q.STATUS_WAITING_FOR_ACK:case q.STATUS_CONFIRMED:return!0;default:return!1}},r.prototype.isEnded=function(){switch(this.status){case q.STATUS_CANCELED:case q.STATUS_TERMINATED:return!0;default:return!1}},r.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},r.prototype.isOnHold=function(){return{local:this.localHold,remote:this.remoteHold}},r.prototype.isReadyToReOffer=function(){return this.rtcReady?this.dialog?this.dialog.uac_pending_reply!==!0&&this.dialog.uas_pending_reply!==!0||(H("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(H("isReadyToReOffer() | session not established yet"),!1):(H("isReadyToReOffer() | internal WebRTC status not ready"),!1)},r.prototype.connect=function(e,t,n){H("connect()"),t=t||{};var r,i,s=e,a=t.eventHandlers||{},l=t.extraHeaders&&t.extraHeaders.slice()||[],u=t.mediaConstraints||{audio:!0,video:!0},c=t.mediaStream||null,h=t.pcConfig||{iceServers:[]},d=t.rtcConstraints||null,f=t.rtcOfferConstraints||null;if(this.rtcOfferConstraints=f,this.rtcAnswerConstraints=t.rtcAnswerConstraints||null,this.sessionTimers.enabled&&K.isDecimal(t.sessionTimersExpires)&&(t.sessionTimersExpires>=V.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=t.sessionTimersExpires:this.sessionTimers.defaultExpires=V.SESSION_EXPIRES),this.data=t.data||this.data,void 0===e)throw new TypeError("Not enough arguments");if(!G.hasWebRTC())throw new z.NotSupportedError("WebRTC not supported");if(e=this.ua.normalizeTarget(e),!e)throw new TypeError("Invalid target: "+s);if(this.status!==q.STATUS_NULL)throw new z.InvalidStateError(this.status);for(r in a)this.on(r,a[r]);this.from_tag=K.newTag(),this.anonymous=t.anonymous||!1,this.isCanceled=!1,i={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(i.from_display_name="Anonymous",i.from_uri="sip:anonymous@anonymous.invalid",l.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),l.push("Privacy: id")),l.push("Contact: "+this.contact),l.push("Content-Type: application/sdp"),this.sessionTimers.enabled&&l.push("Session-Expires: "+this.sessionTimers.defaultExpires),this.request=new $.OutgoingRequest(V.INVITE,e,this.ua,i,l),this.id=this.request.call_id+this.from_tag,o.call(this,h,d),this.ua.sessions[this.id]=this,this.direction="outgoing",this.local_identity=this.request.from,this.remote_identity=this.request.to,n?n(this):R.call(this,"local",this.request),p.call(this,u,f,c)},r.prototype.init_incoming=function(e,t){H("init_incoming()");var n,r=this,i=e.getHeader("Content-Type");return e.body&&"application/sdp"!==i?void e.reply(415):(this.status=q.STATUS_INVITE_RECEIVED,this.from_tag=e.from_tag,this.id=e.call_id+this.from_tag,this.request=e,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,e.hasHeader("expires")&&(n=1e3*e.getHeader("expires")),e.to_tag=K.newTag(),l.call(this,e,"UAS",!0)?(e.body?this.late_sdp=!1:this.late_sdp=!0,this.status=q.STATUS_WAITING_FOR_ANSWER,this.timers.userNoAnswerTimer=setTimeout(function(){e.reply(408),O.call(r,"local",null,V.causes.NO_ANSWER)},this.ua.configuration.no_answer_timeout),n&&(this.timers.expiresTimer=setTimeout(function(){r.status===q.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),O.call(r,"system",null,V.causes.EXPIRES))},n)),this.direction="incoming",this.local_identity=e.to,this.remote_identity=e.from,t?t(this):R.call(this,"remote",e),void(this.status!==q.STATUS_TERMINATED&&(e.reply(180,null,["Contact: "+r.contact]),k.call(r,"local",null)))):void e.reply(500,"Missing Contact header field"))},r.prototype.answer=function(e){function t(e){y.status!==q.STATUS_TERMINATED&&(y.localMediaStream=e,e&&y.connection.addStream(e),y.late_sdp?r():y.connection.setRemoteDescription(new G.RTCSessionDescription({type:"offer",sdp:b.body}),r,function(){b.reply(488),O.call(y,"system",null,V.causes.WEBRTC_ERROR)}))}function n(){y.status!==q.STATUS_TERMINATED&&(b.reply(480),O.call(y,"local",null,V.causes.USER_DENIED_MEDIA_ACCESS))}function r(){I.call(y,b),y.late_sdp?a.call(y,"offer",u,c,y.rtcOfferConstraints):a.call(y,"answer",u,c,R)}function u(e){function t(){y.status=q.STATUS_WAITING_FOR_ACK,i.call(y,b,e),s.call(y),x.call(y,"local")}function n(){O.call(y,"system",null,V.causes.CONNECTION_ERROR)}y.status!==q.STATUS_TERMINATED&&(S.call(y,b,T),b.reply(200,null,T,e,t,n))}function c(){y.status!==q.STATUS_TERMINATED&&(b.reply(500),O.call(y,"system",null,V.causes.WEBRTC_ERROR))}H("answer()"),e=e||{};var h,d,f,p,g=!1,m=!1,_=!1,v=!1,y=this,b=this.request,T=e.extraHeaders&&e.extraHeaders.slice()||[],w=e.mediaConstraints||{},E=e.mediaStream||null,C=e.pcConfig||{iceServers:[]},A=e.rtcConstraints||null,R=e.rtcAnswerConstraints||null;if(this.rtcAnswerConstraints=R,this.rtcOfferConstraints=e.rtcOfferConstraints||null,this.sessionTimers.enabled&&K.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=V.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=e.sessionTimersExpires:this.sessionTimers.defaultExpires=V.SESSION_EXPIRES),this.data=e.data||this.data,"incoming"!==this.direction)throw new z.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==q.STATUS_WAITING_FOR_ANSWER)throw new z.InvalidStateError(this.status);if(this.status=q.STATUS_ANSWERED,!l.call(this,b,"UAS"))return void b.reply(500,"Error creating dialog");for(clearTimeout(this.timers.userNoAnswerTimer),T.unshift("Contact: "+y.contact),f=b.parseSDP(),Array.isArray(f.media)||(f.media=[f.media]),h=f.media.length;h--;){var k=f.media[h];"audio"===k.type&&(g=!0,k.direction&&"sendrecv"!==k.direction||(_=!0)),"video"===k.type&&(m=!0,k.direction&&"sendrecv"!==k.direction||(v=!0))}if(E&&w.audio===!1)for(p=E.getAudioTracks(),d=p.length,h=0;h<d;h++)E.removeTrack(p[h]);if(E&&w.video===!1)for(p=E.getVideoTracks(),d=p.length,h=0;h<d;h++)E.removeTrack(p[h]);E||void 0!==w.audio||(w.audio=_),E||void 0!==w.video||(w.video=v),E||g||(w.audio=!1),E||m||(w.video=!1),o.call(this,C,A),E?t(E):w.audio||w.video?(y.localMediaStreamLocallyGenerated=!0,G.getUserMedia(w,t,n)):t(null)},r.prototype.terminate=function(e){H("terminate()"),e=e||{};var t,n,r=e.cause||V.causes.BYE,i=e.status_code,s=e.reason_phrase,o=e.extraHeaders&&e.extraHeaders.slice()||[],a=e.body,l=this;if(this.status===q.STATUS_TERMINATED)throw new z.InvalidStateError(this.status);switch(this.status){case q.STATUS_NULL:case q.STATUS_INVITE_SENT:case q.STATUS_1XX_RECEIVED:if(H("canceling sesssion"),i&&(i<200||i>=700))throw new TypeError("Invalid status_code: "+i);i&&(s=s||V.REASON_PHRASE[i]||"",t="SIP ;cause="+i+' ;text="'+s+'"'),this.status===q.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=t):this.status===q.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=t):this.status===q.STATUS_1XX_RECEIVED&&this.request.cancel(t),this.status=q.STATUS_CANCELED,O.call(this,"local",null,V.causes.CANCELED);break;case q.STATUS_WAITING_FOR_ANSWER:case q.STATUS_ANSWERED:if(H("rejecting session"),i=i||480,i<300||i>=700)throw new TypeError("Invalid status_code: "+i);this.request.reply(i,s,o,a),O.call(this,"local",null,V.causes.REJECTED);break;case q.STATUS_WAITING_FOR_ACK:case q.STATUS_CONFIRMED:if(H("terminating session"),s=e.reason_phrase||V.REASON_PHRASE[i]||"",i&&(i<200||i>=700))throw new TypeError("Invalid status_code: "+i);i&&o.push("Reason: SIP ;cause="+i+'; text="'+s+'"'),this.status===q.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==Y.C.STATUS_TERMINATED?(n=this.dialog,this.receiveRequest=function(e){e.method===V.ACK&&(y.call(this,V.BYE,{extraHeaders:o,body:a}),n.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===Y.C.STATUS_TERMINATED&&(y.call(l,V.BYE,{extraHeaders:o,body:a}),n.terminate())}),D.call(this,"local",null,r),this.dialog=n,this.ua.dialogs[n.id.toString()]=n):(y.call(this,V.BYE,{extraHeaders:o,body:a}),D.call(this,"local",null,r))}},r.prototype.close=function(){H("close()");var e;if(this.status!==q.STATUS_TERMINATED){if(this.connection)try{this.connection.close()}catch(t){F("close() | error closing the RTCPeerConnection: %o",t)}this.localMediaStream&&this.localMediaStreamLocallyGenerated&&(H("close() | closing local MediaStream"),G.closeMediaStream(this.localMediaStream));for(e in this.timers)clearTimeout(this.timers[e]);clearTimeout(this.sessionTimers.timer),this.dialog&&(this.dialog.terminate(),delete this.dialog);for(e in this.earlyDialogs)this.earlyDialogs[e].terminate(),delete this.earlyDialogs[e];this.status=q.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},r.prototype.sendDTMF=function(e,t){function n(){var e,a;if(o.status===q.STATUS_TERMINATED||!o.tones||s>=o.tones.length)return void(o.tones=null);if(e=o.tones[s],s+=1,","===e)a=2e3;else{var l=new ee(o);t.eventHandlers={failed:function(){o.tones=null}},l.send(e,t),a=r+i}setTimeout(n,a)}H("sendDTMF() | tones: %s",e);var r,i,s=0,o=this;if(t=t||{},r=t.duration||null,i=t.interToneGap||null,void 0===e)throw new TypeError("Not enough arguments");if(this.status!==q.STATUS_CONFIRMED&&this.status!==q.STATUS_WAITING_FOR_ACK)throw new z.InvalidStateError(this.status);if("number"==typeof e&&(e=e.toString()),!e||"string"!=typeof e||!e.match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+e);if(r&&!K.isDecimal(r))throw new TypeError("Invalid tone duration: "+r);if(r?r<ee.C.MIN_DURATION?(H('"duration" value is lower than the minimum allowed, setting it to '+ee.C.MIN_DURATION+" milliseconds"),r=ee.C.MIN_DURATION):r>ee.C.MAX_DURATION?(H('"duration" value is greater than the maximum allowed, setting it to '+ee.C.MAX_DURATION+" milliseconds"),r=ee.C.MAX_DURATION):r=Math.abs(r):r=ee.C.DEFAULT_DURATION,t.duration=r,i&&!K.isDecimal(i))throw new TypeError("Invalid interToneGap: "+i);return i?i<ee.C.MIN_INTER_TONE_GAP?(H('"interToneGap" value is lower than the minimum allowed, setting it to '+ee.C.MIN_INTER_TONE_GAP+" milliseconds"),i=ee.C.MIN_INTER_TONE_GAP):i=Math.abs(i):i=ee.C.DEFAULT_INTER_TONE_GAP,this.tones?void(this.tones+=e):(this.tones=e,void n())},r.prototype.mute=function(e){H("mute()"),e=e||{audio:!0,video:!1};var t=!1,n=!1;this.audioMuted===!1&&e.audio&&(t=!0,this.audioMuted=!0,C.call(this,!0)),this.videoMuted===!1&&e.video&&(n=!0,this.videoMuted=!0,A.call(this,!0)),t!==!0&&n!==!0||M.call(this,{audio:t,video:n})},r.prototype.unmute=function(e){H("unmute()"),e=e||{audio:!0,video:!0};var t=!1,n=!1;this.audioMuted===!0&&e.audio&&(t=!0,this.audioMuted=!1,this.localHold===!1&&C.call(this,!1)),this.videoMuted===!0&&e.video&&(n=!0,this.videoMuted=!1,this.localHold===!1&&A.call(this,!1)),t!==!0&&n!==!0||P.call(this,{audio:t,video:n})},r.prototype.hold=function(e,t){H("hold()"),e=e||{};var n,r=this;return(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(this.localHold!==!0&&(!!this.isReadyToReOffer()&&(this.localHold=!0,N.call(this,"local"),n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:V.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}},e.useUpdate?_.call(this,{sdpOffer:!0,eventHandlers:n,extraHeaders:e.extraHeaders}):m.call(this,{eventHandlers:n,extraHeaders:e.extraHeaders}),!0)))},r.prototype.unhold=function(e,t){H("unhold()"),e=e||{};var n,r=this;return(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(this.localHold!==!1&&(!!this.isReadyToReOffer()&&(this.localHold=!1,L.call(this,"local"),n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:V.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}},e.useUpdate?_.call(this,{sdpOffer:!0,eventHandlers:n,extraHeaders:e.extraHeaders}):m.call(this,{eventHandlers:n,extraHeaders:e.extraHeaders}),!0)))},r.prototype.renegotiate=function(e,t){H("renegotiate()"),e=e||{};var n,r=this,i=e.rtcOfferConstraints||null;return(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(!!this.isReadyToReOffer()&&(n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:V.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},T.call(this),e.useUpdate?_.call(this,{sdpOffer:!0,eventHandlers:n,rtcOfferConstraints:i,extraHeaders:e.extraHeaders}):m.call(this,{eventHandlers:n,rtcOfferConstraints:i,extraHeaders:e.extraHeaders}),!0))},r.prototype.refer=function(e,t){H("refer()");var n=e;if(this.status!==q.STATUS_WAITING_FOR_ACK&&this.status!==q.STATUS_CONFIRMED)return!1;if(this.referSubscriber)return!1;if(e=this.ua.normalizeTarget(e),!e)throw new TypeError("Invalid target: "+n);this.referSubscriber=new ne(this),this.referSubscriber.sendRefer(e,t)},r.prototype.receiveRequest=function(e){H("receiveRequest()");var t,n=this;if(e.method===V.CANCEL)this.status!==q.STATUS_WAITING_FOR_ANSWER&&this.status!==q.STATUS_ANSWERED||(this.status=q.STATUS_CANCELED,this.request.reply(487),O.call(this,"remote",e,V.causes.CANCELED));else switch(e.method){case V.ACK:if(this.status===q.STATUS_WAITING_FOR_ACK){if(clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!e.body){D.call(this,"remote",e,V.causes.MISSING_SDP);break}this.connection.setRemoteDescription(new G.RTCSessionDescription({type:"answer",sdp:e.body}),function(){n.status=q.STATUS_CONFIRMED},function(){D.call(n,"remote",e,V.causes.BAD_MEDIA_DESCRIPTION)})}else this.status=q.STATUS_CONFIRMED;this.status!==q.STATUS_CONFIRMED||this.is_confirmed||U.call(this,"remote",e)}break;case V.BYE:this.status===q.STATUS_CONFIRMED?(e.reply(200),D.call(this,"remote",e,V.causes.BYE)):this.status===q.STATUS_INVITE_RECEIVED?(e.reply(200),this.request.reply(487,"BYE Received"),D.call(this,"remote",e,V.causes.BYE)):e.reply(403,"Wrong Status");break;case V.INVITE:this.status===q.STATUS_CONFIRMED?e.hasHeader("replaces")?f.call(this,e):u.call(this,e):e.reply(403,"Wrong Status");break;case V.INFO:this.status===q.STATUS_CONFIRMED||this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_INVITE_RECEIVED?(t=e.getHeader("content-type"),t&&t.match(/^application\/dtmf-relay/i)?new ee(this).init_incoming(e):e.reply(415)):e.reply(403,"Wrong Status");break;case V.UPDATE:this.status===q.STATUS_CONFIRMED?c.call(this,e):e.reply(403,"Wrong Status");break;case V.REFER:this.status===q.STATUS_CONFIRMED?h.call(this,e):e.reply(403,"Wrong Status");break;case V.NOTIFY:this.status===q.STATUS_CONFIRMED?d.call(this,e):e.reply(403,"Wrong Status");break;default:e.reply(501)}},r.prototype.onTransportError=function(){F("onTransportError()"),this.status!==q.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:V.causes.CONNECTION_ERROR,cause:V.causes.CONNECTION_ERROR})},r.prototype.onRequestTimeout=function(){H("onRequestTimeout"),this.status!==q.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:V.causes.REQUEST_TIMEOUT,cause:V.causes.REQUEST_TIMEOUT})},r.prototype.onDialogError=function(){F("onDialogError()"),this.status!==q.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:V.causes.DIALOG_ERROR,cause:V.causes.DIALOG_ERROR})},r.prototype.newDTMF=function(e){H("newDTMF()"),this.emit("newDTMF",e)},r.prototype.resetLocalMedia=function(){H("resetLocalMedia()"),this.localHold=!1,this.audioMuted=!1,this.videoMuted=!1,T.call(this)}},{"./Constants":7,"./Dialog":8,"./Exceptions":11,"./RTCSession/DTMF":18,"./RTCSession/ReferNotifier":19,"./RTCSession/ReferSubscriber":20,"./RTCSession/Request":21,"./RequestSender":23,"./SIPMessage":24,"./Timers":25,"./Transactions":26,"./Utils":30,debug:32,events:1,rtcninja:37,"sdp-transform":43,util:5}],18:[function(e,t,n){function r(e){this.owner=e,this.direction=null,this.tone=null,this.duration=null}t.exports=r;var i={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};r.C=i;var s=e("debug")("JsSIP:RTCSession:DTMF"),o=e("debug")("JsSIP:ERROR:RTCSession:DTMF");o.log=console.warn.bind(console);var a=e("../Constants"),l=e("../Exceptions"),u=e("../RTCSession");r.prototype.send=function(e,t){var n,r;if(void 0===e)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==u.C.STATUS_CONFIRMED&&this.owner.status!==u.C.STATUS_WAITING_FOR_ACK)throw new l.InvalidStateError(this.owner.status);if(t=t||{},n=t.extraHeaders?t.extraHeaders.slice():[],this.eventHandlers=t.eventHandlers||{},"string"==typeof e)e=e.toUpperCase();else{if("number"!=typeof e)throw new TypeError("Invalid tone: "+e);e=e.toString()}if(!e.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+e);this.tone=e,this.duration=t.duration,n.push("Content-Type: application/dtmf-relay"),r="Signal="+this.tone+"\r\n",r+="Duration="+this.duration,this.owner.newDTMF({originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,a.INFO,{extraHeaders:n,body:r})},r.prototype.receiveResponse=function(e){switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):s("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(e);break;default:this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(e)}},r.prototype.onRequestTimeout=function(){o("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},r.prototype.onTransportError=function(){o("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},r.prototype.onDialogError=function(){o("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()},r.prototype.init_incoming=function(e){var t,n=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,r=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=e,e.reply(200),e.body&&(t=e.body.split("\n"),t.length>=1&&n.test(t[0])&&(this.tone=t[0].replace(n,"$2")),t.length>=2&&r.test(t[1])&&(this.duration=parseInt(t[1].replace(r,"$2"),10))),this.duration||(this.duration=i.DEFAULT_DURATION),this.tone?this.owner.newDTMF({originator:"remote",dtmf:this,request:e}):s("invalid INFO DTMF received, discarded")}},{"../Constants":7,"../Exceptions":11,"../RTCSession":17,debug:32}],19:[function(e,t,n){function r(e,t,n){this.session=e,this.id=t,this.expires=n||i.expires,this.active=!0,this.notify(100)}t.exports=r;var i={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300},s=e("debug")("JsSIP:RTCSession:ReferNotifier"),o=e("../Constants"),a=e("./Request");r.prototype.notify=function(e,t){s("notify()");var n,r=this;if(this.active!==!1){t=t||o.REASON_PHRASE[e]||"",n=e>=200?"terminated;reason=noresource":"active;expires="+this.expires;var l=new a(this.session,o.NOTIFY);l.send({extraHeaders:["Event: "+i.event_type+";id="+r.id,"Subscription-State: "+n,"Content-Type: "+i.body_type],body:"SIP/2.0 "+e+" "+t,eventHandlers:{onErrorResponse:function(){r.active=!1}}})}}},{"../Constants":7,"./Request":21,debug:32}],20:[function(e,t,n){function r(e){this.session=e,this.timer=null,a.EventEmitter.call(this)}function i(){console.log("removeSubscriber()"),clearTimeout(this.timer),this.session.referSubscriber=null}t.exports=r;var s={expires:120},o=e("util"),a=e("events"),l=e("debug")("JsSIP:RTCSession:ReferSubscriber"),u=e("../Constants"),c=e("../Grammar"),h=e("./Request");o.inherits(r,a.EventEmitter),r.prototype.sendRefer=function(e,t){l("sendRefer()");var n,r,o,a=null,c=this;t=t||{},n=t.extraHeaders?t.extraHeaders.slice():[],r=t.eventHandlers||{};for(var d in r)this.on(d,r[d]);t.replaces&&(a=t.replaces.request.call_id,a+=";to-tag="+t.replaces.to_tag,a+=";from-tag="+t.replaces.from_tag,a=encodeURIComponent(a)),o="Refer-To: <"+e+(a?"?Replaces="+a:"")+">",n.push(o);var f=new h(this.session,u.REFER);this.timer=setTimeout(function(){i.call(c)},1e3*s.expires),f.send({extraHeaders:n,eventHandlers:{onSuccessResponse:function(e){c.emit("requestSucceeded",{response:e})},onErrorResponse:function(e){c.emit("requestFailed",{response:e,cause:u.causes.REJECTED})},onTransportError:function(){i.call(c),c.emit("requestFailed",{response:null,cause:u.causes.CONNECTION_ERROR})},onRequestTimeout:function(){i.call(c),c.emit("requestFailed",{response:null,cause:u.causes.REQUEST_TIMEOUT})},onDialogError:function(){i.call(c),c.emit("requestFailed",{response:null,cause:u.causes.DIALOG_ERROR})}}})},r.prototype.receiveNotify=function(e){l("receiveNotify()");var t;if(e.body){if(t=c.parse(e.body,"Status_Line"),t===-1)return void l('receiveNotify() | error parsing NOTIFY body: "'+e.body+'"');switch(!0){case/^100$/.test(t.status_code):this.emit("trying",{request:e,satus_line:t});break;case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",{request:e,satus_line:t});break;case/^2[0-9]{2}$/.test(t.status_code):i.call(this),this.emit("accepted",{request:e,satus_line:t});break;default:i.call(this),this.emit("failed",{request:e,satus_line:t})}}}},{"../Constants":7,"../Grammar":12,"./Request":21,debug:32,events:1,util:5}],21:[function(e,t,n){function r(e,t){if(i("new | %s",t),this.session=e,this.method=t,this.session.status!==l.C.STATUS_1XX_RECEIVED&&this.session.status!==l.C.STATUS_WAITING_FOR_ANSWER&&this.session.status!==l.C.STATUS_WAITING_FOR_ACK&&this.session.status!==l.C.STATUS_CONFIRMED&&this.session.status!==l.C.STATUS_TERMINATED)throw new a.InvalidStateError(this.session.status);if(this.session.status===l.C.STATUS_TERMINATED&&t!==o.BYE)throw new a.InvalidStateError(this.session.status)}t.exports=r;var i=e("debug")("JsSIP:RTCSession:Request"),s=e("debug")("JsSIP:ERROR:RTCSession:Request");s.log=console.warn.bind(console);var o=e("../Constants"),a=e("../Exceptions"),l=e("../RTCSession");r.prototype.send=function(e){e=e||{};var t=e.extraHeaders&&e.extraHeaders.slice()||[],n=e.body||null;this.eventHandlers=e.eventHandlers||{},this.session.dialog.sendRequest(this,this.method,{extraHeaders:t,body:n})},r.prototype.receiveResponse=function(e){switch(!0){case/^1[0-9]{2}$/.test(e.status_code):i("onProgressResponse"),this.eventHandlers.onProgressResponse&&this.eventHandlers.onProgressResponse(e);break;case/^2[0-9]{2}$/.test(e.status_code):i("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(e);break;default:i("onErrorResponse"),this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(e)}},r.prototype.onRequestTimeout=function(){s("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},r.prototype.onTransportError=function(){s("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},r.prototype.onDialogError=function(){s("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()}},{"../Constants":7,"../Exceptions":11,"../RTCSession":17,debug:32}],22:[function(e,t,n){function r(e,t){var n=1;this.ua=e,this.transport=t,this.registrar=e.configuration.registrar_server,this.expires=e.configuration.register_expires,this.call_id=s.createRandomToken(22),this.cseq=0,this.to_uri=e.configuration.uri,this.registrationTimer=null,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",n&&(this.contact+=";reg-id="+n,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')}t.exports=r;var i=e("debug")("JsSIP:Registrator"),s=e("./Utils"),o=e("./Constants"),a=e("./SIPMessage"),l=e("./RequestSender");r.prototype={setExtraHeaders:function(e){Array.isArray(e)||(e=[]),this.extraHeaders=e.slice()},setExtraContactParams:function(e){e instanceof Object||(e={}),this.extraContactParams="";for(var t in e){var n=e[t];this.extraContactParams+=";"+t,n&&(this.extraContactParams+="="+n)}},register:function(){var e,t,n,r=this;n=this.extraHeaders.slice(),n.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),n.push("Expires: "+this.expires),this.request=new a.OutgoingRequest(o.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},n),e=new l(this,this.ua),this.receiveResponse=function(e){var n,a,l=e.getHeaders("contact").length;if(e.cseq===this.cseq)switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):if(e.hasHeader("expires")&&(a=e.getHeader("expires")),!l){i("no Contact header in response to REGISTER, response ignored");break}for(;l--;){if(n=e.parseHeader("contact",l),n.uri.user===this.ua.contact.uri.user){a=n.getParam("expires");break}n=null}if(!n){i("no Contact header pointing to us, response ignored");break}a||(a=this.expires),this.registrationTimer=setTimeout(function(){r.registrationTimer=null,r.register()},1e3*a-3e3),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=n.getParam("temp-gruu").replace(/"/g,"")),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=n.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.registered({response:e}));break;case/^423$/.test(e.status_code):e.hasHeader("min-expires")?(this.expires=e.getHeader("min-expires"),this.register()):(i("423 response received for REGISTER without Min-Expires"),this.registrationFailure(e,o.causes.SIP_FAILURE_CODE));break;default:t=s.sipErrorCause(e.status_code),this.registrationFailure(e,t)}},this.onRequestTimeout=function(){this.registrationFailure(null,o.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,o.causes.CONNECTION_ERROR)},e.send()},unregister:function(e){var t;if(!this.registered)return void i("already unregistered");e=e||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),t=this.extraHeaders.slice(),e.all?(t.push("Contact: *"+this.extraContactParams),t.push("Expires: 0"),this.request=new a.OutgoingRequest(o.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},t)):(t.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),t.push("Expires: 0"),this.request=new a.OutgoingRequest(o.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},t));var n=new l(this,this.ua);this.receiveResponse=function(e){var t;switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this.unregistered(e);break;default:t=s.sipErrorCause(e.status_code),this.unregistered(e,t)}},this.onRequestTimeout=function(){this.unregistered(null,o.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,o.causes.CONNECTION_ERROR)},n.send()},registrationFailure:function(e,t){this.ua.registrationFailed({response:e||null,cause:t}),this.registered&&(this.registered=!1,this.ua.unregistered({response:e||null,cause:t}))},unregistered:function(e,t){this.registered=!1,this.ua.unregistered({response:e||null,cause:t||null})},onTransportClosed:function(){null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.unregistered({}))},close:function(){this.registered&&this.unregister()}}},{"./Constants":7,"./RequestSender":23,"./SIPMessage":24,"./Utils":30,debug:32}],23:[function(e,t,n){function r(e,t){this.ua=t,this.applicant=e,this.method=e.request.method,this.request=e.request,this.credentials=null,this.challenged=!1,this.staled=!1,t.status!==o.C.STATUS_USER_CLOSED||this.method===s.BYE&&this.method===s.ACK||this.onTransportError()}t.exports=r;var i=e("debug")("JsSIP:RequestSender"),s=e("./Constants"),o=e("./UA"),a=e("./DigestAuthentication"),l=e("./Transactions");r.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new l.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new l.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new l.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(e){var t,n,r,o=e.status_code;if(401!==o&&407!==o||null===this.ua.configuration.password)this.applicant.receiveResponse(e);else{if(401===e.status_code?(n=e.parseHeader("www-authenticate"),r="authorization"):(n=e.parseHeader("proxy-authenticate"),r="proxy-authorization"),!n)return i(e.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(e);if(!this.challenged||!this.staled&&n.stale===!0){if(this.credentials||(this.credentials=new a(this.ua)),!this.credentials.authenticate(this.request,n))return void this.applicant.receiveResponse(e);this.challenged=!0,n.stale&&(this.staled=!0),e.method===s.REGISTER?t=this.applicant.cseq+=1:this.request.dialog?t=this.request.dialog.local_seqnum+=1:(t=this.request.cseq+1,this.request.cseq=t),this.request.setHeader("cseq",t+" "+this.method),this.request.setHeader(r,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(e)}}}},{"./Constants":7,"./DigestAuthentication":10,"./Transactions":26,"./UA":28,debug:32}],24:[function(e,t,n){function r(e,t,n,r,i,s){var o,a,l,d;return r=r||{},e&&t&&n?(this.ua=n,this.headers={},this.method=e,this.ruri=t,this.body=s,this.extraHeaders=i&&i.slice()||[],r.route_set?this.setHeader("route",r.route_set):n.configuration.use_preloaded_route&&this.setHeader("route",n.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",u.MAX_FORWARDS),o=r.to_display_name||0===r.to_display_name?'"'+r.to_display_name+'" ':"",o+="<"+(r.to_uri||t)+">",o+=r.to_tag?";tag="+r.to_tag:"",this.to=new h.parse(o),this.setHeader("to",o),a=r.from_display_name||0===r.from_display_name?'"'+r.from_display_name+'" ':n.configuration.display_name?'"'+n.configuration.display_name+'" ':"",a+="<"+(r.from_uri||n.configuration.uri)+">;tag=",a+=r.from_tag||c.newTag(),this.from=new h.parse(a),this.setHeader("from",a),l=r.call_id||n.configuration.jssip_id+c.createRandomToken(15),this.call_id=l,this.setHeader("call-id",l),d=r.cseq||Math.floor(1e4*Math.random()),this.cseq=d,void this.setHeader("cseq",d+" "+e)):null}function i(){this.data=null,this.headers=null,this.method=null,
this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}function s(e){this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function o(){this.headers={},this.status_code=null,this.reason_phrase=null}t.exports={OutgoingRequest:r,IncomingRequest:s,IncomingResponse:o};var a=e("debug")("JsSIP:SIPMessage"),l=e("sdp-transform"),u=e("./Constants"),c=e("./Utils"),h=e("./NameAddrHeader"),d=e("./Grammar");r.prototype={setHeader:function(e,t){var n,r;for(n=new RegExp("^\\s*"+e+"\\s*:","i"),r=0;r<this.extraHeaders.length;r++)n.test(this.extraHeaders[r])&&this.extraHeaders.splice(r,1);this.headers[c.headerize(e)]=Array.isArray(t)?t:[t]},getHeader:function(e){var t,n,r=this.extraHeaders.length,i=this.headers[c.headerize(e)];if(i){if(i[0])return i[0]}else for(t=new RegExp("^\\s*"+e+"\\s*:","i"),n=0;n<r;n++)if(i=this.extraHeaders[n],t.test(i))return i.substring(i.indexOf(":")+1).trim()},getHeaders:function(e){var t,n,r,i=this.headers[c.headerize(e)],s=[];if(i){for(n=i.length,t=0;t<n;t++)s.push(i[t]);return s}for(n=this.extraHeaders.length,r=new RegExp("^\\s*"+e+"\\s*:","i"),t=0;t<n;t++)i=this.extraHeaders[t],r.test(i)&&s.push(i.substring(i.indexOf(":")+1).trim());return s},hasHeader:function(e){var t,n,r=this.extraHeaders.length;if(this.headers[c.headerize(e)])return!0;for(t=new RegExp("^\\s*"+e+"\\s*:","i"),n=0;n<r;n++)if(t.test(this.extraHeaders[n]))return!0;return!1},parseSDP:function(e){return!e&&this.sdp?this.sdp:(this.sdp=l.parse(this.body||""),this.sdp)},toString:function(){var e,t,n,r="",i=[];r+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(e in this.headers)for(t=this.headers[e].length,n=0;n<t;n++)r+=e+": "+this.headers[e][n]+"\r\n";for(t=this.extraHeaders.length,n=0;n<t;n++)r+=this.extraHeaders[n].trim()+"\r\n";switch(this.method){case u.REGISTER:i.push("path","gruu");break;case u.INVITE:this.ua.configuration.session_timers&&i.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&i.push("gruu"),i.push("ice","replaces");break;case u.UPDATE:this.ua.configuration.session_timers&&i.push("timer"),i.push("ice")}return i.push("outbound"),r+="Allow: "+u.ALLOWED_METHODS+"\r\n",r+="Supported: "+i+"\r\n",r+="User-Agent: "+u.USER_AGENT+"\r\n",this.body?(t=c.str_utf8_length(this.body),r+="Content-Length: "+t+"\r\n\r\n",r+=this.body):r+="Content-Length: 0\r\n\r\n",r}},i.prototype={addHeader:function(e,t){var n={raw:t};e=c.headerize(e),this.headers[e]?this.headers[e].push(n):this.headers[e]=[n]},getHeader:function(e){var t=this.headers[c.headerize(e)];if(t)return t[0]?t[0].raw:void 0},getHeaders:function(e){var t,n,r=this.headers[c.headerize(e)],i=[];if(!r)return[];for(n=r.length,t=0;t<n;t++)i.push(r[t].raw);return i},hasHeader:function(e){return!!this.headers[c.headerize(e)]},parseHeader:function(e,t){var n,r,i;return e=c.headerize(e),t=t||0,this.headers[e]?t>=this.headers[e].length?void a('not so many "'+e+'" headers present'):(n=this.headers[e][t],r=n.raw,n.parsed?n.parsed:(i=d.parse(r,e.replace(/-/g,"_")),i===-1?(this.headers[e].splice(t,1),void a('error parsing "'+e+'" header field with value "'+r+'"')):(n.parsed=i,i))):void a('header "'+e+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(e,t){var n={raw:t};this.headers[c.headerize(e)]=[n]},parseSDP:function(e){return!e&&this.sdp?this.sdp:(this.sdp=l.parse(this.body||""),this.sdp)},toString:function(){return this.data}},s.prototype=new i,s.prototype.reply=function(e,t,n,r,i,s){var o,a,l,h,d,f=[],p=this.getHeader("To"),g=0,m=0;if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);if(t=t||u.REASON_PHRASE[e]||"",n=n&&n.slice()||[],d="SIP/2.0 "+e+" "+t+"\r\n",this.method===u.INVITE&&e>100&&e<=200)for(o=this.getHeaders("record-route"),l=o.length,g;g<l;g++)d+="Record-Route: "+o[g]+"\r\n";for(a=this.getHeaders("via"),l=a.length,m;m<l;m++)d+="Via: "+a[m]+"\r\n";for(!this.to_tag&&e>100?p+=";tag="+c.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),d+="To: "+p+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",l=n.length,h=0;h<l;h++)d+=n[h].trim()+"\r\n";switch(this.method){case u.INVITE:this.ua.configuration.session_timers&&f.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&f.push("gruu"),f.push("ice","replaces");break;case u.UPDATE:this.ua.configuration.session_timers&&f.push("timer"),r&&f.push("ice"),f.push("replaces")}f.push("outbound"),this.method===u.OPTIONS?(d+="Allow: "+u.ALLOWED_METHODS+"\r\n",d+="Accept: "+u.ACCEPTED_BODY_TYPES+"\r\n"):405===e?d+="Allow: "+u.ALLOWED_METHODS+"\r\n":415===e&&(d+="Accept: "+u.ACCEPTED_BODY_TYPES+"\r\n"),d+="Supported: "+f+"\r\n",r?(l=c.str_utf8_length(r),d+="Content-Type: application/sdp\r\n",d+="Content-Length: "+l+"\r\n\r\n",d+=r):d+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(e,d,i,s)},s.prototype.reply_sl=function(e,t){var n,r,i=0,s=this.getHeaders("via"),o=s.length;if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);for(t=t||u.REASON_PHRASE[e]||"",r="SIP/2.0 "+e+" "+t+"\r\n",i;i<o;i++)r+="Via: "+s[i]+"\r\n";n=this.getHeader("To"),!this.to_tag&&e>100?n+=";tag="+c.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(n+=";tag="+this.to_tag),r+="To: "+n+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.call_id+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r)},o.prototype=new i},{"./Constants":7,"./Grammar":12,"./NameAddrHeader":15,"./Utils":30,debug:32,"sdp-transform":43}],25:[function(e,t,n){var r=500,i=4e3,s=5e3,o={T1:r,T2:i,T4:s,TIMER_B:64*r,TIMER_D:0*r,TIMER_F:64*r,TIMER_H:64*r,TIMER_I:0*r,TIMER_J:0*r,TIMER_K:0*s,TIMER_L:64*r,TIMER_M:64*r,PROVISIONAL_RESPONSE_INTERVAL:6e4};t.exports=o},{}],26:[function(e,t,n){function r(e,t,n){var r,i;this.type=u.NON_INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,i=e.ua.configuration.hack_via_tcp?"TCP":e.ua.configuration.hack_via_ws?"WS":n.server.scheme,r="SIP/2.0/"+i,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),h.EventEmitter.call(this)}function i(e,t,n){var r,i,s=this;this.type=u.INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,i=e.ua.configuration.hack_via_tcp?"TCP":e.ua.configuration.hack_via_ws?"WS":n.server.scheme,r="SIP/2.0/"+i,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e){s.cancel_request(s,e)},h.EventEmitter.call(this)}function s(e,t,n){var r,i;this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,i=e.ua.configuration.hack_via_tcp?"TCP":e.ua.configuration.hack_via_ws?"WS":n.server.scheme,r="SIP/2.0/"+i,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),h.EventEmitter.call(this)}function o(e,t){this.type=u.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.state=u.STATUS_TRYING,t.newTransaction(this),h.EventEmitter.call(this)}function a(e,t){this.type=u.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.state=u.STATUS_PROCEEDING,t.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100),h.EventEmitter.call(this)}function l(e,t){var n;switch(t.method){case _.INVITE:if(n=e.transactions.ist[t.via_branch]){switch(n.state){case u.STATUS_PROCEEDING:n.transport.send(n.last_response);break;case u.STATUS_ACCEPTED:}return!0}break;case _.ACK:if(n=e.transactions.ist[t.via_branch],!n)return!1;if(n.state===u.STATUS_ACCEPTED)return!1;if(n.state===u.STATUS_COMPLETED)return n.state=u.STATUS_CONFIRMED,n.I=setTimeout(function(){n.timer_I()},v.TIMER_I),!0;break;case _.CANCEL:return n=e.transactions.ist[t.via_branch],n?(t.reply_sl(200),n.state!==u.STATUS_PROCEEDING):(t.reply_sl(481),!0);default:if(n=e.transactions.nist[t.via_branch]){switch(n.state){case u.STATUS_TRYING:break;case u.STATUS_PROCEEDING:case u.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}}t.exports={C:null,NonInviteClientTransaction:r,InviteClientTransaction:i,AckClientTransaction:s,NonInviteServerTransaction:o,InviteServerTransaction:a,checkTransaction:l};var u={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};t.exports.C=u;var c=e("util"),h=e("events"),d=e("debug")("JsSIP:NonInviteClientTransaction"),f=e("debug")("JsSIP:InviteClientTransaction"),p=e("debug")("JsSIP:AckClientTransaction"),g=e("debug")("JsSIP:NonInviteServerTransaction"),m=e("debug")("JsSIP:InviteServerTransaction"),_=e("./Constants"),v=e("./Timers");c.inherits(r,h.EventEmitter),r.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){var e=this;this.stateChanged(u.STATUS_TRYING),this.F=setTimeout(function(){e.timer_F()},v.TIMER_F),this.transport.send(this.request)||this.onTransportError()},r.prototype.onTransportError=function(){d("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},r.prototype.timer_F=function(){d("Timer F expired for transaction "+this.id),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},r.prototype.timer_K=function(){this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.receiveResponse=function(e){var t=this,n=e.status_code;if(n<200)switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_PROCEEDING),this.request_sender.receiveResponse(e)}else switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),clearTimeout(this.F),408===n?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(e),this.K=setTimeout(function(){t.timer_K()},v.TIMER_K);break;case u.STATUS_COMPLETED:}},c.inherits(i,h.EventEmitter),i.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){var e=this;this.stateChanged(u.STATUS_CALLING),this.B=setTimeout(function(){e.timer_B()},v.TIMER_B),this.transport.send(this.request)||this.onTransportError()},i.prototype.onTransportError=function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==u.STATUS_ACCEPTED&&(f("transport error occurred, deleting transaction "+this.id),this.request_sender.onTransportError()),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.timer_M=function(){f("Timer M expired for transaction "+this.id),this.state===u.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},i.prototype.timer_B=function(){f("Timer B expired for transaction "+this.id),this.state===u.STATUS_CALLING&&(this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},i.prototype.timer_D=function(){f("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.sendACK=function(e){var t=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+e.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){t.timer_D()},v.TIMER_D),this.transport.send(this.ack)},i.prototype.cancel_request=function(e,t){var n=e.request;this.cancel=_.CANCEL+" "+n.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+n.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+n.headers.Route.toString()+"\r\n"),this.cancel+="To: "+n.headers.To.toString()+"\r\n",this.cancel+="From: "+n.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+n.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+n.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",t&&(this.cancel+="Reason: "+t+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===u.STATUS_PROCEEDING&&this.transport.send(this.cancel)},i.prototype.receiveResponse=function(e){var t=this,n=e.status_code;if(n>=100&&n<=199)switch(this.state){case u.STATUS_CALLING:this.stateChanged(u.STATUS_PROCEEDING),this.request_sender.receiveResponse(e);break;case u.STATUS_PROCEEDING:this.request_sender.receiveResponse(e)}else if(n>=200&&n<=299)switch(this.state){case u.STATUS_CALLING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_ACCEPTED),this.M=setTimeout(function(){t.timer_M()},v.TIMER_M),this.request_sender.receiveResponse(e);break;case u.STATUS_ACCEPTED:this.request_sender.receiveResponse(e)}else if(n>=300&&n<=699)switch(this.state){case u.STATUS_CALLING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),this.sendACK(e),this.request_sender.receiveResponse(e);break;case u.STATUS_COMPLETED:this.sendACK(e)}},c.inherits(s,h.EventEmitter),s.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},s.prototype.onTransportError=function(){p("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},c.inherits(o,h.EventEmitter),o.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},o.prototype.timer_J=function(){g("Timer J expired for transaction "+this.id),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,g("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.receiveResponse=function(e,t,n,r){var i=this;if(100===e)switch(this.state){case u.STATUS_TRYING:this.stateChanged(u.STATUS_PROCEEDING),this.transport.send(t)||this.onTransportError();break;case u.STATUS_PROCEEDING:this.last_response=t,this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(e>=200&&e<=699)switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),this.last_response=t,this.J=setTimeout(function(){i.timer_J()},v.TIMER_J),this.transport.send(t)?n&&n():(this.onTransportError(),r&&r());break;case u.STATUS_COMPLETED:}},c.inherits(a,h.EventEmitter),a.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){m("Timer H expired for transaction "+this.id),this.state===u.STATUS_COMPLETED&&m("ACK not received, dialog will be terminated"),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(u.STATUS_TERMINATED)},a.prototype.timer_L=function(){m("Timer L expired for transaction "+this.id),this.state===u.STATUS_ACCEPTED&&(this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,m("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},a.prototype.receiveResponse=function(e,t,n,r){var i=this;if(e>=100&&e<=199)switch(this.state){case u.STATUS_PROCEEDING:this.transport.send(t)||this.onTransportError(),this.last_response=t}if(e>100&&e<=199&&this.state===u.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){i.resend_provisional()},v.PROVISIONAL_RESPONSE_INTERVAL));else if(e>=200&&e<=299)switch(this.state){case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_ACCEPTED),this.last_response=t,this.L=setTimeout(function(){i.timer_L()},v.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case u.STATUS_ACCEPTED:this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(e>=300&&e<=699)switch(this.state){case u.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(t)?(this.stateChanged(u.STATUS_COMPLETED),this.H=setTimeout(function(){i.timer_H()},v.TIMER_H),n&&n()):(this.onTransportError(),r&&r())}}},{"./Constants":7,"./Timers":25,debug:32,events:1,util:5}],27:[function(e,t,n){function r(e,t){this.ua=e,this.ws=null,this.server=t,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.node_websocket_options=this.ua.configuration.node_websocket_options||{},this.node_websocket_options.headers=this.node_websocket_options.headers||{},this.node_websocket_options.headers["User-Agent"]=a.USER_AGENT}t.exports=r;var i={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};r.C=i;var s=e("debug")("JsSIP:Transport"),o=e("debug")("JsSIP:ERROR:Transport");o.log=console.warn.bind(console);var a=e("./Constants"),l=e("./Parser"),u=e("./UA"),c=e("./SIPMessage"),h=e("./sanityCheck"),d=e("websocket").w3cwebsocket;r.prototype={connect:function(){var e=this;if(this.ws&&(this.ws.readyState===this.ws.OPEN||this.ws.readyState===this.ws.CONNECTING))return s("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),s("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{d.length>3?this.ws=new d(this.server.ws_uri,"sip",this.node_websocket_options.origin,this.node_websocket_options.headers,this.node_websocket_options.requestOptions,this.node_websocket_options.clientConfig):this.ws=new d(this.server.ws_uri,"sip"),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(t){e.onClose(t)},this.ws.onmessage=function(t){e.onMessage(t)},this.ws.onerror=function(t){e.onError(t)}}catch(t){o("error connecting to WebSocket "+this.server.ws_uri+": "+t),this.lastTransportError.code=null,this.lastTransportError.reason=t.message,this.ua.onTransportError(this)}},disconnect:function(){this.ws&&(clearTimeout(this.reconnectTimer),this.closed=!0,s("closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.onTransportDisconnected({transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},send:function(e){var t=e.toString();return this.ws&&this.ws.readyState===this.ws.OPEN?(s("sending WebSocket message:\n%s\n",t),this.ws.send(t),!0):(o("unable to send message, WebSocket is not open"),!1)},onOpen:function(){this.connected=!0,s("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(e){var t=this.connected;this.connected=!1,this.lastTransportError.code=e.code,this.lastTransportError.reason=e.reason,s("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),e.wasClean===!1&&o("WebSocket abrupt disconnection"),t===!0?(this.ua.onTransportClosed(this),this.closed||this.reConnect()):this.ua.onTransportError(this)},onMessage:function(e){var t,n,r=e.data;if("\r\n"===r)return void s("received WebSocket message with CRLF Keep Alive response");if("string"!=typeof r){try{r=String.fromCharCode.apply(null,new Uint8Array(r))}catch(i){return void o("received WebSocket binary message failed to be converted into string, message discarded")}s("received WebSocket binary message:\n%s\n",r)}else s("received WebSocket text message:\n%s\n",r);if(t=l.parseMessage(r,this.ua),t&&!(this.ua.status===u.C.STATUS_USER_CLOSED&&t instanceof c.IncomingRequest)&&h(t,this.ua,this))if(t instanceof c.IncomingRequest)t.transport=this,this.ua.receiveRequest(t);else if(t instanceof c.IncomingResponse)switch(t.method){case a.INVITE:n=this.ua.transactions.ict[t.via_branch],n&&n.receiveResponse(t);break;case a.ACK:break;default:n=this.ua.transactions.nict[t.via_branch],n&&n.receiveResponse(t)}},onError:function(e){o("WebSocket connection error: %o",e)},reConnect:function(){var e=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(o("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(s("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=setTimeout(function(){e.connect(),e.reconnectTimer=null},1e3*this.ua.configuration.ws_server_reconnection_timeout))}}},{"./Constants":7,"./Parser":16,"./SIPMessage":24,"./UA":28,"./sanityCheck":31,debug:32,websocket:46}],28:[function(e,t,n){function r(e){if(this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=i.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],n=0;for(e in t)n+=Object.keys(this.transactions[t[e]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===e)throw new TypeError("Not enough arguments");try{this.loadConfig(e)}catch(t){throw this.status=i.STATUS_NOT_READY,this.error=i.CONFIGURATION_ERROR,t}this._registrator=new h(this),o.EventEmitter.call(this),u.called||u()}t.exports=r;var i={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};r.C=i;var s=e("util"),o=e("events"),a=e("debug")("JsSIP:UA"),l=e("debug")("JsSIP:ERROR:UA");l.log=console.warn.bind(console);var u=e("rtcninja"),c=e("./Constants"),h=e("./Registrator"),d=e("./RTCSession"),f=e("./Message"),p=e("./Transport"),g=e("./Transactions"),g=e("./Transactions"),m=e("./Utils"),_=e("./Exceptions"),v=e("./URI"),y=e("./Grammar");s.inherits(r,o.EventEmitter),r.prototype.start=function(){function e(){a("restarting UA"),n.status=i.STATUS_READY,n.transport.connect()}a("start()");var t,n=this;this.status===i.STATUS_INIT?(t=this.getNextWsServer(),this.transport=new p(this,t),this.transport.connect()):this.status===i.STATUS_USER_CLOSED?this.isConnected()?this.once("disconnected",e):e():a(this.status===i.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this.dynConfiguration.register=this.configuration.register},r.prototype.register=function(){a("register()"),this.dynConfiguration.register=!0,this._registrator.register()},r.prototype.unregister=function(e){a("unregister()"),this.dynConfiguration.register=!1,this._registrator.unregister(e)},r.prototype.registrator=function(){return this._registrator},r.prototype.isRegistered=function(){return!!this._registrator.registered},r.prototype.isConnected=function(){return!!this.transport&&this.transport.connected},r.prototype.call=function(e,t){a("call()");var n;return n=new d(this),n.connect(e,t),n},r.prototype.sendMessage=function(e,t,n){a("sendMessage()");var r;return r=new f(this),r.send(e,t,n),r},r.prototype.terminateSessions=function(e){a("terminateSessions()");for(var t in this.sessions)this.sessions[t].isEnded()||this.sessions[t].terminate(e)},r.prototype.stop=function(){a("stop()");var e,t,n,r=this;if(this.dynConfiguration={},this.status===i.STATUS_USER_CLOSED)return void a("UA already closed");clearTimeout(this.transportRecoveryTimer),this._registrator.close(),n=Object.keys(this.sessions).length;for(e in this.sessions){a("closing session "+e);try{this.sessions[e].terminate()}catch(s){}}for(t in this.applicants)try{this.applicants[t].close()}catch(s){}this.status=i.STATUS_USER_CLOSED,setTimeout(function(){r.transport.disconnect()},2e3)},r.prototype.normalizeTarget=function(e){return m.normalizeTarget(e,this.configuration.hostport_params)},r.prototype.set=function(e,t){switch(e){case"password":this.configuration.password=String(t);break;default:return l('set() | cannot set "%s" parameter in runtime',e),!1}return!0},r.prototype.onTransportClosed=function(e){var t,n,r,i=["nict","ict","nist","ist"];for(e.server.status=p.C.STATUS_DISCONNECTED,r=i.length,t=0;t<r;t++)for(n in this.transactions[i[t]])this.transactions[i[t]][n].onTransportError();this.emit("disconnected",{transport:e,code:e.lastTransportError.code,reason:e.lastTransportError.reason})},r.prototype.onTransportError=function(e){var t;a("transport "+e.server.ws_uri+" failed | connection state set to "+p.C.STATUS_ERROR),e.server.status=p.C.STATUS_ERROR,this.emit("disconnected",{transport:e,code:e.lastTransportError.code,reason:e.lastTransportError.reason}),this.status!==i.STATUS_USER_CLOSED&&(t=this.getNextWsServer(),t?(this.transport=new p(this,t),this.transport.connect()):(this.closeSessionsOnTransportError(),this.error&&this.error===i.NETWORK_ERROR||(this.status=i.STATUS_NOT_READY,this.error=i.NETWORK_ERROR),this.recoverTransport()))},r.prototype.onTransportConnected=function(e){this.transport=e,this.transportRecoverAttempts=0,e.server.status=p.C.STATUS_READY,this.status!==i.STATUS_USER_CLOSED&&(this.status=i.STATUS_READY,this.error=null,this.dynConfiguration.register&&this._registrator.register(),this.emit("connected",{transport:e}))},r.prototype.onTransportConnecting=function(e,t){this.emit("connecting",{transport:e,attempts:t})},r.prototype.onTransportDisconnected=function(e){this.emit("disconnected",e)},r.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},r.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},r.prototype.newMessage=function(e){this.emit("newMessage",e)},r.prototype.newRTCSession=function(e){this.emit("newRTCSession",e)},r.prototype.registered=function(e){this.emit("registered",e)},r.prototype.unregistered=function(e){this.emit("unregistered",e)},r.prototype.registrationFailed=function(e){this.emit("registrationFailed",e)},r.prototype.receiveRequest=function(e){var t,n,r,i,s=e.method;if(e.ruri.user!==this.configuration.uri.user&&e.ruri.user!==this.contact.uri.user)return a("Request-URI does not point to us"),void(e.method!==c.ACK&&e.reply_sl(404));if(e.ruri.scheme===c.SIPS)return void e.reply_sl(416);if(!g.checkTransaction(this,e)){if(s===c.INVITE?new g.InviteServerTransaction(e,this):s!==c.ACK&&s!==c.CANCEL&&new g.NonInviteServerTransaction(e,this),s===c.OPTIONS)e.reply(200);else if(s===c.MESSAGE){if(0===this.listeners("newMessage").length)return void e.reply(405);r=new f(this),r.init_incoming(e)}else if(s===c.INVITE&&!e.to_tag&&0===this.listeners("newRTCSession").length)return void e.reply(405);if(e.to_tag)t=this.findDialog(e.call_id,e.from_tag,e.to_tag),t?t.receiveRequest(e):s===c.NOTIFY?(n=this.findSession(e),n?n.receiveRequest(e):(a("received NOTIFY request for a non existent subscription"),e.reply(481,"Subscription does not exist"))):s!==c.ACK&&e.reply(481);else switch(s){case c.INVITE:u.hasWebRTC()?e.hasHeader("replaces")?(i=e.replaces,t=this.findDialog(i.call_id,i.from_tag,i.to_tag),t?(n=t.owner,n.isEnded()?e.reply(603):n.receiveRequest(e)):e.reply(481)):(n=new d(this),n.init_incoming(e)):(a("INVITE received but WebRTC is not supported"),e.reply(488));break;case c.BYE:e.reply(481);break;case c.CANCEL:n=this.findSession(e),n?n.receiveRequest(e):a("received CANCEL request for a non existent session");break;case c.ACK:break;default:e.reply(405)}}},r.prototype.findSession=function(e){var t=e.call_id+e.from_tag,n=this.sessions[t],r=e.call_id+e.to_tag,i=this.sessions[r];return n?n:i?i:null},r.prototype.findDialog=function(e,t,n){var r=e+t+n,i=this.dialogs[r];return i?i:(r=e+n+t,i=this.dialogs[r],i?i:null)},r.prototype.getNextWsServer=function(){var e,t,n,r=[];for(t=this.configuration.ws_servers.length,e=0;e<t;e++)n=this.configuration.ws_servers[e],n.status!==p.C.STATUS_ERROR&&(0===r.length?r.push(n):n.weight>r[0].weight?r=[n]:n.weight===r[0].weight&&r.push(n));return e=Math.floor(Math.random()*r.length),r[e]},r.prototype.closeSessionsOnTransportError=function(){var e;for(e in this.sessions)this.sessions[e].onTransportError();this._registrator.onTransportClosed()},r.prototype.recoverTransport=function(e){var t,n,r,i,s,o;for(e=e||this,s=e.transportRecoverAttempts,n=e.configuration.ws_servers.length,t=0;t<n;t++)e.configuration.ws_servers[t].status=0;o=e.getNextWsServer(),r=Math.floor(Math.random()*Math.pow(2,s)+1),i=r*e.configuration.connection_recovery_min_interval,i>e.configuration.connection_recovery_max_interval&&(a("time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),i=e.configuration.connection_recovery_min_interval,s=0),a("next connection attempt in "+i+" seconds"),this.transportRecoveryTimer=setTimeout(function(){e.transportRecoverAttempts=s+1,e.transport=new p(e,o),e.transport.connect()},1e3*i)},r.prototype.loadConfig=function(e){var t,n,i,s,o,l={via_host:m.createRandomToken(12)+".invalid",password:null,register_expires:600,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,session_timers:!0,hack_via_tcp:!1,hack_via_ws:!1,hack_ip_in_contact:!1,node_websocket_options:{}};for(t in r.configuration_check.mandatory){if(!e.hasOwnProperty(t))throw new _.ConfigurationError(t);if(n=e[t],i=r.configuration_check.mandatory[t].call(this,n),void 0===i)throw new _.ConfigurationError(t,n);l[t]=i}for(t in r.configuration_check.optional)if(e.hasOwnProperty(t)){if(n=e[t],m.isEmpty(n))continue;if(i=r.configuration_check.optional[t].call(this,n),void 0===i)throw new _.ConfigurationError(t,n);l[t]=i}if(l.connection_recovery_max_interval<l.connection_recovery_min_interval)throw new _.ConfigurationError("connection_recovery_max_interval",l.connection_recovery_max_interval);0===l.display_name&&(l.display_name="0"),l.instance_id||(l.instance_id=m.newUUID()),l.jssip_id=m.createRandomToken(5),s=l.uri.clone(),s.user=null,l.hostport_params=s.toString().replace(/^sip:/i,""),l.authorization_user||(l.authorization_user=l.uri.user),
l.registrar_server||(o=l.uri.clone(),o.user=null,o.clearParams(),o.clearHeaders(),l.registrar_server=o),l.no_answer_timeout=1e3*l.no_answer_timeout,l.hack_ip_in_contact&&(l.via_host=m.getRandomTestNetIP()),this.contact={pub_gruu:null,temp_gruu:null,uri:new v("sip",m.createRandomToken(8),l.via_host,null,{transport:"ws"}),toString:function(e){e=e||{};var t=e.anonymous||null,n=e.outbound||null,r="<";return r+=t?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!n||(t?this.temp_gruu:this.pub_gruu)||(r+=";ob"),r+=">"}};for(t in l)r.configuration_skeleton[t].value=l[t];Object.defineProperties(this.configuration,r.configuration_skeleton);for(t in l)r.configuration_skeleton[t].value="";a("configuration parameters after validation:");for(t in l)switch(t){case"uri":case"registrar_server":a("- "+t+": "+l[t]);break;case"password":a("- "+t+": NOT SHOWN");break;default:a("- "+t+": "+JSON.stringify(l[t]))}},r.configuration_skeleton=function(){var e,t,n,r={},i=["jssip_id","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_via_ws","hack_ip_in_contact","instance_id","no_answer_timeout","session_timers","node_websocket_options","password","register_expires","registrar_server","use_preloaded_route","via_core_value","via_host"];for(e in i)t=i[e],n=["password"].indexOf(t)!==-1,r[t]={value:"",writable:n,configurable:!1};return r.register={value:"",writable:!0,configurable:!1},r}(),r.configuration_check={mandatory:{uri:function(e){var t;return/^sip:/i.test(e)||(e=c.SIP+":"+e),t=v.parse(e),t&&t.user?t:void 0},ws_servers:function(e){var t,n,r;if("string"==typeof e)e=[{ws_uri:e}];else{if(!Array.isArray(e))return;for(n=e.length,t=0;t<n;t++)"string"==typeof e[t]&&(e[t]={ws_uri:e[t]})}if(0===e.length)return!1;for(n=e.length,t=0;t<n;t++){if(!e[t].ws_uri)return void a('ERROR: missing "ws_uri" attribute in ws_servers parameter');if(e[t].weight&&!Number(e[t].weight))return void a('ERROR: "weight" attribute in ws_servers parameter must be a Number');if(r=y.parse(e[t].ws_uri,"absoluteURI"),r===-1)return void a('ERROR: invalid "ws_uri" attribute in ws_servers parameter: '+e[t].ws_uri);if("wss"!==r.scheme&&"ws"!==r.scheme)return void a("ERROR: invalid URI scheme in ws_servers parameter: "+r.scheme);e[t].sip_uri="<sip:"+r.host+(r.port?":"+r.port:"")+";transport=ws;lr>",e[t].weight||(e[t].weight=0),e[t].status=0,e[t].scheme=r.scheme.toUpperCase()}return e}},optional:{authorization_user:function(e){return y.parse('"'+e+'"',"quoted_string")===-1?void 0:e},connection_recovery_max_interval:function(e){var t;if(m.isDecimal(e)&&(t=Number(e),t>0))return t},connection_recovery_min_interval:function(e){var t;if(m.isDecimal(e)&&(t=Number(e),t>0))return t},display_name:function(e){return y.parse('"'+e+'"',"display_name")===-1?void 0:e},hack_via_tcp:function(e){if("boolean"==typeof e)return e},hack_via_ws:function(e){if("boolean"==typeof e)return e},hack_ip_in_contact:function(e){if("boolean"==typeof e)return e},instance_id:function(e){return/^uuid:/i.test(e)&&(e=e.substr(5)),y.parse(e,"uuid")===-1?void 0:e},no_answer_timeout:function(e){var t;if(m.isDecimal(e)&&(t=Number(e),t>0))return t},session_timers:function(e){if("boolean"==typeof e)return e},node_websocket_options:function(e){return"object"==typeof e?e:{}},password:function(e){return String(e)},register:function(e){if("boolean"==typeof e)return e},register_expires:function(e){var t;if(m.isDecimal(e)&&(t=Number(e),t>0))return t},registrar_server:function(e){var t;return/^sip:/i.test(e)||(e=c.SIP+":"+e),t=v.parse(e),t?t.user?void 0:t:void 0},use_preloaded_route:function(e){if("boolean"==typeof e)return e}}}},{"./Constants":7,"./Exceptions":11,"./Grammar":12,"./Message":14,"./RTCSession":17,"./Registrator":22,"./Transactions":26,"./Transport":27,"./URI":29,"./Utils":30,debug:32,events:1,rtcninja:37,util:5}],29:[function(e,t,n){function r(e,t,n,r,s,o){var a,l;if(!n)throw new TypeError('missing or invalid "host" parameter');e=e||i.SIP,this.parameters={},this.headers={};for(a in s)this.setParam(a,s[a]);for(l in o)this.setHeader(l,o[l]);Object.defineProperties(this,{scheme:{get:function(){return e},set:function(t){e=t.toLowerCase()}},user:{get:function(){return t},set:function(e){t=e}},host:{get:function(){return n},set:function(e){n=e.toLowerCase()}},port:{get:function(){return r},set:function(e){r=0===e?e:parseInt(e,10)||null}}})}t.exports=r;var i=e("./Constants"),s=e("./Utils"),o=e("./Grammar");r.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]="undefined"==typeof t||null===t?null:t.toString().toLowerCase())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(e,t){this.headers[s.headerize(e)]=Array.isArray(t)?t:[t]},getHeader:function(e){if(e)return this.headers[s.headerize(e)]},hasHeader:function(e){if(e)return this.headers.hasOwnProperty(s.headerize(e))&&!0||!1},deleteHeader:function(e){var t;if(e=s.headerize(e),this.headers.hasOwnProperty(e))return t=this.headers[e],delete this.headers[e],t},clearHeaders:function(){this.headers={}},clone:function(){return new r(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var e,t,n,r,i=[];r=this.scheme+":",this.user&&(r+=s.escapeUser(this.user)+"@"),r+=this.host,(this.port||0===this.port)&&(r+=":"+this.port);for(t in this.parameters)r+=";"+t,null!==this.parameters[t]&&(r+="="+this.parameters[t]);for(e in this.headers)for(n=0;n<this.headers[e].length;n++)i.push(e+"="+this.headers[e][n]);return i.length>0&&(r+="?"+i.join("&")),r},toAor:function(e){var t;return t=this.scheme+":",this.user&&(t+=s.escapeUser(this.user)+"@"),t+=this.host,e&&(this.port||0===this.port)&&(t+=":"+this.port),t}},r.parse=function(e){return e=o.parse(e,"SIP_URI"),e!==-1?e:void 0}},{"./Constants":7,"./Grammar":12,"./Utils":30}],30:[function(e,t,n){var r={};t.exports=r;var i=e("./Constants"),s=e("./URI"),o=e("./Grammar");r.str_utf8_length=function(e){return unescape(encodeURIComponent(e)).length},r.isFunction=function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},r.isDecimal=function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},r.isEmpty=function(e){if(null===e||""===e||void 0===e||Array.isArray(e)&&0===e.length||"number"==typeof e&&isNaN(e))return!0},r.createRandomToken=function(e,t){var n,r,i="";for(t=t||32,n=0;n<e;n++)r=Math.random()*t|0,i+=r.toString(t);return i},r.newTag=function(){return r.createRandomToken(10)},r.newUUID=function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return e},r.hostType=function(e){if(e)return e=o.parse(e,"host"),e!==-1?e.host_type:void 0},r.normalizeTarget=function(e,t){var n,o,a,l;if(e){if(e instanceof s)return e;if("string"==typeof e){switch(o=e.split("@"),o.length){case 1:if(!t)return;a=e,l=t;break;case 2:a=o[0],l=o[1];break;default:a=o.slice(0,o.length-1).join("@"),l=o[o.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,"")),e=i.SIP+":"+r.escapeUser(a)+"@"+l,(n=s.parse(e))?n:void 0}}else;},r.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},r.headerize=function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i="",s=r.length;for(t=0;t<s;t++)0!==t&&(i+="-"),i+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return n[i]&&(i=n[i]),i},r.sipErrorCause=function(e){var t;for(t in i.SIP_ERROR_CAUSES)if(i.SIP_ERROR_CAUSES[t].indexOf(e)!==-1)return i.causes[t];return i.causes.SIP_FAILURE_CODE},r.getRandomTestNetIP=function(){function e(e,t){return Math.floor(Math.random()*(t-e+1)+e)}return"192.0.2."+e(1,254)},r.calculateMD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,s,o;return i=2147483648&e,s=2147483648&t,n=1073741824&e,r=1073741824&t,o=(1073741823&e)+(1073741823&t),n&r?2147483648^o^i^s:n|r?1073741824&o?3221225472^o^i^s:1073741824^o^i^s:o^i^s}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function s(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function a(e,i,s,o,a,l,u){return e=n(e,n(n(r(i,s,o),a),u)),n(t(e,l),i)}function l(e,r,s,o,a,l,u){return e=n(e,n(n(i(r,s,o),a),u)),n(t(e,l),r)}function u(e,r,i,o,a,l,u){return e=n(e,n(n(s(r,i,o),a),u)),n(t(e,l),r)}function c(e,r,i,s,a,l,u){return e=n(e,n(n(o(r,i,s),a),u)),n(t(e,l),r)}function h(e){for(var t,n=e.length,r=n+8,i=(r-r%64)/64,s=16*(i+1),o=new Array(s-1),a=0,l=0;l<n;)t=(l-l%4)/4,a=l%4*8,o[t]=o[t]|e.charCodeAt(l)<<a,l++;return t=(l-l%4)/4,a=l%4*8,o[t]=o[t]|128<<a,o[s-2]=n<<3,o[s-1]=n>>>29,o}function d(e){var t,n,r="",i="";for(n=0;n<=3;n++)t=e>>>8*n&255,i="0"+t.toString(16),r+=i.substr(i.length-2,2);return r}function f(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var p,g,m,_,v,y,b,T,S,w=[],E=7,C=12,A=17,R=22,I=5,k=9,x=14,U=20,D=4,O=11,N=16,L=23,M=6,P=10,q=15,B=21;for(e=f(e),w=h(e),y=1732584193,b=4023233417,T=2562383102,S=271733878,p=0;p<w.length;p+=16)g=y,m=b,_=T,v=S,y=a(y,b,T,S,w[p+0],E,3614090360),S=a(S,y,b,T,w[p+1],C,3905402710),T=a(T,S,y,b,w[p+2],A,606105819),b=a(b,T,S,y,w[p+3],R,3250441966),y=a(y,b,T,S,w[p+4],E,4118548399),S=a(S,y,b,T,w[p+5],C,1200080426),T=a(T,S,y,b,w[p+6],A,2821735955),b=a(b,T,S,y,w[p+7],R,4249261313),y=a(y,b,T,S,w[p+8],E,1770035416),S=a(S,y,b,T,w[p+9],C,2336552879),T=a(T,S,y,b,w[p+10],A,4294925233),b=a(b,T,S,y,w[p+11],R,2304563134),y=a(y,b,T,S,w[p+12],E,1804603682),S=a(S,y,b,T,w[p+13],C,4254626195),T=a(T,S,y,b,w[p+14],A,2792965006),b=a(b,T,S,y,w[p+15],R,1236535329),y=l(y,b,T,S,w[p+1],I,4129170786),S=l(S,y,b,T,w[p+6],k,3225465664),T=l(T,S,y,b,w[p+11],x,643717713),b=l(b,T,S,y,w[p+0],U,3921069994),y=l(y,b,T,S,w[p+5],I,3593408605),S=l(S,y,b,T,w[p+10],k,38016083),T=l(T,S,y,b,w[p+15],x,3634488961),b=l(b,T,S,y,w[p+4],U,3889429448),y=l(y,b,T,S,w[p+9],I,568446438),S=l(S,y,b,T,w[p+14],k,3275163606),T=l(T,S,y,b,w[p+3],x,4107603335),b=l(b,T,S,y,w[p+8],U,1163531501),y=l(y,b,T,S,w[p+13],I,2850285829),S=l(S,y,b,T,w[p+2],k,4243563512),T=l(T,S,y,b,w[p+7],x,1735328473),b=l(b,T,S,y,w[p+12],U,2368359562),y=u(y,b,T,S,w[p+5],D,4294588738),S=u(S,y,b,T,w[p+8],O,2272392833),T=u(T,S,y,b,w[p+11],N,1839030562),b=u(b,T,S,y,w[p+14],L,4259657740),y=u(y,b,T,S,w[p+1],D,2763975236),S=u(S,y,b,T,w[p+4],O,1272893353),T=u(T,S,y,b,w[p+7],N,4139469664),b=u(b,T,S,y,w[p+10],L,3200236656),y=u(y,b,T,S,w[p+13],D,681279174),S=u(S,y,b,T,w[p+0],O,3936430074),T=u(T,S,y,b,w[p+3],N,3572445317),b=u(b,T,S,y,w[p+6],L,76029189),y=u(y,b,T,S,w[p+9],D,3654602809),S=u(S,y,b,T,w[p+12],O,3873151461),T=u(T,S,y,b,w[p+15],N,530742520),b=u(b,T,S,y,w[p+2],L,3299628645),y=c(y,b,T,S,w[p+0],M,4096336452),S=c(S,y,b,T,w[p+7],P,1126891415),T=c(T,S,y,b,w[p+14],q,2878612391),b=c(b,T,S,y,w[p+5],B,4237533241),y=c(y,b,T,S,w[p+12],M,1700485571),S=c(S,y,b,T,w[p+3],P,2399980690),T=c(T,S,y,b,w[p+10],q,4293915773),b=c(b,T,S,y,w[p+1],B,2240044497),y=c(y,b,T,S,w[p+8],M,1873313359),S=c(S,y,b,T,w[p+15],P,4264355552),T=c(T,S,y,b,w[p+6],q,2734768916),b=c(b,T,S,y,w[p+13],B,1309151649),y=c(y,b,T,S,w[p+4],M,4149444226),S=c(S,y,b,T,w[p+11],P,3174756917),T=c(T,S,y,b,w[p+2],q,718787259),b=c(b,T,S,y,w[p+9],B,3951481745),y=n(y,g),b=n(b,m),T=n(T,_),S=n(S,v);var j=d(y)+d(b)+d(T)+d(S);return j.toLowerCase()}},{"./Constants":7,"./Grammar":12,"./URI":29}],31:[function(e,t,n){function r(e,t,n){var r,i;for(d=e,f=t,p=n,r=T.length;r--;)if(i=T[r](d),i===!1)return!1;if(d instanceof _.IncomingRequest){for(r=y.length;r--;)if(i=y[r](d),i===!1)return!1}else if(d instanceof _.IncomingResponse)for(r=b.length;r--;)if(i=b[r](d),i===!1)return!1;return!0}function i(){if("sip"!==d.s("to").uri.scheme)return h(416),!1}function s(){if(!d.to_tag&&d.call_id.substr(0,5)===f.configuration.jssip_id)return h(482),!1}function o(){var e=v.str_utf8_length(d.body),t=d.getHeader("content-length");if(e<t)return h(400),!1}function a(){var e,t,n=d.from_tag,r=d.call_id,i=d.cseq;if(!d.to_tag)if(d.method===m.INVITE){if(f.transactions.ist[d.via_branch])return!1;for(t in f.transactions.ist)if(e=f.transactions.ist[t],e.request.from_tag===n&&e.request.call_id===r&&e.request.cseq===i)return h(482),!1}else{if(f.transactions.nist[d.via_branch])return!1;for(t in f.transactions.nist)if(e=f.transactions.nist[t],e.request.from_tag===n&&e.request.call_id===r&&e.request.cseq===i)return h(482),!1}}function l(){if(d.getHeaders("via").length>1)return g("more than one Via header field present in the response, dropping the response"),!1}function u(){var e=v.str_utf8_length(d.body),t=d.getHeader("content-length");if(e<t)return g("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function c(){for(var e=["from","to","call_id","cseq","via"],t=e.length;t--;)if(!d.hasHeader(e[t]))return g("missing mandatory header field : "+e[t]+", dropping the response"),!1}function h(e){var t,n="SIP/2.0 "+e+" "+m.REASON_PHRASE[e]+"\r\n",r=d.getHeaders("via"),i=r.length,s=0;for(s;s<i;s++)n+="Via: "+r[s]+"\r\n";t=d.getHeader("To"),d.to_tag||(t+=";tag="+v.newTag()),n+="To: "+t+"\r\n",n+="From: "+d.getHeader("From")+"\r\n",n+="Call-ID: "+d.call_id+"\r\n",n+="CSeq: "+d.cseq+" "+d.method+"\r\n",n+="\r\n",p.send(n)}t.exports=r;var d,f,p,g=e("debug")("JsSIP:sanityCheck"),m=e("./Constants"),_=e("./SIPMessage"),v=e("./Utils"),y=[],b=[],T=[];y.push(i),y.push(s),y.push(o),y.push(a),b.push(l),b.push(u),T.push(c)},{"./Constants":7,"./SIPMessage":24,"./Utils":30,debug:32}],32:[function(e,t,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,s=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(s=i))}),e.splice(s,0,r),e}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(t){}}function a(){var e;try{e=n.storage.debug}catch(t){}return e}function l(){try{return window.localStorage}catch(e){}}n=t.exports=e("./debug"),n.log=s,n.formatArgs=i,n.save=o,n.load=a,n.useColors=r,n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:l(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(a())},{"./debug":33}],33:[function(e,t,n){function r(){return n.colors[c++%n.colors.length]}function i(e){function t(){}function i(){var e=i,t=+new Date,s=t-(u||t);e.diff=s,e.prev=u,e.curr=t,u=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=r());var o=Array.prototype.slice.call(arguments);o[0]=n.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var a=0;o[0]=o[0].replace(/%([a-z%])/g,function(t,r){if("%%"===t)return t;a++;var i=n.formatters[r];if("function"==typeof i){var s=o[a];t=i.call(e,s),o.splice(a,1),a--}return t}),"function"==typeof n.formatArgs&&(o=n.formatArgs.apply(e,o));var l=i.log||n.log||console.log.bind(console);l.apply(e,o)}t.enabled=!1,i.enabled=!0;var s=n.enabled(e)?i:t;return s.namespace=e,s}function s(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,i=0;i<r;i++)t[i]&&(e=t[i].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function o(){n.enable("")}function a(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=i,n.coerce=l,n.disable=o,n.enable=s,n.enabled=a,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var u,c=0},{ms:34}],34:[function(e,t,n){function r(e){if(e=""+e,!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*h;case"days":case"day":case"d":return n*c;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*l;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function i(e){return e>=c?Math.round(e/c)+"d":e>=u?Math.round(e/u)+"h":e>=l?Math.round(e/l)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function s(e){return o(e,c,"day")||o(e,u,"hour")||o(e,l,"minute")||o(e,a,"second")||e+" ms"}function o(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var a=1e3,l=60*a,u=60*l,c=24*u,h=365.25*c;t.exports=function(e,t){return t=t||{},"string"==typeof e?r(e):t["long"]?s(e):i(e)}},{}],35:[function(e,t,n){(function(n){"use strict";function r(e){function t(e){return function(){throw new Error("rtcninja: WebRTC not supported, missing "+e+" [browser: "+o.name+" "+o.version+"]")}}if(y&&o.chrome&&v>=32||o.android&&o.chrome&&v>=39||y&&o.opera&&v>=27||o.android&&o.opera&&v>=24||o.android&&o.webkit&&!o.chrome&&v>=37||s.webkitGetUserMedia&&i.webkitRTCPeerConnection)b=!0,u=s.webkitGetUserMedia.bind(s),c=i.webkitRTCPeerConnection,h=i.RTCSessionDescription,d=i.RTCIceCandidate,f=i.MediaStreamTrack,f&&f.getSources?p=f.getSources.bind(f):s.getMediaDevices&&(p=s.getMediaDevices.bind(s)),g=function(e,t){return e.src=URL.createObjectURL(t),e},m=!0,_=!1;else if(y&&o.firefox&&v>=22||o.android&&o.firefox&&v>=33||s.mozGetUserMedia&&i.mozRTCPeerConnection)b=!0,u=s.mozGetUserMedia.bind(s),c=i.mozRTCPeerConnection,h=i.mozRTCSessionDescription,d=i.mozRTCIceCandidate,f=i.MediaStreamTrack,g=function(e,t){return e.src=URL.createObjectURL(t),e},m=!1,_=!1;else if(e.plugin&&"function"==typeof e.plugin.isRequired&&e.plugin.isRequired()&&"function"==typeof e.plugin.isInstalled&&e.plugin.isInstalled()){var n=e.plugin["interface"];b=!0,u=n.getUserMedia,c=n.RTCPeerConnection,h=n.RTCSessionDescription,d=n.RTCIceCandidate,f=n.MediaStreamTrack,f&&f.getSources?p=f.getSources.bind(f):s.getMediaDevices&&(p=s.getMediaDevices.bind(s)),g=n.attachMediaStream,m=n.canRenegotiate,_=!0}else s.getUserMedia&&i.RTCPeerConnection&&(b=!0,u=s.getUserMedia.bind(s),c=i.RTCPeerConnection,h=i.RTCSessionDescription,d=i.RTCIceCandidate,f=i.MediaStreamTrack,f&&f.getSources?p=f.getSources.bind(f):s.getMediaDevices&&(p=s.getMediaDevices.bind(s)),g=i.attachMediaStream||function(e,t){return e.src=URL.createObjectURL(t),e},m=!1,_=!1);return r.hasWebRTC=function(){return b},u?r.getUserMedia=function(e,t,n){a("getUserMedia() | constraints: %o",e);try{u(e,function(e){a("getUserMedia() | success"),t&&t(e)},function(e){a("getUserMedia() | error:",e),n&&n(e)})}catch(r){l("getUserMedia() | error:",r),n&&n(r)}}:r.getUserMedia=function(e,n,r){l("getUserMedia() | WebRTC not supported"),r?r(new Error("rtcninja: WebRTC not supported, missing getUserMedia [browser: "+o.name+" "+o.version+"]")):t("getUserMedia")},r.RTCPeerConnection=c||t("RTCPeerConnection"),r.RTCSessionDescription=h||t("RTCSessionDescription"),r.RTCIceCandidate=d||t("RTCIceCandidate"),r.MediaStreamTrack=f||t("MediaStreamTrack"),r.getMediaDevices=p,r.attachMediaStream=g||t("attachMediaStream"),r.canRenegotiate=m,r.closeMediaStream=function(e){if(e)if(f&&f.prototype&&f.prototype.stop){a("closeMediaStream() | calling stop() on all the MediaStreamTrack");var t,n,r;if(e.getTracks)for(t=e.getTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop();else{for(t=e.getAudioTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop();for(t=e.getVideoTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop()}}else"function"==typeof e.stop&&(a("closeMediaStream() | calling stop() on the MediaStream"),e.stop())},r.fixPeerConnectionConfig=function(e){var t,n,r,i,s;for(Array.isArray(e.iceServers)||(e.iceServers=[]),t=0,n=e.iceServers.length;t<n;t+=1)r=e.iceServers[t],i=r.hasOwnProperty("urls"),s=r.hasOwnProperty("url"),"object"==typeof r&&(i&&!s?r.url=Array.isArray(r.urls)?r.urls[0]:r.urls:!i&&s&&(r.urls=Array.isArray(r.url)?r.url.slice():r.url),s&&Array.isArray(r.url)&&(r.url=r.url[0]))},r.fixRTCOfferOptions=function(e){e=e||{},_?(e.offerToReceiveAudio&&(e.mandatory=e.mandatory||{},e.mandatory.OfferToReceiveAudio=!0),e.offerToReceiveVideo&&(e.mandatory=e.mandatory||{},e.mandatory.OfferToReceiveVideo=!0)):(e.mandatory&&e.mandatory.OfferToReceiveAudio&&(e.offerToReceiveAudio=1),e.mandatory&&e.mandatory.OfferToReceiveVideo&&(e.offerToReceiveVideo=1),delete e.mandatory)},r}t.exports=r;var i,s,o=e("bowser"),a=e("debug")("rtcninja:Adapter"),l=e("debug")("rtcninja:ERROR:Adapter"),u=null,c=null,h=null,d=null,f=null,p=null,g=null,m=!1,_=!1,v=Number(o.version)||0,y=!(o.mobile||o.tablet),b=!1;l.log=console.warn.bind(console),i=n.window||n,s=i.navigator||{}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bowser:39,debug:32}],36:[function(e,t,n){"use strict";function r(e,t){h("new | pcConfig: %o",e),i.call(this,e),this.pcConstraints=t,this.ourLocalDescription=null,this.ourSignalingState=null,this.ourIceConnectionState=null,this.ourIceGatheringState=null,this.timerGatheringTimeout=null,this.timerGatheringTimeoutAfterRelay=null,this.ignoreIceGathering=!1,this.closed=!1,a.call(this),u.call(this)}function i(e){this.pcConfig=c(!0,e),f.fixPeerConnectionConfig(this.pcConfig),this.options={iceTransportsRelay:"relay"===this.pcConfig.iceTransports,iceTransportsNone:"none"===this.pcConfig.iceTransports,gatheringTimeout:this.pcConfig.gatheringTimeout,gatheringTimeoutAfterRelay:this.pcConfig.gatheringTimeoutAfterRelay},delete this.pcConfig.gatheringTimeout,delete this.pcConfig.gatheringTimeoutAfterRelay,h("setConfigurationAndOptions | processed pcConfig: %o",this.pcConfig)}function s(){return this.closed||this.pc&&"closed"===this.pc.iceConnectionState}function o(){var e=this,t=this.pc;t.onnegotiationneeded=function(t){s.call(e)||(h("onnegotiationneeded()"),e.onnegotiationneeded&&e.onnegotiationneeded(t))},t.onicecandidate=function(t){var n,r,i;if(!s.call(e)&&!e.ignoreIceGathering&&!e.options.iceTransportsNone)if(n=t.candidate){if(r=p.REGEXP_RELAY_CANDIDATE.test(n.candidate),e.options.iceTransportsRelay&&!r)return;r&&!e.timerGatheringTimeoutAfterRelay&&"number"==typeof e.options.gatheringTimeoutAfterRelay&&(h("onicecandidate() | first relay candidate found, ending gathering in %d ms",e.options.gatheringTimeoutAfterRelay),e.timerGatheringTimeoutAfterRelay=setTimeout(function(){s.call(e)||(h("forced end of candidates after timeout"),delete e.timerGatheringTimeoutAfterRelay,clearTimeout(e.timerGatheringTimeout),delete e.timerGatheringTimeout,e.ignoreIceGathering=!0,e.onicecandidate&&e.onicecandidate({candidate:null},null))},e.options.gatheringTimeoutAfterRelay)),i=new f.RTCIceCandidate({sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,candidate:n.candidate}),null===g.normalizeCandidate&&(p.REGEXP_NORMALIZED_CANDIDATE.test(n.candidate)?g.normalizeCandidate=!1:(h('onicecandidate() | normalizing ICE candidates syntax (remove "a=" and "\\r\\n")'),g.normalizeCandidate=!0)),g.normalizeCandidate&&(i.candidate=n.candidate.replace(p.REGEXP_FIX_CANDIDATE,"")),h("onicecandidate() | m%d(%s) %s",i.sdpMLineIndex,i.sdpMid||"no mid",i.candidate),e.onicecandidate&&e.onicecandidate(t,i)}else h("onicecandidate() | end of candidates"),clearTimeout(e.timerGatheringTimeout),delete e.timerGatheringTimeout,clearTimeout(e.timerGatheringTimeoutAfterRelay),delete e.timerGatheringTimeoutAfterRelay,e.onicecandidate&&e.onicecandidate(t,null)},t.onaddstream=function(t){s.call(e)||(h("onaddstream() | stream: %o",t.stream),e.onaddstream&&e.onaddstream(t,t.stream))},t.onremovestream=function(t){s.call(e)||(h("onremovestream() | stream: %o",t.stream),e.onremovestream&&e.onremovestream(t,t.stream))},t.ondatachannel=function(t){s.call(e)||(h("ondatachannel() | datachannel: %o",t.channel),e.ondatachannel&&e.ondatachannel(t,t.channel))},t.onsignalingstatechange=function(n){t.signalingState!==e.ourSignalingState&&(h("onsignalingstatechange() | signalingState: %s",t.signalingState),e.ourSignalingState=t.signalingState,e.onsignalingstatechange&&e.onsignalingstatechange(n,t.signalingState))},t.oniceconnectionstatechange=function(n){t.iceConnectionState!==e.ourIceConnectionState&&(h("oniceconnectionstatechange() | iceConnectionState: %s",t.iceConnectionState),e.ourIceConnectionState=t.iceConnectionState,e.oniceconnectionstatechange&&e.oniceconnectionstatechange(n,t.iceConnectionState))},t.onicegatheringstatechange=function(n){s.call(e)||t.iceGatheringState!==e.ourIceGatheringState&&(h("onicegatheringstatechange() | iceGatheringState: %s",t.iceGatheringState),e.ourIceGatheringState=t.iceGatheringState,e.onicegatheringstatechange&&e.onicegatheringstatechange(n,t.iceGatheringState))},t.onidentityresult=function(t){s.call(e)||(h("onidentityresult()"),e.onidentityresult&&e.onidentityresult(t))},t.onpeeridentity=function(t){s.call(e)||(h("onpeeridentity()"),e.onpeeridentity&&e.onpeeridentity(t))},t.onidpassertionerror=function(t){s.call(e)||(h("onidpassertionerror()"),e.onidpassertionerror&&e.onidpassertionerror(t))},t.onidpvalidationerror=function(t){s.call(e)||(h("onidpvalidationerror()"),e.onidpvalidationerror&&e.onidpvalidationerror(t))}}function a(){this.pcConstraints?this.pc=new f.RTCPeerConnection(this.pcConfig,this.pcConstraints):this.pc=new f.RTCPeerConnection(this.pcConfig),o.call(this)}function l(){var e=this.pc,t=this.options,n=null;return e.localDescription?(t.iceTransportsRelay?n=e.localDescription.sdp.replace(p.REGEXP_SDP_NON_RELAY_CANDIDATES,""):t.iceTransportsNone&&(n=e.localDescription.sdp.replace(p.REGEXP_SDP_CANDIDATES,"")),this.ourLocalDescription=new f.RTCSessionDescription({type:e.localDescription.type,sdp:n||e.localDescription.sdp}),this.ourLocalDescription):(this.ourLocalDescription=null,null)}function u(){var e=this;Object.defineProperties(this,{peerConnection:{get:function(){return e.pc}},signalingState:{get:function(){return e.pc.signalingState}},iceConnectionState:{get:function(){return e.pc.iceConnectionState}},iceGatheringState:{get:function(){return e.pc.iceGatheringState}},localDescription:{get:function(){return l.call(e)}},remoteDescription:{get:function(){return e.pc.remoteDescription}},peerIdentity:{get:function(){return e.pc.peerIdentity}}})}t.exports=r;var c=e("merge"),h=e("debug")("rtcninja:RTCPeerConnection"),d=e("debug")("rtcninja:ERROR:RTCPeerConnection"),f=e("./Adapter"),p={REGEXP_NORMALIZED_CANDIDATE:new RegExp(/^candidate:/i),REGEXP_FIX_CANDIDATE:new RegExp(/(^a=|\r|\n)/gi),REGEXP_RELAY_CANDIDATE:new RegExp(/ relay /i),REGEXP_SDP_CANDIDATES:new RegExp(/^a=candidate:.*\r\n/gim),REGEXP_SDP_NON_RELAY_CANDIDATES:new RegExp(/^a=candidate:(.(?!relay ))*\r\n/gim)},g={normalizeCandidate:null};d.log=console.warn.bind(console),r.prototype.createOffer=function(e,t,n){h("createOffer()");var r=this;f.fixRTCOfferOptions(n),this.pc.createOffer(function(t){s.call(r)||(h("createOffer() | success"),e&&e(t))},function(e){s.call(r)||(d("createOffer() | error:",e),t&&t(e))},n)},r.prototype.createAnswer=function(e,t,n){h("createAnswer()");var r=this;this.pc.createAnswer(function(t){s.call(r)||(h("createAnswer() | success"),e&&e(t))},function(e){s.call(r)||(d("createAnswer() | error:",e),t&&t(e))},n)},r.prototype.setLocalDescription=function(e,t,n){function r(){"number"==typeof i.options.gatheringTimeout&&"complete"!==i.pc.iceGatheringState&&(h("setLocalDescription() | ending gathering in %d ms (gatheringTimeout option)",i.options.gatheringTimeout),i.timerGatheringTimeout=setTimeout(function(){s.call(i)||(h("forced end of candidates after gatheringTimeout timeout"),delete i.timerGatheringTimeout,clearTimeout(i.timerGatheringTimeoutAfterRelay),delete i.timerGatheringTimeoutAfterRelay,i.ignoreIceGathering=!0,i.onicecandidate&&i.onicecandidate({candidate:null},null))},i.options.gatheringTimeout))}h("setLocalDescription()");var i=this;this.pc.setLocalDescription(e,function(){s.call(i)||(h("setLocalDescription() | success"),clearTimeout(i.timerGatheringTimeout),delete i.timerGatheringTimeout,clearTimeout(i.timerGatheringTimeoutAfterRelay),delete i.timerGatheringTimeoutAfterRelay,r(),t&&t())},function(e){s.call(i)||(d("setLocalDescription() | error:",e),n&&n(e))}),this.ignoreIceGathering=!1},r.prototype.setRemoteDescription=function(e,t,n){h("setRemoteDescription()");var r=this;this.pc.setRemoteDescription(e,function(){s.call(r)||(h("setRemoteDescription() | success"),t&&t())},function(e){s.call(r)||(d("setRemoteDescription() | error:",e),n&&n(e))})},r.prototype.updateIce=function(e){h("updateIce() | pcConfig: %o",e),i.call(this,e),this.pc.updateIce(this.pcConfig),this.ignoreIceGathering=!1},r.prototype.addIceCandidate=function(e,t,n){h("addIceCandidate() | candidate: %o",e);var r=this;this.pc.addIceCandidate(e,function(){s.call(r)||(h("addIceCandidate() | success"),t&&t())},function(e){s.call(r)||(d("addIceCandidate() | error:",e),n&&n(e))})},r.prototype.getConfiguration=function(){return h("getConfiguration()"),this.pc.getConfiguration()},r.prototype.getLocalStreams=function(){return h("getLocalStreams()"),this.pc.getLocalStreams()},r.prototype.getRemoteStreams=function(){return h("getRemoteStreams()"),this.pc.getRemoteStreams()},r.prototype.getStreamById=function(e){return h("getStreamById() | streamId: %s",e),this.pc.getStreamById(e)},r.prototype.addStream=function(e){h("addStream() | stream: %s",e),this.pc.addStream(e)},r.prototype.removeStream=function(e){h("removeStream() | stream: %o",e),this.pc.removeStream(e)},r.prototype.close=function(){h("close()"),this.closed=!0,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,this.pc.close()},r.prototype.createDataChannel=function(){return h("createDataChannel()"),this.pc.createDataChannel.apply(this.pc,arguments)},r.prototype.createDTMFSender=function(e){return h("createDTMFSender()"),this.pc.createDTMFSender(e)},r.prototype.getStats=function(){return h("getStats()"),this.pc.getStats.apply(this.pc,arguments)},r.prototype.setIdentityProvider=function(){return h("setIdentityProvider()"),this.pc.setIdentityProvider.apply(this.pc,arguments)},r.prototype.getIdentityAssertion=function(){return h("getIdentityAssertion()"),this.pc.getIdentityAssertion()},r.prototype.reset=function(e){h("reset() | pcConfig: %o",e);var t=this.pc;t.onnegotiationneeded=null,t.onicecandidate=null,t.onaddstream=null,t.onremovestream=null,t.ondatachannel=null,t.onsignalingstatechange=null,t.oniceconnectionstatechange=null,t.onicegatheringstatechange=null,t.onidentityresult=null,t.onpeeridentity=null,t.onidpassertionerror=null,t.onidpvalidationerror=null,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,
h("reset() | closing current peerConnection"),t.close(),i.call(this,e),a.call(this)}},{"./Adapter":35,debug:32,merge:40}],37:[function(e,t,n){"use strict";function r(e){var t=l(e||{});return c=!0,r.RTCPeerConnection=u,r.getUserMedia=t.getUserMedia,r.RTCSessionDescription=t.RTCSessionDescription,r.RTCIceCandidate=t.RTCIceCandidate,r.MediaStreamTrack=t.MediaStreamTrack,r.getMediaDevices=t.getMediaDevices,r.attachMediaStream=t.attachMediaStream,r.closeMediaStream=t.closeMediaStream,r.canRenegotiate=t.canRenegotiate,t.hasWebRTC()?(s("WebRTC supported"),!0):(o("WebRTC not supported"),!1)}t.exports=r;var i=e("bowser"),s=e("debug")("rtcninja"),o=e("debug")("rtcninja:ERROR"),a=e("./version"),l=e("./Adapter"),u=e("./RTCPeerConnection"),c=!1;o.log=console.warn.bind(console),s("version %s",a),s("detected browser: %s %s [mobile:%s, tablet:%s, android:%s, ios:%s]",i.name,i.version,!!i.mobile,!!i.tablet,!!i.android,!!i.ios),r.hasWebRTC=function(){return c||r(),l.hasWebRTC()},Object.defineProperty(r,"version",{get:function(){return a}}),Object.defineProperty(r,"called",{get:function(){return c}}),r.debug=e("debug"),r.browser=i},{"./Adapter":35,"./RTCPeerConnection":36,"./version":38,bowser:39,debug:32}],38:[function(e,t,n){"use strict";t.exports=e("../package.json").version},{"../package.json":41}],39:[function(t,n,r){/*!
   * Bowser - a browser detector
   * https://github.com/ded/bowser
   * MIT License | (c) Dustin Diaz 2015
   */
!function(t,r){"undefined"!=typeof n&&n.exports?n.exports=r():"function"==typeof e&&e.amd?e(r):this[t]=r()}("bowser",function(){function e(e){function n(t){var n=e.match(t);return n&&n.length>1&&n[1]||""}function r(t){var n=e.match(t);return n&&n.length>1&&n[2]||""}var i,s=n(/(ipod|iphone|ipad)/i).toLowerCase(),o=/like android/i.test(e),a=!o&&/android/i.test(e),l=/CrOS/.test(e),u=n(/edge\/(\d+(\.\d+)?)/i),c=n(/version\/(\d+(\.\d+)?)/i),h=/tablet/i.test(e),d=!h&&/[^-]mobi/i.test(e);/opera|opr/i.test(e)?i={name:"Opera",opera:t,version:c||n(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?i={name:"Yandex Browser",yandexbrowser:t,version:c||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(e)?(i={name:"Windows Phone",windowsphone:t},u?(i.msedge=t,i.version=u):(i.msie=t,i.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?i={name:"Internet Explorer",msie:t,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:l?i={name:"Chrome",chromeBook:t,chrome:t,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(e)?i={name:"Microsoft Edge",msedge:t,version:u}:/chrome|crios|crmo/i.test(e)?i={name:"Chrome",chrome:t,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:s?(i={name:"iphone"==s?"iPhone":"ipad"==s?"iPad":"iPod"},c&&(i.version=c)):/sailfish/i.test(e)?i={name:"Sailfish",sailfish:t,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?i={name:"SeaMonkey",seamonkey:t,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(e)?(i={name:"Firefox",firefox:t,version:n(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(i.firefoxos=t)):/silk/i.test(e)?i={name:"Amazon Silk",silk:t,version:n(/silk\/(\d+(\.\d+)?)/i)}:a?i={name:"Android",version:c}:/phantom/i.test(e)?i={name:"PhantomJS",phantom:t,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?i={name:"BlackBerry",blackberry:t,version:c||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(e)?(i={name:"WebOS",webos:t,version:c||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(i.touchpad=t)):i=/bada/i.test(e)?{name:"Bada",bada:t,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(e)?{name:"Tizen",tizen:t,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||c}:/safari/i.test(e)?{name:"Safari",safari:t,version:c}:{name:n(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(e)?(i.name=i.name||"Webkit",i.webkit=t,!i.version&&c&&(i.version=c)):!i.opera&&/gecko\//i.test(e)&&(i.name=i.name||"Gecko",i.gecko=t,i.version=i.version||n(/gecko\/(\d+(\.\d+)?)/i)),i.msedge||!a&&!i.silk?s&&(i[s]=t,i.ios=t):i.android=t;var f="";i.windowsphone?f=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):s?(f=n(/os (\d+([_\s]\d+)*) like mac os x/i),f=f.replace(/[_\s]/g,".")):a?f=n(/android[ \/-](\d+(\.\d+)*)/i):i.webos?f=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?f=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?f=n(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(f=n(/tizen[\/\s](\d+(\.\d+)*)/i)),f&&(i.osversion=f);var p=f.split(".")[0];return h||"ipad"==s||a&&(3==p||4==p&&!d)||i.silk?i.tablet=t:(d||"iphone"==s||"ipod"==s||a||i.blackberry||i.webos||i.bada)&&(i.mobile=t),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.chrome&&i.version>=20||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1?i.a=t:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6?i.c=t:i.x=t,i}var t=!0,n=e("undefined"!=typeof navigator?navigator.userAgent:"");return n.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if("string"==typeof r&&r in n)return!0}return!1},n._detect=e,n})},{}],40:[function(e,t,n){!function(e){function n(e,t){if("object"!==i(e))return t;for(var r in t)"object"===i(e[r])&&"object"===i(t[r])?e[r]=n(e[r],t[r]):e[r]=t[r];return e}function r(e,t,r){var o=r[0],a=r.length;(e||"object"!==i(o))&&(o={});for(var l=0;l<a;++l){var u=r[l],c=i(u);if("object"===c)for(var h in u){var d=e?s.clone(u[h]):u[h];t?o[h]=n(o[h],d):o[h]=d}}return o}function i(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var s=function(e){return r(e===!0,!1,arguments)},o="merge";s.recursive=function(e){return r(e===!0,!0,arguments)},s.clone=function(e){var t,n,r=e,o=i(e);if("array"===o)for(r=[],n=e.length,t=0;t<n;++t)r[t]=s.clone(e[t]);else if("object"===o){r={};for(t in e)r[t]=s.clone(e[t])}return r},e?t.exports=s:window[o]=s}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],41:[function(e,t,n){t.exports={name:"rtcninja",version:"0.6.4",description:"WebRTC API wrapper to deal with different browsers",author:{name:"Iñaki Baz Castillo",email:"inaki.baz@eface2face.com",url:"http://eface2face.com"},contributors:[{name:"Jesús Pérez",email:"jesus.perez@eface2face.com"}],license:"MIT",main:"lib/rtcninja.js",homepage:"https://github.com/eface2face/rtcninja.js",repository:{type:"git",url:"https://github.com/eface2face/rtcninja.js.git"},keywords:["webrtc"],engines:{node:">=0.10.32"},dependencies:{bowser:"^1.0.0",debug:"^2.2.0",merge:"^1.2.0"},devDependencies:{browserify:"^11.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-filelog":"^0.4.1","gulp-header":"^1.7.1","gulp-jscs":"^2.0.0","gulp-jscs-stylish":"^1.1.2","gulp-jshint":"^1.11.2","gulp-rename":"^1.2.2","gulp-uglify":"^1.4.0","jshint-stylish":"^2.0.1",retire:"^1.1.1",shelljs:"^0.5.3","vinyl-source-stream":"^1.1.0"},gitHead:"18789cbefdb5a6c6c038ab4f1ce8e9e3813135b0",bugs:{url:"https://github.com/eface2face/rtcninja.js/issues"},_id:"rtcninja@0.6.4",scripts:{},_shasum:"7ede8577ce978cb431772d877967c53aadeb5e99",_from:"rtcninja@>=0.6.4 <0.7.0",_npmVersion:"2.5.1",_nodeVersion:"0.12.0",_npmUser:{name:"ibc",email:"ibc@aliax.net"},dist:{shasum:"7ede8577ce978cb431772d877967c53aadeb5e99",tarball:"http://registry.npmjs.org/rtcninja/-/rtcninja-0.6.4.tgz"},maintainers:[{name:"ibc",email:"ibc@aliax.net"}],directories:{},_resolved:"https://registry.npmjs.org/rtcninja/-/rtcninja-0.6.4.tgz"}},{}],42:[function(e,t,n){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(e){return null!=e.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",null!=e.generation&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],43:[function(e,t,n){var r=e("./parser"),i=e("./writer");n.write=i,n.parse=r.parse,n.parseFmtpConfig=r.parseFmtpConfig,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates},{"./parser":44,"./writer":45}],44:[function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var s=0;s<n.length;s+=1)null!=e[s+1]&&(t[n[s]]=r(e[s+1]))},s=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},o=e("./grammar"),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var a=0;a<(o[t]||[]).length;a+=1){var l=o[t][a];if(l.reg.test(i))return s(l,r,i)}}),t.media=n,t};var l=function(e,t){var n=t.split("=");return 2===n.length&&(e[n[0]]=r(n[1])),e};n.parseFmtpConfig=function(e){return e.split(/\;\s?/).reduce(l,{})},n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t}},{"./grammar":42}],45:[function(e,t,n){var r=e("./grammar"),i=/%[sdv%]/g,s=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},o=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?i.push(n[t.name][a]):i.push(n[t.names[o]])}else i.push(n[t.name]);return s.apply(null,i)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||a,i=t.innerOrder||l,s=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?s.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){s.push(o(t,n,e))})})}),e.media.forEach(function(e){s.push(o("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?s.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){s.push(o(t,n,e))})})})}),s.join("\r\n")+"\r\n"}},{"./grammar":42}],46:[function(e,t,n){function r(e,t){var n;return n=t?new s(e,t):new s(e)}var i=function(){return this}(),s=i.WebSocket||i.MozWebSocket,o=e("./version");t.exports={w3cwebsocket:s?r:null,version:o}},{"./version":47}],47:[function(e,t,n){t.exports=e("../package.json").version},{"../package.json":48}],48:[function(e,t,n){t.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],version:"1.0.22",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=0.8.0"},dependencies:{debug:"~2.2.0",nan:"~2.0.5","typedarray-to-buffer":"~3.0.3",yaeti:"~0.0.4"},devDependencies:{"buffer-equal":"^0.0.1",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^1.11.2","jshint-stylish":"^1.0.2",tape:"^4.0.1"},config:{verbose:!1},scripts:{install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0",gitHead:"19108bbfd7d94a5cd02dbff3495eafee9e901ca4",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},_id:"websocket@1.0.22",_shasum:"8c33e3449f879aaf518297c9744cebf812b9e3d8",_from:"websocket@>=1.0.22 <2.0.0",_npmVersion:"2.14.3",_nodeVersion:"3.3.1",_npmUser:{name:"theturtle32",email:"brian@worlize.com"},maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],dist:{shasum:"8c33e3449f879aaf518297c9744cebf812b9e3d8",tarball:"http://registry.npmjs.org/websocket/-/websocket-1.0.22.tgz"},_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.22.tgz"}},{}],49:[function(e,t,n){t.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"0.7.9",homepage:"http://jssip.net",author:{name:"José Luis Millán",email:"jmillan@aliax.net",url:"https://github.com/jmillan"},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"https://github.com/ibc"},{name:"Saúl Ibarra Corretgé",email:"saghul@gmail.com",url:"https://github.com/saghul"}],main:"lib/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^2.2.0",rtcninja:"^0.6.4","sdp-transform":"~1.5.0",websocket:"^1.0.22"},devDependencies:{browserify:"^11.2.0",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-header":"^1.7.1","gulp-jshint":"^1.11.2","gulp-nodeunit-runner":"^0.2.2","gulp-rename":"^1.2.2","gulp-uglify":"^1.4.2","gulp-util":"^3.0.6","jshint-stylish":"^2.0.1",pegjs:"0.7.0","vinyl-source-stream":"^1.1.0"},scripts:{test:"gulp test"},gitHead:"244c9fd89f82b5707dbfdd4bf1db7c1c49bf7e4a",_id:"jssip@0.7.9",_shasum:"aebd1b9e4c053ac7158de2113f50880d9b9b5f61",_from:"jssip@0.7.9",_npmVersion:"2.5.1",_nodeVersion:"0.12.0",_npmUser:{name:"ibc",email:"ibc@aliax.net"},dist:{shasum:"aebd1b9e4c053ac7158de2113f50880d9b9b5f61",tarball:"http://registry.npmjs.org/jssip/-/jssip-0.7.9.tgz"},maintainers:[{name:"ibc",email:"ibc@aliax.net"},{name:"jmillan",email:"jmillan@aliax.net"}],directories:{},_resolved:"https://registry.npmjs.org/jssip/-/jssip-0.7.9.tgz"}},{}]},{},[6])(6)});/**
* Copyright (C) 2015 etcloud
* yangchengguo
* VERSION : '0.0.4'
* UPDATE: 2015/09/01
**/
var uploads=new Array,channelist=new Array,uploadPer=0,initChannelFun=null,autoUploadFlag=1,EtcFileSdk={VERSION:"0.0.3",FAILED:4,DONE:5,FILE_SIZE_ERROR:400,FILE_NAME_LENTH_ERROR:401,FILE_PAGE_SIZE_ERROR:402,FILE_GUID_LENTH_ERROR:403,FILE_SAVE_FAIL:404,TIMEOUT:500};etcjs_file_channel.prototype.send=function(e,t){this.actionID++;var n=new Object;n.tag0=e.tag0,n.action=e.action,n.actionid=this.actionID,n.cmd=e.cmd,n.parameters=e.parameters,null==this.callBacks[this.actionID.toString()],null!=t&&(this.callBacks[this.actionID.toString()]=t);var r=JSON.stringify(n);this.socket.send(r)},etcjs_file_channel.prototype.close=function(){this.socket.close(),1==autoUploadFlag&&(uploadPer>0&&uploadPer--,uploads.length>0&&startInitChannel())},etcjs_file_channel.prototype.onReceive=function(e){var t=JSON.parse(e),n=t.action;if(null!=n){if("etc.delete"==n&&t.result)return void(null!=this.fileDeleteCallBack&&this.fileDeleteCallBack(t));if("etc.data"==n&&null!=t.url)return null!=this.fileUpLoadCallBack&&this.fileUpLoadCallBack(t),void(autoUploadFlag&&this.close());if("etc.fail"==n)return null!=this.fileUpLoadFailCallBack&&this.fileUpLoadFailCallBack(t),void(autoUploadFlag&&this.close())}if(null!=t.actionid){var r=t.actionid.toString(),i=this.callBacks[r.toString()];null!=i?i(t):null!=this.receive&&this.receive(t)}},etcjs_file_channel.prototype.connect=function(e){var t=this;this.socket=new WebSocket(e);this.queues,this.socket;this.socket.onopen=function(e){null!=t.connected&&t.connected(e,t),startNext(t),channelist.push(t)},this.socket.onclose=function(e){null!=t.disposed&&t.disposed(e)},this.socket.onmessage=function(e){t.onReceive(e.data.toString())},this.socket.onerror=function(e){null!=t.error&&t.error(e)}},etcjs_file_channel.prototype.deleteFileById=function(e){var t={action:"etc.delete",token:"token",parameters:{FileName:e}},n=JSON.stringify(t);this.socket.send(n)},etcjs_FileInfo.prototype.reset=function(){this.PageIndex=0,this.UploadBytes=0},etcjs_FileInfo.prototype.toBase64String=function(){for(var e="",t=new Uint8Array(this.dataBuffer),n=t.byteLength,r=0;r<n;r++)e+=String.fromCharCode(t[r]);return window.btoa(e)},etcjs_FileInfo.prototype.onLoadData=function(e){var t=e.target.tag;e.target.readyState==FileReader.DONE?(t.dataBuffer=e.target.result,null!=t.loadCallBack&&t.loadCallBack(t)):null!=t.uploadError&&t.uploadError(fi,e.target.error)},etcjs_FileInfo.prototype.load=function(e){this.loadCallBack=e,null!=this.filereader&&void 0!=this.filereader||(this.filereader=new FileReader);var t=this.filereader;t.tag=this,t.onloadend=this.onLoadData;var n=this.size-this.pageIndex*this.pageSize;n>this.pageSize&&(n=this.pageSize),this.uploadBytes+=n;var r=null;r=this.file.webkitSlice?this.file.webkitSlice(this.pageIndex*this.pageSize,this.pageIndex*this.pageSize+n):this.file.mozSlice?this.file.mozSlice(this.pageIndex*this.pageSize,this.pageIndex*this.pageSize+n):this.file.slice(this.pageIndex*this.pageSize,this.pageIndex*this.pageSize+n),t.readAsArrayBuffer(r)},etcjs_FileInfo.prototype.onUploadData=function(e){var t=e._channel,n=(e._action,e.tag+"_"+e.pageIndex);t.send({tag0:n,action:"etc.data",token:"token",parameters:{FileID:e.id,PageIndex:e.pageIndex,Pages:e.pages,PageSize:e.pageSize,Base64Data:e.toBase64String(),tag1:n}},function(t){null==t.status||void 0==t.status?(e.pageIndex++,null!=e.uploadProcess&&e.uploadProcess(e),e.pageIndex<e.pages&&e.load(e.onUploadData)):null!=e.uploadError&&e.uploadError(e,data.status)})},etcjs_FileInfo.prototype.upload=function(e){var t=this,n=t.tag+"_00";e.send({tag0:n,action:"etc.uploadfile",token:"token",parameters:{FileName:t.fileName,Size:t.size,Pages:t.pages,PageSize:t.pageSize,FileID:t.id,tag1:n}},function(n){null==n.status||void 0==n.status?(t._channel=e,t._action=n.data,t.load(t.onUploadData)):null!=file.uploadError&&file.uploadError(t,n.status)})},et_http.prototype.etInitConfig=function(e){this.http_host=e.http_host,this.http_port=e.http_port,this.appkey=e.appkey,this.secretkey=e.secretkey,this.userid=e.userid},et_http.prototype.etGetBuddys=function(e){var t=this,n="http://"+t.http_host+":"+t.http_port+"/webserver_friend/getfriendlists";console.log(t);var r=Math.round((new Date).getTime()/1e3).toString(),i=JSON.stringify({userid:t.userid}),s=hex_md5(t.appkey+t.secretkey+r);$.ajax({type:"POST",url:n,crossDomain:!0,data:{appkey:this.appkey,apptoken:s,data:encode64(utf16to8(i)),random:r},success:function(t,n){e&&e(t,n)},error:function(t,n){e&&e(t,n)}})},et_http.prototype.etAddUsers=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_user/adduser",i=Math.round((new Date).getTime()/1e3).toString();if(e&&e.userlist&&Array.isArray(e.userlist))for(var s=0,o=e.userlist.length;s<o;s++)e.userlist[s].platformtype=etGetSDKPlatform();var a='{"userlists":'+JSON.stringify(e.userlist)+"}",l=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:l,data:encode64(utf16to8(a)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etGetUserState=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_user/getuserstate",i=Math.round((new Date).getTime()/1e3).toString(),s='{"userid":'+e.userid+"}";console.log(s);var o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etAddBuddy=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_friend/addfriend",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({userid:n.userid,friendid:e.friendid}),o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etAddBuddyEx=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_friend/addfriendex",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({userid:n.userid,friendid:e.friendid,notify:e.notify}),o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etDeleteBuddy=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_friend/deletefriend",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({userid:n.userid,friendid:e.friendid}),o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etDeleteBuddyEx=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_friend/deletefriendex",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({userid:n.userid,friendid:e.friendid,notify:e.notify}),o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etCreateGroup=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_group/creategroup",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({userid:n.userid,groupname:e.groupname,userlist:e.other_userid}),o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etGetGroups=function(e){var t=this,n="http://"+t.http_host+":"+t.http_port+"/webserver_group/getgrouplist",r=Math.round((new Date).getTime()/1e3).toString(),i=JSON.stringify({userid:t.userid});console.log(i);var s=hex_md5(t.appkey+t.secretkey+r);$.ajax({type:"POST",url:n,crossDomain:!0,data:{appkey:t.appkey,apptoken:s,data:encode64(utf16to8(i)),random:r},success:function(t,n){e&&e(t,n)},error:function(t,n){e&&e(t,n)}})},et_http.prototype.etLogoutGroup=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_group/logoutgroup",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({topic:e.topic,userid:n.userid});console.log(s);var o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etReleaseGroup=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_group/releasegroup",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({topic:e.topic,userid:n.userid});console.log(s);var o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etAddGroupMember=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_group/addgroupmember",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({topic:e.topic,userlist:e.userlist}),o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etGetGroupMembers=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_group/getgroupuserlists",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({userid:n.userid,topic:e.topic}),o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etDeleteGroupMember=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_group/deletegroupmember",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({userid:n.userid,topic:e.topic,userlist:e.userlist});console.log(s);var o=hex_md5(n.appkey+n.secretkey+i);$.ajax({type:"POST",url:r,crossDomain:!0,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i},success:function(e,n){t&&t(e,n)},error:function(e,n){t&&t(e,n)}})},et_http.prototype.etCreateRoom=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_video/create_room",i=Math.round((new Date).getTime()/1e3).toString(),s=JSON.stringify({roomname:e,createuserid:n.userid,userlist:t}),o=hex_md5(n.appkey+n.secretkey+i),a=$.ajax({type:"POST",url:r,crossDomain:!0,async:!1,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(s)),random:i}}),l=$.parseJSON(a.responseText);return l},et_http.prototype.etSelectRoom=function(e){var t=this,n="http://"+t.http_host+":"+t.http_port+"/webserver_video/select_room",r=JSON.stringify({roomid:e}),i=Math.round((new Date).getTime()/1e3).toString(),s=hex_md5(t.appkey+t.secretkey+i),o=$.ajax({type:"POST",url:n,crossDomain:!0,async:!1,data:{appkey:t.appkey,apptoken:s,data:encode64(utf16to8(r)),random:i}}),a=$.parseJSON(o.responseText);return a},et_http.prototype.etAddRoomPerson=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_video/plus_room_person",i=JSON.stringify({roomid:e,userid:t}),s=Math.round((new Date).getTime()/1e3).toString(),o=hex_md5(n.appkey+n.secretkey+s),a=$.ajax({type:"POST",url:r,crossDomain:!0,async:!1,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(i)),random:s}}),l=$.parseJSON(a.responseText);return l},et_http.prototype.etReduceRoomPerson=function(e,t){var n=this,r="http://"+n.http_host+":"+n.http_port+"/webserver_video/reduce_room_person",i=JSON.stringify({roomid:e,userid:t}),s=Math.round((new Date).getTime()/1e3).toString(),o=hex_md5(n.appkey+n.secretkey+s),a=$.ajax({type:"POST",url:r,crossDomain:!0,async:!1,data:{appkey:n.appkey,apptoken:o,data:encode64(utf16to8(i)),random:s}}),l=$.parseJSON(a.responseText);return l};var ServiceType={IM:"IM",IW:"IW",WS:"WS",VS:"VS",FS:"FS",FW:"FW"};et_lb.prototype.etInitConfig=function(e){this.config=e,this.balanceServer&&this.balanceServer!=e.balanceServer&&(this.IW.effectiveTime=0,this.FW.effectiveTime=0,this.WS.effectiveTime=0,this.VS.effectiveTime=0),this.balanceServer=e.balanceServer,"undefine"==e.protocolVer||null==e.protocolVer?this.protocolVer=etGetLBProtocolNo():this.protocolVer=e.protocolVer},et_lb.prototype.etIMInfo=function(e){var t=this,n={config:t.config,service:ServiceType.IW,cb:function(n){var r=n.event;if(0==n.type){if(1==r.version){if(r.ip.indexOf(":")==-1){var r={type:"error",error:{code:-11,message:"没有拿到正确的IM地址"}};return void e(r)}var i=r.ip.split(":");t.IW.im_host=i[0],t.IW.im_port=parseInt(i[1]),t.IW.effectiveTime=r.timeout,t.IW.lastUpdateTime=(new Date).getTime()/1e3}else{if(r.data.indexOf(":")==-1){var r={type:"error",error:{code:-11,message:"没有拿到正确的IM地址"}};return void e(r)}var i=r.data.split(":");t.IW.im_host=i[0],t.IW.im_port=parseInt(i[1])}e(r)}else if(2==n.type){if(!r.error){var r={type:"error",error:{code:-13,message:"LB地址不可用"}};return void e(r)}return void e(r)}}};if(0==t.protocolVer)getServer(n);else{var r=(new Date).getTime()/1e3;r-t.IW.lastUpdateTime<t.IW.effectiveTime?e({type:"message",data:t.IW.im_host+":"+t.IW.im_port}):getServerVer1(n)}},et_lb.prototype.etHttpInfo=function(e){var t=this,n={config:t.config,service:ServiceType.WS,cb:function(n){var r=n.event;if(0==n.type)if(1==r.version){if(r.ip.indexOf(":")==-1){var r={type:"error",error:{code:-12,message:"没有拿到正确的HTTP地址"}};return void e(r)}var i=r.ip.split(":");t.WS.http_host=i[0],t.WS.http_port=i[1],t.WS.effectiveTime=r.timeout,t.WS.lastUpdateTime=(new Date).getTime()/1e3,e(r),t.imCallBack&&t.imCallBack({type:"message",topic:"http",message:r.ip})}else{if(r.data.indexOf(":")==-1){var r={type:"error",error:{code:-12,message:"没有拿到正确的HTTP地址"}};return void e(r)}var i=r.data.split(":");t.WS.http_host=i[0],t.WS.http_port=i[1],e(r),t.imCallBack&&t.imCallBack({type:"message",topic:"http",message:r.data})}else 2==n.type&&(e(r),t.imCallBack&&t.imCallBack({type:"message",topic:"http",message:r.data}))}};if(0==t.protocolVer)getServer(n);else{var r=(new Date).getTime()/1e3;r-t.WS.lastUpdateTime<t.WS.effectiveTime?(e({type:"message"}),t.imCallBack&&t.imCallBack({type:"message",topic:"http",message:t.WS.http_host+":"+t.WS.http_port})):getServerVer1(n)}},et_lb.prototype.etFileInfo=function(e){var t=this,n={config:this.config,service:ServiceType.FW,cb:function(n){var r=n.event;0==n.type?1==r.version?(t.FW.effectiveTime=r.timeout,t.FW.lastUpdateTime=(new Date).getTime()/1e3,t.FW.ip=r.ip,e(r),t.imCallBack&&t.imCallBack({type:"message",topic:"file_ws",message:r.ip})):(t.FW.ip=r.data,e(r),t.imCallBack&&t.imCallBack({type:"message",topic:"file_ws",message:r.data})):2==n.type&&e(r)}};if(0==t.protocolVer)getServer(n);else{var r=(new Date).getTime()/1e3;r-t.FW.lastUpdateTime<t.FW.effectiveTime?(e({type:"message"}),t.imCallBack&&t.imCallBack({type:"message",topic:"file_ws",message:t.FW.ip})):getServerVer1(n)}},et_lb.prototype.etVideoInfo=function(e,t){var n=this;"function"==typeof e&&(t=e);var e={config:this.config,service:ServiceType.VS,cb:function(e){var r=e.event;0==e.type?1==r.version?(n.VS.effectiveTime=r.timeout,n.VS.lastUpdateTime=(new Date).getTime()/1e3,n.VS.ip=r.ip,t(r),n.imCallBack&&n.imCallBack({type:"message",topic:"video",message:r.ip})):(n.VS.ip=r.data,t(r),n.imCallBack&&n.imCallBack({type:"message",topic:"video",message:r.data})):2==e.type&&t(r)}};if(0==n.protocolVer)getServer(e);else{var r=(new Date).getTime()/1e3;r-n.VS.lastUpdateTime<n.VS.effectiveTime?(t({type:"message"}),n.imCallBack&&n.imCallBack({type:"message",topic:"video",message:n.VS.ip})):getServerVer1(e)}};var hexcase=0,chrsz=8,keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",sdkInfo={protocolVersionNo:{lb:1,im:"1.0",file:"0.0",vs:"0.0"},sdkVersionNo:"3.1.0.0",platform:2};!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.buffer=e()}}(function(){return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){(function(t){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
"use strict";function r(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}function i(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,n){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return a(this,e,t,n)}function a(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?f(e,t,n,r):"string"==typeof t?h(e,t,n):p(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number')}function u(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}function c(e,t){if(l(t),e=s(e,t<0?0:0|g(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!o.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|_(t,n);return e=s(e,r),e.write(t,n),e}function d(e,t){var n=0|g(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=d(e,t),e}function p(e,t){if(o.isBuffer(t)){var n=0|g(t.length);return e=s(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||J(t.length)?s(e,0):d(e,t);if("Buffer"===t.type&&Q(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function g(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function m(e){return+e!=e&&(e=0),o.alloc(+e)}function _(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"binary":case"raw":case"raws":return n;case"utf8":case"utf-8":case void 0:return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Y(e).length;default:if(r)return W(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return x(this,t,n);case"binary":return U(this,t,n);case"base64":return R(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function b(e,t,n,r){function i(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,o=e.length,a=t.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,o/=2,a/=2,n/=2}for(var l=-1,u=n;u<o;++u)if(i(e,u)===i(t,l===-1?0:u-l)){if(l===-1&&(l=u),u-l+1===a)return l*s}else l!==-1&&(u-=u-l),l=-1;return-1}function T(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var s=t.length;if(s%2!==0)throw new Error("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[n+o]=a}return o}function S(e,t,n,r){return K(W(t,e.length-n),e,n,r)}function w(e,t,n,r){return K(V(t),e,n,r)}function E(e,t,n,r){return w(e,t,n,r)}function C(e,t,n,r){return K(Y(t),e,n,r)}function A(e,t,n,r){return K(z(t,e.length-n),e,n,r)}function R(e,t,n){return 0===t&&n===e.length?$.fromByteArray(e):$.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s=e[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=n){var l,u,c,h;switch(a){case 1:s<128&&(o=s);break;case 2:l=e[i+1],128===(192&l)&&(h=(31&s)<<6|63&l,h>127&&(o=h));break;case 3:l=e[i+1],u=e[i+2],128===(192&l)&&128===(192&u)&&(h=(15&s)<<12|(63&l)<<6|63&u,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:l=e[i+1],u=e[i+2],c=e[i+3],128===(192&l)&&128===(192&u)&&128===(192&c)&&(h=(15&s)<<18|(63&l)<<12|(63&u)<<6|63&c,h>65535&&h<1114112&&(o=h))}}null===o?(o=65533,a=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),i+=a}return k(r)}function k(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Z));return n}function x(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function U(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function D(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=G(e[s]);return i}function O(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function N(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,r,i,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function P(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function q(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,r,i){return i||q(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,i){return i||q(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(e,t,n,r,52,8),n+8}function H(e){if(e=F(e).replace(ee,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function F(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function G(e){return e<16?"0"+e.toString(16):e.toString(16)}function W(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function V(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function z(e,t){for(var n,r,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}function Y(e){return $.toByteArray(H(e))}function K(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function J(e){return e!==e}var $=e("base64-js"),X=e("ieee754"),Q=e("isarray");n.Buffer=o,n.SlowBuffer=m,n.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:r(),n.kMaxLength=i(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,n){return a(null,e,t,n)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,n){return u(null,e,t,n)},o.allocUnsafe=function(e){return c(null,e)},o.allocUnsafeSlow=function(e){return c(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Q(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=_,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):v.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,n,r,i){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,l=Math.min(s,a),u=this.slice(r,i),c=e.slice(t,n),h=0;h<l;++h)if(u[h]!==c[h]){s=u[h],a=c[h];break}return s<a?-1:a<s?1:0},o.prototype.indexOf=function(e,t,n){if("string"==typeof t?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(t<0&&(t=Math.max(this.length+t,0)),"string"==typeof e&&(e=o.from(e,n)),o.isBuffer(e))return 0===e.length?-1:b(this,e,t,n);if("number"==typeof e)return o.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):b(this,[e],t,n);throw new TypeError("val must be string, number or Buffer")},o.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t=0|t,isFinite(n)?(n=0|n,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return T(this,e,t,n);case"utf8":case"utf-8":return S(this,e,t,n);case"ascii":return w(this,e,t,n);case"binary":return E(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var r;if(o.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=o.prototype;else{var i=t-e;r=new o(i,(void 0));for(var s=0;s<i;++s)r[s]=this[s+e]}return r},o.prototype.readUIntLE=function(e,t,n){e=0|e,t=0|t,n||N(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},o.prototype.readUIntBE=function(e,t,n){e=0|e,t=0|t,n||N(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return t||N(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||N(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||N(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e=0|e,t=0|t,n||N(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e=0|e,t=0|t,n||N(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return t||N(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},o.prototype.readInt16LE=function(e,t){t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||N(e,4,this.length),X.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||N(e,4,this.length),X.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||N(e,8,this.length),X.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||N(e,8,this.length),X.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t=0|t,n=0|n,!r){var i=Math.pow(2,8*n)-1;L(this,e,t,n,i,0)}var s=1,o=0;for(this[t]=255&e;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t=0|t,n=0|n,!r){var i=Math.pow(2,8*n)-1;L(this,e,t,n,i,0)}var s=n-1,o=1;for(this[t+s]=255&e;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t=0|t,!r){var i=Math.pow(2,8*n-1);L(this,e,t,n,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t=0|t,!r){var i=Math.pow(2,8*n-1);L(this,e,t,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t=0|t,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,s=r-n;if(this===e&&n<t&&t<r)for(i=s-1;i>=0;--i)e[i+t]=this[i+n];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e=255&e);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=o.isBuffer(e)?e:W(new o(e,r).toString()),l=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%l]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":2,ieee754:3,isarray:4}],2:[function(e,t,n){"use strict";function r(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)l[t]=e[t],u[e.charCodeAt(t)]=t;u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63}function i(e){var t,n,r,i,s,o,a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[a-2]?2:"="===e[a-1]?1:0,o=new c(3*a/4-s),r=s>0?a-4:a;var l=0;for(t=0,n=0;t<r;t+=4,n+=3)i=u[e.charCodeAt(t)]<<18|u[e.charCodeAt(t+1)]<<12|u[e.charCodeAt(t+2)]<<6|u[e.charCodeAt(t+3)],o[l++]=i>>16&255,o[l++]=i>>8&255,o[l++]=255&i;return 2===s?(i=u[e.charCodeAt(t)]<<2|u[e.charCodeAt(t+1)]>>4,o[l++]=255&i):1===s&&(i=u[e.charCodeAt(t)]<<10|u[e.charCodeAt(t+1)]<<4|u[e.charCodeAt(t+2)]>>2,o[l++]=i>>8&255,o[l++]=255&i),o}function s(e){return l[e>>18&63]+l[e>>12&63]+l[e>>6&63]+l[63&e]}function o(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(s(r));return i.join("")}function a(e){for(var t,n=e.length,r=n%3,i="",s=[],a=16383,u=0,c=n-r;u<c;u+=a)s.push(o(e,u,u+a>c?c:u+a));return 1===r?(t=e[n-1],i+=l[t>>2],i+=l[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=l[t>>10],i+=l[t>>4&63],i+=l[t<<2&63],i+="="),s.push(i),s.join("")}n.toByteArray=i,n.fromByteArray=a;var l=[],u=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array;r()},{}],3:[function(e,t,n){n.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,u=l>>1,c=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=256*s+e[t+h],h+=d,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=r;c>0;o=256*o+e[t+h],h+=d,c-=8);if(0===s)s=1-u;else{if(s===l)return o?NaN:(f?-1:1)*(1/0);o+=Math.pow(2,r),s-=u}return(f?-1:1)*o*Math.pow(2,s-r)},n.write=function(e,t,n,r,i,s){var o,a,l,u=8*s-i-1,c=(1<<u)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),t+=o+h>=1?d/l:d*Math.pow(2,1-h),t*l>=2&&(o++,l/=2),o+h>=c?(a=0,o=c):o+h>=1?(a=(t*l-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+f]=255&o,f+=p,o/=256,u-=8);e[n+f-p]|=128*g}},{}],4:[function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},{}]},{},[1])(1)});var sessionType={audio:"audio",video:"video",share:"share"},commonError={"-1":"执行失败","-2":"内存溢出","-3":"参数错误","-4":"申请内存失败","-5":"不支持的设置","-6":"创建IM锁失败","-7":"账号信息无效","-8":"创建LB socket失败","-9":"解析LB域名失败","-10":"连接LB失败","-11":"获取服务器地址失败","-12":"解析服务器地址失败","-13":"LB失败，协议非法","-14":"LB失败，UID非法","-15":"LB失败，无可用的服务","-16":"解析IM服务器地址失败","-17":"解析Http服务器地址失败","-18":"解析File服务器地址失败","-19":"解析VS服务器地址失败","-20":"LB失败，未知的错误原因","-21":"LB地址未指定"},imError={"-0x1000":"未知错误","-0x1001":"重复登录iLink","-0x1002":"创建iLink socket失败","-0x1003":"连接iLink失败","-0x1004":"UID未指定","-0x1005":"AppKey未指定","-0x1006":"secretkey没有指定","-0x1010":"连接已拒绝，不支持的协议版本","-0x1011":"连接已拒绝，不合格的客户端标识符","-0x1012":"连接已拒绝，服务端不可用","-0x1013":"连接已拒绝，无效的UID或AppKey","-0x1014":"连接已拒绝，未授权或是License授权数不足","-0x1110":"创建外网任务失败","-0x1111":"iLink未连接，API执行失败","-0x1200":"重复启动内网","-0x1201":"初始化内网Socket失败","-0x1202":"获取本地IP失败","-0x1203":"发送内网设备启动通知失败","-0x1204":"创建内网任务失败","-0x1205":"内网连接已达上限","-0x1300":"消息队列已满","-0x1301":"协议解析失败","-0x1302":"接收消息应答超时","-0x1303":"消息发送失败","-0x1304":"Topic不能解析，IM消息解析失败"},httpError={"-0x3000":"未知错误","-0x3001":"封装HTTP数据失败","-0x3002":"数据长度超限","-0x3003":"发送失败","-0x3004":"获取应答数据失败","-0x3005":"解析应答数据失败","-0x3006":"HTTP服务连接失败","-0x3100":"服务器验证失败，无效的apptoken","-0x3101":"服务器验证失败，无效的appkey或secretkey","-0x3102":"服务器base64解码失败","-0x3103":"服务器操作失败，无效的参数","-0x3104":"服务器操作失败，无效的API","-0x3105":"服务器执行数据库操作失败","-0x3106":"无效操作，重复请求","-0x3107":"权限不足","-0x3108":"服务器通知IM失败，操作无效","-0x3109":"数据不存在"},fileError={"-0x2000":"未知错误","-0x2001":"解析文件消息失败","-0x2002":"字段type缺失","-0x2003":"字段fileId缺失","-0x2004":"字段fileName缺失","-0x2005":"字段size缺失","-0x2006":"字段ip缺失ip","-0x2007":"字段port缺失","-0x2100":"不合法的文件消息类型","-0x2200":"初始化文件客户端失败","-0x2201":"连接文件服务器失败","-0x2202":"文件id不合法","-0x2203":"获取文件头信息失败","-0x2204":"文件状态异常","-0x2205":"接收文件内容失败","-0x2206":"执行文件下载回调失败,文件下载回调返回值为失败","-0x2207":"获取上传存储路径失败","-0x2208":"上传失败","-0x2209":"封装文件消息失败","-0x220A":"发送文件消息失败"},avError={"-0x4000":"未知错误","-0x4001":"没有可用的VS服务","-0x4002":"SIP异常 注册失败","-0x4003":"SIP异常 sip库初始化失败","-0x4004":"SIP异常 sip外呼失败","-0x4005":"SIP异常 sip应答失败","-0x4006":"SIP异常 sip挂断失败"};et_cloud.prototype.etConnect=function(e){function t(e){r._imEvent(e)}function n(n){if("message"===n.type){if("auth fail"==n.data){console.log(" auth fail, balance环境初始化失败,密码不正确！");var i={};return i.error={},i.type="error",i.error.message="balance环境初始化失败,密码不正确！",void(r.imCallBack&&r.imCallBack(i))}r.im||(r.im=new et_client.et_client);var s={im_host:r.lb.IW.im_host,im_port:r.lb.IW.im_port,userid:e.userid,appkey:e.appkey,clean:e.clean};r.im.etInitConfig(s),r.im.etConnect(function(n){return"connect"==n.type?(t(n),void r.lb.etHttpInfo(function(i){if("error"==i.type)n.type="http@fail";else if("message"==i.type){n.type="http@success",r.http||(r.http=new et_http);var s={http_host:r.lb.WS.http_host,http_port:r.lb.WS.http_port,appkey:e.appkey,secretkey:e.secretkey,userid:e.userid};r.http.etInitConfig(s),t(n)}})):void t(n)})}else"error"===n.type?(console.log("balance环境初始化失败!"),n=loadbalance_error(n),r.imCallBack&&r.imCallBack(n)):"close"===n.type&&console.log("balance环境断开！")}var r=this;if(r.userid=e.userid,r.appkey=e.appkey,!e.userid||!e.appkey||!e.secretkey||!e.balanceServer||r.isLogin){var i={};return i.error={},i.type="error",e.userid?e.appkey?e.balanceServer?r.isLogin&&(i.error.code="-0x1001",i.error.message=imError[i.error.code]):(i.error.code="-21",i.error.message=commonError[i.error.code]):(i.error.code="-0x1005",i.error.message=imError[i.error.code]):(i.error.code="-0x1004",i.error.message=imError[i.error.code]),void(r.imCallBack&&r.imCallBack(i))}r.lb||(r.lb=new et_lb(t)),"undefine"!=e.balanceProtocolVer&&null!=e.balanceProtocolVer||(e.balanceProtocolVer=etGetLBProtocolNo());var s={protocolVer:e.balanceProtocolVer,balanceServer:e.balanceServer,userid:e.userid};r.lb.etInitConfig(s),r.lb.etIMInfo(n)},et_cloud.prototype.etDisconnect=function(){var e=this;e.isLogin&&(e.av?(e.sessionHangUp(),setTimeout(function(){e.im.etDisconnect(function(e){e||console.log("注销成功！")})},1e3)):e.im.etDisconnect(function(e){e||console.log("注销成功！")}),closeAllchannels())},et_cloud.prototype.etChatTo=function(e,t){var n=this;return""==e.userid?void alert("请选择一个聊天对象"):void(n.isLogin&&n.im&&""!=e.message&&""!=e.userid&&e.message&&e.userid&&n.im.etChatTo(e,t))},et_cloud.prototype.etGetOtherUserStatus=function(e,t){var n=this;return""==e.userid?void alert("请选择一个聊天对象"):void(n.isLogin&&n.im&&""!=e.message&&""!=e.userid&&e.message&&e.userid&&""!=e.message&&n.im.etGetUserStatus(e,t))},et_cloud.prototype.etGetUserStatus=function(e,t){var n=this;return""==e.userid?void alert("请选择一个聊天对象"):void(n.isLogin&&n.im&&""!=e.message&&""!=e.userid&&e.message&&e.userid&&""!=e.message&&n.im.etGetUserStatus(e,t))},et_cloud.prototype.etGetBuddysEx=function(e,t){var n=this;if(e.require&&""!=e.require){if(!n.isLogin)return;if(!n.im)return;n.im.etGetBuddysEx(e,t)}else alert("require 参数不能为空")},et_cloud.prototype.etChatToEx=function(e,t){var n=this;n.etChatToJson(e,t)},et_cloud.prototype.etChatToJson=function(e,t){var n=this;if(""==e.userid)return void alert("请选择一个聊天对象");if(n.isLogin&&n.im&&""!=e.message&&""!=e.userid&&e.message&&e.userid){var r=Math.round((new Date).getTime()/1e3),i={userid:e.userid,message:{content:e.message,nickname:n.nickName,datetime:r}};n.im.etChatToJson(i,t)}},et_cloud.prototype.etChatToByte=function(e,t){var n=this;return""==e.userid?void alert("请选择一个聊天对象"):void(n.isLogin&&n.im&&""!=e.message&&""!=e.userid&&e.message&&e.userid&&(e={userid:e.userid,message:new buffer.Buffer(e.message)},n.im.etChatTo(e,t)))},et_cloud.prototype.etSubscribeAllBuddies=function(e){var t=this;e||(e=function(e){e&&t._imErrorCallBack("订阅所有好友失败",e)}),t.isLogin&&t.im&&t.im.etSubscribeAllBuddies(e)},et_cloud.prototype.etSubscribe=function(e,t){var n=this;t||(t=function(e){e&&n._imErrorCallBack("subscribe 消息发送失败",e)}),n.isLogin&&n.im&&""!=e&&e&&n.im.etSubscribePrefix(e,t)},et_cloud.prototype.etUnSubscribeAllBuddies=function(e){var t=this;e||(e=function(e){e&&t._imErrorCallBack("取消全部好友订阅失败",e)}),t.isLogin&&t.im&&t.im.etUnSubscribeAllBuddies(e)},et_cloud.prototype.etUnsubscribe=function(e,t){var n=this;t||(t=function(e){e&&n._imErrorCallBack("取消订阅失败",e)}),n.isLogin&&n.im&&""!=e&&e&&n.im.etUnsubscribePrefix(e,t)},et_cloud.prototype.getFileServer=function(e){var t=this;t.isLogin&&t.lb&&(e||(e=function(e){e&&t._imErrorCallBack("getFileServer 消息发送失败",e)}),t.lb.etFileInfo(e))},et_cloud.prototype.etOfflineMessage=function(e){var t=this;e||(e=function(e){e&&t._imErrorCallBack("获取离线消息失败",e)}),t.isLogin&&t.im&&t.im.etOfflineMessage(e)},et_cloud.prototype.etStateSubscribe=function(e,t){var n=this;t||(t=function(e){e&&n._imErrorCallBack("订阅用户在线状态失败",e)}),n.isLogin&&n.im&&""!=e.userid&&e.userid&&n.im.etStateSubscribe(e,t)},et_cloud.prototype.etStateUnsubscribe=function(e,t){var n=this;t||(t=function(e){e&&n._imErrorCallBack("取消订阅用户在线状态失败",e)}),n.isLogin&&n.im&&""!=e.userid&&e.userid&&n.im.etStateUnsubscribe(e,t)},et_cloud.prototype.getVideoServer=function(e){var t=this;t.isLogin&&t.lb&&(e||(e=function(e){e&&t._imErrorCallBack("getVideoServer 消息发送失败",e)}),t.lb.etVideoInfo(e))},et_cloud.prototype.etPublish=function(e,t){var n=this;t||(t=function(e){e&&n._imErrorCallBack("publish 消息发送失败，发布主题失败",e)}),n.isLogin&&n.im&&""!=e.topic&&e.topic&&n.im.etPublishPrefix(e,t)},et_cloud.prototype.etPublishToGroup=function(e,t){var n=this;if(t||(t=function(e){e&&n._imErrorCallBack("publish 消息发送失败，发布主题失败",e)}),n.isLogin&&n.im&&""!=e.groupid&&e.groupid&&""!=e.message&&e.message){var r={topic:e.groupid,message:e.message};n.im.etPublish(r,t)}},et_cloud.prototype.etGetBuddys=function(e){var t=this;t.isLogin&&t.http&&t.http.etGetBuddys(function(t,n){http_callback(t,n,e)})},et_cloud.prototype.etAddUsers=function(e,t){var n=this;if(!n.isLogin){n.lb||(n.lb=new et_lb);var r={balanceServer:e.balanceServer,userid:"FcUuAGdaymBVtArB12eZ4tPJ4kE8sJPv3w"};return n.lb.etInitConfig(r),void n.lb.etHttpInfo(function(r){if("error"==r.type)t(r);else if("message"==r.type){var i=new et_http,s={http_host:n.lb.WS.http_host,http_port:n.lb.WS.http_port,appkey:e.appkey,secretkey:e.secretkey};i.etInitConfig(s),i.etAddUsers(e,function(e,n){http_callback(e,n,t)})}})}n.http&&n.http.etAddUsers(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etAddBuddy=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etAddBuddy(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etAddBuddyEx=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etAddBuddyEx(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etDeleteBuddy=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etDeleteBuddy(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etDeleteBuddyEx=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etDeleteBuddyEx(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etCreateGroup=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etCreateGroup(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etGetGroups=function(e){var t=this;t.isLogin&&t.http&&t.http.etGetGroups(function(t,n){http_callback(t,n,e)})},et_cloud.prototype.etLogoutGroup=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etLogoutGroup(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etReleaseGroup=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etReleaseGroup(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etAddGroupMember=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etAddGroupMember(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etGetGroupMembers=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etGetGroupMembers(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etDeleteGroupMember=function(e,t){var n=this;n.isLogin&&n.http&&n.http.etDeleteGroupMember(e,function(e,n){http_callback(e,n,t)})},et_cloud.prototype.etTokenAll=function(e){var t=this;e||(e=function(e){e&&t._imErrorCallBack("etTokenAll",e)});var n={topic:"token@all",message:""};t.isLogin&&t.im&&t.im.etPublish(n,e)},et_cloud.prototype._imEvent=function(e){var t=this;if("message"===e.type){if("video"===e.topic){var n=$.parseJSON(e.message.toString());return t.sipServer=n.video.sipServer,t.wsServer=n.video.wsServer,t.iceServer=n.video.iceServers,void(t.sessionType==sessionType.share?t.initAV():t._requestVideo())}if("svideo"===e.topic){var n=$.parseJSON(e.message.toString());if("request"===n.type){if(t.isTalking)return void t.byeVideo("busy");t.sipServer=n.ip,
t.wsServer=n.ws,t.iceServer=n.ice,t.sessionType=n.sessionType,t.isCaller=!1,t.target=e.from_userid,t.lastRoomID=n.room}else"accept"===n.type?t.isCaller&&(t.sdkVersion=n.sdkVersion,t.initAV()):"success"===n.type?(t.av.isOtherSuccess=!0,t._startCall()):"bye"===n.type&&(t.av&&(t.av.isOtherSuccess=!1),t.sessionHangUp(),t.isTalking=!1,"kick"==n.cause&&(t.lastRoomID=""));return e.type=e.topic,void t.avCallBack(e)}if("file_ws"===e.topic)return t.fileServer="ws://"+e.message.toString(),setInitChannelEvent(function(){t._initFileClient(t)}),void t._etAddFileToUploadQueues(t.fileList.shift());if("sfile"===e.topic)return e.type=e.topic,void t.fileCallBack(e);"token"===e.topic?(t.token=e.message.toString(),console.log(t.token)):0==e.topic.indexOf(et_client.pubPrefix)&&(e.topic=e.topic.substr(2))}else"connect"===e.type?t.isLogin=!0:"offline"===e.type||"close"===e.type?(t.isLogin=!1,t.http=null,t.im=null,t.av=null):"error"===e.type&&e.error&&("Connection refused: Unacceptable protocol version"==e.error.message?(e.error.code="-0x1010",e.error.message=imError[e.error.code]):"Connection refused: Identifier rejected"==e.error.message?(e.error.code="-0x1011",e.error.message=imError[e.error.code]):"Connection refused: Server unavailable"==e.error.message?(e.error.code="-0x1012",e.error.message=imError[e.error.code]):"Connection refused: Bad username or password"==e.error.message?(e.error.code="-0x1013",e.error.message=imError[e.error.code]):"Connection refused: Not authorized"==e.error.message?(e.error.code="-0x1014",e.error.message=imError[e.error.code]):"can not parse im protocols"==e.error.message&&(e.error.code="-0x1304",e.error.message=imError[e.error.code]));t.imCallBack&&t.imCallBack(e)},et_cloud.prototype._imErrorCallBack=function(e,t){var n=this;console.log(e);var r={};r.type="error",r.message=e,r.error=t,n.imCallBack&&n.imCallBack(r)},et_cloud.prototype.initAV=function(){var e=this;if(!e.av){var t={logDebug:!0,ua_events_listener:function(t){e._avEvent(t)},session_events_listener:function(t){e._avEvent(t)},pcConfig:{iceServers:e.iceServer,gatheringTimeout:2e3},sip_ua:{uri:"sip:"+e.userid+"@"+e.sipServer,password:"asdf",ws_servers:e.wsServer,display_name:"ETSip_"+e.userid,authorization_user:e.userid,register:!0,register_expires:600,registrar_server:"sip:"+e.sipServer,no_answer_timeout:60,session_timers:!0,connection_recovery_min_interval:2,connection_recovery_max_interval:30}};if(e.av=new et_av.et_av(t),!e.av.hasWebRTC()&&confirm("您的浏览器不支持WebRTC，安装插件WebRTC4all.exe可以解决问题，需要安装吗."))return void(window.location="http://code.google.com/p/webrtc4all/downloads/list");e.av.start()}},et_cloud.prototype._avEvent=function(e){var t=this,n=e.type;switch(n){case"newRTCSession":break;case"registered":console.log("UA State: "+n),t.av.isRegisted=!0,t.sessionType==sessionType.share?t._join():t.isCaller?t._startCall():t._successVideo();break;case"unregistered":console.log("UA State: "+n),t.av.isRegisted=!1;break;case"registrationFailed":console.log("UA State: "+n),t.av.isRegisted=!1,t.isCaller?e.message="向服务器注册失败":t.byeVideo("regfail"),t.isTalking=!1,t.av.isOtherSuccess=!1;break;case"progress":"incoming"===e.session.direction&&t.sessionAnswer();break;case"accepted":t.sessionType!=sessionType.audio?e.video_local=t.selfView:e.video_local=t.selfAudio;break;case"addstream":t.sessionType!=sessionType.audio?e.video_remote=t.remoteView:e.video_remote=t.remoteAudio;break;case"failed":var r=e.cause;"User Denied Media Access"==r&&(e.message="拒绝媒体访问，视频或语音设备不可用。"),t.isTalking=!1,t.av.isOtherSuccess=!1,t.av=null;break;case"ended":t.isTalking=!1,t.sessionType!=sessionType.share&&t.byeVideo("ok")}t.avCallBack&&t.avCallBack(e)},et_cloud.prototype.sipRegister=function(){var e=this;e.av.register()},et_cloud.prototype.sipUnRegister=function(){var e=this;e.av.unregister()},et_cloud.prototype.etStartCall=function(e,t,n){var r=this;return r.isLogin?""==e?void alert("请选择聊天对象"):void(r.isTalking||(r.sessionType=t,r.target=e,r.sessionType==sessionType.share&&(r.lastRoomID=e),r.isCaller=!0,r.isTalking=!0,r.getVideoServer(function(e){if(e){if("error"==e.type)r.isTalking=!1,e=loadbalance_error(e);else{if("close"==e.type)return;if("message"==e.type)return void(n&&n())}r.avCallBack&&r.avCallBack(e)}}))):void alert("未登录，请先登录IM！")},et_cloud.prototype._startCall=function(){var e=this;if(e.isCaller&&e.av.isRegisted&&e.av.isOtherSuccess){var t={mediaConstraints:{audio:!0,video:e.sessionType!=sessionType.audio}},n=e.target;e.sdkVersion&&e.sdkVersion.toLowerCase().indexOf("javascript")!=-1&&e.sessionType!=sessionType.share&&(n="p2p"+n),e.av.call(n,t)}},et_cloud.prototype.etEndCall=function(){var e=this;e.isTalking=!1,e.av?e.av.isOtherSuccess=!1:e.byeVideo("reject"),e.sessionHangUp()},et_cloud.prototype._requestVideo=function(){var e=this,t={type:"request",ip:e.sipServer,ws:e.wsServer,ice:e.iceServer,sessionType:e.sessionType},n={userid:e.target,message:JSON.stringify(t)};e.im.etVideoTo(n,function(t){t&&e._imErrorCallBack("_requestVideo 消息发送失败",t)})},et_cloud.prototype._successVideo=function(){var e=this,t={type:"success"},n={userid:e.target,message:JSON.stringify(t)};e.im.etVideoTo(n,function(t){t&&e._imErrorCallBack("successVideo 消息发送失败",t)})},et_cloud.prototype.etAgreeCall=function(e){var t=this,n={type:"accept",sdkVersion:this.etGetSDKVersion()},r={userid:t.target,message:JSON.stringify(n)};t.im.etVideoTo(r,function(n){return n?void t._imErrorCallBack("agreeVideo 消息发送失败",n):(t.initAV(),void(e&&e()))})},et_cloud.prototype.byeVideo=function(e){var t=this;if(t.im){var n={type:"bye",cause:e},r={userid:t.target,message:JSON.stringify(n)};t.im.etVideoTo(r,function(e){e&&t._imErrorCallBack("byeVideo 消息发送失败",e)})}},et_cloud.prototype.sessionAnswer=function(){var e=this,t={mediaConstraints:{audio:!0,video:e.sessionType!=sessionType.audio}};e.av.answer(t)},et_cloud.prototype.sessionHangUp=function(){var e=this;if(e.isLogin&&(e.av&&(e.av.hangup(),e.av.unregister(),setTimeout(function(){e.av&&(e.av.stop(),e.av=null)},500)),e.sessionType==sessionType.share)){if(!e.http)return;var t=e.http.etSelectRoom(e.lastRoomID);if(!t)throw new TypeError("self.im.etSelectRoom HTTP error");if(0!=t.ret)throw new TypeError(t.message);e.http.etReduceRoomPerson(e.lastRoomID,e.userid)}},et_cloud.prototype.etSessionCloseAudio=function(){var e=this,t={audio:!0,video:!1};e.av.mute(t)},et_cloud.prototype.etSessionOpenAudio=function(){var e=this,t={audio:!0,video:!1};e.av.unmute(t)},et_cloud.prototype.etSessionCloseVideo=function(){var e=this,t={audio:!1,video:!0};e.av.mute(t)},et_cloud.prototype.etSessionOpenVideo=function(){var e=this,t={audio:!1,video:!0};e.av.unmute(t)},et_cloud.prototype._initFileClient=function(e){var t=this,n=new etcjs_file_channel;n.filecount=0,n.filecomplet=0,n.connected=function(t){console.log("连接文件服务器成功"),e.fileCallBack&&e.fileCallBack(t)},n.disposed=function(t){n=null,console.log("文件服务器,连接已断开"),e.fileCallBack&&e.fileCallBack(t)},n.error=function(t){n=null,console.log("连接文件服务出错!"),e.fileCallBack&&e.fileCallBack(t)},n.fileUpLoadCallBack=function(n){var r=this;console.log("文件上传成功");var i=r._fileInfo.descn;"undefined"==typeof i||null==i?n.descn="":n.descn=i,"undefined"!=typeof n.crc&&null!=n.crc||(n.crc=""),"undefined"!=typeof n.url&&null!=n.url||(n.url="");var s={userid:r._fileInfo.toUserid,message:JSON.stringify(n)};t.im.etFileTo(s,function(e){e&&alert(e)}),document.getElementById(r._fileInfo.progressLabel)&&(document.getElementById(r._fileInfo.progressLabel).innerHTML="100% ("+n.fileName+")",document.getElementById(r._fileInfo.progressbarValue).style.width="100%",document.getElementById(r._fileInfo.progressLabel).innerHTML=n.fileName+" 发送完成！");var o={};o.type="success",o.fileInfo=r._fileInfo,o.value=100,e.fileCallBack&&e.fileCallBack(o)},n.fileUpLoadFailCallBack=function(t){var n=this;console.log(t.fileName+" 发送失败！code:"+t.returncode),document.getElementById(n._fileInfo.progressLabel).innerHTML=t.fileName+" 发送失败！";var r={};r.type="fail",r.fileInfo=n._fileInfo,e.fileCallBack&&e.fileCallBack(r)},n.fileDeleteCallBack=function(e){console.log(e)},n.connect(e.fileServer)},et_cloud.prototype.etGetFileInfo=function(e){return new etcjs_FileInfo(e,4096)},et_cloud.prototype.etAddFileToUploadQueues=function(e){var t=this;return t.isLogin?(t.fileList.push(e),void t.getFileServer(function(e){if("error"==e.type)e=loadbalance_error(e);else{if("close"==e.type)return;if("message"==e.type)return}t.fileCallBack&&t.fileCallBack(e)})):void alert("未登录，请先登录IM！")},et_cloud.prototype._etAddFileToUploadQueues=function(e){if(e){var t=this;addFileToUploadQueues(e,function(n){var r=Math.round(n.uploadBytes/n.size*100);document.getElementById(e.progressLabel)&&(document.getElementById(e.progressLabel).innerHTML=r+"% ("+e.fileName+")",document.getElementById(e.progressbarValue).style.width=r+"%"),t.fileCallBack({type:"progress",fileInfo:e,value:r})})}},et_cloud.prototype.etGetSDKVersion=function(){return etGetSDKVersion()},et_cloud.prototype.etCreateRoomID=function(e,t){var n=this;if(n.isLogin&&n.http){var r=n.http.etCreateRoom(e,t);if(!r)throw new TypeError("self.im.etCreateRoom HTTP error!");if(0!=r.ret)throw new TypeError(r.message);n.etJoin(r.roomid)}},et_cloud.prototype.etCreateRoom=function(e,t){var n=this;if(n.isLogin&&n.http){var r=n.http.etCreateRoom(e,t);if(!r)throw new TypeError("self.im.etCreateRoom HTTP error!");if(0!=r.ret)throw new TypeError(r.message);n.lastRoomID=r.roomid,n.etStartCall(r.roomid,sessionType.share)}},et_cloud.prototype.etJoin=function(){var e=this;e.initAV()},et_cloud.prototype._join=function(){var e=this;if(e.isLogin){var t={mediaConstraints:{audio:!0,video:e.sessionType!=sessionType.audio}},n="room_"+e.lastRoomID;if(e.av.call(n,t),e.http){var r=e.http.etSelectRoom(e.lastRoomID);if(!r)throw new TypeError("self.im.etSelectRoom HTTP error");if(0!=r.ret)throw new TypeError(r.message);e.im.etAddRoomPerson(e.lastRoomID,e.userid)}}},et_cloud.prototype.etInvite=function(e,t,n){var r=this,i={type:"request",ip:r.sipServer,ws:r.wsServer,ice:r.iceServer,sessionType:r.sessionType,room:r.lastRoomID,userlist:e,forceOtherAgree:t||0,allowOtherShare:n||1},s={userid:"room",message:JSON.stringify(i)};r.im.etVideoTo(s,function(e){e&&r._imErrorCallBack("_requestVideo 消息发送失败",e)})},et_cloud.prototype.etKick=function(e){var t=this;t.byeVideo("kick")},et_cloud.prototype.etShare=function(){var e=this,t=["X-Foo: foo","X-Bar: bar"],n={duration:160,interToneGap:1200,extraHeaders:t};e.av.session.sendDTMF("#",n)},et_cloud.prototype.etLeave=function(){var e=this;e.sessionHangUp()};
//# sourceMappingURL=ilink-js-sdk.min.js.map
